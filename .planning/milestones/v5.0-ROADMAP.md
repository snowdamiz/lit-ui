# Milestone v5.0: Overlay & Feedback Components

**Status:** SHIPPED 2026-02-02
**Phases:** 51-55
**Total Plans:** 11

## Overview

This milestone added three overlay/feedback primitives -- Toast, Tooltip, and Popover -- built on a shared Floating UI positioning utility in `@lit-ui/core`. The build order followed dependency chains: shared infrastructure first, then Tooltip (simplest overlay, establishes patterns), Popover (adds focus management and click triggers), Toast (most complex, independent architecture), and finally documentation for all three components.

## Phases

### Phase 51: Shared Infrastructure

**Goal**: Developers have a reliable positioning foundation that handles Shadow DOM correctly, so Tooltip and Popover can build on proven utilities
**Depends on**: Nothing (first phase of milestone)
**Plans**: 2 plans

Plans:
- [x] 51-01-PLAN.md — Floating UI wrapper with Shadow DOM platform fix (`@lit-ui/core/floating` entry point)
- [x] 51-02-PLAN.md — CSS design tokens for tooltip/popover/toast and overlay animation pattern

**Details:**
- Created `@lit-ui/core/floating` export wrapping `@floating-ui/dom` with `composed-offset-position` ponyfill for Shadow DOM-safe positioning
- Bundled Floating UI into core (28KB / 8.7KB gzipped) for zero-config DX
- Added 37 CSS custom properties (`--ui-toast-*`, `--ui-tooltip-*`, `--ui-popover-*`) with dark mode overrides
- Created overlay animation reference using `@starting-style` + `transition-behavior: allow-discrete`
- Token objects added to `@lit-ui/core/tokens` for programmatic access

### Phase 52: Tooltip

**Goal**: Users can wrap any element with `<lui-tooltip>` to display accessible, well-positioned hint text on hover and keyboard focus
**Depends on**: Phase 51
**Plans**: 2 plans

Plans:
- [x] 52-01-PLAN.md — Tooltip package scaffolding, delay group module, and full tooltip component implementation (TIP-01 through TIP-16)
- [x] 52-02-PLAN.md — CLI registry entry, copy-source template, and full workspace build verification (TIP-17)

**Details:**
- Complete `@lit-ui/tooltip` package (9.82 KB / 2.76 KB gzipped)
- Hover/focus triggers with configurable delay (300ms default), hide delay (100ms), touch filtering
- Floating UI positioning with 12 placements, flip/shift collision avoidance, arrow indicator
- Delay group singleton for skip-delay behavior between adjacent tooltips
- Rich variant with title + description
- Full ARIA: role="tooltip", aria-describedby, Escape dismissal
- `tooltipTitle` property to avoid HTMLElement.title conflict
- JSX type declarations for React, Vue, Svelte
- CLI registry entry with 2-file copy-source template (tooltip + delay-group) with inlined shadowDomPlatform

### Phase 53: Popover

**Goal**: Users can create interactive overlay content that opens on click, manages focus correctly, and supports nesting
**Depends on**: Phase 51
**Plans**: 2 plans

Plans:
- [x] 53-01-PLAN.md — Popover package scaffolding and full component implementation (POP-01 through POP-17)
- [x] 53-02-PLAN.md — CLI registry entry, copy-source template, and full workspace build verification (POP-18)

**Details:**
- Complete `@lit-ui/popover` package (12.04 KB / 3.56 KB gzipped)
- Click-to-toggle trigger with Escape and light dismiss (click outside)
- Native Popover API integration (`popover="auto"`) with position:fixed fallback
- Imperative showPopover()/hidePopover() due to shadow DOM spec limitation
- Focus management: focus to content on open, return to trigger on close
- Modal mode with sentinel-based focus trapping
- Nested popover support with cascade close via custom event
- Controlled (`open` + `open-changed`) and uncontrolled modes
- Trigger width matching via CSS custom property
- CLI registry entry with single-file copy-source template including size middleware

### Phase 54: Toast

**Goal**: Developers can trigger toast notifications from any framework using a simple imperative API, with queuing, auto-dismiss, swipe gestures, and full accessibility
**Depends on**: Phase 51 (CSS tokens and animation patterns; no Floating UI dependency)
**Plans**: 2 plans

Plans:
- [x] 54-01-PLAN.md — Toast package scaffolding, state manager, imperative API, and full component implementation (TOAST-01 through TOAST-19)
- [x] 54-02-PLAN.md — CLI registry entry, copy-source templates, and full workspace build verification (TOAST-20)

**Details:**
- Complete `@lit-ui/toast` package (21.23 KB / 4.97 KB gzipped)
- Imperative API: `toast()`, `toast.success()`, `toast.error()`, `toast.warning()`, `toast.info()`, `toast.dismiss()`, `toast.dismissAll()`, `toast.promise()`
- Singleton state manager with observer pattern decoupling API from rendering
- `<lui-toaster>` auto-creates on first toast call, uses `popover="manual"` for top-layer
- 6 position options, configurable maxVisible (default 3), queue management
- 5 variants (success/error/warning/info/default) with distinct colors and icons
- Auto-dismiss with configurable duration, pause on hover/focus
- Swipe-to-dismiss via Pointer Events with velocity threshold
- Action buttons, promise mode (loading → success/error transitions)
- Accessible: role="status"/aria-live="polite" for info, role="alert"/aria-live="assertive" for errors
- @starting-style entry animations, prefers-reduced-motion support
- CLI registry entry with 6 copy-source templates using namespaced keys and CSS fallback values

### Phase 55: Documentation

**Goal**: All three overlay components have complete documentation pages with usage examples, API references, and accessibility notes
**Depends on**: Phase 52, Phase 53, Phase 54
**Plans**: 3 plans

Plans:
- [x] 55-01-PLAN.md — Wiring: package deps, LivePreview imports/types, nav entries, routes, PrevNextNav chain fixes
- [x] 55-02-PLAN.md — Tooltip and Popover documentation pages with interactive examples and API reference
- [x] 55-03-PLAN.md — Toast documentation page with imperative API docs and interactive button demos

**Details:**
- TooltipPage.tsx (570 lines): 4 interactive examples, 9 props, 3 slots, 10 CSS vars, 4 CSS parts
- PopoverPage.tsx (664 lines): 4 interactive examples including controlled mode, 7 props, 2 slots, 1 event, 9 CSS vars, 4 CSS parts
- ToastPage.tsx (766 lines): imperative API reference, 4 button-click demos, 21 CSS custom properties, accessibility table
- Nav updated to 15 component entries in alphabetical order
- PrevNextNav chain fully connected
- CLI registry verified at 15 total components

---

## Milestone Summary

**Key Decisions:**

- Bundle @floating-ui/dom into @lit-ui/core/floating (zero-config DX for consumers)
- Toast variant colors use OKLCH with inverted lightness for dark mode
- overlay-animation.css is a copy-paste reference, not an imported module
- tooltipTitle property avoids HTMLElement.title conflict
- Tooltip uses position:fixed without Popover API (z-index:50 sufficient for non-interactive)
- Copy-source templates inline shadowDomPlatform (no @lit-ui/core dependency in copy mode)
- Popover uses imperative showPopover()/hidePopover() (shadow DOM spec limitation)
- Modal popover uses sentinel divs for focus trapping (not dialog showModal())
- Toast uses module-level singleton state manager with observer pattern
- Toaster uses popover=manual for top-layer rendering
- Toast template keys use componentName/fileStem namespaced pattern
- Copy-source templates include CSS var() fallbacks for standalone usage

**Issues Resolved:**

- api-extractor couldn't resolve Map symbol in updated() — fixed with PropertyValues type
- Template string escaping issues in tooltip copy-source — corrected to match existing patterns
- copy-component.ts lookup couldn't find namespaced template keys — added componentName/fileStem lookup

**Issues Deferred:**

- None new. Pre-existing: 30 CLI tests need update for CSS variable naming (from v3.0)
- CLI registry.json incorrect time-picker→calendar dependency (from v4.3)

**Technical Debt Incurred:**

- Toast entry animation uses @starting-style; exit uses instant removal (animated exit can be added later)
- Docs app has pre-existing TS errors for date-picker, date-range-picker, time-picker module declarations

---

_For current project status, see .planning/MILESTONES.md_
