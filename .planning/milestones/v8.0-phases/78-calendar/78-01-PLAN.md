---
phase: 78-calendar
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - packages/core/src/styles/tailwind.css
autonomous: true
requirements:
  - CAL-01

must_haves:
  truths:
    - "Calendar dark mode appearance is governed by semantic .dark token cascade; all 10 hardcoded .dark --ui-calendar-* declarations removed"
    - "No --ui-calendar-* declarations remain in the .dark block"
    - "The :root calendar token block is updated with tooltip-bg and tooltip-text tokens (used in calendar.ts but previously undeclared in :root)"
  artifacts:
    - path: "packages/core/src/styles/tailwind.css"
      provides: "Calendar .dark block cleared; :root tooltip tokens added"
      contains: "/* Calendar Component */"
  key_links:
    - from: "packages/core/src/styles/tailwind.css (.dark block)"
      to: "packages/core/src/styles/tailwind.css (:root block)"
      via: "double-fallback var() cascade"
      pattern: "var\\(--color-background,|var\\(--color-foreground,|var\\(--color-primary,"
---

<objective>
Remove all 10 hardcoded .dark --ui-calendar-* declarations from tailwind.css — every token's :root definition uses a double-fallback var() that correctly resolves through the .dark semantic overrides. Also add --ui-calendar-tooltip-bg and --ui-calendar-tooltip-text to the :root block (they are used in calendar.ts but are currently undeclared, so their dark behavior is undefined).

Purpose: Calendar dark mode currently duplicates logic already handled by the semantic .dark cascade. Unlike checkbox/switch which had a hardcoded 'white' exception, every calendar color token in :root uses var(--color-*,...) — the .dark block already overrides --color-primary, --color-background, --color-foreground, --color-muted, --color-muted-foreground, --color-border, and --color-ring, so all 10 .dark calendar declarations are redundant.

Output: `packages/core/src/styles/tailwind.css` — .dark calendar block removed (10 declarations); 2 tooltip tokens added to :root calendar block
</objective>

<execution_context>
@/Users/sn0w/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sn0w/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/77-switch/77-01-SUMMARY.md

<interfaces>
<!-- Current .dark calendar block in tailwind.css (lines ~207-216): -->
```css
  /* Calendar dark mode overrides */
  --ui-calendar-bg: var(--color-gray-950);
  --ui-calendar-text: var(--color-gray-50);
  --ui-calendar-border: var(--color-gray-800);
  --ui-calendar-hover-bg: var(--color-gray-800);
  --ui-calendar-weekday-color: var(--color-gray-400);
  --ui-calendar-nav-color: var(--color-gray-50);
  --ui-calendar-today-border: 2px solid var(--color-brand-300);
  --ui-calendar-selected-bg: var(--color-brand-50);
  --ui-calendar-selected-text: var(--color-brand-900);
  --ui-calendar-focus-ring: var(--color-brand-300);
```

<!-- Calendar :root color tokens (lines ~839-859) — source of truth for cascade analysis: -->
```css
  --ui-calendar-bg: var(--color-background, #ffffff);
  --ui-calendar-text: var(--color-foreground, var(--ui-color-foreground));
  --ui-calendar-border: var(--color-border, #e5e7eb);
  --ui-calendar-hover-bg: var(--color-muted, #f3f4f6);
  --ui-calendar-weekday-color: var(--color-muted-foreground, #6b7280);
  --ui-calendar-nav-color: var(--color-foreground, currentColor);
  --ui-calendar-today-border: 2px solid var(--color-primary, var(--ui-color-primary));
  --ui-calendar-selected-bg: var(--color-primary, var(--ui-color-primary));
  --ui-calendar-selected-text: var(--color-primary-foreground, white);
  --ui-calendar-focus-ring: var(--color-ring, var(--ui-color-ring));
```

<!-- .dark block semantic overrides (lines ~172-203) that make cascade work: -->
```css
.dark {
  --color-primary: var(--color-brand-50);             /* selected-bg & today-border cascade through this */
  --color-primary-foreground: var(--color-brand-900); /* selected-text cascades through this */
  --color-muted: var(--color-gray-800);               /* hover-bg cascades */
  --color-muted-foreground: var(--color-gray-400);    /* weekday-color cascades */
  --color-background: var(--color-gray-950);          /* bg cascades */
  --color-foreground: var(--color-gray-50);           /* text and nav-color cascade */
  --color-border: var(--color-gray-800);              /* border cascades */
  --color-ring: oklch(0.55 0 0);                      /* focus-ring cascades */
}
```

<!-- Cascade analysis — all 10 are removable (no 'white' hardcoded exception unlike checkbox/switch):
  - bg: :root = var(--color-background,...) → .dark sets --color-background → REMOVE
  - text: :root = var(--color-foreground,...) → .dark sets --color-foreground → REMOVE
  - border: :root = var(--color-border,...) → .dark sets --color-border → REMOVE
  - hover-bg: :root = var(--color-muted,...) → .dark sets --color-muted → REMOVE
  - weekday-color: :root = var(--color-muted-foreground,...) → .dark sets that → REMOVE
  - nav-color: :root = var(--color-foreground,...) → .dark sets --color-foreground → REMOVE
  - today-border: :root = 2px solid var(--color-primary,...) → .dark sets --color-primary: var(--color-brand-50) → REMOVE
  - selected-bg: :root = var(--color-primary,...) → .dark sets --color-primary: var(--color-brand-50) → REMOVE
  - selected-text: :root = var(--color-primary-foreground, white) → .dark sets --color-primary-foreground: var(--color-brand-900) → REMOVE
  - focus-ring: :root = var(--color-ring,...) → .dark sets --color-ring → REMOVE
-->

<!-- Missing tooltip tokens used in calendar.ts but not declared in :root (lines ~387-388 of calendar.ts):
  background: var(--ui-calendar-tooltip-bg);
  color: var(--ui-calendar-tooltip-text);
  These need to be added to :root so dark mode tooltip colors have a defined fallback.
-->
</interfaces>
</context>

<tasks>

<task type="auto">
  <name>Task 1: Remove .dark calendar block and add tooltip tokens to :root</name>
  <files>packages/core/src/styles/tailwind.css</files>
  <action>
Make two edits to `packages/core/src/styles/tailwind.css`:

**Edit 1 — Remove the .dark calendar block entirely.**

Find and delete the following 11-line block in the `.dark` rule (comment + 10 declarations):

```css
  /* Calendar dark mode overrides */
  --ui-calendar-bg: var(--color-gray-950);
  --ui-calendar-text: var(--color-gray-50);
  --ui-calendar-border: var(--color-gray-800);
  --ui-calendar-hover-bg: var(--color-gray-800);
  --ui-calendar-weekday-color: var(--color-gray-400);
  --ui-calendar-nav-color: var(--color-gray-50);
  --ui-calendar-today-border: 2px solid var(--color-brand-300);
  --ui-calendar-selected-bg: var(--color-brand-50);
  --ui-calendar-selected-text: var(--color-brand-900);
  --ui-calendar-focus-ring: var(--color-brand-300);
```

Why all 10 are removed: every :root value uses `var(--color-*)` double-fallback form; the `.dark` block already overrides all the referenced semantic tokens (`--color-primary`, `--color-primary-foreground`, `--color-background`, `--color-foreground`, `--color-muted`, `--color-muted-foreground`, `--color-border`, `--color-ring`). Unlike checkbox/switch which had a hardcoded `white` exception, no calendar token has a hardcoded non-var :root value.

**Edit 2 — Add tooltip tokens to the :root calendar block.**

In the `:root` block, find the calendar section's focus ring line:
```css
  --ui-calendar-focus-ring: var(--color-ring, var(--ui-color-ring));
```

After that line, append two tooltip tokens with a comment:
```css
  /* Constraint tooltip (show-constraint-tooltips) */
  --ui-calendar-tooltip-bg: var(--color-foreground, #111827);
  --ui-calendar-tooltip-text: var(--color-background, #ffffff);
```

These tokens are used in `calendar.ts` (lines ~387-388) for the constraint tooltip pseudo-element but were never declared in `:root`. Adding them here ensures dark mode correctly inverts them through the semantic cascade (`.dark` overrides `--color-foreground` and `--color-background`).
  </action>
  <verify>
    <automated>grep -c "ui-calendar" /Users/sn0w/Documents/dev/lit-components/packages/core/src/styles/tailwind.css</automated>
  </verify>
  <done>
Running `grep -n "ui-calendar" packages/core/src/styles/tailwind.css` shows:
- Zero `--ui-calendar-*` lines in the `.dark {}` block (the "Calendar dark mode overrides" comment and all 10 declarations are gone)
- The `:root` block contains all original calendar tokens plus the 2 new tooltip tokens (`--ui-calendar-tooltip-bg` and `--ui-calendar-tooltip-text`)
- Total `--ui-calendar-*` declaration count: 21 (was 19 in :root + 10 in .dark = 29; now 21 in :root only)
  </done>
</task>

</tasks>

<verification>
After task completion, verify:
1. `grep -n "ui-calendar" packages/core/src/styles/tailwind.css | grep -v "^[0-9][0-9][0-9]"` — confirm no calendar tokens outside :root block
2. `grep "Calendar dark mode" packages/core/src/styles/tailwind.css` — returns empty (block removed)
3. `grep "ui-calendar-tooltip" packages/core/src/styles/tailwind.css` — shows 2 lines in :root
4. `grep -c "ui-calendar" packages/core/src/styles/tailwind.css` — count is 21 (19 original :root + 2 new tooltip)
</verification>

<success_criteria>
- The .dark block contains zero --ui-calendar-* declarations
- The "Calendar dark mode overrides" comment is removed
- The :root calendar block has 21 tokens including --ui-calendar-tooltip-bg and --ui-calendar-tooltip-text
- Calendar dark mode appearance governed entirely by semantic .dark cascade (no per-component overrides needed)
</success_criteria>

<output>
After completion, create `.planning/phases/78-calendar/78-01-SUMMARY.md` following the summary template.
</output>
