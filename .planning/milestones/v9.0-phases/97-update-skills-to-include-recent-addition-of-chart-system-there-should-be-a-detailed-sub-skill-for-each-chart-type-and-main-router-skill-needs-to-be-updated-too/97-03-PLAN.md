---
phase: 97-update-skills-to-include-recent-addition-of-chart-system-there-should-be-a-detailed-sub-skill-for-each-chart-type-and-main-router-skill-needs-to-be-updated-too
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - skill/skills/pie-chart/SKILL.md
  - skill/skills/scatter-chart/SKILL.md
  - skill/skills/heatmap-chart/SKILL.md
autonomous: true
requirements:
  - SKILL-PIE-CHART
  - SKILL-SCATTER-CHART
  - SKILL-HEATMAP-CHART

must_haves:
  truths:
    - "skill/skills/pie-chart/SKILL.md documents minPercent, innerRadius, centerLabel props and PieSlice data type"
    - "skill/skills/scatter-chart/SKILL.md documents bubble mode, enable-gl WebGL limitation, and ScatterPoint type"
    - "skill/skills/heatmap-chart/SKILL.md documents xCategories/yCategories as JS-only props and HeatmapCell [xIdx,yIdx,value] type"
    - "scatter-chart skill prominently warns that bubble+enable-gl uses fixed symbol size (GPU limitation)"
    - "heatmap-chart skill prominently warns that xCategories/yCategories cannot be HTML attributes"
  artifacts:
    - path: "skill/skills/pie-chart/SKILL.md"
      provides: "lui-pie-chart skill"
      contains: "innerRadius"
    - path: "skill/skills/scatter-chart/SKILL.md"
      provides: "lui-scatter-chart skill"
      contains: "enable-gl"
    - path: "skill/skills/heatmap-chart/SKILL.md"
      provides: "lui-heatmap-chart skill"
      contains: "xCategories"
  key_links:
    - from: "skill/skills/pie-chart/SKILL.md"
      to: "skill/skills/charts/SKILL.md"
      via: "shared props reference"
      pattern: "skills/charts"
    - from: "skill/skills/heatmap-chart/SKILL.md"
      to: "skill/skills/charts/SKILL.md"
      via: "shared props reference"
      pattern: "skills/charts"
---

<objective>
Create skill files for pie chart, scatter chart, and heatmap chart — each with critical pitfall warnings that prevent common integration mistakes.

Purpose: These three chart types have the highest density of non-obvious pitfalls: scatter has a WebGL+bubble size limitation, heatmap requires JS-only array props, and pie has a donut mode that changes the component API. Without accurate skill files these pitfalls will frequently cause developer confusion.
Output: skill/skills/pie-chart/SKILL.md, skill/skills/scatter-chart/SKILL.md, skill/skills/heatmap-chart/SKILL.md
</objective>

<execution_context>
@/Users/sn0w/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sn0w/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/97-update-skills-to-include-recent-addition-of-chart-system-there-should-be-a-detailed-sub-skill-for-each-chart-type-and-main-router-skill-needs-to-be-updated-too/97-RESEARCH.md

<interfaces>
<!-- lui-pie-chart chart-specific props (from RESEARCH.md) -->
minPercent    — min-percent attribute. number, default 0. Merge slices below this % into "Other". 0 = no merging.
innerRadius   — inner-radius attribute. string | number, default 0. Donut hole radius. '0'/'0%'/0 = filled pie.
centerLabel   — center-label attribute. string, default ''. Text in donut center. Only shown when innerRadius non-zero.
labelPosition — label-position attribute. 'top' | 'bottom', default 'top'. 'top' = outside with connectors; 'bottom' = inside slice.

Data type: PieSlice[]
  type PieSlice = { name: string; value: number }

isDonut guard: handles four falsy cases: 0, '0', '0%', '' — '0' is truthy in JS but semantically means no inner radius.
centerLabel passed as undefined when empty string — prevents ECharts layout interference.

<!-- lui-scatter-chart chart-specific props -->
bubble        — boolean, default false. value[2] drives symbol size (Canvas only — GPU limitation).

Data type: ScatterPoint[]
  type ScatterPoint = [number, number] | [number, number, number]

WebGL: enable-gl (from base) selects scatterGL series. bubble + enable-gl = fixed symbol size (GPU cannot support per-point size callbacks).
Streaming: uses circular buffer (not appendData) even in GL mode.

<!-- lui-heatmap-chart chart-specific props -->
xCategories   — JS only (attribute:false). string[]. X-axis category labels. MUST be JS property.
yCategories   — JS only (attribute:false). string[]. Y-axis category labels. MUST be JS property.
colorRange    — color-range attribute. string | null, default null. Two-color gradient as '#minColor,#maxColor'. Default: '#313695,#d73027' (blue-to-red).

Data type: HeatmapCell[]
  type HeatmapCell = [xIdx: number, yIdx: number, value: number]
  — integer indices into xCategories/yCategories arrays, NOT the category string values.

pushData() override: accepts HeatmapCell and updates the specific cell in-place (not rolling buffer).
visualMap min/max default to [0, 100] — prevents color drift during streaming.
</interfaces>
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create skill/skills/pie-chart/SKILL.md</name>
  <files>skill/skills/pie-chart/SKILL.md</files>
  <action>
Create the directory skill/skills/pie-chart/ and write skill/skills/pie-chart/SKILL.md.

Content:

---
name: lit-ui-pie-chart
description: >-
  How to use <lui-pie-chart> — pie and donut mode, minPercent slice merging, innerRadius, centerLabel, streaming.
---

# Pie Chart

Pie and donut chart built on ECharts. Supports automatic small-slice merging below a configurable threshold, configurable donut hole with center label text, and streaming data updates via pushData().

## Usage

**Important:** `data` and `option` are JS properties — not HTML attributes.

```js
import '@lit-ui/charts/pie-chart';

const chart = document.querySelector('lui-pie-chart');
chart.data = [
  { name: 'Chrome', value: 65 },
  { name: 'Firefox', value: 18 },
  { name: 'Safari', value: 12 },
  { name: 'Edge', value: 5 },
];
```

```html
<!-- Pie chart with small-slice merging -->
<lui-pie-chart min-percent="3"></lui-pie-chart>

<!-- Donut chart with center label -->
<lui-pie-chart inner-radius="40%" center-label="Total"></lui-pie-chart>
```

```tsx
// React
import { useRef, useEffect } from 'react';
function PieChartDemo({ data }) {
  const ref = useRef(null);
  useEffect(() => {
    if (ref.current) ref.current.data = data;
  }, [data]);
  return <lui-pie-chart ref={ref} inner-radius="40%" center-label="Total" />;
}
```

```js
// Streaming: update proportions over time
chart.data = [{ name: 'A', value: 50 }, { name: 'B', value: 50 }];
setInterval(() => chart.pushData({ name: 'A', value: Math.random() * 100 }), 500);
```

## Data Type

```ts
type PieSlice = {
  name: string;
  value: number;
};

// chart.data is PieSlice[]
chart.data = [
  { name: 'Product A', value: 40 },
  { name: 'Product B', value: 35 },
  { name: 'Product C', value: 25 },
];
```

## Props

For shared props (data, option, loading, enableGl, maxPoints) see `skills/charts`.

| Prop | Attribute | Type | Default | Description |
|------|-----------|------|---------|-------------|
| `minPercent` | `min-percent` | `number` | `0` | Merge slices below this percentage into an "Other" segment. `0` = no merging. |
| `innerRadius` | `inner-radius` | `string \| number` | `0` | Donut hole radius. `0`, `'0'`, or `'0%'` = filled pie. Use `'40%'` for typical donut. |
| `centerLabel` | `center-label` | `string` | `''` | Text displayed in the donut center. Only shown when `innerRadius` is non-zero. |
| `labelPosition` | `label-position` | `'top' \| 'bottom'` | `'top'` | `'top'` = labels outside with connector lines; `'bottom'` = labels inside slices. |

## Methods

See `skills/charts` for shared `pushData()` and `getChart()`.

## CSS Custom Properties

See `skills/charts` for all 17 shared `--ui-chart-*` tokens.

## Behavior Notes

- **JS property required**: `data` and `option` must be set as JS properties.
- **innerRadius falsy check**: `0`, `'0'`, and `'0%'` all render a filled pie (not a donut). The string `'0'` is truthy in JavaScript but the component treats it as "no inner radius".
- **centerLabel requires innerRadius**: Setting `center-label` has no visible effect unless `inner-radius` is also non-zero.
- **minPercent merging**: Slices below `minPercent` are merged into a single "Other" segment before rendering. The merge is pre-processing — legend and tooltip data reflect original slice names, not the merged segment.
- **Streaming**: Uses circular buffer. Call `pushData({ name, value })` to update a slice by name.
  </action>
  <verify>
    <automated>grep -c "innerRadius\|inner-radius\|PieSlice\|centerLabel" /Users/sn0w/Documents/dev/lit-components/skill/skills/pie-chart/SKILL.md</automated>
  </verify>
  <done>skill/skills/pie-chart/SKILL.md exists with PieSlice data type, all 4 chart-specific props (minPercent, innerRadius, centerLabel, labelPosition), donut mode notes, and centerLabel requirement on innerRadius.</done>
</task>

<task type="auto">
  <name>Task 2: Create skill/skills/scatter-chart/SKILL.md and skill/skills/heatmap-chart/SKILL.md</name>
  <files>skill/skills/scatter-chart/SKILL.md, skill/skills/heatmap-chart/SKILL.md</files>
  <action>
Create both skill files.

--- SCATTER CHART ---

Write skill/skills/scatter-chart/SKILL.md:

---
name: lit-ui-scatter-chart
description: >-
  How to use <lui-scatter-chart> — bubble mode, WebGL rendering for 500K+ points, ScatterPoint type, streaming.
---

# Scatter Chart

Scatter and bubble chart built on ECharts. Supports 2D point cloud (Canvas) and 500K+ point WebGL rendering via echarts-gl. Bubble mode adds a third dimension for point size.

## Usage

**Important:** `data` and `option` are JS properties — not HTML attributes.

```js
import '@lit-ui/charts/scatter-chart';

const chart = document.querySelector('lui-scatter-chart');
chart.data = [
  [10.0, 8.04],
  [8.0, 6.95],
  [13.0, 7.58],
];
```

```html
<!-- Standard scatter -->
<lui-scatter-chart></lui-scatter-chart>

<!-- Bubble mode: data[2] drives point size -->
<lui-scatter-chart bubble></lui-scatter-chart>

<!-- WebGL mode for 500K+ points -->
<lui-scatter-chart enable-gl></lui-scatter-chart>
```

```tsx
// React
import { useRef, useEffect } from 'react';
function ScatterChartDemo({ data }) {
  const ref = useRef(null);
  useEffect(() => {
    if (ref.current) ref.current.data = data;
  }, [data]);
  return <lui-scatter-chart ref={ref} bubble />;
}
```

```js
// WebGL fallback handling
const chart = document.querySelector('lui-scatter-chart');
chart.addEventListener('ui-webgl-unavailable', (e) => {
  console.warn('WebGL not available:', e.detail.reason);
  // Chart automatically falls back to Canvas
});
```

## Data Type

```ts
type ScatterPoint = [number, number] | [number, number, number];
// [x, y] for 2D scatter
// [x, y, size] for bubble mode — size drives symbol radius (Canvas only)

// chart.data is ScatterPoint[]
chart.data = [
  [10.0, 8.04],
  [8.0, 6.95],
  [13.0, 7.58, 30], // bubble: 30 = point size (Canvas only)
];
```

## Props

For shared props (data, option, loading, enableGl, maxPoints) see `skills/charts`.

| Prop | Attribute | Type | Default | Description |
|------|-----------|------|---------|-------------|
| `bubble` | `bubble` | `boolean` | `false` | Use `value[2]` as symbol size. Canvas only — see behavior note. |

## Events

| Event | Detail | Description |
|-------|--------|-------------|
| `ui-webgl-unavailable` | `{ reason: string }` | Fires when `enable-gl` is set but WebGL is unavailable. Chart falls back to Canvas. |

## CSS Custom Properties

See `skills/charts` for all 17 shared `--ui-chart-*` tokens.

## Behavior Notes

- **JS property required**: `data` and `option` must be set as JS properties.
- **bubble + enable-gl = fixed size**: When both `bubble` and `enable-gl` are set simultaneously, point size is fixed (GPU rendering cannot support per-point size callbacks). `bubble` mode size variation only works in Canvas rendering (without `enable-gl`).
- **WebGL bundle impact**: Setting `enable-gl` lazy-loads echarts-gl (approximately +200KB gzipped). This load only happens once. If WebGL is unavailable, the chart falls back to Canvas automatically and fires `ui-webgl-unavailable`.
- **Streaming**: Uses circular buffer (not appendData) even in GL mode. Call `pushData([x, y])` to append.
- **500K+ point performance**: Use `enable-gl` for datasets with 100K+ points. Canvas mode degrades above ~50K points.

--- HEATMAP CHART ---

Write skill/skills/heatmap-chart/SKILL.md:

---
name: lit-ui-heatmap-chart
description: >-
  How to use <lui-heatmap-chart> — xCategories/yCategories JS props, HeatmapCell type, colorRange, cell-update streaming.
---

# Heatmap Chart

Cartesian heatmap chart built on ECharts with VisualMap color scale. Uses integer index pairs to address cells. Category labels must be set as JS properties — not HTML attributes.

## Usage

**Important:** `data`, `xCategories`, and `yCategories` are JS properties — they CANNOT be set as HTML attributes.

```js
import '@lit-ui/charts/heatmap-chart';

const chart = document.querySelector('lui-heatmap-chart');
chart.xCategories = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri'];
chart.yCategories = ['Morning', 'Afternoon', 'Evening'];
chart.data = [
  [0, 0, 85],   // Mon Morning: 85
  [1, 0, 72],   // Tue Morning: 72
  [2, 1, 40],   // Wed Afternoon: 40
  [4, 2, 91],   // Fri Evening: 91
];
```

```html
<!-- colorRange as comma-separated hex colors (min,max) -->
<lui-heatmap-chart color-range="#ffffff,#ef4444"></lui-heatmap-chart>
```

```tsx
// React — useRef + useEffect required for xCategories, yCategories, and data
import { useRef, useEffect } from 'react';
function HeatmapChartDemo({ xCats, yCats, data }) {
  const ref = useRef(null);
  useEffect(() => {
    if (!ref.current) return;
    ref.current.xCategories = xCats;
    ref.current.yCategories = yCats;
    ref.current.data = data;
  }, [xCats, yCats, data]);
  return <lui-heatmap-chart ref={ref} />;
}
```

```js
// Cell-update streaming: update a specific cell value
chart.pushData([2, 1, 55]); // Update Wed Afternoon to 55
// pushData on heatmap updates the cell in-place — not a rolling buffer
```

## Data Type

```ts
type HeatmapCell = [xIdx: number, yIdx: number, value: number];
// xIdx: integer index into xCategories array
// yIdx: integer index into yCategories array
// value: numeric value for color encoding

// chart.data is HeatmapCell[]
chart.data = [
  [0, 0, 85],  // xCategories[0], yCategories[0], value=85
  [1, 2, 43],  // xCategories[1], yCategories[2], value=43
];
```

## Props

For shared props (data, option, loading, enableGl, maxPoints) see `skills/charts`.

| Prop | Attribute | Type | Default | Description |
|------|-----------|------|---------|-------------|
| `xCategories` | — (JS only) | `string[]` | `[]` | X-axis category labels. **Must be JS property** — cannot be HTML attribute. |
| `yCategories` | — (JS only) | `string[]` | `[]` | Y-axis category labels. **Must be JS property** — cannot be HTML attribute. |
| `colorRange` | `color-range` | `string \| null` | `null` | VisualMap color gradient as `'#minColor,#maxColor'`. Default: `'#313695,#d73027'` (blue-to-red). |

## Methods

See `skills/charts` for shared `getChart()`. `pushData()` is overridden — see behavior notes.

## CSS Custom Properties

See `skills/charts` for all 17 shared `--ui-chart-*` tokens.

## Behavior Notes

- **xCategories and yCategories are JS properties**: Cannot be set as HTML attributes (`x-categories="[...]"` will not work). Must be set as `element.xCategories = [...]` in JavaScript. In React, use a ref + useEffect.
- **Data uses integer indices**: HeatmapCell values `[xIdx, yIdx, value]` are integer positions into xCategories/yCategories arrays — not the string category values.
- **pushData() overridden**: Heatmap's `pushData()` updates a specific cell in-place, not a rolling circular buffer. Pass a `HeatmapCell` tuple `[xIdx, yIdx, newValue]`.
- **VisualMap min/max defaults**: The color scale defaults to `[0, 100]` to prevent color drift during streaming. Override via the `option` prop if your data range differs.
- **colorRange format**: Provide two hex colors separated by a comma: `'#minColor,#maxColor'`. The first color maps to the minimum value, the second to the maximum.

Write both files to their respective paths.
  </action>
  <verify>
    <automated>grep -l "xCategories\|enable-gl" /Users/sn0w/Documents/dev/lit-components/skill/skills/scatter-chart/SKILL.md /Users/sn0w/Documents/dev/lit-components/skill/skills/heatmap-chart/SKILL.md | wc -l</automated>
  </verify>
  <done>skill/skills/scatter-chart/SKILL.md exists with bubble+enable-gl limitation documented. skill/skills/heatmap-chart/SKILL.md exists with xCategories/yCategories JS-only warning and HeatmapCell integer index type.</done>
</task>

</tasks>

<verification>
1. `ls skill/skills/pie-chart/SKILL.md skill/skills/scatter-chart/SKILL.md skill/skills/heatmap-chart/SKILL.md` — all 3 files exist
2. `grep "bubble.*enable-gl\|enable-gl.*bubble\|fixed symbol\|fixed size" skill/skills/scatter-chart/SKILL.md` — WebGL+bubble limitation documented
3. `grep "JS only\|JS property\|attribute" skill/skills/heatmap-chart/SKILL.md` — xCategories JS-only warning present
4. `grep "PieSlice\|innerRadius\|inner-radius" skill/skills/pie-chart/SKILL.md` — donut props documented
</verification>

<success_criteria>
- All 3 skill files created with correct frontmatter, Usage section with React example, Data Type block, Props table, and Behavior Notes
- Scatter chart prominently warns about bubble+enable-gl fixed size limitation
- Heatmap chart prominently warns that xCategories/yCategories are JS-only properties
- Pie chart documents the innerRadius falsy check (0/'0'/'0%' all mean pie mode)
</success_criteria>

<output>
After completion, create `.planning/phases/97-update-skills-to-include-recent-addition-of-chart-system-there-should-be-a-detailed-sub-skill-for-each-chart-type-and-main-router-skill-needs-to-be-updated-too/97-03-SUMMARY.md`
</output>
