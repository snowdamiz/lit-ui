---
phase: 89-line-chart-area-chart
plan: 02
type: execute
wave: 2
depends_on: ["89-01"]
files_modified:
  - packages/charts/src/area/area-chart.ts
  - packages/charts/src/index.ts
autonomous: true
requirements: [AREA-01, AREA-02]

must_haves:
  truths:
    - "Developer can render a filled area chart with `stacked` and `smooth` props and see filled areas that stack correctly across multiple series"
    - "Developer can call `pushData(point)` on an area chart and see the series extend in real time"
    - "Developer can import LuiLineChart and LuiAreaChart from '@lit-ui/charts'"
    - "Developer can import LineChartSeries and MarkLineSpec types from '@lit-ui/charts'"
  artifacts:
    - path: "packages/charts/src/area/area-chart.ts"
      provides: "LuiAreaChart Lit custom element extending BaseChartElement"
      exports: ["LuiAreaChart"]
    - path: "packages/charts/src/index.ts"
      provides: "Updated public API — adds LuiLineChart, LuiAreaChart, LineChartSeries, MarkLineSpec exports"
      exports: ["LuiLineChart", "LuiAreaChart", "LineChartSeries", "MarkLineSpec"]
  key_links:
    - from: "packages/charts/src/area/area-chart.ts"
      to: "packages/charts/src/line/line-registry.ts"
      via: "_registerModules() calls registerLineModules() — same module as line chart"
      pattern: "registerLineModules"
    - from: "packages/charts/src/area/area-chart.ts"
      to: "packages/charts/src/shared/line-option-builder.ts"
      via: "import { buildLineOption, LineChartSeries }"
      pattern: "buildLineOption.*area"
    - from: "packages/charts/src/index.ts"
      to: "packages/charts/src/line/line-chart.ts"
      via: "export { LuiLineChart }"
      pattern: "LuiLineChart"
    - from: "packages/charts/src/index.ts"
      to: "packages/charts/src/area/area-chart.ts"
      via: "export { LuiAreaChart }"
      pattern: "LuiAreaChart"
---

<objective>
Create LuiAreaChart and wire both new components into the @lit-ui/charts public API via index.ts updates.

Purpose: Complete Phase 89 by shipping the area chart variant and making both line and area charts importable by consumers.
Output: `area-chart.ts`, updated `index.ts` — both components publicly exported with full type support.
</objective>

<execution_context>
@/Users/sn0w/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sn0w/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/89-line-chart-area-chart/89-RESEARCH.md
@.planning/phases/89-line-chart-area-chart/89-01-SUMMARY.md

<interfaces>
<!-- Key types and contracts the executor needs. Produced by Plan 01. -->
<!-- Executor should use these directly — no codebase exploration needed. -->

From packages/charts/src/shared/line-option-builder.ts (created in Plan 01):
```typescript
export type LineChartSeries = {
  name: string;
  data: (number | [number | string, number] | null)[];
};

export type MarkLineSpec = {
  value: number;
  label?: string;
  color?: string;
};

export type LineOptionProps = {
  smooth?: boolean | number;
  zoom?: boolean;
  markLines?: MarkLineSpec[];
  stacked?: boolean;   // area chart only
  opacity?: number;    // area chart only, default 0.6
};

export function buildLineOption(
  series: LineChartSeries[],
  props: LineOptionProps,
  mode: 'line' | 'area'
): Record<string, unknown>;
// Passing mode: 'area' adds areaStyle: { opacity: 0.6 } to each series
// and stack: 'total' on all series when props.stacked === true
```

From packages/charts/src/line/line-registry.ts (created in Plan 01):
```typescript
export async function registerLineModules(): Promise<void>;
// Registers CanvasRenderer + shared components via registerCanvasCore()
// then registers LineChart ECharts module.
// Area charts reuse this same function — ECharts has no separate AreaChart module.
// _lineRegistered guard makes repeated calls safe.
```

From packages/charts/src/line/line-chart.ts (created in Plan 01):
```typescript
export class LuiLineChart extends BaseChartElement {
  smooth: boolean;
  zoom: boolean;
  markLines?: MarkLineSpec[];
}
// Custom element: 'lui-line-chart'
```

From packages/charts/src/index.ts (current after Phase 88):
```typescript
export { BaseChartElement } from './base/base-chart-element.js';
export { ThemeBridge } from './base/theme-bridge.js';
export { registerCanvasCore } from './registry/canvas-core.js';
export type { EChartsOption } from './base/base-chart-element.js';
// Plan 02 adds LuiLineChart, LuiAreaChart, LineChartSeries, MarkLineSpec
```
</interfaces>
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create LuiAreaChart (area-chart.ts)</name>
  <files>packages/charts/src/area/area-chart.ts</files>
  <action>
Create `packages/charts/src/area/area-chart.ts`. LuiAreaChart is a thin variant of LuiLineChart — the only differences are: `areaStyle` on each series (handled by buildLineOption mode:'area'), `stacked` prop, and the custom element name.

```typescript
/**
 * LuiAreaChart — Filled area chart component extending BaseChartElement.
 *
 * AREA-01: Filled area chart with `stacked` and `smooth` options
 * AREA-02: Real-time streaming via inherited pushData() + appendData path
 *
 * ECharts design: Area charts are NOT a separate chart type.
 * They are line charts with `areaStyle: {}` on each series.
 * This component reuses registerLineModules() from line-registry.ts
 * and passes mode: 'area' to buildLineOption() for areaStyle injection.
 *
 * CRITICAL-03: same constraint as LuiLineChart — setOption only before streaming.
 */

import { property } from 'lit/decorators.js';
import type { PropertyValues } from 'lit';
import { BaseChartElement } from '../base/base-chart-element.js';
import { registerLineModules } from '../line/line-registry.js';
import {
  buildLineOption,
  type LineChartSeries,
} from '../shared/line-option-builder.js';

export class LuiAreaChart extends BaseChartElement {
  constructor() {
    super();
    // STRM-04: Area chart uses native appendData path — same as line chart.
    this._streamingMode = 'appendData';
  }

  // AREA-01: Smooth Catmull-Rom spline interpolation (same as line chart)
  @property({ type: Boolean }) smooth = false;

  // AREA-01: Stack all series with stack: 'total' (string, not boolean — ECharts requirement)
  @property({ type: Boolean }) stacked = false;

  // Zoom/pan controls — DataZoomComponent already registered in canvas-core
  @property({ type: Boolean }) zoom = false;

  protected override async _registerModules(): Promise<void> {
    // Area charts reuse the same ECharts LineChart module — no separate AreaChart in ECharts.
    // The _lineRegistered guard in line-registry.ts prevents double-registration.
    await registerLineModules();
  }

  override updated(changed: PropertyValues): void {
    super.updated(changed); // base handles this.option and this.loading
    if (!this._chart) return;
    const areaProps = ['data', 'smooth', 'stacked', 'zoom'] as const;
    if (areaProps.some((k) => changed.has(k))) {
      this._applyData();
    }
  }

  private _applyData(): void {
    if (!this._chart || !this.data) return;
    const option = buildLineOption(
      this.data as LineChartSeries[],
      { smooth: this.smooth, stacked: this.stacked, zoom: this.zoom },
      'area'   // triggers areaStyle + opacity 0.6 default in buildLineOption
    );
    // CRITICAL-03: Only safe before streaming starts
    this._chart.setOption(option, { notMerge: false });
  }
}

// Custom element registration — same guard pattern as all other @lit-ui packages
if (typeof customElements !== 'undefined' && !customElements.get('lui-area-chart')) {
  customElements.define('lui-area-chart', LuiAreaChart);
}

declare global {
  interface HTMLElementTagNameMap {
    'lui-area-chart': LuiAreaChart;
  }
}
```

No area-specific registry file is needed — `registerLineModules()` from `line-registry.ts` covers both chart types.
  </action>
  <verify>
    <automated>cd /Users/sn0w/Documents/dev/lit-components && npx tsc --noEmit -p packages/charts/tsconfig.json 2>&1 | head -30</automated>
  </verify>
  <done>
    - `packages/charts/src/area/area-chart.ts` exists and exports `LuiAreaChart`
    - Registers `lui-area-chart` custom element
    - `_streamingMode = 'appendData'` set in constructor
    - `smooth`, `stacked`, `zoom` props present
    - TypeScript compiles without errors
  </done>
</task>

<task type="auto">
  <name>Task 2: Update index.ts exports and verify full build</name>
  <files>packages/charts/src/index.ts</files>
  <action>
Update `packages/charts/src/index.ts` to add the Phase 89 exports. Read the current file first, then replace its content with the full updated version.

Current content (Phase 88):
```typescript
export { BaseChartElement } from './base/base-chart-element.js';
export { ThemeBridge } from './base/theme-bridge.js';
export { registerCanvasCore } from './registry/canvas-core.js';
export type { EChartsOption } from './base/base-chart-element.js';
```

New content (Phase 89 additions appended):
```typescript
// @lit-ui/charts — High-performance chart components with WebGL rendering,
// real-time streaming, and CSS token theming built with Lit and ECharts

// Phase 88: Infrastructure
export { BaseChartElement } from './base/base-chart-element.js';
export { ThemeBridge } from './base/theme-bridge.js';
export { registerCanvasCore } from './registry/canvas-core.js';
export type { EChartsOption } from './base/base-chart-element.js';

// Phase 89: Line Chart + Area Chart
export { LuiLineChart } from './line/line-chart.js';
export { LuiAreaChart } from './area/area-chart.js';
export type { LineChartSeries, MarkLineSpec, LineOptionProps } from './shared/line-option-builder.js';
```

After updating index.ts, run a full build to confirm the package produces updated dist output:

```bash
cd /Users/sn0w/Documents/dev/lit-components && pnpm --filter @lit-ui/charts build
```

The build output should include both `LuiLineChart` and `LuiAreaChart` in the compiled dist. Verify dist/index.d.ts contains the new exports.
  </action>
  <verify>
    <automated>cd /Users/sn0w/Documents/dev/lit-components && pnpm --filter @lit-ui/charts build 2>&1 | tail -15 && grep -c "LuiLineChart\|LuiAreaChart" packages/charts/dist/index.d.ts</automated>
  </verify>
  <done>
    - `packages/charts/src/index.ts` exports LuiLineChart, LuiAreaChart, LineChartSeries, MarkLineSpec, LineOptionProps
    - `pnpm build` succeeds with zero errors
    - `dist/index.d.ts` contains LuiLineChart and LuiAreaChart exports (grep count >= 2)
    - `dist/index.js` updated with new component code
  </done>
</task>

</tasks>

<verification>
Final cross-check after both tasks complete:

```bash
# 1. TypeScript clean
cd /Users/sn0w/Documents/dev/lit-components && npx tsc --noEmit -p packages/charts/tsconfig.json

# 2. Build succeeds
pnpm --filter @lit-ui/charts build

# 3. All five required exports present in dist
grep "LuiLineChart\|LuiAreaChart\|LineChartSeries\|MarkLineSpec\|LineOptionProps" packages/charts/dist/index.d.ts
```

All three commands should succeed with zero errors and matching export names.
</verification>

<success_criteria>
- `packages/charts/src/area/area-chart.ts` exists with LuiAreaChart, `_streamingMode = 'appendData'`, smooth/stacked/zoom props
- `packages/charts/src/index.ts` exports LuiLineChart, LuiAreaChart, LineChartSeries, MarkLineSpec, LineOptionProps
- `pnpm build` for @lit-ui/charts succeeds
- dist/index.d.ts contains all five new Phase 89 exports
- Zero TypeScript errors across the charts package
</success_criteria>

<output>
After completion, create `.planning/phases/89-line-chart-area-chart/89-02-SUMMARY.md`
</output>
