# Milestone v2.0: NPM + SSR

**Status:** SHIPPED 2026-01-25
**Phases:** 13-20
**Total Plans:** 27

## Overview

Enable NPM package distribution and SSR compatibility, giving developers the choice between copy-source ownership and traditional npm install.

## Phases

### Phase 13: Monorepo Infrastructure
**Goal**: Project restructured as pnpm monorepo with changesets for version management
**Depends on**: v1.0 complete
**Plans**: 5 plans

Plans:
- [x] 13-01: Workspace foundation (pnpm-workspace.yaml, root package.json, changesets)
- [x] 13-02: Shared configs (@lit-ui/typescript-config, @lit-ui/vite-config)
- [x] 13-03: Package scaffolding (core, button, dialog stubs)
- [x] 13-04: Apps migration (docs, landing to apps/)
- [x] 13-05: Verification and cleanup (install, build, changeset test)

**Details:**
- Fixed mode versioning for all @lit-ui packages (lockstep releases)
- Separate base.json and library.json for TypeScript configs
- Factory function pattern for Vite config (createLibraryConfig)

### Phase 14: Core Package
**Goal**: @lit-ui/core exports SSR-aware TailwindElement with dual-mode styling
**Depends on**: Phase 13
**Plans**: 3 plans

Plans:
- [x] 14-01: SSR-aware TailwindElement with dual-mode styling
- [x] 14-02: Design tokens module and utility helpers
- [x] 14-03: Build verification and FOUC prevention

**Details:**
- SSR uses inline CSS via static styles getter (isServer === true)
- Constructable stylesheets guarded with !isServer check
- Tailwind token names (--color-primary) not custom --lui- namespace

### Phase 15: Component Packages
**Goal**: Button and Dialog published as independent packages with SSR compatibility
**Depends on**: Phase 14
**Plans**: 3 plans

Plans:
- [x] 15-01: Button package migration with SSR guards
- [x] 15-02: Dialog package migration with SSR guards
- [x] 15-03: Build verification and FOUC CSS update

**Details:**
- Use import.meta.env?.DEV instead of process.env.NODE_ENV
- Remove rollupTypes from vite-plugin-dts (api-extractor Map bug)
- Simple no-op SSR approach for showModal/close

### Phase 16: SSR Package
**Goal**: @lit-ui/ssr provides utilities for server-rendering components
**Depends on**: Phase 15
**Plans**: 2 plans

Plans:
- [x] 16-01: SSR package structure and render utilities
- [x] 16-02: Hydration support and build verification

**Details:**
- All Lit packages (@lit-labs/*) marked external in vite.config.ts
- renderToString helper wraps render() + collectResult()
- Hydration import order: @lit-ui/ssr/hydration must be first

### Phase 17: Framework Integration
**Goal**: Working SSR examples for Next.js, Astro, and generic Node.js
**Depends on**: Phase 16
**Plans**: 3 plans

Plans:
- [x] 17-01: Node.js/Express SSR example
- [x] 17-02: Next.js App Router SSR example
- [x] 17-03: Astro SSR example

**Details:**
- Components register on both server and client (removed isServer guard)
- TailwindElement exports tailwindBaseStyles for subclass composition
- 'use client' boundary pattern for Lit in Next.js App Router
- @semantic-ui/astro-lit instead of deprecated @astrojs/lit

### Phase 18: CLI Enhancement
**Goal**: CLI supports both copy-source and npm installation modes
**Depends on**: Phase 15
**Plans**: 4 plans

Plans:
- [x] 18-01: Config schema update and init mode prompt
- [x] 18-02: Add command mode branching with npm install
- [x] 18-03: Migrate command with diff detection
- [x] 18-04: List command update and verification

**Details:**
- Config file renamed to lit-ui.config.json for clarity
- Default mode is copy-source for backward compatibility
- Install @lit-ui/core peer dependency automatically
- Flag overrides config: --npm or --copy takes precedence

### Phase 19: Publishing
**Goal**: All packages published to npm under @lit-ui scope
**Depends on**: Phase 16, Phase 17, Phase 18
**Plans**: 4 plans

Plans:
- [x] 19-01: Package metadata (repository, description, license)
- [x] 19-02: README files for all publishable packages
- [x] 19-03: GitHub Actions release workflow
- [x] 19-04: npm organization setup and verification

**Details:**
- Static output for Astro example (CI build compatibility)
- Standard NPM_TOKEN secret approach (not OIDC)
- npm organization 'lit-ui' created for @lit-ui scope

### Phase 20: Documentation
**Goal**: Docs site updated with NPM and SSR guides
**Depends on**: Phase 19
**Plans**: 3 plans

Plans:
- [x] 20-01: Installation page (NPM primary + copy-source alternative)
- [x] 20-02: SSR Guide (Next.js + Astro setup)
- [x] 20-03: Migration Guide (copy-source to npm)

**Details:**
- NPM as primary installation path with trade-offs table
- Four-section SSR guide: hydration order, Next.js, Astro, FOUC
- CLI-focused migration content

---

## Milestone Summary

**Key Decisions:**
- pnpm over npm/yarn for monorepo (better workspace support)
- Fixed/lockstep versioning (keep @lit-ui packages in sync)
- Dual-mode styling for SSR (static styles server, constructable client)
- Components register on both server/client (@lit-labs/ssr shim)
- Lit as peer dependency (avoid conflicts, reduce bundle)
- Copy-source as default CLI mode (backward compatibility)

**Issues Resolved:**
- Component registration for SSR (changed guard from isServer to customElements check)
- Style inheritance pattern (changed getter to property for subclass override)
- Hydration import order documented and enforced

**Issues Deferred:**
- @lit-ui/core/fouc.css convenience export (docs reference non-existent file)
- apps/docs/tsconfig.json legacy path mapping (cosmetic)

**Technical Debt Incurred:**
- 2 low-severity items (both non-blocking, documented in audit)

---

_For current project status, see .planning/ROADMAP.md_
_Archived: 2026-01-25 as part of v2.0 milestone completion_
