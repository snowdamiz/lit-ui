---
phase: 97-update-skills-to-include-recent-addition-of-chart-system-there-should-be-a-detailed-sub-skill-for-each-chart-type-and-main-router-skill-needs-to-be-updated-too
plan: 04
type: execute
wave: 1
depends_on: []
files_modified:
  - skill/skills/candlestick-chart/SKILL.md
  - skill/skills/treemap-chart/SKILL.md
autonomous: true
requirements:
  - SKILL-CANDLESTICK-CHART
  - SKILL-TREEMAP-CHART

must_haves:
  truths:
    - "skill/skills/candlestick-chart/SKILL.md prominently warns that OHLC order is [open,close,low,high] NOT [open,high,low,close]"
    - "skill/skills/candlestick-chart/SKILL.md documents showVolume, movingAverages props and MAConfig type"
    - "skill/skills/treemap-chart/SKILL.md documents that pushData() is NOT supported and .data must be reassigned"
    - "skill/skills/treemap-chart/SKILL.md documents breadcrumb, rounded, levelColors props and TreemapNode type"
    - "skill/skills/treemap-chart/SKILL.md warns about levelColors requiring array-of-arrays format (not flat string[])"
  artifacts:
    - path: "skill/skills/candlestick-chart/SKILL.md"
      provides: "lui-candlestick-chart skill"
      contains: "open, close, low, high"
    - path: "skill/skills/treemap-chart/SKILL.md"
      provides: "lui-treemap-chart skill"
      contains: "pushData"
  key_links:
    - from: "skill/skills/candlestick-chart/SKILL.md"
      to: "skill/skills/charts/SKILL.md"
      via: "shared props reference"
      pattern: "skills/charts"
    - from: "skill/skills/treemap-chart/SKILL.md"
      to: "skill/skills/charts/SKILL.md"
      via: "shared props reference"
      pattern: "skills/charts"
---

<objective>
Create skill files for candlestick chart and treemap chart — the two chart types with the most critical and non-obvious pitfalls that cause hard-to-debug failures.

Purpose: The candlestick OHLC order trap (ECharts expects [open,close,low,high] not the acronym order) and the treemap pushData() no-op are silent failures that produce incorrect visual output with no error messages. AI assistants will produce broken code without explicit skill documentation of these traps.
Output: skill/skills/candlestick-chart/SKILL.md, skill/skills/treemap-chart/SKILL.md
</objective>

<execution_context>
@/Users/sn0w/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sn0w/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/97-update-skills-to-include-recent-addition-of-chart-system-there-should-be-a-detailed-sub-skill-for-each-chart-type-and-main-router-skill-needs-to-be-updated-too/97-RESEARCH.md

<interfaces>
<!-- lui-candlestick-chart chart-specific props (from RESEARCH.md) -->
bullColor     — bull-color attribute. string | null, default null → '#26a69a'. Rising candle. ECharts itemStyle.color.
bearColor     — bear-color attribute. string | null, default null → '#ef5350'. Falling candle. ECharts itemStyle.color0.
showVolume    — show-volume attribute. boolean, default false. Volume bar panel below candlestick grid.
movingAverages — moving-averages attribute. string | null, default null. JSON string of MAConfig[].

Data type:
  type OhlcBar = [number, number, number, number]; // [open, close, low, high] — NOT OHLC acronym order!
  type MAConfig = { period: number; color: string; type?: 'sma' | 'ema' }
  type CandlestickBarPoint = {
    label: string;        // x-axis label (timestamp string)
    ohlc: OhlcBar;        // [open, close, low, high] — NOT [open, high, low, close]!
    volume?: number;
  }

CRITICAL: ECharts candlestick data order is [open, close, low, high] — NOT the OHLC acronym order [open, high, low, close].
pushData() override: appends CandlestickBarPoint to bar buffer.
movingAverages: MAConfig[] passed as JSON string attribute. Example: '[{"period":20,"color":"#f59e0b"}]'.

<!-- lui-treemap-chart chart-specific props -->
breadcrumb    — boolean, default true. ECharts breadcrumb navigation for drill-down.
rounded       — boolean, default false. Border-radius on cells (6px top level, decremented per depth).
levelColors   — level-colors attribute. string | null, default null. JSON string of string[][].
               Example: '[["#ef4444","#f97316"],["#3b82f6"]]'
               CRITICAL: Must be array-of-arrays (string[][]) — flat string[] is silently rejected.

Data type:
  type TreemapNode = {
    name: string;
    value: number;
    children?: TreemapNode[];
  }

pushData(): NOT SUPPORTED. Overridden with console.warn no-op. Prevents base circular-buffer from overwriting hierarchical data.
To update: reassign chart.data directly.
notMerge: false in _applyData() preserves drill-down state when props change.
</interfaces>
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create skill/skills/candlestick-chart/SKILL.md</name>
  <files>skill/skills/candlestick-chart/SKILL.md</files>
  <action>
Create the directory skill/skills/candlestick-chart/ and write skill/skills/candlestick-chart/SKILL.md.

The OHLC order pitfall MUST be the most prominent feature of this skill — it is a silent failure that produces upside-down or incorrectly-wicked candlesticks with no error message.

Content:

---
name: lit-ui-candlestick-chart
description: >-
  How to use <lui-candlestick-chart> — OHLC data order, bull/bear colors, volume panel, moving averages, streaming.
---

# Candlestick Chart

Financial OHLC candlestick chart built on ECharts. Supports configurable bull/bear colors, optional volume panel on a secondary axis, SMA/EMA moving average overlays, and streaming new bars via pushData().

**CRITICAL:** ECharts candlestick data order is `[open, close, low, high]` — NOT the OHLC acronym order `[open, high, low, close]`. Using the wrong order produces silently incorrect candlesticks (wicks in the wrong position, colors reversed).

## Usage

**Important:** `data` and `option` are JS properties — not HTML attributes.

```js
import '@lit-ui/charts/candlestick-chart';

const chart = document.querySelector('lui-candlestick-chart');
chart.data = [
  // [open, close, low, high] — NOT [open, high, low, close]!
  { label: '2024-01-01', ohlc: [100, 110, 95, 115], volume: 50000 },
  { label: '2024-01-02', ohlc: [110, 105, 102, 112], volume: 45000 },
  { label: '2024-01-03', ohlc: [105, 120, 103, 122], volume: 62000 },
];
```

```html
<!-- Show volume panel -->
<lui-candlestick-chart show-volume></lui-candlestick-chart>

<!-- Custom bull/bear colors -->
<lui-candlestick-chart bull-color="#00c853" bear-color="#ff1744"></lui-candlestick-chart>

<!-- Moving averages (JSON string attribute) -->
<lui-candlestick-chart moving-averages='[{"period":20,"color":"#f59e0b"},{"period":50,"color":"#8b5cf6","type":"ema"}]'></lui-candlestick-chart>
```

```tsx
// React
import { useRef, useEffect } from 'react';
function CandlestickChartDemo({ data }) {
  const ref = useRef(null);
  useEffect(() => {
    if (ref.current) ref.current.data = data;
  }, [data]);
  return <lui-candlestick-chart ref={ref} show-volume />;
}
```

```js
// Real-time streaming: append a new OHLC bar
chart.pushData({ label: '2024-01-04', ohlc: [120, 118, 115, 125], volume: 48000 });
```

## Data Type

```ts
// WARNING: ECharts order is [open, close, low, high]
// NOT the OHLC acronym order [open, high, low, close]
type OhlcBar = [
  open: number,
  close: number,  // ← second position, not fourth
  low: number,
  high: number    // ← fourth position, not second
];

type CandlestickBarPoint = {
  label: string;     // x-axis label — typically a date string
  ohlc: OhlcBar;     // [open, close, low, high]
  volume?: number;   // required if show-volume is set
};

type MAConfig = {
  period: number;        // e.g. 20 for 20-period MA
  color: string;         // hex color for the MA line
  type?: 'sma' | 'ema'; // default: 'sma'
};

// chart.data is CandlestickBarPoint[]
```

## Props

For shared props (data, option, loading, enableGl, maxPoints) see `skills/charts`.

| Prop | Attribute | Type | Default | Description |
|------|-----------|------|---------|-------------|
| `bullColor` | `bull-color` | `string \| null` | `null` → `'#26a69a'` | Rising candle fill color. |
| `bearColor` | `bear-color` | `string \| null` | `null` → `'#ef5350'` | Falling candle fill color. |
| `showVolume` | `show-volume` | `boolean` | `false` | Render a volume bar panel on a secondary y-axis below the main chart. |
| `movingAverages` | `moving-averages` | `string \| null` | `null` | JSON string of `MAConfig[]`. See data type section. |

## Methods

See `skills/charts` for `getChart()`. `pushData()` is overridden — see below.

| Method | Signature | Description |
|--------|-----------|-------------|
| `pushData(point)` | `(point: CandlestickBarPoint) => void` | Append a new OHLC bar. Uses `lazyUpdate: true` to preserve DataZoom state. |

## CSS Custom Properties

See `skills/charts` for all 17 shared `--ui-chart-*` tokens.

## Behavior Notes

- **OHLC order is [open, close, low, high]**: ECharts expects this order, NOT the OHLC acronym `[open, high, low, close]`. Wrong order produces silently incorrect candlesticks — no error is thrown.
- **JS property required**: `data` and `option` must be set as JS properties.
- **movingAverages as JSON string**: The `moving-averages` attribute accepts a JSON string (not a JS object). Pass it as `'[{"period":20,"color":"#f59e0b"}]'`. In JavaScript, use `JSON.stringify(maConfigs)`.
- **volume required for show-volume**: When `show-volume` is set, each data point should include a `volume` field. Points without volume will render as 0-height bars.
- **DataZoom synchronization**: When `show-volume` is true, DataZoom controls both the main and volume panels simultaneously.
- **pushData uses lazyUpdate**: Streaming preserves DataZoom scroll position (unlike `setOption` which resets it).

Write this content to skill/skills/candlestick-chart/SKILL.md.
  </action>
  <verify>
    <automated>grep -c "open, close, low, high\|OhlcBar\|MAConfig" /Users/sn0w/Documents/dev/lit-components/skill/skills/candlestick-chart/SKILL.md</automated>
  </verify>
  <done>skill/skills/candlestick-chart/SKILL.md exists with prominent OHLC order warning, OhlcBar and CandlestickBarPoint type definitions, all 4 chart-specific props, MAConfig type documented.</done>
</task>

<task type="auto">
  <name>Task 2: Create skill/skills/treemap-chart/SKILL.md</name>
  <files>skill/skills/treemap-chart/SKILL.md</files>
  <action>
Create the directory skill/skills/treemap-chart/ and write skill/skills/treemap-chart/SKILL.md.

The pushData() NOT SUPPORTED warning MUST be prominent — it is a silent failure (no error thrown, chart just does not update).

Content:

---
name: lit-ui-treemap-chart
description: >-
  How to use <lui-treemap-chart> — hierarchical data, breadcrumb navigation, rounded cells, levelColors, data updates.
---

# Treemap Chart

Hierarchical space-filling treemap chart built on ECharts. Supports breadcrumb drill-down navigation, rounded cell borders, and per-level color palettes.

**IMPORTANT:** `pushData()` is NOT supported on treemap charts. Calling `pushData()` on a treemap logs a console warning and does nothing. To update data, reassign the `.data` property directly.

## Usage

**Important:** `data` and `option` are JS properties — not HTML attributes.

```js
import '@lit-ui/charts/treemap-chart';

const chart = document.querySelector('lui-treemap-chart');
chart.data = [
  {
    name: 'Technology',
    value: 80,
    children: [
      { name: 'Frontend', value: 35 },
      { name: 'Backend', value: 30 },
      { name: 'DevOps', value: 15 },
    ],
  },
  {
    name: 'Design',
    value: 45,
    children: [
      { name: 'UI', value: 25 },
      { name: 'UX', value: 20 },
    ],
  },
];
```

```html
<!-- Rounded cells, no breadcrumb -->
<lui-treemap-chart rounded></lui-treemap-chart>
<lui-treemap-chart breadcrumb="false"></lui-treemap-chart>

<!-- Per-level colors (JSON string of string[][]) -->
<lui-treemap-chart level-colors='[["#ef4444","#f97316","#eab308"],["#3b82f6","#8b5cf6"]]'></lui-treemap-chart>
```

```tsx
// React
import { useRef, useEffect } from 'react';
function TreemapChartDemo({ data }) {
  const ref = useRef(null);
  useEffect(() => {
    if (ref.current) ref.current.data = data;
  }, [data]);
  return <lui-treemap-chart ref={ref} rounded />;
}
```

```js
// Updating treemap data — DO NOT use pushData()
const chart = document.querySelector('lui-treemap-chart');

// WRONG: pushData() is a no-op (console.warn, no update)
// chart.pushData({ name: 'New Node', value: 10 }); // ← does nothing

// CORRECT: reassign .data to trigger a re-render
chart.data = [...updatedHierarchy];
```

## Data Type

```ts
type TreemapNode = {
  name: string;
  value: number;
  children?: TreemapNode[]; // optional — leaf nodes have no children
};

// chart.data is TreemapNode[]
chart.data = [
  {
    name: 'Category A',
    value: 40,
    children: [
      { name: 'Sub A1', value: 25 },
      { name: 'Sub A2', value: 15 },
    ],
  },
  { name: 'Category B', value: 30 }, // leaf node
];
```

## Props

For shared props (data, option, loading, enableGl, maxPoints) see `skills/charts`.

| Prop | Attribute | Type | Default | Description |
|------|-----------|------|---------|-------------|
| `breadcrumb` | `breadcrumb` | `boolean` | `true` | Show ECharts breadcrumb navigation for drill-down into child nodes. |
| `rounded` | `rounded` | `boolean` | `false` | Apply border-radius to cells (6px top level, decremented per depth level). |
| `levelColors` | `level-colors` | `string \| null` | `null` | JSON string of `string[][]` — per-level color palettes. See behavior notes. |

## Methods

| Method | Signature | Description |
|--------|-----------|-------------|
| `getChart()` | `() => EChartsType \| undefined` | Direct ECharts instance access. |
| `pushData(point)` | — | **NOT SUPPORTED.** Logs console.warn and does nothing. Use `.data` reassignment instead. |

## CSS Custom Properties

See `skills/charts` for all 17 shared `--ui-chart-*` tokens.

## Behavior Notes

- **pushData() not supported**: Treemap overrides `pushData()` with a console.warn no-op to prevent the base class circular buffer from corrupting hierarchical data. Update treemap data by reassigning the `.data` property.
- **JS property required**: `data` and `option` must be set as JS properties.
- **levelColors requires array-of-arrays**: `levelColors` must be a `string[][]` — an array of arrays where each inner array is the color palette for one depth level. A flat `string[]` (single array of colors) is silently rejected and no colors are applied. Example: `[["#ef4444","#f97316"],["#3b82f6"]]` — first level uses red/orange, second level uses blue.
- **levelColors as JSON string**: The `level-colors` attribute accepts a JSON string. Pass it as `'[["#ef4444"],["#3b82f6"]]'`. In JavaScript, use `JSON.stringify(colorArrayOfArrays)`.
- **breadcrumb: false behavior**: When `breadcrumb` is `false`, users can still click to drill down but cannot navigate back via breadcrumb — use the ECharts instance from `getChart()` to programmatically navigate if needed.
- **Drill-down state preserved**: When the `data` prop changes, the component uses `notMerge: false` internally so the user's current drill-down position in the hierarchy is preserved.

Write this content to skill/skills/treemap-chart/SKILL.md.
  </action>
  <verify>
    <automated>grep -c "pushData.*NOT\|NOT.*pushData\|no-op\|console.warn" /Users/sn0w/Documents/dev/lit-components/skill/skills/treemap-chart/SKILL.md</automated>
  </verify>
  <done>skill/skills/treemap-chart/SKILL.md exists with prominent pushData() NOT SUPPORTED warning, TreemapNode type, all 3 chart-specific props (breadcrumb/rounded/levelColors), levelColors array-of-arrays requirement documented.</done>
</task>

</tasks>

<verification>
1. `ls skill/skills/candlestick-chart/SKILL.md skill/skills/treemap-chart/SKILL.md` — both files exist
2. `grep "open, close, low, high" skill/skills/candlestick-chart/SKILL.md` — OHLC order documented correctly
3. `grep "NOT SUPPORTED\|no-op\|pushData" skill/skills/treemap-chart/SKILL.md` — pushData limitation prominent
4. `grep "string\[\]\[\]\|array-of-arrays" skill/skills/treemap-chart/SKILL.md` — levelColors format warning present
5. `grep "MAConfig\|moving-averages" skill/skills/candlestick-chart/SKILL.md` — moving averages documented
</verification>

<success_criteria>
- skill/skills/candlestick-chart/SKILL.md created with CRITICAL OHLC order warning as top-of-file notice, OhlcBar/CandlestickBarPoint/MAConfig types, and all 4 props
- skill/skills/treemap-chart/SKILL.md created with IMPORTANT pushData() NOT SUPPORTED notice, TreemapNode type, levelColors array-of-arrays requirement
- Both files follow established skill format
</success_criteria>

<output>
After completion, create `.planning/phases/97-update-skills-to-include-recent-addition-of-chart-system-there-should-be-a-detailed-sub-skill-for-each-chart-type-and-main-router-skill-needs-to-be-updated-too/97-04-SUMMARY.md`
</output>
