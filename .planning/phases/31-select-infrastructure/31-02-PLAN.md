---
phase: 31-select-infrastructure
plan: 02
type: execute
wave: 2
depends_on: ["31-01"]
files_modified:
  - packages/select/package.json
  - packages/select/tsconfig.json
  - packages/select/vite.config.ts
  - packages/select/src/index.ts
  - packages/select/src/select.ts
  - packages/select/src/jsx.d.ts
  - packages/select/src/vite-env.d.ts
autonomous: true

must_haves:
  truths:
    - "Developer can import Select from @lit-ui/select"
    - "Package includes @floating-ui/dom as bundled dependency"
    - "Skeleton component renders trigger with placeholder text"
    - "Package builds successfully with pnpm build"
    - "Component uses CSS tokens from Plan 01"
  artifacts:
    - path: "packages/select/package.json"
      provides: "Package configuration with Floating UI dependency"
      contains: "@floating-ui/dom"
    - path: "packages/select/src/select.ts"
      provides: "Select component class"
      contains: "class Select extends TailwindElement"
    - path: "packages/select/src/index.ts"
      provides: "Package entry point with element registration"
      contains: "lui-select"
    - path: "packages/select/dist/index.js"
      provides: "Built package output"
  key_links:
    - from: "packages/select/src/select.ts"
      to: "@floating-ui/dom"
      via: "import statement"
      pattern: "from '@floating-ui/dom'"
    - from: "packages/select/src/select.ts"
      to: "packages/core/src/styles/tailwind.css"
      via: "CSS variable references"
      pattern: "var\\(--ui-select-"
---

<objective>
Create the @lit-ui/select package with skeleton component and Floating UI integration.

Purpose: Establish the package infrastructure that will house the Select component. The skeleton component validates the build pipeline, CSS token integration, and Floating UI dependency - full functionality comes in Phase 32.

Output: A buildable @lit-ui/select package with a minimal Select component that renders a trigger button and imports Floating UI.
</objective>

<execution_context>
@/Users/sn0w/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sn0w/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/31-select-infrastructure/31-RESEARCH.md
@.planning/phases/31-select-infrastructure/31-01-SUMMARY.md

# Reference files for patterns
@packages/input/package.json
@packages/input/src/index.ts
@packages/input/src/input.ts
@packages/input/src/jsx.d.ts
@packages/input/vite.config.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create package structure and configuration files</name>
  <files>
packages/select/package.json
packages/select/tsconfig.json
packages/select/vite.config.ts
packages/select/src/vite-env.d.ts
  </files>
  <action>
Create the @lit-ui/select package directory and configuration files following the @lit-ui/input pattern exactly.

1. Create directory: `packages/select/src/`

2. Create `packages/select/package.json`:
```json
{
  "name": "@lit-ui/select",
  "version": "1.0.0",
  "description": "Accessible select/dropdown component built with Lit and Tailwind CSS",
  "author": "",
  "license": "MIT",
  "repository": {
    "type": "git",
    "url": "git+https://github.com/user/lit-ui.git",
    "directory": "packages/select"
  },
  "keywords": [
    "lit",
    "web-components",
    "ui",
    "tailwind",
    "ssr",
    "select",
    "dropdown",
    "combobox"
  ],
  "type": "module",
  "main": "dist/index.js",
  "module": "dist/index.js",
  "types": "dist/index.d.ts",
  "exports": {
    ".": {
      "import": "./dist/index.js",
      "types": "./dist/index.d.ts"
    }
  },
  "files": [
    "dist"
  ],
  "sideEffects": true,
  "scripts": {
    "dev": "vite build --watch",
    "build": "vite build"
  },
  "peerDependencies": {
    "lit": "^3.0.0",
    "@lit-ui/core": "^1.0.0"
  },
  "dependencies": {
    "@floating-ui/dom": "^1.7.4"
  },
  "devDependencies": {
    "@lit-ui/core": "workspace:*",
    "@lit-ui/typescript-config": "workspace:*",
    "@lit-ui/vite-config": "workspace:*",
    "@tailwindcss/vite": "^4.1.18",
    "lit": "^3.3.2",
    "tailwindcss": "^4.1.18",
    "typescript": "^5.9.3",
    "vite": "^7.3.1",
    "vite-plugin-dts": "^4.5.4"
  }
}
```

Key difference from input: `@floating-ui/dom` in `dependencies` (not devDependencies or peerDependencies).

3. Create `packages/select/tsconfig.json`:
```json
{
  "extends": "@lit-ui/typescript-config/library.json",
  "compilerOptions": {
    "outDir": "./dist",
    "rootDir": "./src",
    "baseUrl": "."
  },
  "include": ["src"]
}
```

4. Create `packages/select/vite.config.ts`:
```typescript
import { createLibraryConfig } from '@lit-ui/vite-config/library';

export default createLibraryConfig({
  entry: 'src/index.ts'
});
```

5. Create `packages/select/src/vite-env.d.ts`:
```typescript
/// <reference types="vite/client" />
```
  </action>
  <verify>
Run `ls -la packages/select/` to confirm directory structure exists.
Run `cat packages/select/package.json | grep floating-ui` to confirm dependency is present.
  </verify>
  <done>
packages/select/ directory exists with package.json (including @floating-ui/dom dependency), tsconfig.json, vite.config.ts, and src/vite-env.d.ts files.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create skeleton Select component with Floating UI</name>
  <files>
packages/select/src/select.ts
packages/select/src/index.ts
packages/select/src/jsx.d.ts
  </files>
  <action>
Create the skeleton Select component that validates CSS tokens work and Floating UI imports correctly.

1. Create `packages/select/src/select.ts`:
```typescript
/**
 * lui-select - A customizable select/dropdown component
 *
 * Features (Phase 32+):
 * - Single select with dropdown
 * - Keyboard navigation
 * - Form participation via ElementInternals
 * - SSR compatible
 *
 * @example
 * ```html
 * <lui-select placeholder="Select an option">
 *   <lui-option value="1">Option 1</lui-option>
 * </lui-select>
 * ```
 */

import { html, css, isServer } from 'lit';
import { property } from 'lit/decorators.js';
import { TailwindElement, tailwindBaseStyles } from '@lit-ui/core';
// Import Floating UI to validate dependency works - used in Phase 32
import { computePosition, flip, shift, offset, size } from '@floating-ui/dom';

/**
 * Select size types for padding and font sizing
 */
export type SelectSize = 'sm' | 'md' | 'lg';

/**
 * A customizable select component with dropdown.
 * Supports form participation via ElementInternals.
 * Form participation is client-side only (guarded with isServer check).
 *
 * @slot default - Options to display in the dropdown (lui-option elements)
 */
export class Select extends TailwindElement {
  /**
   * Enable form association for this custom element.
   * This allows the select to participate in form submission.
   */
  static formAssociated = true;

  /**
   * ElementInternals for form participation.
   * Null during SSR since attachInternals() is not available.
   */
  private internals: ElementInternals | null = null;

  /**
   * The size of the select affecting padding and font size.
   * @default 'md'
   */
  @property({ type: String })
  size: SelectSize = 'md';

  /**
   * Placeholder text displayed when no option is selected.
   * @default 'Select an option'
   */
  @property({ type: String })
  placeholder = 'Select an option';

  /**
   * The name of the select for form submission.
   * @default ''
   */
  @property({ type: String })
  name = '';

  /**
   * The current value of the select.
   * @default ''
   */
  @property({ type: String })
  value = '';

  /**
   * Whether the select is disabled.
   * @default false
   */
  @property({ type: Boolean, reflect: true })
  disabled = false;

  /**
   * Whether the select is required for form submission.
   * @default false
   */
  @property({ type: Boolean, reflect: true })
  required = false;

  constructor() {
    super();
    // Only attach internals on client (not during SSR)
    if (!isServer) {
      this.internals = this.attachInternals();
    }
  }

  /**
   * Static styles for the select component.
   * Uses CSS custom properties from Phase 31 tokens.
   */
  static override styles = [
    ...tailwindBaseStyles,
    css`
      :host {
        display: inline-block;
      }

      :host([disabled]) {
        pointer-events: none;
      }

      /* Trigger button - the clickable select display */
      .trigger {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 0.5rem;
        width: 100%;
        border-radius: var(--ui-select-radius);
        border-width: var(--ui-select-border-width);
        border-style: solid;
        border-color: var(--ui-select-border);
        background-color: var(--ui-select-bg);
        color: var(--ui-select-text);
        cursor: pointer;
        transition: border-color var(--ui-select-transition);
      }

      .trigger:focus {
        outline: none;
        border-color: var(--ui-select-border-focus);
      }

      .trigger:focus-visible {
        outline: 2px solid var(--ui-select-ring);
        outline-offset: 2px;
      }

      /* Size variants */
      .trigger-sm {
        padding: var(--ui-select-padding-y-sm) var(--ui-select-padding-x-sm);
        font-size: var(--ui-select-font-size-sm);
      }

      .trigger-md {
        padding: var(--ui-select-padding-y-md) var(--ui-select-padding-x-md);
        font-size: var(--ui-select-font-size-md);
      }

      .trigger-lg {
        padding: var(--ui-select-padding-y-lg) var(--ui-select-padding-x-lg);
        font-size: var(--ui-select-font-size-lg);
      }

      /* Disabled state */
      .trigger-disabled {
        background-color: var(--ui-select-bg-disabled);
        color: var(--ui-select-text-disabled);
        border-color: var(--ui-select-border-disabled);
        cursor: not-allowed;
      }

      /* Placeholder text */
      .placeholder {
        color: var(--ui-select-placeholder);
      }

      /* Chevron icon */
      .chevron {
        flex-shrink: 0;
        width: 1em;
        height: 1em;
        opacity: 0.5;
      }
    `,
  ];

  /**
   * Get the CSS classes for the trigger element.
   */
  private getTriggerClasses(): string {
    const classes = ['trigger', `trigger-${this.size}`];
    if (this.disabled) {
      classes.push('trigger-disabled');
    }
    return classes.join(' ');
  }

  /**
   * Placeholder method for positioning dropdown.
   * Full implementation in Phase 32.
   */
  protected async positionDropdown(
    trigger: HTMLElement,
    dropdown: HTMLElement
  ): Promise<void> {
    // Skip during SSR - dropdown isn't visible anyway
    if (isServer) return;

    const { x, y } = await computePosition(trigger, dropdown, {
      placement: 'bottom-start',
      strategy: 'fixed',
      middleware: [
        offset(4),
        flip({ fallbackPlacements: ['top-start'] }),
        shift({ padding: 8 }),
        size({
          apply({ availableHeight, elements }) {
            Object.assign(elements.floating.style, {
              maxHeight: `${Math.min(availableHeight, 240)}px`,
            });
          },
        }),
      ],
    });

    Object.assign(dropdown.style, {
      left: `${x}px`,
      top: `${y}px`,
    });
  }

  override render() {
    return html`
      <div
        class=${this.getTriggerClasses()}
        role="combobox"
        aria-expanded="false"
        aria-haspopup="listbox"
        aria-disabled=${this.disabled ? 'true' : 'false'}
        tabindex=${this.disabled ? '-1' : '0'}
      >
        <span class="placeholder">${this.placeholder}</span>
        <svg
          class="chevron"
          viewBox="0 0 16 16"
          fill="none"
          stroke="currentColor"
          aria-hidden="true"
        >
          <path
            d="M4 6l4 4 4-4"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          />
        </svg>
      </div>
    `;
  }
}
```

2. Create `packages/select/src/index.ts`:
```typescript
// @lit-ui/select - Select component with SSR support
/// <reference path="./jsx.d.ts" />
import { isServer } from 'lit';

// Export component class and types
export { Select } from './select.js';
export type { SelectSize } from './select.js';

// Re-export TailwindElement and isServer for convenience
export { TailwindElement, isServer } from '@lit-ui/core';

// Safe custom element registration with collision detection
// Register on both server (via @lit-labs/ssr-dom-shim) and client
import { Select } from './select.js';

if (typeof customElements !== 'undefined') {
  if (!customElements.get('lui-select')) {
    customElements.define('lui-select', Select);
  } else if (!isServer && import.meta.env?.DEV) {
    console.warn(
      '[lui-select] Custom element already registered. ' +
        'This may indicate duplicate imports or version conflicts.'
    );
  }
}

// TypeScript global type registration
declare global {
  interface HTMLElementTagNameMap {
    'lui-select': Select;
  }
}
```

3. Create `packages/select/src/jsx.d.ts`:
```typescript
/**
 * JSX type declarations for lui-select custom element.
 * Provides type support for React, Vue, and Svelte.
 */

import type { Select, SelectSize } from './select.js';

// Common attributes for lui-select
interface LuiSelectAttributes {
  size?: SelectSize;
  name?: string;
  value?: string;
  placeholder?: string;
  required?: boolean;
  disabled?: boolean;
}

// React JSX support
declare global {
  namespace JSX {
    interface IntrinsicElements {
      'lui-select': React.DetailedHTMLProps<
        React.HTMLAttributes<Select> & LuiSelectAttributes,
        Select
      >;
    }
  }
}

// Vue support
declare module 'vue' {
  export interface GlobalComponents {
    'lui-select': import('vue').DefineComponent<LuiSelectAttributes>;
  }
}

// Svelte support
declare namespace svelteHTML {
  interface IntrinsicElements {
    'lui-select': LuiSelectAttributes & {
      onchange?: (e: Event) => void;
      'on:change'?: (e: CustomEvent) => void;
    };
  }
}

export {};
```
  </action>
  <verify>
Run `ls -la packages/select/src/` to confirm all source files exist.
Run `grep "computePosition" packages/select/src/select.ts` to confirm Floating UI import.
Run `grep "ui-select" packages/select/src/select.ts` to confirm CSS token usage.
  </verify>
  <done>
packages/select/src/ contains select.ts (skeleton component using CSS tokens and Floating UI), index.ts (entry point with element registration), and jsx.d.ts (framework type declarations).
  </done>
</task>

<task type="auto">
  <name>Task 3: Install dependencies and build package</name>
  <files>packages/select/dist/index.js</files>
  <action>
Install workspace dependencies and build the select package to verify everything works.

1. Run `pnpm install` from workspace root to install @floating-ui/dom and link workspace dependencies.

2. Run `pnpm --filter @lit-ui/select build` to build the package.

3. Verify the build output exists at `packages/select/dist/index.js`.

If build fails:
- Check for TypeScript errors in the output
- Verify @lit-ui/core is correctly linked (pnpm install should handle this)
- Ensure vite.config.ts is using the correct shared config

Expected output:
- dist/index.js - bundled JavaScript
- dist/index.d.ts - TypeScript declarations
  </action>
  <verify>
Run `ls -la packages/select/dist/` to confirm build output exists.
Run `grep "floating-ui" packages/select/dist/index.js` to confirm Floating UI is bundled (not externalized).
  </verify>
  <done>
@lit-ui/select package builds successfully, producing dist/index.js and dist/index.d.ts with Floating UI bundled.
  </done>
</task>

</tasks>

<verification>
1. `ls packages/select/` shows package.json, tsconfig.json, vite.config.ts, src/
2. `cat packages/select/package.json | grep floating-ui` returns match
3. `ls packages/select/src/` shows index.ts, select.ts, jsx.d.ts, vite-env.d.ts
4. `grep "var(--ui-select" packages/select/src/select.ts` returns multiple matches
5. `pnpm --filter @lit-ui/select build` completes without errors
6. `ls packages/select/dist/` shows index.js, index.d.ts
</verification>

<success_criteria>
- [ ] packages/select/ directory structure matches @lit-ui/input pattern
- [ ] package.json includes @floating-ui/dom in dependencies
- [ ] select.ts uses --ui-select-* CSS variables
- [ ] select.ts imports and uses @floating-ui/dom
- [ ] index.ts registers lui-select custom element
- [ ] jsx.d.ts provides React/Vue/Svelte types
- [ ] `pnpm --filter @lit-ui/select build` succeeds
- [ ] dist/ contains built JavaScript and type declarations
</success_criteria>

<output>
After completion, create `.planning/phases/31-select-infrastructure/31-02-SUMMARY.md`
</output>
