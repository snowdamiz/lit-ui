---
phase: 102-docs-skills-update
plan: "02"
type: execute
wave: 1
depends_on: []
files_modified:
  - skill/skills/candlestick-chart/SKILL.md
autonomous: true
requirements:
  - none
must_haves:
  truths:
    - "An AI agent reading skill/skills/candlestick-chart/SKILL.md knows that MAConfig.color is optional (CSS token default), MAConfig.showType appends the type to the legend label, NaN closes produce null MA gaps (not NaN propagation), and changing movingAverages after streaming requires full reinit"
    - "The MAConfig type definition in the skill file is accurate: color is optional (not required), showType is present"
  artifacts:
    - path: "skill/skills/candlestick-chart/SKILL.md"
      provides: "Complete v10.0 candlestick skill file with MA features"
      contains: "showType"
  key_links:
    - from: "skill/skills/candlestick-chart/SKILL.md MAConfig type block"
      to: "color?: string (optional)"
      via: "TypeScript type definition in code block"
      pattern: "color\\?:"
    - from: "skill/skills/candlestick-chart/SKILL.md Behavior Notes"
      to: "NaN closes are gaps"
      via: "bullet point"
      pattern: "NaN"
---

<objective>
Update the candlestick-chart skill file with all v10.0 moving average changes: MAConfig.showType option, optional color with CSS-token defaults, NaN-gap rule, and "Looks Done But Isn't" reinit warning.

Purpose: The current candlestick skill file was written before Phase 99 added the incremental MA state machine. It documents MAConfig.color as required (not optional), omits showType, and has no NaN-gap rule. AI agents reading it will generate incorrect code (missing showType, passing required color when it can be omitted, not warning about reinit).
Output: Updated candlestick-chart SKILL.md with accurate MA v10.0 API and behavior notes.
</objective>

<execution_context>
@/Users/sn0w/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sn0w/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/phases/102-docs-skills-update/102-RESEARCH.md
@skill/skills/candlestick-chart/SKILL.md

<interfaces>
<!-- Source: packages/charts/src/shared/candlestick-option-builder.ts (confirmed in RESEARCH.md) -->
<!-- Full MAConfig type as implemented in v10.0: -->
```typescript
type MAConfig = {
  period: number;        // number of bars in MA window (required)
  color?: string;        // optional hex color — omit to use CSS token defaults
  type?: 'sma' | 'ema'; // default: 'sma'
  showType?: boolean;    // when true: legend shows "MA20 (EMA)" instead of "MA20"
};
```

<!-- CSS token default assignment order (from _MA_DEFAULT_COLOR_TOKENS in candlestick-chart.ts): -->
<!-- MA overlay 1 → --ui-chart-color-2 (skips color-1 reserved for primary data series) -->
<!-- MA overlay 2 → --ui-chart-color-3 -->
<!-- MA overlay 3 → --ui-chart-color-4 -->
<!-- MA overlay 4 → --ui-chart-color-5 -->
<!-- MA overlay 5+ → cycles back to --ui-chart-color-2 -->

<!-- NaN behavior (from ma-state-machine.ts SMAState.push() + EMAState.push()): -->
<!-- NaN close → returns null (gap in MA line) — running SMA sum is NOT modified -->
<!-- Source: MA-03 requirement, confirmed Phase 99 implementation -->
</interfaces>
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update MAConfig type definition and Usage examples</name>
  <files>skill/skills/candlestick-chart/SKILL.md</files>
  <action>
**1. Fix the `MAConfig` type in the `## Data Type` section.**

Current (incorrect — color is required):
```typescript
type MAConfig = {
  period: number;        // e.g. 20 for 20-period MA
  color: string;         // hex color for the MA line
  type?: 'sma' | 'ema'; // default: 'sma'
};
```

Replace with (correct — color is optional, showType added):
```typescript
type MAConfig = {
  period: number;        // number of bars in MA window (required)
  color?: string;        // optional — omit to use CSS token defaults (see Behavior Notes)
  type?: 'sma' | 'ema'; // default: 'sma'
  showType?: boolean;    // when true: legend label becomes "MA20 (EMA)" instead of "MA20"
};
```

**2. Update the `moving-averages` HTML attribute example in `## Usage`.**

Current example:
```html
<lui-candlestick-chart moving-averages='[{"period":20,"color":"#f59e0b"},{"period":50,"color":"#8b5cf6","type":"ema"}]'></lui-candlestick-chart>
```

Replace with an example showing both color-omitted (CSS default) and color-explicit patterns, plus showType:
```html
<!-- MA with explicit colors -->
<lui-candlestick-chart moving-averages='[{"period":20,"color":"#f59e0b"},{"period":50,"color":"#8b5cf6","type":"ema"}]'></lui-candlestick-chart>

<!-- MA with CSS token defaults (omit color — auto-assigned --ui-chart-color-2, -3, -4...) -->
<lui-candlestick-chart moving-averages='[{"period":20},{"period":50,"type":"ema","showType":true}]'></lui-candlestick-chart>
<!-- Second MA above: legend shows "MA50 (EMA)" because showType is true -->
```

**3. Add a NaN streaming example** to the `## Usage` section after the `pushData` example:

```js
// NaN closes produce null MA gaps — they do NOT corrupt the MA window
chart.pushData({ label: '2024-01-03', ohlc: [105, NaN, 103, 122] });
// This bar's MA value will be null → rendered as a gap in the MA line
// Next valid close resumes MA calculation cleanly
```
  </action>
  <verify>
    <automated>grep -c "color?:" /Users/sn0w/Documents/dev/lit-components/skill/skills/candlestick-chart/SKILL.md && grep -c "showType" /Users/sn0w/Documents/dev/lit-components/skill/skills/candlestick-chart/SKILL.md</automated>
  </verify>
  <done>The MAConfig type block in candlestick-chart/SKILL.md shows `color?: string` (optional), has `showType?: boolean`, and the Usage section has an example with showType and a NaN example.</done>
</task>

<task type="auto">
  <name>Task 2: Add v10.0 Behavior Notes and "Looks Done But Isn't" warning</name>
  <files>skill/skills/candlestick-chart/SKILL.md</files>
  <action>
Append new behavior notes to the `## Behavior Notes` section. Keep ALL existing notes and add the following new ones:

**New note — MA default colors:**
`- **MA CSS token default colors**: When \`MAConfig.color\` is omitted, MA overlays receive colors from the CSS token sequence: \`--ui-chart-color-2\` (first MA), \`--ui-chart-color-3\` (second), \`--ui-chart-color-4\` (third), \`--ui-chart-color-5\` (fourth), cycling back to color-2 for a fifth. \`--ui-chart-color-1\` is reserved for the candlestick data series and is intentionally skipped.`

**New note — NaN closes are gaps:**
`- **NaN closes are gaps**: A \`NaN\` close value in a streaming bar returns \`null\` for that bar's MA value — rendered as a gap in the MA line. NaN is NOT propagated through the SMA/EMA window and does NOT corrupt the running sum. MA calculation resumes cleanly on the next valid close.`

**New note — showType legend label:**
`- **showType appends MA type to legend**: Setting \`showType: true\` in MAConfig changes the legend label from "MA20" to "MA20 (SMA)" or "MA20 (EMA)" depending on the \`type\` field.`

**New warning — MA reinit (this is the "Looks Done But Isn't" callout — keep it prominent):**

Insert a blank line before this note, then add:
`- **LOOKS DONE BUT ISN'T — Changing movingAverages after streaming starts**: If you reassign the \`moving-averages\` attribute after \`pushData()\` has been called, the new MA config takes effect but the state machines rebuild from only the current \`_ohlcBuffer\` (which may have been trimmed). Historical MA values before the trim are lost. To get correct MA history after a config change, call \`chart.data = []\` first to perform a full reinit, then replay your history. The chart will appear correct for new bars immediately, so the corruption of historical MA is easy to miss.`
  </action>
  <verify>
    <automated>grep -c "NaN" /Users/sn0w/Documents/dev/lit-components/skill/skills/candlestick-chart/SKILL.md && grep -c "LOOKS DONE" /Users/sn0w/Documents/dev/lit-components/skill/skills/candlestick-chart/SKILL.md && grep -c "ui-chart-color-2" /Users/sn0w/Documents/dev/lit-components/skill/skills/candlestick-chart/SKILL.md</automated>
  </verify>
  <done>candlestick-chart/SKILL.md Behavior Notes section contains: NaN-gap rule, "LOOKS DONE BUT ISN'T" reinit warning, CSS token default color sequence (--ui-chart-color-2 through -5), showType legend note. All counts >= 1.</done>
</task>

</tasks>

<verification>
```bash
echo "=== MAConfig type check ===" && grep "color?:" /Users/sn0w/Documents/dev/lit-components/skill/skills/candlestick-chart/SKILL.md
echo "=== showType present ===" && grep "showType" /Users/sn0w/Documents/dev/lit-components/skill/skills/candlestick-chart/SKILL.md | head -5
echo "=== NaN gap rule ===" && grep "NaN" /Users/sn0w/Documents/dev/lit-components/skill/skills/candlestick-chart/SKILL.md | head -5
echo "=== Reinit warning ===" && grep "LOOKS DONE" /Users/sn0w/Documents/dev/lit-components/skill/skills/candlestick-chart/SKILL.md
echo "=== CSS token colors ===" && grep "ui-chart-color-2" /Users/sn0w/Documents/dev/lit-components/skill/skills/candlestick-chart/SKILL.md
```
All should return non-empty matches.
</verification>

<success_criteria>
- MAConfig.color is `color?: string` (optional) in the type block — not `color: string`
- MAConfig.showType documented with example showing "MA20 (EMA)" legend behavior
- NaN-gap rule present: NaN close → null MA → gap in line, SMA window not corrupted
- "LOOKS DONE BUT ISN'T" reinit warning present
- CSS token default color sequence documented (color-2 through color-5, skipping color-1)
- No future requirements (MA-05 full ThemeBridge dark mode NOT documented as current)
</success_criteria>

<output>
After completion, create `.planning/phases/102-docs-skills-update/102-02-SUMMARY.md`
</output>
