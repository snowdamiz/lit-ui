---
phase: 43-calendar-display-advanced
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - packages/calendar/src/date-utils.ts
autonomous: true

must_haves:
  truths:
    - "getISOWeekNumber wraps date-fns getISOWeek"
    - "getWeekRange returns start and end dates of an ISO week"
    - "getMonthWeeks returns all week numbers for a displayed month"
  artifacts:
    - path: "packages/calendar/src/date-utils.ts"
      provides: "ISO 8601 week number utilities"
      exports: ["getISOWeekNumber", "getWeekRange", "getMonthWeeks"]
  key_links:
    - from: "packages/calendar/src/date-utils.ts"
      to: "date-fns"
      via: "import"
      pattern: "getISOWeek|startOfISOWeek|endOfISOWeek"
---

<objective>
Add ISO 8601 week number utility functions to date-utils.ts.

Purpose: Week number display (CAL-26) and week selection (CAL-27) require ISO week calculations. date-fns provides the heavy lifting; we create wrapper functions matching the project pattern.
Output: Three new exported functions in date-utils.ts for week number calculations.
</objective>

<execution_context>
@/Users/sn0w/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sn0w/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@packages/calendar/src/date-utils.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add ISO week number functions to date-utils.ts</name>
  <files>packages/calendar/src/date-utils.ts</files>
  <action>
Add the following to date-utils.ts:

1. Add new date-fns imports: `getISOWeek`, `startOfISOWeek`, `endOfISOWeek`, `eachDayOfInterval` (eachDayOfInterval may already be imported - check first)

2. Add `getISOWeekNumber(date: Date): number` function:
   - Wraps `getISOWeek(date)` from date-fns
   - Returns ISO 8601 week number (1-53)
   - Add JSDoc with example showing year boundary edge case (Dec 31 can be week 1)

3. Add `getWeekRange(date: Date): { start: Date; end: Date }` function:
   - Returns `{ start: startOfISOWeek(date), end: endOfISOWeek(date) }`
   - ISO weeks always start Monday, end Sunday
   - Add JSDoc with example

4. Add `WeekInfo` interface:
   ```typescript
   export interface WeekInfo {
     weekNumber: number;
     startDate: Date;
     endDate: Date;
   }
   ```

5. Add `getMonthWeeks(monthDate: Date): WeekInfo[]` function:
   - Get all days in the month via getMonthDays
   - For each unique week number, create a WeekInfo entry
   - Use a Map keyed on weekNumber to deduplicate
   - Return sorted array of WeekInfo objects
   - Handle year boundary: Jan 1 may have weekNumber 52/53 from previous year

Follow the existing code style in date-utils.ts (JSDoc comments, explicit typing, examples).
  </action>
  <verify>
`npx tsc --noEmit -p packages/calendar/tsconfig.json` compiles without errors.
  </verify>
  <done>
Three new ISO week functions exported from date-utils.ts: getISOWeekNumber, getWeekRange, getMonthWeeks. All use date-fns for correct ISO 8601 week calculation including year boundary edge cases.
  </done>
</task>

</tasks>

<verification>
- `npx tsc --noEmit -p packages/calendar/tsconfig.json` passes
- New imports from date-fns: getISOWeek, startOfISOWeek, endOfISOWeek
- WeekInfo interface exported
- getMonthWeeks returns correct week numbers for any month
</verification>

<success_criteria>
ISO week utility functions ready for Calendar week number column integration.
</success_criteria>

<output>
After completion, create `.planning/phases/43-calendar-display-advanced/43-03-SUMMARY.md`
</output>
