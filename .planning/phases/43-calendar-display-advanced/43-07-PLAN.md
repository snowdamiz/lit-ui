---
phase: 43-calendar-display-advanced
plan: 07
type: execute
wave: 5
depends_on: ["43-06"]
files_modified:
  - packages/calendar/src/calendar.ts
  - packages/calendar/src/calendar-multi.ts
autonomous: true

must_haves:
  truths:
    - "Calendar adapts layout based on container size (not viewport)"
    - "Multi-month display stacks vertically on narrow containers"
    - "Small container shows compact cell sizes"
    - "Large container shows spacious cell sizes"
  artifacts:
    - path: "packages/calendar/src/calendar.ts"
      provides: "Container query responsive styles"
      contains: "@container calendar"
    - path: "packages/calendar/src/calendar-multi.ts"
      provides: "Responsive multi-month layout"
      contains: "@container"
  key_links:
    - from: "packages/calendar/src/calendar.ts"
      to: "CSS container queries"
      via: "container-type: inline-size on :host"
      pattern: "container-type.*inline-size"
---

<objective>
Add responsive container query layout to Calendar and CalendarMulti.

Purpose: Calendar needs to adapt to its container size (CAL-29), not viewport size. This enables the calendar to work in sidebars, modals, and narrow layouts without viewport media queries. Multi-month display should stack vertically on narrow containers.
Output: Calendar and CalendarMulti with container query responsive styles.
</objective>

<execution_context>
@/Users/sn0w/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sn0w/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@packages/calendar/src/calendar.ts
@packages/calendar/src/calendar-multi.ts
@.planning/phases/43-calendar-display-advanced/43-RESEARCH.md
@.planning/phases/43-calendar-display-advanced/43-06-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add container queries to Calendar</name>
  <files>packages/calendar/src/calendar.ts</files>
  <action>
Update Calendar static styles to use container queries:

1. Update `:host` rule to add container query support:
   ```css
   :host {
     display: block;
     position: relative;
     container-type: inline-size;
     container-name: calendar;
   }
   ```

2. Add container query breakpoints that complement (not replace) the size prop system:
   ```css
   /* Compact: container < 280px */
   @container calendar (max-width: 280px) {
     [role='grid'] { gap: 0.125rem; }
     [role='gridcell'] { min-height: 1.75rem; font-size: 0.7rem; }
     [role='columnheader'] { padding: 0.125rem; font-size: 0.7rem; }
     .calendar-header h2 { font-size: 0.75rem; }
     .calendar-header button { font-size: 0.75rem; padding: 0.125rem 0.25rem; }
     .calendar-selectors select { font-size: 0.7rem; padding: 0.125rem 0.25rem; }
   }

   /* Standard: 280px - 380px (default, no overrides needed) */

   /* Spacious: container > 380px */
   @container calendar (min-width: 380px) {
     [role='gridcell'] { min-height: 3rem; }
     .calendar-header h2 { font-size: 1.25rem; }
   }
   ```

3. Container queries should work alongside the existing size prop (sm/md/lg). The size prop sets the base, container queries adjust for available space.

4. Decade/century grid cells should also adapt:
   ```css
   @container calendar (max-width: 280px) {
     .year-grid [role="gridcell"], .decade-grid [role="gridcell"] {
       min-height: 2rem;
       font-size: 0.75rem;
     }
   }
   ```
  </action>
  <verify>
`npx tsc --noEmit -p packages/calendar/tsconfig.json` compiles.
  </verify>
  <done>
Calendar uses container queries to adapt layout to its container size. Works in sidebars, modals, and narrow layouts.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add responsive layout to CalendarMulti</name>
  <files>packages/calendar/src/calendar-multi.ts</files>
  <action>
Update CalendarMulti styles for responsive behavior:

1. Add container query support to :host:
   ```css
   :host {
     display: block;
     container-type: inline-size;
     container-name: calendar-multi;
   }
   ```

2. Update .calendar-grid-container for responsive wrapping:
   ```css
   .calendar-grid-container {
     display: flex;
     flex-wrap: wrap;
     gap: 1rem;
   }
   .calendar-grid-container > * {
     flex: 1 1 280px; /* Each month needs at least 280px */
   }
   ```

3. Add container query for stacking:
   ```css
   @container calendar-multi (max-width: 600px) {
     .calendar-grid-container {
       flex-direction: column;
     }
     .calendar-grid-container > * {
       flex: 1 1 auto;
     }
   }
   ```

4. Ensure dark mode styles are present for all new responsive elements.
  </action>
  <verify>
`npx tsc --noEmit -p packages/calendar/tsconfig.json` compiles.
`pnpm --filter @lit-ui/calendar build` succeeds.
  </verify>
  <done>
CalendarMulti stacks vertically on narrow containers and displays side-by-side on wide containers. Layout adapts to container, not viewport.
  </done>
</task>

</tasks>

<verification>
- TypeScript compiles: `npx tsc --noEmit -p packages/calendar/tsconfig.json`
- Build passes: `pnpm --filter @lit-ui/calendar build`
- Calendar has container-type: inline-size on :host
- Calendar has @container queries for compact and spacious layouts
- CalendarMulti has responsive flex-wrap layout
- CalendarMulti stacks at narrow widths
</verification>

<success_criteria>
Calendar and CalendarMulti adapt responsively to their container size using container queries. Works correctly in sidebars, modals, and full-width layouts.
</success_criteria>

<output>
After completion, create `.planning/phases/43-calendar-display-advanced/43-07-SUMMARY.md`
</output>
