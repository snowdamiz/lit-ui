---
phase: 43-calendar-display-advanced
plan: 07
type: execute
wave: 5
depends_on: ["43-06"]
files_modified:
  - packages/calendar/src/calendar.ts
  - packages/calendar/src/calendar-multi.ts
autonomous: true

must_haves:
  truths:
    - "Calendar uses container queries with three breakpoints: compact (<280px), standard (280-380px), spacious (>380px)"
    - "Container queries work inside Shadow DOM with container-type: inline-size on :host"
    - "CalendarMulti stacks calendars vertically when container width is below 600px"
    - "Compact mode uses smaller day cells and font sizes for narrow containers"
    - "Spacious mode uses larger day cells for wider containers"
  artifacts:
    - path: "packages/calendar/src/calendar.ts"
      provides: "Calendar with responsive container query layout"
      contains: "@container"
    - path: "packages/calendar/src/calendar-multi.ts"
      provides: "CalendarMulti with responsive stacking"
      contains: "@container"
  key_links:
    - from: "packages/calendar/src/calendar.ts"
      to: "CSS Container Queries"
      via: "container-type: inline-size on :host"
      pattern: "container-type.*inline-size"
---

<objective>
Add CSS container queries to Calendar and CalendarMulti for component-level responsive layout that adapts to container size rather than viewport.

Purpose: Web components may be placed in sidebars, modals, or full-width contexts. Container queries ensure the calendar adapts to its actual available space, not the viewport. This is the standard approach for component-level responsiveness.
Output: Calendar with three responsive breakpoints and CalendarMulti with vertical stacking for narrow containers.
</objective>

<execution_context>
@/Users/sn0w/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sn0w/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/43-calendar-display-advanced/43-RESEARCH.md
@.planning/phases/43-calendar-display-advanced/43-06-SUMMARY.md

Reference patterns from:
@packages/calendar/src/calendar.ts (current state after Plan 05)
@packages/calendar/src/calendar-multi.ts (from Plan 06)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add container queries to Calendar component</name>
  <files>packages/calendar/src/calendar.ts</files>
  <action>
    Update the static styles in Calendar to add container query support:

    1. Modify the `:host` rule to add container setup:
       ```css
       :host {
         display: block;
         container-type: inline-size;
       }
       ```

    2. Add container query rules at the END of the styles (after all existing CSS including dark mode):

       **Compact breakpoint (<280px):**
       ```css
       @container (max-width: 279px) {
         .calendar {
           --ui-calendar-width: 100%;
           --ui-calendar-day-size: 1.75rem;
         }
         .calendar-header h2,
         .view-heading {
           font-size: 0.75rem;
         }
         .weekday-header {
           font-size: 0.625rem;
           padding: 0.25rem 0;
         }
         .date-button {
           font-size: 0.75rem;
         }
         .nav-button {
           width: 1.5rem;
           height: 1.5rem;
         }
         .nav-button svg {
           width: 0.75rem;
           height: 0.75rem;
         }
         .year-cell, .decade-cell {
           padding: 0.5rem 0.25rem;
           font-size: 0.75rem;
         }
         .week-number {
           font-size: 0.625rem;
           width: 1.5rem;
         }
         .help-button {
           font-size: 0.625rem;
         }
       }
       ```

       **Spacious breakpoint (>380px):**
       ```css
       @container (min-width: 381px) {
         .calendar {
           --ui-calendar-day-size: 3rem;
         }
         .date-button {
           font-size: 1rem;
         }
         .weekday-header {
           font-size: 0.875rem;
         }
         .calendar-header h2,
         .view-heading {
           font-size: 1rem;
         }
         .year-cell, .decade-cell {
           padding: 1rem 0.75rem;
           font-size: 1rem;
         }
       }
       ```

       **Standard breakpoint (280-380px):** No additional styles needed â€” this is the default styling that already exists.

    3. Remove the hardcoded `width: var(--ui-calendar-width, 320px)` from `.calendar` and replace with `width: var(--ui-calendar-width, 100%); max-width: 380px;` so the calendar fills its container by default.
  </action>
  <verify>
    - `grep "container-type" packages/calendar/src/calendar.ts` confirms container setup
    - `grep "@container" packages/calendar/src/calendar.ts` confirms container queries exist
    - `grep "max-width: 279px" packages/calendar/src/calendar.ts` confirms compact breakpoint
    - `grep "min-width: 381px" packages/calendar/src/calendar.ts` confirms spacious breakpoint
  </verify>
  <done>Calendar has three container query breakpoints with responsive sizing for day cells, fonts, and navigation controls</done>
</task>

<task type="auto">
  <name>Task 2: Add container queries to CalendarMulti</name>
  <files>packages/calendar/src/calendar-multi.ts</files>
  <action>
    Update the static styles in CalendarMulti:

    1. Modify `:host` to add container setup:
       ```css
       :host {
         display: block;
         container-type: inline-size;
       }
       ```

    2. Add container query for vertical stacking on narrow containers:
       ```css
       @container (max-width: 599px) {
         .multi-wrapper {
           flex-direction: column;
         }
       }
       ```
       This makes the side-by-side calendars stack vertically when the CalendarMulti component's container is narrower than 600px.

    3. Add a wider container query for spacing:
       ```css
       @container (min-width: 800px) {
         .multi-wrapper {
           gap: 1.5rem;
         }
       }
       ```

    4. Ensure the multi-wrapper has proper defaults:
       ```css
       .multi-wrapper {
         display: flex;
         gap: 1rem;
         flex-wrap: wrap;
       }
       .multi-wrapper > * {
         min-width: 240px;
         flex: 1 1 280px;
       }
       ```
       Use flex-wrap: wrap as a fallback for browsers or contexts where container queries might not apply as expected. The flex-basis of 280px combined with flex-wrap naturally causes stacking when the container is too narrow.

    5. Add dark mode styles for CalendarMulti matching the Calendar dark mode pattern:
       ```css
       :host-context(.dark) .nav-button:hover {
         background-color: var(--ui-calendar-hover-bg, #1f2937);
       }
       :host-context(.dark) .multi-heading {
         color: var(--ui-calendar-text, #f9fafb);
       }
       ```
  </action>
  <verify>
    - `grep "container-type" packages/calendar/src/calendar-multi.ts` confirms container setup
    - `grep "@container" packages/calendar/src/calendar-multi.ts` confirms container queries
    - `grep "flex-direction: column" packages/calendar/src/calendar-multi.ts` confirms vertical stacking
    - `pnpm --filter @lit-ui/calendar build` succeeds
  </verify>
  <done>CalendarMulti stacks vertically at <600px container width, has responsive gap at >800px, with flex-wrap fallback</done>
</task>

</tasks>

<verification>
- `pnpm --filter @lit-ui/calendar build` completes without errors
- Calendar :host has container-type: inline-size
- Calendar has @container rules for compact (<280px) and spacious (>380px)
- CalendarMulti :host has container-type: inline-size
- CalendarMulti stacks vertically via @container (max-width: 599px)
- Both components use CSS custom properties that scale with container size
</verification>

<success_criteria>
1. Calendar adapts day cell size to container width (compact/standard/spacious)
2. Calendar fills its container width by default (not fixed 320px)
3. CalendarMulti stacks calendars vertically in narrow containers
4. Container queries work inside Shadow DOM
5. Package builds without errors
</success_criteria>

<output>
After completion, create `.planning/phases/43-calendar-display-advanced/43-07-SUMMARY.md`
</output>
