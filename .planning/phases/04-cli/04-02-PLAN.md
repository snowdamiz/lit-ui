---
phase: 04-cli
plan: 02
type: execute
wave: 2
depends_on: ["04-01"]
files_modified:
  - packages/cli/src/utils/config.ts
  - packages/cli/src/utils/detect-build-tool.ts
  - packages/cli/src/utils/detect-package-manager.ts
  - packages/cli/src/utils/logger.ts
autonomous: true

must_haves:
  truths:
    - "Config utility can read/write lit-ui.json with proper defaults"
    - "Build tool detection identifies Vite, Webpack, or esbuild from project files"
    - "Package manager detection works via lockfile or packageManager field"
  artifacts:
    - path: "packages/cli/src/utils/config.ts"
      provides: "lit-ui.json read/write operations"
      exports: ["getConfig", "writeConfig", "CONFIG_FILE"]
    - path: "packages/cli/src/utils/detect-build-tool.ts"
      provides: "Build tool detection"
      exports: ["detectBuildTool"]
    - path: "packages/cli/src/utils/detect-package-manager.ts"
      provides: "Package manager detection"
      exports: ["detectPackageManager", "getInstallCommand"]
  key_links:
    - from: "packages/cli/src/utils/config.ts"
      to: "fs-extra"
      via: "readJson/writeJson"
      pattern: "readJson|writeJson"
---

<objective>
Create utility functions for configuration management, build tool detection, and package manager detection.

Purpose: These utilities are shared by init, add, and list commands.
Output: Reusable utility modules that commands can import.
</objective>

<execution_context>
@/Users/sn0w/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sn0w/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/04-cli/04-RESEARCH.md
@.planning/phases/04-cli/04-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create config utility</name>
  <files>packages/cli/src/utils/config.ts</files>
  <action>
Create config.ts with:

1. Interface `LitUIConfig`:
   - $schema?: string
   - componentsPath: string (where to install components)
   - tailwind: { css: string } (path to user's tailwind CSS)
   - aliases: { components: string, base: string } (import aliases)

2. Constants:
   - CONFIG_FILE = "lit-ui.json"
   - DEFAULT_CONFIG with sensible defaults:
     - componentsPath: "src/components/ui"
     - tailwind.css: "src/styles/tailwind.css"
     - aliases.components: "@/components/ui"
     - aliases.base: "@/lib/lit-ui"

3. Functions:
   - `getConfig(cwd: string): Promise<LitUIConfig | null>` - read lit-ui.json with defu defaults
   - `writeConfig(cwd: string, config: Partial<LitUIConfig>): Promise<void>` - write with $schema
   - `configExists(cwd: string): Promise<boolean>` - check if config exists

Use fs-extra (readJson, writeJson), pathe (resolve), defu (merge defaults).
  </action>
  <verify>TypeScript compiles without errors</verify>
  <done>Config utility exports getConfig, writeConfig, configExists</done>
</task>

<task type="auto">
  <name>Task 2: Create build tool and package manager detection</name>
  <files>packages/cli/src/utils/detect-build-tool.ts, packages/cli/src/utils/detect-package-manager.ts</files>
  <action>
1. `detect-build-tool.ts`:
   - Interface BuildToolInfo: { name: 'vite' | 'webpack' | 'esbuild' | 'unknown', configFile?: string }
   - Function `detectBuildTool(cwd: string): BuildToolInfo`
   - Check for config files in order:
     - Vite: vite.config.ts, vite.config.js, vite.config.mts
     - Webpack: webpack.config.js, webpack.config.ts
     - esbuild: esbuild.config.js, esbuild.config.mjs
   - Fallback: check package.json devDependencies for vite/webpack/esbuild
   - Return { name: 'unknown' } if nothing detected
   - Use existsSync from fs, resolve from pathe

2. `detect-package-manager.ts`:
   - Use `detect` from package-manager-detector
   - Function `detectPackageManager(cwd: string): Promise<'npm' | 'yarn' | 'pnpm' | 'bun'>`
   - Function `getInstallCommand(pm: string, packages: string[]): string`
     - npm: "npm install {packages}"
     - yarn/pnpm/bun: "{pm} add {packages}"
  </action>
  <verify>TypeScript compiles, functions can be imported</verify>
  <done>Both detection utilities export their main functions</done>
</task>

<task type="auto">
  <name>Task 3: Create logger utility and rebuild</name>
  <files>packages/cli/src/utils/logger.ts</files>
  <action>
1. Create `logger.ts`:
   - Import consola, picocolors, ora
   - Export configured consola instance with custom formatters
   - Export helper functions:
     - `success(msg: string)` - green checkmark
     - `error(msg: string)` - red X
     - `warn(msg: string)` - yellow warning
     - `info(msg: string)` - blue info
     - `spinner(msg: string)` - returns ora spinner instance
   - Use picocolors for consistent coloring

2. Run build: `npm run build` in packages/cli
3. Verify no TypeScript errors

Note: Use picocolors directly (pc.green, pc.red, etc.) rather than consola's built-in colors for consistency.
  </action>
  <verify>cd packages/cli && npm run build succeeds</verify>
  <done>All utility modules compile and export correctly</done>
</task>

</tasks>

<verification>
- All utility files exist in packages/cli/src/utils/
- `npm run build` in packages/cli succeeds
- No TypeScript errors
</verification>

<success_criteria>
Utility layer complete with config, detection, and logging functions
</success_criteria>

<output>
After completion, create `.planning/phases/04-cli/04-02-SUMMARY.md`
</output>
