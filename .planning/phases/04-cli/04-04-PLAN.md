---
phase: 04-cli
plan: 04
type: execute
wave: 3
depends_on: ["04-02", "04-03"]
files_modified:
  - packages/cli/src/commands/init.ts
  - packages/cli/src/index.ts
autonomous: true

must_haves:
  truths:
    - "Running `lit-ui init` creates lit-ui.json config file"
    - "Init detects build tool and package manager automatically"
    - "Init copies base files (TailwindElement, styles) to user's project"
    - "Init provides Tailwind v4 CSS-based setup instructions"
  artifacts:
    - path: "packages/cli/src/commands/init.ts"
      provides: "Init command implementation"
      exports: ["init"]
    - path: "packages/cli/src/index.ts"
      provides: "CLI with init subcommand"
      contains: "init"
  key_links:
    - from: "packages/cli/src/commands/init.ts"
      to: "packages/cli/src/utils/config.ts"
      via: "writeConfig"
      pattern: "writeConfig"
    - from: "packages/cli/src/commands/init.ts"
      to: "packages/cli/src/utils/detect-build-tool.ts"
      via: "detectBuildTool"
      pattern: "detectBuildTool"
---

<objective>
Implement the `lit-ui init` command that sets up lit-ui in a user's project.

Purpose: Init is the entry point for new users - it creates config and copies base files.
Output: Working init command that detects environment and sets up project.
</objective>

<execution_context>
@/Users/sn0w/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sn0w/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/04-cli/04-RESEARCH.md
@.planning/phases/04-cli/04-CONTEXT.md
@.planning/phases/04-cli/04-02-SUMMARY.md
@.planning/phases/04-cli/04-03-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create init command</name>
  <files>packages/cli/src/commands/init.ts</files>
  <action>
Create init.ts using citty defineCommand:

1. Command definition:
   ```typescript
   export const init = defineCommand({
     meta: { name: 'init', description: 'Initialize lit-ui in your project' },
     args: {
       yes: { type: 'boolean', alias: 'y', description: 'Skip prompts', default: false },
       cwd: { type: 'string', description: 'Working directory', default: '.' },
     },
     async run({ args }) { ... }
   });
   ```

2. Init flow (from CONTEXT.md decisions):
   a. Check if lit-ui.json exists - warn if reinitializing
   b. Detect build tool (Vite/Webpack/esbuild/unknown)
   c. Detect package manager
   d. If not --yes, prompt for:
      - Components path (default: src/components/ui)
      - Confirm detected settings
   e. Write lit-ui.json config
   f. Show dependencies to install (lit)
   g. If not --yes, confirm before installing
   h. Copy base files:
      - base/tailwind-element.ts -> {componentsPath}/../lib/lit-ui/tailwind-element.ts
      - styles/tailwind.css -> {componentsPath}/../lib/lit-ui/tailwind.css
      - styles/host-defaults.css -> {componentsPath}/../lib/lit-ui/host-defaults.css
   i. Show setup instructions for Tailwind v4

3. Use consola for prompts, ora for spinners, picocolors for output.

4. Error handling:
   - If package.json not found, error with helpful message
   - If base file copy fails, show clear error
  </action>
  <verify>TypeScript compiles</verify>
  <done>Init command defined with full workflow</done>
</task>

<task type="auto">
  <name>Task 2: Implement file copying and setup instructions</name>
  <files>packages/cli/src/commands/init.ts</files>
  <action>
Add to init.ts:

1. File copying logic:
   - Get source path (relative to CLI package - need to bundle or reference)
   - For now, embed file content or reference from monorepo src/
   - Use fs-extra copy with proper paths
   - Create directories if they don't exist (ensureDir)

2. Tailwind v4 setup instructions per build tool:
   ```typescript
   const instructions = {
     vite: `
   Add to your main CSS file:
   @import "tailwindcss";
   @import "./lib/lit-ui/tailwind.css";
   @import "./lib/lit-ui/host-defaults.css";
   `,
     webpack: `
   Add to your main CSS file:
   @import "tailwindcss";
   @import "./lib/lit-ui/tailwind.css";
   @import "./lib/lit-ui/host-defaults.css";

   Ensure @tailwindcss/postcss is configured.
   `,
     unknown: `
   Add to your main CSS file:
   @import "tailwindcss";
   @import "./lib/lit-ui/tailwind.css";
   @import "./lib/lit-ui/host-defaults.css";
   `
   };
   ```

3. Success output:
   - Green checkmark for each completed step
   - Summary of created files
   - Next steps: "Run `lit-ui add button` to add your first component"

For file content sourcing strategy:
- Option A: Bundle source files into CLI dist (complex)
- Option B: Reference from monorepo during dev, fetch from npm in production
- Option C: Embed as template strings (simpler for MVP)

Use Option C for MVP - embed base file templates directly in init.ts or a templates module.
  </action>
  <verify>Init command handles all file operations</verify>
  <done>File copying and instructions implemented</done>
</task>

<task type="auto">
  <name>Task 3: Wire init to main CLI and test</name>
  <files>packages/cli/src/index.ts</files>
  <action>
1. Update src/index.ts to add init subcommand:
   ```typescript
   import { init } from './commands/init';

   const main = defineCommand({
     meta: { ... },
     subCommands: { init },
   });
   ```

2. Build: `npm run build`

3. Test init command:
   - Create a temp test directory
   - Run `node dist/index.js init --yes`
   - Verify lit-ui.json created
   - Verify base files copied
   - Clean up test directory

Fix any runtime errors discovered during testing.
  </action>
  <verify>lit-ui init creates config and copies files</verify>
  <done>Init command works end-to-end</done>
</task>

</tasks>

<verification>
- `lit-ui init` creates lit-ui.json in current directory
- `lit-ui init` copies base files to lib/lit-ui/
- `lit-ui init --help` shows command options
- Build tool and PM detection results shown in output
</verification>

<success_criteria>
Init command creates working lit-ui setup with config, base files, and instructions
</success_criteria>

<output>
After completion, create `.planning/phases/04-cli/04-04-SUMMARY.md`
</output>
