---
phase: 36-async-loading
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - packages/select/package.json
  - packages/select/src/select.ts
autonomous: true

must_haves:
  truths:
    - "Select component displays skeleton loading placeholders during async operations"
    - "Skeleton animation is smooth and matches option layout dimensions"
  artifacts:
    - path: "packages/select/package.json"
      provides: "New dependencies for async loading"
      contains: "@lit/task"
    - path: "packages/select/package.json"
      provides: "Virtual scrolling dependency"
      contains: "@tanstack/lit-virtual"
    - path: "packages/select/src/select.ts"
      provides: "Skeleton loading placeholder rendering"
      contains: "renderSkeletonOptions"
  key_links:
    - from: "packages/select/src/select.ts"
      to: "@lit/task"
      via: "import statement"
      pattern: "import.*@lit/task"
---

<objective>
Add dependencies for async loading features and implement skeleton loading placeholder rendering.

Purpose: Establish the foundation for all async loading capabilities by adding required libraries and implementing the shared skeleton loading UI pattern that will be used across initial load, search loading, and load-more states.

Output: Package.json updated with @lit/task and @tanstack/lit-virtual dependencies. Select component extended with skeleton option rendering method and CSS styles.
</objective>

<execution_context>
@/Users/sn0w/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sn0w/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/36-async-loading/36-RESEARCH.md
@packages/select/package.json
@packages/select/src/select.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add async loading dependencies to package.json</name>
  <files>packages/select/package.json</files>
  <action>
Add the following dependencies to packages/select/package.json:

In the "dependencies" section (not devDependencies), add:
- "@lit/task": "^1.0.3"
- "@tanstack/lit-virtual": "^3.13.2"

These are runtime dependencies that will be bundled with the select package. @lit/task provides reactive async state management with Task controller. @tanstack/lit-virtual provides virtual scrolling via VirtualizerController.

After updating package.json, run `pnpm install` from the monorepo root to install the new dependencies.
  </action>
  <verify>
Run `pnpm ls @lit/task @tanstack/lit-virtual --filter @lit-ui/select` to verify dependencies are installed.
  </verify>
  <done>
@lit/task and @tanstack/lit-virtual appear in packages/select dependencies and are installed.
  </done>
</task>

<task type="auto">
  <name>Task 2: Implement skeleton loading placeholder rendering</name>
  <files>packages/select/src/select.ts</files>
  <action>
Add skeleton loading placeholder rendering to the Select component. This will be the shared UI pattern used across:
- Initial async options loading
- Async search loading
- Load-more infinite scroll loading

1. Add CSS styles for skeleton elements within the static styles array:

```css
/* Skeleton loading placeholders */
.option-skeleton {
  display: flex;
  align-items: center;
  padding: var(--ui-select-option-padding-y, 0.5rem)
    var(--ui-select-option-padding-x, 0.75rem);
  gap: 0.5rem;
}

.skeleton-indicator {
  width: 1rem;
  height: 1rem;
  border-radius: var(--radius-sm, 0.25rem);
  background: var(--ui-select-skeleton-bg, hsl(200, 20%, 88%));
  animation: skeleton-pulse 1.5s ease-in-out infinite;
  flex-shrink: 0;
}

.skeleton-text {
  height: 1rem;
  border-radius: var(--radius-sm, 0.25rem);
  background: var(--ui-select-skeleton-bg, hsl(200, 20%, 88%));
  animation: skeleton-pulse 1.5s ease-in-out infinite;
}

/* Vary skeleton text widths for natural appearance */
.skeleton-text-1 { width: 70%; }
.skeleton-text-2 { width: 55%; }
.skeleton-text-3 { width: 80%; }
.skeleton-text-4 { width: 60%; }

@keyframes skeleton-pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.5; }
}

/* Dark mode skeleton colors */
:host-context(.dark) .skeleton-indicator,
:host-context(.dark) .skeleton-text {
  background: var(--ui-select-skeleton-bg, hsl(200, 10%, 30%));
}
```

2. Add a private method to render skeleton loading placeholders:

```typescript
/**
 * Render skeleton loading placeholders.
 * Used during initial async load, search loading, and load-more.
 * @param count Number of skeleton rows to render (default 4)
 */
private renderSkeletonOptions(count = 4) {
  // Rotate through text widths for natural appearance
  const textWidths = ['skeleton-text-1', 'skeleton-text-2', 'skeleton-text-3', 'skeleton-text-4'];

  return html`
    ${Array.from({ length: count }).map((_, index) => html`
      <div class="option-skeleton" role="presentation" aria-hidden="true">
        ${this.multiple ? html`
          <div class="skeleton-indicator"></div>
        ` : nothing}
        <div class="skeleton-text ${textWidths[index % textWidths.length]}"></div>
      </div>
    `)}
  `;
}
```

The skeleton uses the checkbox indicator width in multi-select mode to maintain visual consistency with real options. Vary text widths across the 4 rows for a more natural appearance.

Note: Import `nothing` from 'lit' if not already imported.
  </action>
  <verify>
Build the package with `pnpm --filter @lit-ui/select build` and verify no TypeScript errors. The skeleton styles and render method should compile correctly.
  </verify>
  <done>
Select component has renderSkeletonOptions method that returns skeleton placeholder HTML. CSS includes skeleton-pulse animation and skeleton element styles with dark mode support.
  </done>
</task>

</tasks>

<verification>
1. `pnpm --filter @lit-ui/select build` succeeds without errors
2. Dependencies @lit/task and @tanstack/lit-virtual are listed in package.json dependencies
3. Select component TypeScript compiles with new skeleton rendering method
</verification>

<success_criteria>
- @lit/task ^1.0.3 added to dependencies
- @tanstack/lit-virtual ^3.x added to dependencies
- renderSkeletonOptions method added to Select class
- Skeleton CSS styles with pulse animation added
- Package builds successfully
</success_criteria>

<output>
After completion, create `.planning/phases/36-async-loading/36-01-SUMMARY.md`
</output>
