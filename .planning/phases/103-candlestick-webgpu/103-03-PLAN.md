---
phase: 103-candlestick-webgpu
plan: "03"
type: execute
wave: 2
depends_on:
  - "103-01"
files_modified:
  - skill/skills/candlestick-chart/SKILL.md
  - skill/skills/charts/SKILL.md
autonomous: true
requirements:
  - WEBGPU-CNDL-03

must_haves:
  truths:
    - "Candlestick skill file documents enable-webgpu, renderer, and renderer-selected with candlestick-specific notes (MA overlays stay in ECharts; init-time color wiring only)"
    - "Shared charts skill file updated to note candlestick now also activates ChartGPU rendering (not just line/area)"
    - "Candlestick skill behavior notes include limitation: bull-color/bear-color changes after init do not update GPU layer colors"
  artifacts:
    - path: "skill/skills/candlestick-chart/SKILL.md"
      provides: "WebGPU props documented for candlestick"
      contains: "enable-webgpu"
    - path: "skill/skills/charts/SKILL.md"
      provides: "Shared enableWebGpu row updated to include candlestick"
      contains: "line/area/candlestick"
  key_links:
    - from: "skill/skills/candlestick-chart/SKILL.md::Props table"
      to: "enable-webgpu row"
      via: "| enableWebGpu | enable-webgpu | boolean | false | ..."
      pattern: "enable-webgpu"
    - from: "skill/skills/charts/SKILL.md::Shared Props table"
      to: "enableWebGpu row description"
      via: "Only line/area/candlestick charts activate ChartGPU rendering"
      pattern: "candlestick"
---

<objective>
Update the candlestick chart skill file and shared charts skill file with v10.0 WebGPU props applicable to candlestick.

Purpose: AI agents and developers reading the skill files need accurate information to configure WebGPU on candlestick charts. The shared skill file currently says "only line/area charts activate ChartGPU" — this is now incorrect.

Output: Updated `skill/skills/candlestick-chart/SKILL.md` with WebGPU props section; updated `skill/skills/charts/SKILL.md` with corrected shared enableWebGpu description.
</objective>

<execution_context>
@/Users/sn0w/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sn0w/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/103-candlestick-webgpu/103-RESEARCH.md
@.planning/phases/103-candlestick-webgpu/103-01-SUMMARY.md

<interfaces>
<!-- Current skill file state — key sections to modify. -->

From skill/skills/charts/SKILL.md (Shared Props table, row to update):
```markdown
| `enableWebGpu` | `enable-webgpu` | `boolean` | `false` | Opt-in WebGPU detection. All charts inherit this from BaseChartElement. Only line/area charts activate ChartGPU rendering; other chart types fire `renderer-selected` but remain on Canvas. |
```
CHANGE: "line/area" → "line/area/candlestick" and update description.

From skill/skills/charts/SKILL.md (Shared Events table, row to update):
```markdown
| `renderer-selected` | `{ renderer: 'webgpu' \| 'webgl' \| 'canvas' }` | Fires in `firstUpdated()` when the renderer tier is determined. All 8 charts fire this when `enable-webgpu` is set. Only line/area charts activate ChartGPU; others fall through to Canvas. |
```
CHANGE: "line/area" → "line/area/candlestick"

From skill/skills/candlestick-chart/SKILL.md (Props section to extend):
```markdown
## Props

For shared props (data, option, loading, enableGl, maxPoints) see `skills/charts`.

| Prop | Attribute | Type | Default | Description |
|------|-----------|------|---------|-------------|
| `bullColor` | `bull-color` | `string \| null` | `null` → `'#26a69a'` | Rising candle fill color. |
| `bearColor` | `bear-color` | `string \| null` | `null` → `'#ef5350'` | Falling candle fill color. |
| `showVolume` | `show-volume` | `boolean` | `false` | Render a volume bar panel... |
| `movingAverages` | `moving-averages` | `string \| null` | `null` | JSON string of MAConfig[]... |
```
ADD: enable-webgpu and renderer rows to this table.
CHANGE: first line "For shared props (data, option, loading, enableGl, maxPoints)" → add enableWebGpu to list.
</interfaces>
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update candlestick-chart SKILL.md with WebGPU props and behavior notes</name>
  <files>skill/skills/candlestick-chart/SKILL.md</files>
  <action>
Make two targeted changes to `skill/skills/candlestick-chart/SKILL.md`:

**Change 1 — Props section header line: add enableWebGpu to the shared props reference.**
Change:
```
For shared props (data, option, loading, enableGl, maxPoints) see `skills/charts`.
```
To:
```
For shared props (data, option, loading, enableGl, maxPoints, enableWebGpu, renderer) see `skills/charts`.
```

**Change 2 — Props table: add enable-webgpu and renderer rows.**
Append these two rows to the end of the props table (after the `movingAverages` row):
```markdown
| `enableWebGpu` | `enable-webgpu` | `boolean` | `false` | Opt-in WebGPU rendering via ChartGPU 0.3.2. When set and WebGPU is available, renders OHLC candles on a GPU-accelerated canvas beneath ECharts. MA overlay lines, volume bars, axes, tooltip, and DataZoom slider always render in ECharts regardless of renderer. Falls back to Canvas automatically on unsupported browsers. |
| `renderer` | — (read-only) | `'webgpu' \| 'webgl' \| 'canvas'` | `'canvas'` | Active renderer tier after `renderer-selected` fires. Read from the event, not synchronously — the async GPU probe may not have resolved at element creation time. |
```

**Change 3 — Behavior Notes: add two WebGPU-specific notes.**
Append these bullet points to the existing Behavior Notes section (after the last existing bullet):
```markdown
- **WebGPU candles only — MA/volume stay in ECharts**: When `enable-webgpu` is set and WebGPU is active, ChartGPU renders only the OHLC candle bodies and wicks. Moving average overlay lines, volume bars, axes, legend, tooltip, and DataZoom slider all render in the ECharts canvas layer above. ECharts candlestick series is set to transparent colors internally to prevent double-rendering.
- **Bull/bear colors are init-time only on WebGPU path**: `bull-color` and `bear-color` are passed to ChartGPU at `_initWebGpuLayer()` time. If you change these attributes after chart initialization, ECharts updates its (transparent) candlestick series, but ChartGPU candle colors do not update. To apply new colors on the GPU path, recreate the chart element. (Full dynamic color wiring deferred to v10.1.)
- **DataZoom sync works with show-volume**: When `show-volume` is true (two-grid layout), the DataZoom percent-space sync to ChartGPU's `setZoomRange()` still works correctly — both ECharts grids and the ChartGPU layer are synchronized via the same `start`/`end` percent values.
```
  </action>
  <verify>
    <automated>grep -n "enable-webgpu\|enableWebGpu\|WebGPU candles\|Bull/bear colors are init" /Users/sn0w/Documents/dev/lit-components/skill/skills/candlestick-chart/SKILL.md</automated>
  </verify>
  <done>Candlestick SKILL.md has: enable-webgpu and renderer in props table; enableWebGpu added to shared props reference line; 3 WebGPU behavior notes including MA/volume caveat and init-time color limitation</done>
</task>

<task type="auto">
  <name>Task 2: Update shared charts SKILL.md to include candlestick in ChartGPU activation list</name>
  <files>skill/skills/charts/SKILL.md</files>
  <action>
Make two targeted changes to `skill/skills/charts/SKILL.md`:

**Change 1 — Shared Props table: update enableWebGpu row description.**
Change:
```markdown
| `enableWebGpu` | `enable-webgpu` | `boolean` | `false` | Opt-in WebGPU detection. All charts inherit this from BaseChartElement. Only line/area charts activate ChartGPU rendering; other chart types fire `renderer-selected` but remain on Canvas. |
```
To:
```markdown
| `enableWebGpu` | `enable-webgpu` | `boolean` | `false` | Opt-in WebGPU detection. All charts inherit this from BaseChartElement. Line, area, and candlestick charts activate ChartGPU rendering when WebGPU is available. Other chart types fire `renderer-selected` but remain on Canvas. |
```

**Change 2 — Shared Events table: update renderer-selected row description.**
Change:
```markdown
| `renderer-selected` | `{ renderer: 'webgpu' \| 'webgl' \| 'canvas' }` | Fires in `firstUpdated()` when the renderer tier is determined. All 8 charts fire this when `enable-webgpu` is set. Only line/area charts activate ChartGPU; others fall through to Canvas. |
```
To:
```markdown
| `renderer-selected` | `{ renderer: 'webgpu' \| 'webgl' \| 'canvas' }` | Fires in `firstUpdated()` when the renderer tier is determined. All 8 charts fire this when `enable-webgpu` is set. Line, area, and candlestick charts activate ChartGPU rendering; other chart types fall through to Canvas. |
```
  </action>
  <verify>
    <automated>grep -n "line/area/candlestick\|line, area, and candlestick\|candlestick charts activate" /Users/sn0w/Documents/dev/lit-components/skill/skills/charts/SKILL.md</automated>
  </verify>
  <done>Shared charts SKILL.md updated: enableWebGpu shared prop description includes candlestick; renderer-selected event description includes candlestick in ChartGPU activation list</done>
</task>

</tasks>

<verification>
```bash
# Verify candlestick skill has WebGPU content
grep -n "enable-webgpu\|WebGPU candles\|Bull/bear colors are init\|init-time only" /Users/sn0w/Documents/dev/lit-components/skill/skills/candlestick-chart/SKILL.md

# Verify shared skill has candlestick in ChartGPU list
grep -n "candlestick" /Users/sn0w/Documents/dev/lit-components/skill/skills/charts/SKILL.md
```
</verification>

<success_criteria>
- `skill/skills/candlestick-chart/SKILL.md` contains enable-webgpu and renderer prop rows
- Candlestick skill shared props reference line includes "enableWebGpu, renderer"
- Three WebGPU behavior notes added: MA/volume stays in ECharts, init-time color limitation, show-volume DataZoom sync works
- `skill/skills/charts/SKILL.md` enableWebGpu description reads "Line, area, and candlestick charts activate ChartGPU rendering"
- Shared renderer-selected event description updated to include candlestick
</success_criteria>

<output>
After completion, create `.planning/phases/103-candlestick-webgpu/103-03-SUMMARY.md`
</output>
