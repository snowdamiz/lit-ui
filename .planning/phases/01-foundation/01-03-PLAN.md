---
phase: 01-foundation
plan: 03
type: execute
wave: 2
depends_on: ["01-01", "01-02"]
files_modified:
  - src/base/tailwind-element.ts
  - src/index.ts
autonomous: true

must_haves:
  truths:
    - "TailwindElement base class extends LitElement"
    - "Compiled Tailwind CSS is injected into Shadow DOM via constructable stylesheets"
    - "@property rules are extracted and applied to document level"
    - "Components extending TailwindElement automatically get Tailwind styles"
  artifacts:
    - path: "src/base/tailwind-element.ts"
      provides: "TailwindElement base class for all components"
      exports: ["TailwindElement"]
      min_lines: 20
    - path: "src/index.ts"
      provides: "Library entry point with TailwindElement export"
      exports: ["TailwindElement"]
  key_links:
    - from: "src/base/tailwind-element.ts"
      to: "src/styles/tailwind.css"
      via: "CSS inline import"
      pattern: "tailwind\\.css\\?inline"
    - from: "src/base/tailwind-element.ts"
      to: "lit"
      via: "extends LitElement"
      pattern: "extends LitElement"
    - from: "src/index.ts"
      to: "src/base/tailwind-element.ts"
      via: "re-export"
      pattern: "export.*TailwindElement"
---

<objective>
Create the TailwindElement base class that automatically injects compiled Tailwind CSS into every component's Shadow DOM via constructable stylesheets.

Purpose: This is the core innovation of the library - enabling Tailwind utility classes inside Shadow DOM. All components will extend this class.
Output: A working base class that components can extend to get full Tailwind support in Shadow DOM.
</objective>

<execution_context>
@/Users/sn0w/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sn0w/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation/01-RESEARCH.md
@.planning/phases/01-foundation/01-01-SUMMARY.md
@.planning/phases/01-foundation/01-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create TailwindElement base class with CSS injection</name>
  <files>src/base/tailwind-element.ts</files>
  <action>
Create src/base/tailwind-element.ts implementing the TailwindElement base class.

Implementation pattern (from research Pattern 1):

1. Import dependencies:
   - LitElement, CSSResultGroup from 'lit'
   - unsafeCSS from 'lit'
   - Tailwind CSS as inline string: `import tailwindStyles from '../styles/tailwind.css?inline'`
   - Host defaults CSS: `import hostDefaults from '../styles/host-defaults.css?inline'`

2. Create shared CSSStyleSheet at module level (parse once, share everywhere):
   ```typescript
   const tailwindSheet = new CSSStyleSheet();
   tailwindSheet.replaceSync(tailwindStyles);

   const hostDefaultsSheet = new CSSStyleSheet();
   hostDefaultsSheet.replaceSync(hostDefaults);
   ```

3. Extract @property rules and apply to document (workaround for Shadow DOM):
   ```typescript
   const propertyRules = tailwindStyles.match(/@property[^}]+\{[^}]+\}/g) || [];
   if (propertyRules.length > 0 && typeof document !== 'undefined') {
     const propertySheet = new CSSStyleSheet();
     propertySheet.replaceSync(propertyRules.join('\n'));
     document.adoptedStyleSheets = [...document.adoptedStyleSheets, propertySheet];
   }
   ```

4. Create TailwindElement class:
   ```typescript
   export class TailwindElement extends LitElement {
     // Static styles merged with Tailwind
     static styles: CSSResultGroup = [];

     connectedCallback() {
       super.connectedCallback();
       this._adoptTailwindStyles();
     }

     private _adoptTailwindStyles() {
       if (this.shadowRoot) {
         const existingSheets = this.shadowRoot.adoptedStyleSheets;
         // Prepend Tailwind and host defaults (component styles come after)
         this.shadowRoot.adoptedStyleSheets = [
           tailwindSheet,
           hostDefaultsSheet,
           ...existingSheets
         ];
       }
     }
   }
   ```

CRITICAL implementation notes:
- Parse CSS ONCE at module level, not per instance
- Apply @property rules to document (they don't work in Shadow DOM)
- Use adoptedStyleSheets for efficient style sharing
- Prepend Tailwind sheets so component-specific styles can override
- Guard document access for SSR compatibility
  </action>
  <verify>
Check file exists: `ls src/base/tailwind-element.ts`
Verify exports: `grep "export class TailwindElement" src/base/tailwind-element.ts`
Verify imports CSS: `grep "tailwind.css?inline" src/base/tailwind-element.ts`
Verify extends LitElement: `grep "extends LitElement" src/base/tailwind-element.ts`
Run TypeScript check: `npx tsc --noEmit`
  </verify>
  <done>TailwindElement base class exists, exports correctly, and TypeScript compiles</done>
</task>

<task type="auto">
  <name>Task 2: Export TailwindElement from library entry point</name>
  <files>src/index.ts</files>
  <action>
Update src/index.ts to export TailwindElement.

```typescript
// Base class for Tailwind-enabled web components
export { TailwindElement } from './base/tailwind-element';
```

This establishes the public API. Consumers will import:
```typescript
import { TailwindElement } from 'lit-ui';
```
  </action>
  <verify>
Check export present: `grep "export.*TailwindElement" src/index.ts`
Run TypeScript check: `npx tsc --noEmit`
Run build: `npm run build` - should produce dist/ with type definitions
  </verify>
  <done>Library exports TailwindElement and builds successfully</done>
</task>

</tasks>

<verification>
After all tasks complete:
1. src/base/tailwind-element.ts exists and exports TailwindElement
2. TailwindElement extends LitElement
3. CSS is imported as inline string via ?inline
4. @property rules extracted and applied to document
5. adoptedStyleSheets used for efficient style injection
6. src/index.ts re-exports TailwindElement
7. `npm run build` succeeds with type definitions
8. `npx tsc --noEmit` passes
</verification>

<success_criteria>
- TailwindElement base class exists (src/base/tailwind-element.ts)
- Class extends LitElement and injects Tailwind CSS into Shadow DOM
- @property workaround implemented (rules applied to document)
- Library exports TailwindElement (import { TailwindElement } from 'lit-ui' works)
- Build produces dist/ with ES modules and type definitions
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-03-SUMMARY.md`
</output>
