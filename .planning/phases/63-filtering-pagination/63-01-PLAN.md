---
phase: 63-filtering-pagination
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - packages/data-table/src/types.ts
  - packages/data-table/src/data-table.ts
  - packages/data-table/src/index.ts
autonomous: true

must_haves:
  truths:
    - "Table accepts columnFilters state and applies TanStack filtering"
    - "Table accepts globalFilter state and filters across all columns"
    - "Filter changes emit ui-filter-change event with filter state"
    - "Filtered columns show visual indicator in header"
    - "Manual filtering mode passes filter state to callback instead of filtering locally"
  artifacts:
    - path: "packages/data-table/src/types.ts"
      provides: "FilterChangeEvent, FilterType enums, filter meta types"
      contains: "FilterChangeEvent"
    - path: "packages/data-table/src/data-table.ts"
      provides: "getFilteredRowModel integration, filter indicator rendering"
      contains: "getFilteredRowModel"
  key_links:
    - from: "packages/data-table/src/data-table.ts"
      to: "@tanstack/lit-table"
      via: "getFilteredRowModel import and usage"
      pattern: "getFilteredRowModel"
    - from: "packages/data-table/src/data-table.ts"
      to: "ui-filter-change event"
      via: "dispatchFilterChange method"
      pattern: "ui-filter-change"
---

<objective>
Integrate TanStack Table filtering state with the DataTable component, adding column filter and global filter support with visual indicators and event emission.

Purpose: Enable filtering infrastructure that filter components will use in Plan 02. Provides the state management, event system, and visual feedback needed for per-column and global filtering.

Output: DataTable component with working columnFilters and globalFilter properties, getFilteredRowModel integration, filter indicator in headers, and ui-filter-change events for both client-side and manual/server-side modes.
</objective>

<execution_context>
@/Users/sn0w/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sn0w/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/63-filtering-pagination/63-RESEARCH.md

@packages/data-table/src/data-table.ts
@packages/data-table/src/types.ts
@packages/data-table/src/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add filtering types and update DataTable state integration</name>
  <files>
    packages/data-table/src/types.ts
    packages/data-table/src/data-table.ts
  </files>
  <action>
In types.ts:
1. Add FilterType enum: 'text' | 'number' | 'date' | 'select' (for column meta)
2. Add FilterChangeEvent interface with:
   - columnFilters: ColumnFiltersState
   - globalFilter: string
   - changedColumn?: string (which column filter changed, if any)
   - isGlobalFilter: boolean (true if global filter changed)
3. Extend LitUIColumnMeta with:
   - filterType?: FilterType
   - filterOptions?: string[] (for select filter options)
   - enableFiltering?: boolean (default true for filterable columns)

In data-table.ts:
1. Import getFilteredRowModel from @tanstack/lit-table
2. Add manualFiltering property (Boolean, attribute: 'manual-filtering', default false)
3. Update tableController.table() config to:
   - Add state.columnFilters and state.globalFilter
   - Add onColumnFiltersChange handler that updates this.columnFilters and dispatches event
   - Add onGlobalFilterChange handler that updates this.globalFilter and dispatches event
   - Add getFilteredRowModel: this.manualFiltering ? undefined : getFilteredRowModel()
   - Add manualFiltering: this.manualFiltering
4. Add dispatchFilterChange(columnFilters, globalFilter, changedColumn?) method that emits CustomEvent 'ui-filter-change' with FilterChangeEvent detail
5. Update the existing filter state change detection (currently in updated()) to use the new infrastructure

IMPORTANT: The columnFilters and globalFilter properties already exist (added in 62-03 for selection clearing). Enhance them, don't duplicate.
  </action>
  <verify>
Run `pnpm build --filter @lit-ui/data-table` - should succeed with no type errors.
Verify getFilteredRowModel is imported and used in table config.
  </verify>
  <done>
DataTable accepts columnFilters and globalFilter state, integrates with TanStack getFilteredRowModel for client-side filtering, and manualFiltering mode skips local filtering.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add filter indicator to column headers</name>
  <files>
    packages/data-table/src/data-table.ts
  </files>
  <action>
1. Add renderFilterIndicator(column) method that:
   - Gets filter value via column.getFilterValue()
   - Returns nothing if filterValue is undefined/null/empty-string/empty-array
   - Returns a filter icon SVG (funnel shape) when column has active filter
   - Include aria-label="Column is filtered" for accessibility
   - Use class "filter-indicator" with title attribute for tooltip

2. Update renderHeaderCell to call renderFilterIndicator after sort indicator (or before header content)

3. Add CSS for filter indicator:
   ```css
   .filter-indicator {
     display: inline-flex;
     align-items: center;
     color: var(--color-primary, #3b82f6);
     margin-left: 4px;
   }

   .filter-indicator svg {
     width: 12px;
     height: 12px;
   }
   ```

4. Filter icon SVG path: viewBox="0 0 16 16", path="M1.5 1.5h13L9 7v5.5l-2 1.5V7L1.5 1.5z"
  </action>
  <verify>
Run `pnpm build --filter @lit-ui/data-table` - build succeeds.
Visually verify by setting a column's filter value - icon should appear in header.
  </verify>
  <done>
Column headers show a filter indicator icon when the column has an active filter value (FILT-08).
  </done>
</task>

<task type="auto">
  <name>Task 3: Export new types and update index</name>
  <files>
    packages/data-table/src/index.ts
    packages/data-table/src/types.ts
  </files>
  <action>
1. In index.ts, verify that types.ts exports are re-exported (they should be via export * from './types.js')

2. In types.ts, ensure all new types are exported:
   - FilterChangeEvent
   - FilterType (or keep as type literal union if preferred)

3. Verify that ColumnFiltersState is re-exported from TanStack (it already is per current types.ts)

No additional index.ts changes should be needed if using export * from './types.js'
  </action>
  <verify>
Run `pnpm build --filter @lit-ui/data-table` - build succeeds.
Check dist/index.d.ts contains FilterChangeEvent export.
  </verify>
  <done>
All new filtering types are exported from @lit-ui/data-table package.
  </done>
</task>

</tasks>

<verification>
1. `pnpm build --filter @lit-ui/data-table` succeeds
2. types.ts contains FilterChangeEvent interface
3. data-table.ts uses getFilteredRowModel from TanStack
4. data-table.ts has manualFiltering property
5. data-table.ts has renderFilterIndicator method
6. data-table.ts dispatches ui-filter-change events
</verification>

<success_criteria>
- DataTable integrates TanStack getFilteredRowModel for client-side filtering
- manualFiltering property switches to server-side mode
- ui-filter-change event emitted on filter state changes
- Filter indicator icon visible on columns with active filters
- All types properly exported
</success_criteria>

<output>
After completion, create `.planning/phases/63-filtering-pagination/63-01-SUMMARY.md`
</output>
