---
phase: 63-filtering-pagination
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - packages/data-table/src/types.ts
  - packages/data-table/src/data-table.ts
  - packages/data-table/src/pagination/pagination-controls.ts
  - packages/data-table/src/pagination/index.ts
  - packages/data-table/src/index.ts
autonomous: true

must_haves:
  truths:
    - "DataTable accepts pagination state (pageIndex, pageSize)"
    - "Pagination controls show prev/next and first/last buttons"
    - "Page size selector allows changing rows per page"
    - "Page info displays current page, total pages, and total records"
    - "Manual pagination mode emits events instead of paginating locally"
  artifacts:
    - path: "packages/data-table/src/types.ts"
      provides: "PaginationChangeEvent interface"
      contains: "PaginationChangeEvent"
    - path: "packages/data-table/src/pagination/pagination-controls.ts"
      provides: "lui-pagination-controls component"
      contains: "class PaginationControls"
    - path: "packages/data-table/src/data-table.ts"
      provides: "getPaginationRowModel integration"
      contains: "getPaginatedRowModel"
  key_links:
    - from: "packages/data-table/src/data-table.ts"
      to: "@tanstack/lit-table"
      via: "getPaginatedRowModel import"
      pattern: "getPaginatedRowModel"
    - from: "packages/data-table/src/pagination/pagination-controls.ts"
      to: "page-change event"
      via: "CustomEvent dispatch"
      pattern: "page-change"
---

<objective>
Add pagination support to the DataTable with TanStack Table integration and a reusable pagination controls component.

Purpose: Enable paginated data display with page navigation, page size selection, and "Showing X-Y of Z" info. Supports both client-side and server-side pagination modes.

Output: DataTable with pagination property, getPaginatedRowModel integration, and lui-pagination-controls component for page navigation UI.
</objective>

<execution_context>
@/Users/sn0w/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sn0w/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/63-filtering-pagination/63-RESEARCH.md

@packages/data-table/src/data-table.ts
@packages/data-table/src/types.ts
@packages/data-table/src/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add pagination types and DataTable state integration</name>
  <files>
    packages/data-table/src/types.ts
    packages/data-table/src/data-table.ts
  </files>
  <action>
In types.ts, add:

```typescript
/**
 * Event detail for pagination change events.
 */
export interface PaginationChangeEvent {
  /** Current page index (0-based) */
  pageIndex: number;
  /** Current page size */
  pageSize: number;
  /** Total page count (if known) */
  pageCount?: number;
}
```

In data-table.ts:

1. Import getPaginatedRowModel from @tanstack/lit-table (already imported as getPaginationRowModel - verify name)
2. Import PaginationState type from @tanstack/lit-table

3. Add properties:
```typescript
@property({ type: Object })
pagination: PaginationState = { pageIndex: 0, pageSize: 25 };

@property({ type: Boolean, attribute: 'manual-pagination' })
manualPagination = false;

@property({ type: Number, attribute: 'page-count' })
pageCount?: number; // For server-side pagination

@property({ type: Array, attribute: 'page-size-options' })
pageSizeOptions = [10, 25, 50, 100];
```

4. Update tableController.table() config:
```typescript
state: {
  // existing...
  pagination: this.pagination,
},
onPaginationChange: (updater) => {
  const newPagination = typeof updater === 'function'
    ? updater(this.pagination)
    : updater;
  this.pagination = newPagination;
  this.dispatchPaginationChange(newPagination);
},
getPaginatedRowModel: this.manualPagination ? undefined : getPaginatedRowModel(),
manualPagination: this.manualPagination,
pageCount: this.pageCount,
```

5. Add dispatchPaginationChange method:
```typescript
private dispatchPaginationChange(pagination: PaginationState): void {
  const event = new CustomEvent('ui-pagination-change', {
    detail: {
      pageIndex: pagination.pageIndex,
      pageSize: pagination.pageSize,
      pageCount: this.pageCount,
    } satisfies PaginationChangeEvent,
    bubbles: true,
    composed: true,
  });
  this.dispatchEvent(event);
}
```

6. Import the PaginationState type (should already be exported from types.ts via TanStack re-export)
  </action>
  <verify>
Run `pnpm build --filter @lit-ui/data-table` - should succeed.
Verify getPaginatedRowModel is conditionally used.
  </verify>
  <done>
DataTable integrates TanStack pagination state and emits ui-pagination-change events (PAGE-04 for manual mode).
  </done>
</task>

<task type="auto">
  <name>Task 2: Create pagination controls component</name>
  <files>
    packages/data-table/src/pagination/pagination-controls.ts
    packages/data-table/src/pagination/index.ts
  </files>
  <action>
Create pagination/ directory and pagination-controls.ts:

```typescript
/**
 * lui-pagination-controls - Pagination UI for data tables
 *
 * Provides page navigation (first, prev, next, last), page size selector,
 * and page info display ("Showing 1-25 of 1,000").
 */
import { html, css, nothing } from 'lit';
import { customElement, property } from 'lit/decorators.js';
import { TailwindElement, tailwindBaseStyles } from '@lit-ui/core';

@customElement('lui-pagination-controls')
export class PaginationControls extends TailwindElement {
  @property({ type: Number, attribute: 'page-index' })
  pageIndex = 0;

  @property({ type: Number, attribute: 'page-count' })
  pageCount = 1;

  @property({ type: Number, attribute: 'page-size' })
  pageSize = 25;

  @property({ type: Array, attribute: false })
  pageSizeOptions: number[] = [10, 25, 50, 100];

  @property({ type: Number, attribute: 'total-rows' })
  totalRows = 0;

  @property({ type: Boolean, attribute: 'show-page-size-selector' })
  showPageSizeSelector = true;

  private get canPrevious(): boolean {
    return this.pageIndex > 0;
  }

  private get canNext(): boolean {
    return this.pageIndex < this.pageCount - 1;
  }

  static override styles = [
    ...tailwindBaseStyles,
    css`
      :host {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 1rem;
        padding: 0.75rem 1rem;
        border-top: 1px solid var(--color-border, #e4e4e7);
        font-size: 0.875rem;
        color: var(--color-muted-foreground, #71717a);
      }

      .page-info {
        flex-shrink: 0;
      }

      .page-size-selector {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        flex-shrink: 0;
      }

      .page-size-selector label {
        white-space: nowrap;
      }

      .page-nav {
        display: flex;
        align-items: center;
        gap: 0.25rem;
      }

      .page-indicator {
        padding: 0 0.5rem;
        white-space: nowrap;
      }

      .nav-button {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 32px;
        height: 32px;
        padding: 0;
        border: 1px solid var(--color-border, #e4e4e7);
        border-radius: var(--ui-radius-sm, 0.25rem);
        background: var(--color-background, #ffffff);
        color: var(--color-foreground, #09090b);
        cursor: pointer;
        transition: background-color 0.15s, border-color 0.15s;
      }

      .nav-button:hover:not(:disabled) {
        background: var(--color-muted, #f4f4f5);
        border-color: var(--color-border, #e4e4e7);
      }

      .nav-button:focus-visible {
        outline: 2px solid var(--color-primary, #3b82f6);
        outline-offset: 2px;
      }

      .nav-button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }

      .nav-button svg {
        width: 16px;
        height: 16px;
        stroke-width: 2;
        stroke-linecap: round;
        stroke-linejoin: round;
      }

      :host-context(.dark) {
        border-color: #3f3f46;
      }

      :host-context(.dark) .nav-button {
        background: #09090b;
        border-color: #3f3f46;
        color: #fafafa;
      }

      :host-context(.dark) .nav-button:hover:not(:disabled) {
        background: #27272a;
      }

      @media (max-width: 640px) {
        :host {
          flex-wrap: wrap;
          justify-content: center;
        }
        .page-info {
          order: 1;
          width: 100%;
          text-align: center;
          margin-bottom: 0.5rem;
        }
      }
    `
  ];

  private handleFirst(): void {
    this.dispatchPageChange(0);
  }

  private handlePrevious(): void {
    if (this.canPrevious) {
      this.dispatchPageChange(this.pageIndex - 1);
    }
  }

  private handleNext(): void {
    if (this.canNext) {
      this.dispatchPageChange(this.pageIndex + 1);
    }
  }

  private handleLast(): void {
    this.dispatchPageChange(this.pageCount - 1);
  }

  private handlePageSizeChange(e: CustomEvent): void {
    const newSize = parseInt(e.detail.value, 10);
    this.dispatchEvent(new CustomEvent('page-size-change', {
      detail: { pageSize: newSize },
      bubbles: true,
      composed: true,
    }));
  }

  private dispatchPageChange(pageIndex: number): void {
    this.dispatchEvent(new CustomEvent('page-change', {
      detail: { pageIndex },
      bubbles: true,
      composed: true,
    }));
  }

  private renderPageInfo() {
    if (this.totalRows === 0) {
      return html`<div class="page-info">No results</div>`;
    }

    const startRow = this.pageIndex * this.pageSize + 1;
    const endRow = Math.min((this.pageIndex + 1) * this.pageSize, this.totalRows);

    return html`
      <div class="page-info">
        Showing ${startRow.toLocaleString()}-${endRow.toLocaleString()}
        of ${this.totalRows.toLocaleString()}
      </div>
    `;
  }

  private renderPageSizeSelector() {
    if (!this.showPageSizeSelector) return nothing;

    return html`
      <div class="page-size-selector">
        <label for="page-size">Rows per page:</label>
        <lui-select
          id="page-size"
          size="sm"
          .value=${this.pageSize.toString()}
          @ui-change=${this.handlePageSizeChange}
          style="width: 80px;"
        >
          ${this.pageSizeOptions.map(size => html`
            <lui-option value=${size.toString()}>${size}</lui-option>
          `)}
        </lui-select>
      </div>
    `;
  }

  override render() {
    return html`
      ${this.renderPageInfo()}
      ${this.renderPageSizeSelector()}

      <nav class="page-nav" role="navigation" aria-label="Pagination">
        <button
          type="button"
          class="nav-button"
          ?disabled=${!this.canPrevious}
          @click=${this.handleFirst}
          aria-label="First page"
          title="First page"
        >
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path d="M11 17l-5-5 5-5"/>
            <path d="M18 17l-5-5 5-5"/>
          </svg>
        </button>
        <button
          type="button"
          class="nav-button"
          ?disabled=${!this.canPrevious}
          @click=${this.handlePrevious}
          aria-label="Previous page"
          title="Previous page"
        >
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path d="M15 18l-6-6 6-6"/>
          </svg>
        </button>

        <span class="page-indicator">
          Page ${this.pageIndex + 1} of ${this.pageCount}
        </span>

        <button
          type="button"
          class="nav-button"
          ?disabled=${!this.canNext}
          @click=${this.handleNext}
          aria-label="Next page"
          title="Next page"
        >
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path d="M9 18l6-6-6-6"/>
          </svg>
        </button>
        <button
          type="button"
          class="nav-button"
          ?disabled=${!this.canNext}
          @click=${this.handleLast}
          aria-label="Last page"
          title="Last page"
        >
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path d="M13 17l5-5-5-5"/>
            <path d="M6 17l5-5-5-5"/>
          </svg>
        </button>
      </nav>
    `;
  }
}

// JSX type declaration
declare global {
  interface HTMLElementTagNameMap {
    'lui-pagination-controls': PaginationControls;
  }
}
```

Create pagination/index.ts:
```typescript
export { PaginationControls } from './pagination-controls.js';
```
  </action>
  <verify>
Run `pnpm build --filter @lit-ui/data-table` - should succeed.
Verify PaginationControls component is properly defined.
  </verify>
  <done>
Pagination controls show page navigation (PAGE-01), page size selector (PAGE-02), and total record count (PAGE-03).
  </done>
</task>

<task type="auto">
  <name>Task 3: Export pagination components and wire up DataTable</name>
  <files>
    packages/data-table/src/index.ts
    packages/data-table/src/data-table.ts
  </files>
  <action>
1. Update index.ts to export pagination:
```typescript
// Pagination components
export * from './pagination/index.js';
```

2. In data-table.ts, update updated() lifecycle to reset pageIndex when filters change:
```typescript
// In the existing filter change detection block
if (this._previousFilterState && currentFilterState !== this._previousFilterState) {
  // Filters changed - clear selection (existing)
  this.rowSelection = {};
  this.lastSelectedRowId = null;

  // Also reset to first page (new)
  if (this.pagination.pageIndex !== 0) {
    this.pagination = { ...this.pagination, pageIndex: 0 };
    this.dispatchPaginationChange(this.pagination);
  }

  // ... rest of existing code
}
```

3. Add helper methods for pagination info:
```typescript
/**
 * Get total row count for pagination display.
 * Uses totalRowCount prop for server-side, or filtered row count for client-side.
 */
private getTotalRowCount(table: Table<TData>): number {
  if (this.manualPagination) {
    return this.totalRowCount ?? this.data.length;
  }
  // For client-side, use filtered row count
  return table.getFilteredRowModel().rows.length;
}

/**
 * Get page count based on mode.
 */
private getPageCount(table: Table<TData>): number {
  if (this.manualPagination && this.pageCount !== undefined) {
    return this.pageCount;
  }
  return table.getPageCount();
}
```
  </action>
  <verify>
Run `pnpm build --filter @lit-ui/data-table` - should succeed.
Check dist/index.d.ts includes PaginationControls export.
  </verify>
  <done>
Pagination fully integrated with DataTable and exported from package.
Page resets to first when filters change (prevents empty page issue).
  </done>
</task>

</tasks>

<verification>
1. `pnpm build --filter @lit-ui/data-table` succeeds
2. types.ts contains PaginationChangeEvent interface
3. data-table.ts uses getPaginatedRowModel from TanStack
4. data-table.ts has pagination, manualPagination, pageCount properties
5. pagination-controls.ts has page nav buttons, page size selector, info display
6. PaginationControls exported from main index.ts
</verification>

<success_criteria>
- DataTable integrates TanStack getPaginatedRowModel for client-side pagination
- manualPagination property switches to server-side mode (PAGE-04)
- ui-pagination-change event emitted on pagination state changes
- lui-pagination-controls shows prev/next/first/last buttons (PAGE-01)
- Page size selector with configurable options (PAGE-02)
- "Showing X-Y of Z" display (PAGE-03)
- Page resets to first when filters change
</success_criteria>

<output>
After completion, create `.planning/phases/63-filtering-pagination/63-03-SUMMARY.md`
</output>
