---
phase: 18-cli-enhancement
plan: 04
type: execute
wave: 3
depends_on: ["18-03"]
files_modified:
  - packages/cli/src/commands/add.ts
  - packages/cli/src/commands/list.ts
autonomous: true

must_haves:
  truths:
    - "All CLI commands work with new lit-ui.config.json filename"
    - "List command shows mode-appropriate information"
    - "Build and lint pass without errors"
    - "Backward compatibility with copy-source mode maintained"
  artifacts:
    - path: "packages/cli/src/commands/list.ts"
      provides: "Mode-aware component listing"
      contains: "mode"
  key_links:
    - from: "packages/cli/src/commands/list.ts"
      to: "packages/cli/src/utils/config.ts"
      via: "getConfig call"
      pattern: "getConfig"
---

<objective>
Verify and finalize CLI enhancement with mode-aware list command and full testing.

Purpose: Ensure all CLI commands work correctly with the new dual-mode system and config file format.

Output: Polished CLI with mode-aware list command and verified functionality.
</objective>

<execution_context>
@/Users/sn0w/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sn0w/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/18-cli-enhancement/18-CONTEXT.md
@.planning/phases/18-cli-enhancement/18-01-SUMMARY.md
@.planning/phases/18-cli-enhancement/18-02-SUMMARY.md
@.planning/phases/18-cli-enhancement/18-03-SUMMARY.md
@packages/cli/src/commands/list.ts
@packages/cli/src/commands/add.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update list command with mode awareness</name>
  <files>packages/cli/src/commands/list.ts</files>
  <action>
Update list command to show mode-appropriate information:

1. Import config utilities:
   ```typescript
   import { getConfig } from '../utils/config';
   ```

2. Read config and show current mode in output:
   ```typescript
   const config = await getConfig(cwd);
   const mode = config?.mode ?? 'copy-source';

   console.log('');
   console.log(pc.bold('lit-ui components'));
   console.log(pc.dim(`Mode: ${mode}`));
   console.log('');
   ```

3. For npm mode, show package names instead of file paths:
   ```typescript
   if (mode === 'npm') {
     for (const component of listComponents()) {
       const packageName = componentToPackage[component.name] ?? `@lit-ui/${component.name}`;
       console.log(`  ${pc.cyan(component.name)} - ${packageName}`);
       console.log(pc.dim(`    ${component.description}`));
     }
   } else {
     // Existing copy-source output
     for (const component of listComponents()) {
       console.log(`  ${pc.cyan(component.name)} - ${component.description}`);
     }
   }
   ```

4. Import componentToPackage from install-component:
   ```typescript
   import { componentToPackage } from '../utils/install-component';
   ```

5. Add add args for cwd if not already present.
  </action>
  <verify>`pnpm --filter @lit-ui/cli build` succeeds</verify>
  <done>List command shows mode and appropriate component information</done>
</task>

<task type="auto">
  <name>Task 2: Final build verification and cleanup</name>
  <files>packages/cli/</files>
  <action>
Run final verification to ensure all changes work correctly:

1. Full build:
   ```bash
   pnpm --filter @lit-ui/cli build
   ```

2. Type check:
   ```bash
   pnpm --filter @lit-ui/cli typecheck
   ```
   If typecheck script doesn't exist, run: `pnpm --filter @lit-ui/cli exec tsc --noEmit`

3. Verify all exports are correct by checking the build output.

4. Quick functional test (if time allows):
   ```bash
   # Create temp directory
   cd /tmp && rm -rf lit-ui-test && mkdir lit-ui-test && cd lit-ui-test
   npm init -y

   # Test init (should prompt for mode)
   node /path/to/packages/cli/dist/index.mjs init

   # Test list (should show mode)
   node /path/to/packages/cli/dist/index.mjs list

   # Test add with --copy flag
   node /path/to/packages/cli/dist/index.mjs add button --copy
   ```

5. If any issues found, fix them before completing.
  </action>
  <verify>
1. Build succeeds without errors
2. Type check passes
3. All commands are accessible via CLI
  </verify>
  <done>CLI builds cleanly, all commands functional, types correct</done>
</task>

</tasks>

<verification>
1. `pnpm --filter @lit-ui/cli build` succeeds
2. TypeScript has no errors
3. `lit-ui init` prompts for mode
4. `lit-ui add button` respects config mode
5. `lit-ui add button --npm` overrides to npm mode
6. `lit-ui add button --copy` overrides to copy-source mode
7. `lit-ui migrate` converts copy-source to npm
8. `lit-ui list` shows current mode and components
</verification>

<success_criteria>
- All CLI commands work with lit-ui.config.json
- List command shows current mode
- Build and type check pass
- No regressions in copy-source mode (backward compatible)
- npm mode correctly installs packages
- Migrate command safely handles modified files
</success_criteria>

<output>
After completion, create `.planning/phases/18-cli-enhancement/18-04-SUMMARY.md`
</output>
