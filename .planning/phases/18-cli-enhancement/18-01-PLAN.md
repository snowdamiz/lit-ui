---
phase: 18-cli-enhancement
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - packages/cli/src/utils/config.ts
  - packages/cli/src/commands/init.ts
autonomous: true

must_haves:
  truths:
    - "Config file supports 'mode' field with 'copy-source' or 'npm' values"
    - "Init command prompts user to choose distribution mode"
    - "Config file named lit-ui.config.json for clarity"
  artifacts:
    - path: "packages/cli/src/utils/config.ts"
      provides: "LitUIConfig with mode field"
      exports: ["LitUIConfig", "getConfig", "writeConfig", "getOrCreateConfig"]
    - path: "packages/cli/src/commands/init.ts"
      provides: "Mode selection prompt in init flow"
      contains: "consola.prompt"
  key_links:
    - from: "packages/cli/src/commands/init.ts"
      to: "packages/cli/src/utils/config.ts"
      via: "writeConfig with mode"
      pattern: "mode.*copy-source|npm"
---

<objective>
Add mode field to CLI configuration and update init command with mode selection.

Purpose: Enable CLI to track whether project uses copy-source (existing) or npm (new) distribution mode. This is the foundation for mode-aware add command and migration.

Output: Updated config schema with mode field, init command with mode prompt.
</objective>

<execution_context>
@/Users/sn0w/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sn0w/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/18-cli-enhancement/18-CONTEXT.md
@.planning/phases/18-cli-enhancement/18-RESEARCH.md
@packages/cli/src/utils/config.ts
@packages/cli/src/commands/init.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update config schema with mode field</name>
  <files>packages/cli/src/utils/config.ts</files>
  <action>
Update the LitUIConfig interface and related functions:

1. Add mode field to LitUIConfig interface:
   ```typescript
   mode: 'copy-source' | 'npm';
   ```

2. Rename CONFIG_FILE constant from 'lit-ui.json' to 'lit-ui.config.json' for clarity

3. Update DEFAULT_CONFIG to include mode: 'copy-source' (matches existing behavior)

4. Add getOrCreateConfig function that auto-creates config with defaults if missing:
   ```typescript
   export async function getOrCreateConfig(cwd: string): Promise<LitUIConfig> {
     const existing = await getConfig(cwd);
     if (existing) return existing;

     const defaultConfig = { ...DEFAULT_CONFIG };
     await writeConfig(cwd, defaultConfig);
     return defaultConfig;
   }
   ```

5. Keep getConfig returning null for missing config (other commands may want to check existence)
  </action>
  <verify>TypeScript compiles without errors: `pnpm --filter @lit-ui/cli build`</verify>
  <done>LitUIConfig has mode field, CONFIG_FILE is 'lit-ui.config.json', getOrCreateConfig exists</done>
</task>

<task type="auto">
  <name>Task 2: Update init command with mode selection</name>
  <files>packages/cli/src/commands/init.ts</files>
  <action>
Update init command to prompt for distribution mode:

1. Add mode selection prompt after environment detection (before components path prompt):
   ```typescript
   let mode: 'copy-source' | 'npm' = 'copy-source';

   if (!args.yes) {
     const selectedMode = await consola.prompt('How would you like to install components?', {
       type: 'select',
       options: [
         {
           value: 'copy-source',
           label: 'Copy source files',
           hint: 'Full control, customize directly, no updates',
         },
         {
           value: 'npm',
           label: 'Install from npm',
           hint: 'Auto updates, smaller bundle, less customization',
         },
       ],
       initial: 'copy-source',
     });
     mode = selectedMode as 'copy-source' | 'npm';
   }
   ```

2. Update config object to include mode before writeConfig call:
   ```typescript
   const config: Partial<LitUIConfig> = {
     mode,
     componentsPath,
     // ... rest of config
   };
   ```

3. For npm mode: Skip copying base files (TailwindElement, host-defaults.css, tailwind.css)
   - These come from @lit-ui/core package in npm mode
   - Keep components directory creation for both modes

4. Update "Next steps" output based on mode:
   - copy-source: Show existing setup instructions
   - npm: Show `npm install @lit-ui/core lit` instead of just `lit`

5. Update CONFIG_FILE import to use new name 'lit-ui.config.json'
  </action>
  <verify>
1. `pnpm --filter @lit-ui/cli build` succeeds
2. Manual test: `cd /tmp && mkdir test-init && cd test-init && npm init -y && node /path/to/cli init` shows mode prompt
  </verify>
  <done>Init prompts for mode, saves to config, skips base files for npm mode</done>
</task>

</tasks>

<verification>
1. Build succeeds: `pnpm --filter @lit-ui/cli build`
2. Config file generated has mode field
3. Init prompt shows mode selection (when not using --yes)
4. Default mode is copy-source (backward compatible)
5. npm mode skips base file creation
</verification>

<success_criteria>
- LitUIConfig interface includes mode: 'copy-source' | 'npm'
- Init command prompts for mode selection
- Config file saved as lit-ui.config.json with mode field
- npm mode skips base files (they come from @lit-ui/core)
</success_criteria>

<output>
After completion, create `.planning/phases/18-cli-enhancement/18-01-SUMMARY.md`
</output>
