---
phase: 42-calendar-display-foundation
plan: 07
type: execute
wave: 4
depends_on: ["42-04", "42-05", "42-06"]
files_modified:
  - packages/calendar/src/intl-utils.ts
  - packages/calendar/src/calendar.ts

autonomous: true

must_haves:
  truths:
    - "Calendar starts on Monday for European locales and Sunday for US/Japan"
    - "Weekday names display in the user's locale language"
    - "Month names in dropdown display in the user's locale language"
    - "Locale property reactively updates the calendar display"
  artifacts:
    - path: "packages/calendar/src/intl-utils.ts"
      provides: "Complete Intl API utilities for locale-aware calendar"
      exports: ["getFirstDayOfWeek", "getWeekdayNames", "getMonthNames"]
    - path: "packages/calendar/src/calendar.ts"
      provides: "Calendar with full locale reactivity"
      contains: "effectiveLocale"
  key_links:
    - from: "packages/calendar/src/calendar.ts"
      to: "packages/calendar/src/intl-utils.ts"
      via: "locale-aware rendering pipeline"
      pattern: "getWeekdayNames.*effectiveLocale"
---

<objective>
Ensure full internationalization support via Intl API so the calendar correctly localizes first day of week, weekday names, and month names based on the user's locale.

Purpose: International users need their calendar to start on the culturally correct day (Monday in Europe, Sunday in US) with names in their language. The Intl API handles this without shipping locale data.
Output: Calendar that fully adapts to any BCP 47 locale tag with correct first day, weekday names, and month names.
</objective>

<execution_context>
@/Users/sn0w/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sn0w/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/42-calendar-display-foundation/42-RESEARCH.md
@.planning/phases/42-calendar-display-foundation/42-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Verify and enhance Intl utilities and locale reactivity</name>
  <files>
    packages/calendar/src/intl-utils.ts
    packages/calendar/src/calendar.ts
  </files>
  <action>
    This plan ensures the i18n infrastructure from Plan 01 is complete and properly integrated. Much of the foundation exists; this plan adds the `first-day-of-week` override property and ensures full locale reactivity.

    1. **Verify intl-utils.ts completeness:**
       - `getFirstDayOfWeek(locale)` should handle: getWeekInfo() method, weekInfo property fallback, locale map fallback. Verify all three fallback levels work.
       - `getWeekdayNames(locale, firstDayOfWeek)` should produce correctly rotated array for any firstDayOfWeek value (1-7).
       - `getMonthNames(locale)` should produce 12 month names using Intl.DateTimeFormat({ month: 'long' }).
       - Test edge cases: empty locale string defaults to 'en-US', invalid locale gracefully falls back.

    2. **Add first-day-of-week override property to calendar.ts:**
       - `@property({ type: String, attribute: 'first-day-of-week' }) firstDayOfWeekOverride = ''`
       - Update `get firstDayOfWeek()` getter: if `firstDayOfWeekOverride` is set and valid (1-7), use it; otherwise call `getFirstDayOfWeek(effectiveLocale)`
       - This allows consumers to override the locale default: `<lui-calendar first-day-of-week="1">` forces Monday start regardless of locale

    3. **Ensure locale property reactivity in calendar.ts:**
       - The `locale` property is already `@property({ type: String })` which gives automatic Lit reactivity
       - Verify that changing `locale` triggers re-render with new weekday names and first day
       - The `effectiveLocale` getter already handles the fallback chain (locale prop -> navigator.language -> 'en-US')
       - Verify the `weekStartsOn` getter correctly maps through `intlFirstDayToDateFns()` for date-fns compatibility

    4. **Verify full rendering pipeline with locale:**
       - Weekday headers: `getWeekdayNames(effectiveLocale, firstDayOfWeek)` produces correct 7-day array
       - Calendar days: `getCalendarDays(currentMonth, weekStartsOn)` aligns with weekday headers
       - Month heading: `getMonthYearLabel(currentMonth, effectiveLocale)` shows localized month name
       - Month dropdown: `getMonthNames(effectiveLocale)` shows localized month names
       - Date labels: `formatDateLabel(date, effectiveLocale)` uses Intl.DateTimeFormat for aria-label

    5. **Add long weekday name for column headers:**
       - Ensure each weekday header has `aria-label` with the full weekday name (not just abbreviation):
         ```html
         <div class="weekday-header" role="columnheader" aria-label="${longName}">${shortName}</div>
         ```
       - Add `getWeekdayLongNames(locale, firstDayOfWeek)` to intl-utils.ts using `{ weekday: 'long' }` format, or generate both short and long names in a single function.

    Build: `pnpm --filter @lit-ui/calendar build`
  </action>
  <verify>
    - `pnpm --filter @lit-ui/calendar build` succeeds
    - `grep "first-day-of-week" packages/calendar/src/calendar.ts` confirms override property
    - `grep "firstDayOfWeekOverride" packages/calendar/src/calendar.ts` confirms override logic
    - `grep "effectiveLocale" packages/calendar/src/calendar.ts` confirms locale fallback chain
    - `grep "getWeekInfo\|weekInfo" packages/calendar/src/intl-utils.ts` confirms three-level fallback
    - `grep "weekday.*long" packages/calendar/src/intl-utils.ts` confirms long weekday names for aria-label
  </verify>
  <done>Calendar fully adapts to locale: first day of week, weekday names (short display + long aria-label), month names all localize. Override property allows forcing specific first day regardless of locale.</done>
</task>

</tasks>

<verification>
- Package builds without errors
- Setting locale="de-DE" produces German weekday/month names starting on Monday
- Setting locale="en-US" produces English names starting on Sunday
- Setting first-day-of-week="1" forces Monday start regardless of locale
- Empty locale defaults to navigator.language
- Month dropdown shows localized month names
</verification>

<success_criteria>
1. First day of week detects correctly from locale (Sunday for US, Monday for Europe)
2. first-day-of-week property overrides locale detection
3. Weekday abbreviations are localized (Mon/Tue vs Mo/Di for German)
4. Weekday headers have long-form aria-label for accessibility
5. Month names in dropdown are localized
6. Changing locale property reactively updates the entire calendar
</success_criteria>

<output>
After completion, create `.planning/phases/42-calendar-display-foundation/42-07-SUMMARY.md`
</output>
