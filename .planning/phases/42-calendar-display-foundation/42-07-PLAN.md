---
phase: 42-calendar-display-foundation
plan: 07
type: execute
wave: 3
depends_on: ["42-01"]
files_modified:
  - packages/calendar/src/calendar.ts
  - packages/calendar/src/intl-utils.ts
autonomous: true

must_haves:
  truths:
    - "Calendar week starts on locale-specific first day (Sunday US, Monday EU)"
    - "Month names localize based on locale property (e.g., 'janvier' for fr-FR)"
    - "Weekday names localize based on locale property (e.g., 'Lun Mar Mer' for fr-FR)"
    - "Changing locale property updates calendar immediately"
    - "First day of week uses Intl.Locale.getWeekInfo() with fallback"
  artifacts:
    - path: "packages/calendar/src/intl-utils.ts"
      provides: "Locale-aware calendar utilities"
      exports: ["getFirstDayOfWeek"]
      contains: "getWeekInfo"
    - path: "packages/calendar/src/calendar.ts"
      provides: "Calendar with internationalization"
      contains: "locale"
  key_links:
    - from: "packages/calendar/src/intl-utils.ts"
      to: "Intl.Locale API"
      via: "getWeekInfo() method"
      pattern: "getWeekInfo"
    - from: "packages/calendar/src/calendar.ts"
      to: "packages/calendar/src/intl-utils.ts"
      via: "getFirstDayOfWeek, getWeekdayNames, getMonthName"
      pattern: "from './intl-utils'"
---

<objective>
Add internationalization for first day of week, month names, and weekday names using native Intl API. Calendar must adapt to user's locale automatically.

Purpose: Internationalization is required for global usability. Different locales have different first days of week and date formats.

Output: Calendar that localizes first day of week, month names, and weekday names based on locale property using Intl API.
</objective>

<execution_context>
@/Users/sn0w/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sn0w/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/42-calendar-display-foundation/42-RESEARCH.md
@/Users/sn0w/Documents/dev/lit-components/packages/button/src/button.ts
</context>

<tasks>

<task type="auto">
  <name>Add getFirstDayOfWeek utility with fallback</name>
  <files>packages/calendar/src/intl-utils.ts</files>
  <action>
    Update packages/calendar/src/intl-utils.ts to add getFirstDayOfWeek:

    Export getFirstDayOfWeek(locale: string): number function:

    ```typescript
    export function getFirstDayOfWeek(locale: string): number {
      try {
        const localeObj = new Intl.Locale(locale);

        // Check if getWeekInfo is available (Chrome 99+, Safari 17+)
        if (typeof localeObj.getWeekInfo === 'function') {
          const weekInfo = localeObj.getWeekInfo();
          // getWeekInfo returns: { firstDay: number, weekend: number[], minimalDays: number }
          // firstDay: 1=Monday, 7=Sunday
          return weekInfo.firstDay;
        }
      } catch (e) {
        // Fall through to fallback
      }

      // Fallback: Sunday (7) for US/IL, Monday (1) for most others
      if (locale.startsWith('en-US') || locale.startsWith('he-IL')) {
        return 7; // Sunday
      }
      return 1; // Monday
    }
    ```

    Follow RESEARCH.md "Pattern 4: Intl API for Locale-Aware Calendar" and fallback pattern from Open Questions section.
  </action>
  <verify>grep "getFirstDayOfWeek\|getWeekInfo" packages/calendar/src/intl-utils.ts shows first day utility</verify>
  <done>intl-utils.ts exports getFirstDayOfWeek with fallback</done>
</task>

<task type="auto">
  <name>Update getWeekdayNames to use locale-specific first day</name>
  <files>packages/calendar/src/intl-utils.ts</files>
  <action>
    Update packages/calendar/src/intl-utils.ts getWeekdayNames function:

    Modify existing getWeekdayNames to start from locale-specific first day:

    ```typescript
    export function getWeekdayNames(locale: string, style: 'long' | 'short' | 'narrow' = 'short'): string[] {
      // Get first day of week for this locale
      const firstDay = getFirstDayOfWeek(locale);

      // Create formatter
      const formatter = new Intl.DateTimeFormat(locale, { weekday: style });

      // Generate names starting from firstDay
      const names: string[] = [];
      for (let i = 0; i < 7; i++) {
        // 2023-01-01 was a Sunday (day 1), so we add (firstDay - 1) to adjust
        const date = new Date(2023, 0, firstDay + i);
        names.push(formatter.format(date));
      }

      return names;
      // en-US, short: ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"]
      // en-GB, short: ["Mon", "Tue", "Wed", "Thu", "Fri", "Sat", "Sun"]
    }
    ```

    This ensures weekday array starts from the correct day for the locale.
  </action>
  <verify>grep "getFirstDayOfWeek" packages/calendar/src/intl-utils.ts shows first day usage in getWeekdayNames</verify>
  <done>getWeekdayNames returns locale-specific weekday array</done>
</task>

<task type="auto">
  <name>Add locale property and localized rendering to calendar</name>
  <files>packages/calendar/src/calendar.ts</files>
  <action>
    Update packages/calendar/src/calendar.ts to add locale support:

    1. Add @property decorator for locale (if not already present):
       ```typescript
       @property({ type: String })
       locale: string = 'en-US';
       ```

    2. Update getWeekdayNames() method to pass locale to intl-utils:
       ```typescript
       private getWeekdayNames(): string[] {
         return getWeekdayNames(this.locale);
       }
       ```

    3. Update getMonthName() method to pass locale to intl-utils:
       ```typescript
       private getMonthName(date: Date): string {
         return getMonthName(date, this.locale);
       }
       ```

    4. Update getMonthYearLabel() method to pass locale to intl-utils:
       ```typescript
       private getMonthYearLabel(): string {
         return getMonthYearLabel(this.currentMonth, this.locale);
       }
       ```

    5. In Intl.DateTimeFormat calls (like in handleDateClick for announcements), use this.locale:
       ```typescript
       const formatter = new Intl.DateTimeFormat(this.locale, {
         weekday: 'long',
         year: 'numeric',
         month: 'long',
         day: 'numeric'
       });
       ```

    6. Update monthOptions to use localized names:
       ```typescript
       private get monthOptions(): string[] {
         return Array.from({ length: 12 }, (_, i) => {
           const date = new Date(2023, i, 1);
           return getMonthName(date, this.locale);
         });
       }
       ```

    Follow CAL-15, CAL-16, CAL-17 requirements: First day of week, month names, weekday names localize via Intl API.
  </action>
  <verify>grep "this.locale" packages/calendar/src/calendar.ts shows locale usage in formatting</verify>
  <done>Calendar localizes based on locale property</done>
</task>

<task type="auto">
  <name>Add locale change reactivity</name>
  <files>packages/calendar/src/calendar.ts</files>
  <action>
    Update packages/calendar/src/calendar.ts to react to locale changes:

    Ensure that when locale property changes, the component re-renders with new locale.

    Since locale is a @property(), Lit automatically calls requestUpdate() when it changes.
    The render() method uses this.locale in all getWeekdayNames(), getMonthName(), getMonthYearLabel() calls,
    so the grid will re-render with localized names.

    Verify by testing:
    1. Set locale="en-US" → Sunday first, "January" month name
    2. Set locale="en-GB" → Monday first, "January" month name (same)
    3. Set locale="fr-FR" → Monday first, "janvier" month name

    No code changes needed - this is automatic via @property() reactivity.

    Optional: Add a test example in render() to demonstrate locale switching:
    ```html
    <select @change=${(e: Event) => this.locale = (e.target as HTMLSelectElement).value}>
       <option value="en-US">English (US)</option>
       <option value="en-GB">English (UK)</option>
       <option value="fr-FR">Français</option>
       <option value="de-DE">Deutsch</option>
       <option value="es-ES">Español</option>
       <option value="ja-JP">日本語</option>
    </select>
    ```

    This is for demo/testing only - not required for production.
  </action>
  <verify>grep "@property.*locale" packages/calendar/src/calendar.ts shows locale property</verify>
  <done>Locale property changes trigger re-render with localized content</done>
</task>

</tasks>

<verification>
After completing all tasks, verify:

1. First day of week: Changes based on locale (en-US=Sunday, en-GB=Monday, fr-FR=Monday)
2. Month names: Localize to locale (fr-FR="janvier", de-DE="Januar")
3. Weekday names: Localize to locale and start from correct first day
4. getWeekInfo: Uses Intl.Locale.getWeekInfo() with fallback for unsupported browsers
5. Fallback: Falls back to Sunday/Monday based on locale when getWeekInfo unavailable
6. Reactivity: Changing locale property updates calendar immediately
7. SSR safety: No client-only API calls without isServer guard
</verification>

<success_criteria>
1. en-US locale: Sunday first, "January" month, "Sun Mon Tue..." weekdays
2. en-GB locale: Monday first, "January" month, "Mon Tue Wed..." weekdays
3. fr-FR locale: Monday first, "janvier" month, "Lun Mar Mer..." weekdays
4. getWeekInfo used when available (Chrome 99+, Safari 17+)
5. Fallback works when getWeekInfo unavailable
</success_criteria>

<output>
After completion, create `.planning/phases/42-calendar-display-foundation/42-07-SUMMARY.md`
</output>
