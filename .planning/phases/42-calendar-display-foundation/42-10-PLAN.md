---
phase: 42-calendar-display-foundation
plan: 10
type: execute
wave: 4
depends_on: ["42-01", "42-02", "42-03", "42-04", "42-05", "42-06", "42-07", "42-08"]
files_modified:
  - packages/calendar/src/calendar.ts
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "User hears screen reader announcements for month changes via aria-live region"
    - "Month navigation (buttons, dropdowns, keyboard) triggers liveAnnouncement state update"
    - "Screen readers announce month changes consistently across all navigation methods"
  artifacts:
    - path: "packages/calendar/src/calendar.ts"
      provides: "Calendar with month change screen reader announcements"
      contains: "liveAnnouncement state update in handlePreviousMonth, handleNextMonth, handleMonthChange, handleYearChange"
      contains: "aria-live region rendering liveAnnouncement text"
  key_links:
    - from: "packages/calendar/src/calendar.ts"
      to: "packages/calendar/src/calendar.ts"
      via: "liveAnnouncement state in render template"
      pattern: "aria-live.*liveAnnouncement"
---

<objective>
Add screen reader announcements for month changes by setting liveAnnouncement state when month changes, similar to how date selection announcements work.

Purpose: The current implementation has aria-live="polite" on the month heading (line 808), but text changes to heading elements may not trigger announcements in all screen readers. A dedicated aria-live region with liveAnnouncement state (like date selection uses) provides reliable announcements. First verify if current approach works, then add liveAnnouncement if needed.

Output: Calendar with consistent month change announcements via dedicated aria-live region (if current approach is insufficient).
</objective>

<execution_context>
@/Users/sn0w/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sn0w/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/42-calendar-display-foundation/42-03-PLAN.md
@.planning/phases/42-calendar-display-foundation/42-04-PLAN.md
@/Users/sn0w/Documents/dev/lit-components/packages/calendar/src/calendar.ts
</context>

<tasks>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Current implementation with aria-live="polite" on month heading (line 808)</what-built>
  <how-to-verify>
    1. Open calendar in browser with screen reader enabled (NVDA on Windows, VoiceOver on Mac, or JAWS)
    2. Navigate to the calendar component
    3. Click the "Next month" button (>)
    4. Listen for screen reader announcement of month change
    5. Repeat for "Previous month" button (<)
    6. Test dropdown navigation (month/year selectors)

    Expected: Screen reader announces the new month name when navigating.

    If announcements work consistently, type "skip" to continue without changes.
    If announcements are missing or inconsistent, type "add" to add dedicated liveAnnouncement.
  </how-to-verify>
  <resume-signal>Type "skip" if current aria-live on heading works, or "add" to add dedicated liveAnnouncement</resume-signal>
</task>

<task type="auto">
  <name>Add liveAnnouncement state updates to month navigation handlers</name>
  <files>packages/calendar/src/calendar.ts</files>
  <action>
    ONLY execute this task if checkpoint verification showed current approach is insufficient.

    In packages/calendar/src/calendar.ts, update month navigation handlers to set liveAnnouncement state.

    The handleDateClick method (lines 661-675) already sets liveAnnouncement for date selection:
    ```typescript
    this.liveAnnouncement = `Selected ${formatter.format(date)}`;
    ```

    Add similar announcements to month navigation methods:

    1. Update handlePreviousMonth (lines ~742-747):
       After line 745 (this.selectedYear = ...), add:
       ```typescript
       // Announce month change to screen readers
       const formatter = new Intl.DateTimeFormat(this.locale, {
         year: 'numeric',
         month: 'long'
       });
       this.liveAnnouncement = `Navigated to ${formatter.format(this.currentMonth)}`;
       ```

    2. Update handleNextMonth (lines ~752-757):
       After line 755 (this.selectedYear = ...), add:
       ```typescript
       // Announce month change to screen readers
       const formatter = new Intl.DateTimeFormat(this.locale, {
         year: 'numeric',
         month: 'long'
       });
       this.liveAnnouncement = `Navigated to ${formatter.format(this.currentMonth)}`;
       ```

    3. Update handleMonthChange (lines ~763-768):
       After line 766 (this.currentMonth = ...), add:
       ```typescript
       // Announce month change to screen readers
       const formatter = new Intl.DateTimeFormat(this.locale, {
         year: 'numeric',
         month: 'long'
       });
       this.liveAnnouncement = `Navigated to ${formatter.format(this.currentMonth)}`;
       ```

    4. Update handleYearChange (lines ~774-779):
       After line 777 (this.currentMonth = ...), add:
       ```typescript
       // Announce month change to screen readers
       const formatter = new Intl.DateTimeFormat(this.locale, {
         year: 'numeric',
         month: 'long'
       });
       this.liveAnnouncement = `Navigated to ${formatter.format(this.currentMonth)}`;
       ```

    Reference: handleDateClick at lines 661-675 shows the pattern for liveAnnouncement.
  </action>
  <verify>grep "liveAnnouncement.*Navigated to" packages/calendar/src/calendar.ts shows all four month navigation methods set announcements</verify>
  <done>All month navigation methods set liveAnnouncement state (if current approach was insufficient)</done>
</task>

<task type="auto">
  <name>Verify aria-live region renders liveAnnouncement correctly</name>
  <files>packages/calendar/src/calendar.ts</files>
  <action>
    ONLY execute this task if Task 2 was executed (dedicated liveAnnouncement was added).

    In packages/calendar/src/calendar.ts, verify the aria-live region at lines ~891-894 correctly renders liveAnnouncement:

    ```html
    <!-- Screen reader live region for announcements -->
    <div aria-live="polite" aria-atomic="true" class="sr-only" part="live-region">
      ${this.liveAnnouncement}
    </div>
    ```

    This region should already exist and render liveAnnouncement state. Verify:
    1. aria-live="polite" is set (correct for non-urgent announcements)
    2. aria-atomic="true" is set (announces entire content, not just changes)
    3. class="sr-only" is set (visually hidden but accessible)
    4. ${this.liveAnnouncement} renders the announcement text

    If the aria-live region does not exist, add it before the closing </div> of the render method.

    The aria-live region should be already correctly implemented from prior plans. No changes needed - just verify it works.
  </action>
  <verify>grep -A 2 'aria-live="polite"' packages/calendar/src/calendar.ts shows live region with liveAnnouncement</verify>
  <done>aria-live region correctly announces month changes and date selections</done>
</task>

</tasks>

<verification>
After completing all tasks (or skipping after checkpoint), verify:

1. If checkpoint showed current approach works: aria-live on heading is sufficient
2. If dedicated liveAnnouncement was added: All four navigation methods set liveAnnouncement
3. aria-live region renders liveAnnouncement text with aria-live="polite"
4. Test with screen reader: Month changes announce month name
5. Test all navigation methods: Previous button, Next button, Month dropdown, Year dropdown
6. Verify date selection announcements still work: "Selected [Weekday, Month Day, Year]"
</verification>

<success_criteria>
1. Screen reader announces month changes consistently across all navigation methods
2. Either aria-live on heading works OR dedicated liveAnnouncement provides announcements
3. Date selection announcements continue to work correctly
4. All navigation methods (buttons, dropdowns, keyboard) trigger announcements
</success_criteria>

<output>
After completion, create `.planning/phases/42-calendar-display-foundation/42-10-SUMMARY.md`
</output>
