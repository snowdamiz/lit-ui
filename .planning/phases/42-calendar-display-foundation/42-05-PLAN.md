---
phase: 42-calendar-display-foundation
plan: 05
type: execute
wave: 2
depends_on: ["42-01", "42-02", "42-03"]
files_modified:
  - packages/calendar/src/calendar.ts
autonomous: true

must_haves:
  truths:
    - "Month heading has aria-live='polite' for announcing month changes"
    - "Date selection announces 'Selected [day of week], [month] [day], [year]' via aria-live region"
    - "Screen reader announces month navigation (previous/next/dropdowns)"
    - "Screen reader announces date selection when user selects date"
    - "aria-live regions use polite announcements (not assertive)"
  artifacts:
    - path: "packages/calendar/src/calendar.ts"
      provides: "Calendar with aria-live announcements"
      contains: "aria-live"
      contains: "liveAnnouncement"
  key_links:
    - from: "packages/calendar/src/calendar.ts"
      to: "WAI-ARIA Live Region API"
      via: "aria-live attributes"
      pattern: "aria-live=\"polite\""
    - from: "packages/calendar/src/calendar.ts"
      to: "Intl.DateTimeFormat"
      via: "Localized announcement formatting"
      pattern: "weekday: 'long'"
---

<objective>
Add aria-live regions for screen reader announcements of month changes and date selections. Screen reader users need audio feedback for all dynamic changes.

Purpose: Screen reader support is required for WCAG 2.1 Level AA compliance. aria-live regions announce dynamic content changes.

Output: Calendar with aria-live="polite" regions that announce month changes and date selections to screen readers.
</objective>

<execution_context>
@/Users/sn0w/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sn0w/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/42-calendar-display-foundation/42-RESEARCH.md
@/Users/sn0w/Documents/dev/lit-components/packages/button/src/button.ts
</context>

<tasks>

<task type="auto">
  <name>Add aria-live region for month heading</name>
  <files>packages/calendar/src/calendar.ts</files>
  <action>
    Update packages/calendar/src/calendar.ts to add aria-live to month heading:

    1. In render() method, add aria-live="polite" to the heading element:
       ```html
       <h2 id="calendar-heading" aria-live="polite">
         ${this.getMonthYearLabel()}
       </h2>
       ```

    2. Ensure heading text updates when currentMonth changes:
       - getMonthYearLabel() is called in render() with currentMonth
       - When currentMonth updates (via prev/next buttons or dropdowns), render() re-runs
       - aria-live region automatically announces the new text

    3. Verify aria-labelledby on grid points to heading:
       ```html
       <div role="grid" aria-labelledby="calendar-heading">
       ```

    Follow CAL-09 requirement: Month changes announced via aria-live region.

    Note: aria-live="polite" waits for user to pause before announcing. Use "polite" not "assertive" to avoid interrupting screen reader.
  </action>
  <verify>grep 'aria-live="polite"' packages/calendar/src/calendar.ts shows aria-live region on heading</verify>
  <done>Month heading announces changes via aria-live</done>
</task>

<task type="auto">
  <name>Add aria-live region for date selection announcements</name>
  <files>packages/calendar/src/calendar.ts</files>
  <action>
    Update packages/calendar/src/calendar.ts to add date selection announcements:

    1. Add @state() private liveAnnouncement: string = ''

    2. In render() method, add hidden aria-live region at the end of template:
       ```html
       <div aria-live="polite" aria-atomic="true" class="sr-only" part="live-region">
         ${this.liveAnnouncement}
       </div>
       ```

    3. Add .sr-only to static styles (screen reader only, visually hidden):
       ```css
       .sr-only {
         position: absolute;
         width: 1px;
         height: 1px;
         padding: 0;
         margin: -1px;
         overflow: hidden;
         clip: rect(0, 0, 0, 0);
         white-space: nowrap;
         border-width: 0;
       }
       ```

    4. In handleDateClick(date: Date), format and set announcement:
       ```typescript
       private handleDateClick(date: Date) {
         this.selectedDate = formatDate(date);

         // Format announcement: "Selected Friday, January 30, 2026"
         const formatter = new Intl.DateTimeFormat(this.locale, {
           weekday: 'long',
           year: 'numeric',
           month: 'long',
           day: 'numeric'
         });
         this.liveAnnouncement = `Selected ${formatter.format(date)}`;

         this.emitDateSelect(date);
       }
       ```

    Follow CAL-10 requirement: Date selections announced via aria-live region.

    Note: aria-atomic="true" ensures entire region is read, not just changed text.
  </action>
  <verify>grep "liveAnnouncement\|aria-live.*polite" packages/calendar/src/calendar.ts shows announcement region</verify>
  <done>Date selections announce via aria-live region</done>
</task>

<task type="auto">
  <name>Add keyboard help text announcement</name>
  <files>packages/calendar/src/calendar.ts</files>
  <action>
    Update packages/calendar/src/calendar.ts to add keyboard help announcement:

    1. Add @state() private showKeyboardHelp: boolean = false

    2. Add keyboard help text:
       - private get keyboardHelpText(): string { return 'Use arrow keys to navigate dates. Enter or Space to select. Page Up and Page Down change months.'; }

    3. Add keyboard help button in header:
       ```html
       <button
         @click=${() => this.showKeyboardHelp = true}
         aria-label="Keyboard shortcuts help"
         class="help-button"
       >
         ?
       </button>
       ```

    4. Add help dialog with aria-live announcement:
       ```html
       ${this.showKeyboardHelp ? html`
         <div role="dialog" aria-modal="true" aria-labelledby="help-title" class="help-dialog">
           <h3 id="help-title">Keyboard Navigation</h3>
           <p aria-live="polite">${this.keyboardHelpText}</p>
           <button @click=${() => this.showKeyboardHelp = false}>Close</button>
         </div>
       ` : ''}
       ```

    5. Add help dialog styles:
       ```css
       .help-button {
         padding: 0.25rem 0.5rem;
         margin-left: 0.5rem;
       }
       .help-dialog {
         position: absolute;
         top: 3rem;
         right: 0;
         background: var(--color-background);
         border: 1px solid var(--color-border);
         padding: 1rem;
         border-radius: 0.375rem;
         box-shadow: 0 4px 6px -1px var(--color-shadow);
         z-index: 10;
       }
       ```

    This is optional enhancement - not required by CAL-09 or CAL-10 but improves accessibility.
  </action>
  <verify>grep "keyboardHelp\|help-dialog" packages/calendar/src/calendar.ts shows help feature</verify>
  <done>Keyboard help available via help button</done>
</task>

</tasks>

<verification>
After completing all tasks, verify:

1. Month heading: Has aria-live="polite" attribute
2. Month announcement: Changing month announces new month/year to screen reader
3. Date selection: Selecting date announces "Selected [weekday], [month] [day], [year]"
4. aria-live regions: Use polite (not assertive) announcements
5. aria-atomic: Date announcement region has aria-atomic="true"
6. sr-only class: Visually hidden but screen reader accessible
7. Intl.DateTimeFormat: Announcement uses localized date format
8. SSR safety: No client-only API calls without isServer guard
</verification>

<success_criteria>
1. Month changes announce via aria-live region on heading
2. Date selections announce via separate aria-live region
3. Announcements use polite mode (wait for pause)
4. Announcement format: "Selected Friday, January 30, 2026" (localized)
5. Help dialog announces keyboard shortcuts when opened
</success_criteria>

<output>
After completion, create `.planning/phases/42-calendar-display-foundation/42-05-SUMMARY.md`
</output>
