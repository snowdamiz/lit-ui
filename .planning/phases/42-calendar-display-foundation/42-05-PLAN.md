---
phase: 42-calendar-display-foundation
plan: 05
type: execute
wave: 3
depends_on: ["42-02", "42-03"]
files_modified:
  - packages/calendar/src/calendar.ts

autonomous: true

must_haves:
  truths:
    - "Screen reader announces the new month when navigating between months"
    - "Screen reader announces the selected date when user clicks or presses Enter"
    - "Keyboard shortcuts help dialog shows available navigation keys"
  artifacts:
    - path: "packages/calendar/src/calendar.ts"
      provides: "Calendar with aria-live announcements and help dialog"
      contains: "aria-live"
  key_links:
    - from: "packages/calendar/src/calendar.ts"
      to: "screen reader"
      via: "aria-live polite region text updates"
      pattern: "liveAnnouncement"
---

<objective>
Add screen reader support with aria-live regions for month change and date selection announcements, plus a keyboard shortcuts help dialog.

Purpose: Screen reader users need audible feedback when the calendar month changes or a date is selected. Without aria-live regions, visual-only changes are invisible to assistive technology.
Output: Calendar with belt-and-suspenders aria-live announcement pattern and keyboard help dialog.
</objective>

<execution_context>
@/Users/sn0w/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sn0w/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/42-calendar-display-foundation/42-RESEARCH.md
@.planning/phases/42-calendar-display-foundation/42-01-SUMMARY.md
@.planning/phases/42-calendar-display-foundation/42-02-SUMMARY.md
@.planning/phases/42-calendar-display-foundation/42-03-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add aria-live announcement regions and keyboard help dialog</name>
  <files>packages/calendar/src/calendar.ts</files>
  <action>
    Update `packages/calendar/src/calendar.ts`:

    1. **State for announcements:**
       - `@state() private liveAnnouncement = ''` — text for dedicated announcement region

    2. **CSS additions:**
       - `.visually-hidden { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0, 0, 0, 0); white-space: nowrap; border-width: 0; }`
       - `.help-button { font-size: 0.75rem; color: var(--ui-calendar-weekday-color, #6b7280); background: none; border: none; cursor: pointer; padding: 0.25rem; text-decoration: underline; }`
       - `.help-dialog { padding: 1rem; border-radius: 0.5rem; border: 1px solid var(--ui-calendar-border, #e5e7eb); max-width: 320px; }`
       - `.help-dialog::backdrop { background: rgba(0, 0, 0, 0.3); }`
       - `.shortcut-list { list-style: none; padding: 0; margin: 0.5rem 0; font-size: 0.875rem; }`
       - `.shortcut-list li { display: flex; justify-content: space-between; padding: 0.25rem 0; }`
       - `.shortcut-list kbd { font-family: monospace; background: var(--ui-calendar-hover-bg, #f3f4f6); padding: 0.125rem 0.375rem; border-radius: 0.25rem; font-size: 0.75rem; }`

    3. **Belt-and-suspenders aria-live pattern:**
       - Add `aria-live="polite"` attribute to the month heading h2 (or the element containing month/year text)
       - Add a dedicated visually-hidden announcement region in the template:
         ```html
         <div class="visually-hidden" role="status" aria-live="polite" aria-atomic="true">
           ${this.liveAnnouncement}
         </div>
         ```

    4. **Shared announcement method:**
       - `private announceMonthChange(): void`:
         - `this.liveAnnouncement = 'Now showing ' + getMonthYearLabel(this.currentMonth, this.effectiveLocale)`
       - Call `announceMonthChange()` from ALL navigation handlers:
         - navigatePrevMonth()
         - navigateNextMonth()
         - handleMonthSelect()
         - handleYearSelect()
         - PageUp/PageDown keyboard handler

    5. **Date selection announcement:**
       - In `handleDateSelect()`, after dispatching the event, update:
         - `this.liveAnnouncement = 'Selected ' + formatDateLabel(date, this.effectiveLocale)`
         - (formatDateLabel already exists from Plan 02 for aria-label)

    6. **Keyboard shortcuts help dialog:**
       - Add `@state() private showHelp = false`
       - Add a help button in the calendar footer area:
         ```html
         <button class="help-button" @click="${() => this.showHelp = true}"
                 aria-label="Keyboard shortcuts">
           ? Keyboard shortcuts
         </button>
         ```
       - Add a native `<dialog>` element for the help content:
         ```html
         <dialog class="help-dialog" ?open="${this.showHelp}">
           <h3>Keyboard shortcuts</h3>
           <ul class="shortcut-list">
             <li><span>Previous day</span><kbd>←</kbd></li>
             <li><span>Next day</span><kbd>→</kbd></li>
             <li><span>Previous week</span><kbd>↑</kbd></li>
             <li><span>Next week</span><kbd>↓</kbd></li>
             <li><span>First day of week</span><kbd>Home</kbd></li>
             <li><span>Last day of week</span><kbd>End</kbd></li>
             <li><span>Previous month</span><kbd>Page Up</kbd></li>
             <li><span>Next month</span><kbd>Page Down</kbd></li>
             <li><span>Select date</span><kbd>Enter</kbd></li>
           </ul>
           <button @click="${() => this.showHelp = false}">Close</button>
         </dialog>
         ```
       - Use native dialog.showModal() for proper focus trapping if available, or simple open attribute for basic implementation. Guard with isServer check.

    Build: `pnpm --filter @lit-ui/calendar build`
  </action>
  <verify>
    - `pnpm --filter @lit-ui/calendar build` succeeds
    - `grep "aria-live" packages/calendar/src/calendar.ts` shows at least 2 aria-live regions (heading + dedicated region)
    - `grep "announceMonthChange" packages/calendar/src/calendar.ts` confirms shared announcement method
    - `grep "liveAnnouncement" packages/calendar/src/calendar.ts` confirms state and template binding
    - `grep "Keyboard shortcuts" packages/calendar/src/calendar.ts` confirms help dialog
    - `grep "role=\"status\"" packages/calendar/src/calendar.ts` confirms status role on announcement region
  </verify>
  <done>Screen reader announces month changes via belt-and-suspenders aria-live pattern, date selection is announced, keyboard shortcuts help dialog lists all navigation keys</done>
</task>

</tasks>

<verification>
- Package builds without errors
- Two aria-live="polite" regions exist: heading and dedicated announcement region
- announceMonthChange() called from all 4+ navigation paths
- Date selection updates liveAnnouncement with formatted date
- Help dialog contains all keyboard shortcuts (arrows, Home/End, PageUp/Down, Enter)
</verification>

<success_criteria>
1. Month changes announce "Now showing [Month Year]" to screen readers
2. Date selection announces "Selected [full date]" to screen readers
3. Both aria-live heading and dedicated region update on navigation
4. Keyboard shortcuts dialog lists all navigation keys
5. Help dialog is accessible (closable, keyboard operable)
</success_criteria>

<output>
After completion, create `.planning/phases/42-calendar-display-foundation/42-05-SUMMARY.md`
</output>
