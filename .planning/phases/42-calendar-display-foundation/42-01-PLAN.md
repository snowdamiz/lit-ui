---
phase: 42-calendar-display-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - packages/calendar/package.json
  - packages/calendar/tsconfig.json
  - packages/calendar/vite.config.ts
  - packages/calendar/src/vite-env.d.ts
  - packages/calendar/src/date-utils.ts
  - packages/calendar/src/intl-utils.ts
  - packages/calendar/src/calendar.ts
  - packages/calendar/src/index.ts

autonomous: true

must_haves:
  truths:
    - "packages/calendar/ exists as valid pnpm workspace package with date-fns peer dependency"
    - "Calendar component renders a 7-column grid with weekday headers showing current month's days"
    - "Leading/trailing days from adjacent months are visible with reduced opacity"
  artifacts:
    - path: "packages/calendar/package.json"
      provides: "Package configuration with date-fns peer dependency"
      contains: "@lit-ui/calendar"
    - path: "packages/calendar/src/date-utils.ts"
      provides: "Date manipulation utilities wrapping date-fns"
      exports: ["getCalendarDays", "getMonthYearLabel"]
    - path: "packages/calendar/src/intl-utils.ts"
      provides: "Intl API helpers for weekday/month names and first day of week"
      exports: ["getWeekdayNames", "getFirstDayOfWeek", "getMonthNames"]
    - path: "packages/calendar/src/calendar.ts"
      provides: "lui-calendar web component with basic grid rendering"
      contains: "class Calendar extends TailwindElement"
    - path: "packages/calendar/src/index.ts"
      provides: "Package entry with safe element registration"
      contains: "customElements.define"
  key_links:
    - from: "packages/calendar/src/calendar.ts"
      to: "packages/calendar/src/date-utils.ts"
      via: "import getCalendarDays"
      pattern: "import.*getCalendarDays.*date-utils"
    - from: "packages/calendar/src/calendar.ts"
      to: "packages/calendar/src/intl-utils.ts"
      via: "import getWeekdayNames"
      pattern: "import.*getWeekdayNames.*intl-utils"
---

<objective>
Create the @lit-ui/calendar package with foundational infrastructure and a basic calendar grid component that renders a 7-column month grid with localized weekday headers.

Purpose: Establishes the package structure, date utility functions, and base calendar component that all subsequent plans build upon.
Output: Working lui-calendar element that displays the current month in a CSS Grid layout with weekday headers and leading/trailing days.
</objective>

<execution_context>
@/Users/sn0w/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sn0w/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/42-calendar-display-foundation/42-RESEARCH.md

Reference patterns from:
@packages/checkbox/package.json (package.json template)
@packages/checkbox/vite.config.ts (vite config template)
@packages/checkbox/tsconfig.json (tsconfig template)
@packages/checkbox/src/index.ts (safe element registration pattern)
@packages/core/src/tailwind-element.ts (TailwindElement base class)
@packages/core/src/utils/events.ts (dispatchCustomEvent helper)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create @lit-ui/calendar package with date utilities</name>
  <files>
    packages/calendar/package.json
    packages/calendar/tsconfig.json
    packages/calendar/vite.config.ts
    packages/calendar/src/vite-env.d.ts
    packages/calendar/src/date-utils.ts
    packages/calendar/src/intl-utils.ts
  </files>
  <action>
    1. Create `packages/calendar/package.json` following the checkbox package pattern:
       - name: "@lit-ui/calendar"
       - description: "Accessible calendar display component built with Lit, Tailwind CSS, and date-fns"
       - Same structure as @lit-ui/checkbox (type: module, main/module/types pointing to dist/, exports map, sideEffects: true)
       - peerDependencies: lit ^3.0.0, @lit-ui/core ^1.0.0, date-fns ^4.0.0
       - devDependencies: same as checkbox PLUS `date-fns: "^4.1.0"` (needed for dev/build)

    2. Create `packages/calendar/tsconfig.json` extending @lit-ui/typescript-config/library.json (same as checkbox)

    3. Create `packages/calendar/vite.config.ts` using createLibraryConfig({ entry: 'src/index.ts' }) (same as checkbox)

    4. Create `packages/calendar/src/vite-env.d.ts` with `/// <reference types="vite/client" />`

    5. Create `packages/calendar/src/date-utils.ts` with these exports:
       - `getCalendarDays(month: Date, weekStartsOn: 0|1|2|3|4|5|6): Date[]` — Uses date-fns startOfMonth, endOfMonth, startOfWeek, endOfWeek, eachDayOfInterval to generate all days visible in calendar grid (including leading/trailing days from adjacent months)
       - `getMonthYearLabel(month: Date, locale: string): string` — Uses Intl.DateTimeFormat with { month: 'long', year: 'numeric' } to format "January 2026"
       - `intlFirstDayToDateFns(intlFirstDay: number): 0|1|2|3|4|5|6` — Maps Intl firstDay (1=Mon...7=Sun) to date-fns weekStartsOn (0=Sun...6=Sat). Formula: firstDay === 7 ? 0 : firstDay
       - Import from date-fns: startOfMonth, endOfMonth, startOfWeek, endOfWeek, eachDayOfInterval, isSameMonth, isSameDay, isToday, addMonths, subMonths, getYear, getMonth, format

    6. Create `packages/calendar/src/intl-utils.ts` with these exports:
       - `getFirstDayOfWeek(locale: string): number` — Try Intl.Locale.getWeekInfo()?.firstDay, fallback to weekInfo property, fallback to locale map (Sunday=7 for en-US/he-IL/ja-JP/ko-KR/zh-TW, Monday=1 for others). Returns Intl format (1-7).
       - `getWeekdayNames(locale: string, firstDayOfWeek: number): string[]` — Uses Intl.DateTimeFormat({ weekday: 'short' }) to get 7 localized weekday abbreviations, rotated so firstDayOfWeek is at index 0. Use a known reference Sunday (Jan 4, 2026) as starting point.
       - `getMonthNames(locale: string): string[]` — Uses Intl.DateTimeFormat({ month: 'long' }) to get 12 localized month names (for dropdown selectors in Plan 03).

    7. Run `pnpm install --filter @lit-ui/calendar` to install dependencies.
  </action>
  <verify>
    - `ls packages/calendar/package.json packages/calendar/tsconfig.json packages/calendar/vite.config.ts` all exist
    - `cat packages/calendar/package.json | grep date-fns` shows peer dependency
    - `cat packages/calendar/src/date-utils.ts | grep "export function"` shows getCalendarDays, getMonthYearLabel, intlFirstDayToDateFns
    - `cat packages/calendar/src/intl-utils.ts | grep "export function"` shows getFirstDayOfWeek, getWeekdayNames, getMonthNames
  </verify>
  <done>Package scaffolded with valid config, date-utils and intl-utils export all required functions</done>
</task>

<task type="auto">
  <name>Task 2: Create Calendar component with 7-column grid rendering</name>
  <files>
    packages/calendar/src/calendar.ts
    packages/calendar/src/index.ts
  </files>
  <action>
    1. Create `packages/calendar/src/calendar.ts`:
       - Import html, css, isServer, PropertyValues from 'lit'
       - Import property, state from 'lit/decorators.js'
       - Import TailwindElement, tailwindBaseStyles from '@lit-ui/core'
       - Import getCalendarDays, getMonthYearLabel, intlFirstDayToDateFns from './date-utils.js'
       - Import getFirstDayOfWeek, getWeekdayNames from './intl-utils.js'

       - Export class Calendar extends TailwindElement
       - Static styles: tailwindBaseStyles + component CSS with:
         - `.calendar { width: var(--ui-calendar-width, 320px); }` as container
         - `.calendar-header { display: flex; align-items: center; justify-content: space-between; padding: 0.5rem; }`
         - `.calendar-weekdays { display: grid; grid-template-columns: repeat(7, 1fr); gap: var(--ui-calendar-gap, 0.125rem); text-align: center; }`
         - `.calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: var(--ui-calendar-gap, 0.125rem); }`
         - `.weekday-header { font-size: 0.75rem; font-weight: 600; color: var(--ui-calendar-weekday-color, #6b7280); padding: 0.5rem 0; }`
         - `.date-button { width: var(--ui-calendar-day-size, 2.5rem); height: var(--ui-calendar-day-size, 2.5rem); display: flex; align-items: center; justify-content: center; border-radius: var(--ui-calendar-radius, 0.375rem); border: none; background: none; cursor: pointer; font-size: 0.875rem; margin: 0 auto; }`
         - `.date-button:hover { background-color: var(--ui-calendar-hover-bg, #f3f4f6); }`
         - `.date-button.outside-month { opacity: var(--ui-calendar-outside-opacity, 0.4); }`

       - Properties:
         - `@property({ type: String }) value = ''` (selected date ISO string)
         - `@property({ type: String }) locale = ''` (BCP 47 locale tag)
         - `@state() private currentMonth = new Date()` (displayed month)

       - Private computed helpers:
         - `private get effectiveLocale(): string` — returns this.locale || (isServer ? 'en-US' : navigator.language)
         - `private get firstDayOfWeek(): number` — returns getFirstDayOfWeek(this.effectiveLocale)
         - `private get weekStartsOn(): 0|1|2|3|4|5|6` — returns intlFirstDayToDateFns(this.firstDayOfWeek)

       - render() method:
         - Generate weekday names via getWeekdayNames(effectiveLocale, firstDayOfWeek)
         - Generate calendar days via getCalendarDays(currentMonth, weekStartsOn)
         - Render structure:
           ```
           <div class="calendar">
             <div class="calendar-header">
               <h2 id="month-heading">${getMonthYearLabel(currentMonth, effectiveLocale)}</h2>
             </div>
             <div class="calendar-weekdays" role="row">
               ${weekdays.map(name => html`<div class="weekday-header" role="columnheader" aria-label="${name}">${name}</div>`)}
             </div>
             <div class="calendar-grid" role="grid" aria-labelledby="month-heading">
               ${days.map(day => html`
                 <button class="date-button ${!isSameMonth(day, currentMonth) ? 'outside-month' : ''}"
                         aria-label="${formatDateLabel(day, effectiveLocale)}"
                         ?aria-disabled="${!isSameMonth(day, currentMonth)}">
                   ${day.getDate()}
                 </button>
               `)}
             </div>
           </div>
           ```
         - Add helper `formatDateLabel(date, locale)` using Intl.DateTimeFormat({ weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' }) for accessible date labels

    2. Create `packages/calendar/src/index.ts` following the checkbox pattern:
       - `/// <reference path="./jsx.d.ts" />` (comment out for now, jsx.d.ts comes in Plan 08)
       - Export Calendar class and relevant types
       - Re-export TailwindElement, isServer from @lit-ui/core
       - Safe element registration for 'lui-calendar' with collision detection
       - Global HTMLElementTagNameMap declaration

    3. Build the package: `cd packages/calendar && pnpm build`
  </action>
  <verify>
    - `pnpm --filter @lit-ui/calendar build` succeeds without errors
    - `ls packages/calendar/dist/index.js` exists
    - `grep "role=\"grid\"" packages/calendar/src/calendar.ts` confirms grid role
    - `grep "grid-template-columns: repeat(7" packages/calendar/src/calendar.ts` confirms 7-column layout
    - `grep "lui-calendar" packages/calendar/src/index.ts` confirms element registration
  </verify>
  <done>lui-calendar element renders a 7-column month grid with localized weekday headers and leading/trailing days from adjacent months, package builds successfully</done>
</task>

</tasks>

<verification>
- `pnpm --filter @lit-ui/calendar build` completes without TypeScript or build errors
- Calendar package has: package.json, tsconfig.json, vite.config.ts, src/calendar.ts, src/date-utils.ts, src/intl-utils.ts, src/index.ts
- The Calendar component extends TailwindElement and uses CSS Grid repeat(7, 1fr)
- date-utils.ts provides getCalendarDays that returns leading+current+trailing days
- intl-utils.ts provides locale-aware weekday names and first day of week
</verification>

<success_criteria>
1. @lit-ui/calendar package exists and builds cleanly
2. lui-calendar renders 7-column grid with weekday headers
3. Calendar shows current month days plus leading/trailing days from adjacent months
4. Weekday names are locale-aware via Intl API
5. Date utility functions handle month boundaries correctly (5-6 rows)
</success_criteria>

<output>
After completion, create `.planning/phases/42-calendar-display-foundation/42-01-SUMMARY.md`
</output>
