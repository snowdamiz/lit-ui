---
phase: 42-calendar-display-foundation
plan: 02
type: execute
wave: 2
depends_on: ["42-01"]
files_modified:
  - packages/calendar/src/calendar.ts

autonomous: true

must_haves:
  truths:
    - "Today's date has a visible border indicator and aria-current='date' attribute"
    - "Clicking a date visually highlights it as selected with distinct color"
    - "Clicking a date emits ui-date-select event with date and ISO string"
    - "Selected date uses aria-selected='true' attribute"
  artifacts:
    - path: "packages/calendar/src/calendar.ts"
      provides: "Calendar with today indicator, selected state, and date selection events"
      contains: "aria-current"
  key_links:
    - from: "packages/calendar/src/calendar.ts"
      to: "consumer"
      via: "ui-date-select CustomEvent"
      pattern: "dispatchCustomEvent.*ui-date-select"
---

<objective>
Add today indicator, selected date visual state, and date selection click handling to the calendar component.

Purpose: Users need to see which day is today and which date they've selected, with proper ARIA semantics and event emission for parent components.
Output: Calendar component with today border ring, selected date highlight, and ui-date-select event on click.
</objective>

<execution_context>
@/Users/sn0w/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sn0w/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/42-calendar-display-foundation/42-RESEARCH.md
@.planning/phases/42-calendar-display-foundation/42-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add today indicator, selected state, and date selection events</name>
  <files>packages/calendar/src/calendar.ts</files>
  <action>
    Update `packages/calendar/src/calendar.ts` to add:

    1. **State tracking:**
       - `@state() private selectedDate: Date | null = null` â€” tracks currently selected date
       - In `updated()` lifecycle: if `this.value` changed, parse it with date-fns `parseISO()` and set `this.selectedDate`

    2. **CSS additions to static styles:**
       - `.date-button.today { border: 2px solid var(--ui-calendar-today-border, var(--color-primary, #3b82f6)); font-weight: 600; }`
       - `.date-button[aria-selected="true"] { background-color: var(--ui-calendar-selected-bg, var(--color-primary, #3b82f6)); color: var(--ui-calendar-selected-text, white); }`
       - `.date-button[aria-selected="true"]:hover { background-color: var(--ui-calendar-selected-bg, var(--color-primary, #3b82f6)); filter: brightness(0.9); }`
       - `.date-button:focus-visible { outline: 2px solid var(--ui-calendar-focus-ring, var(--color-ring, #3b82f6)); outline-offset: 2px; }`

    3. **Template updates in render():**
       - For each date button, add conditional classes and ARIA:
         - `class="date-button ${isToday(day) ? 'today' : ''} ${!isSameMonth(day, currentMonth) ? 'outside-month' : ''}"`
         - `aria-current="${isToday(day) ? 'date' : nothing}"` (use `nothing` from Lit for conditional attributes)
         - `aria-selected="${this.selectedDate && isSameDay(day, this.selectedDate) ? 'true' : 'false'}"`
         - `@click="${() => this.handleDateSelect(day)}"` (only for current month days)

    4. **Click handler:**
       - `private handleDateSelect(date: Date): void` method:
         - Skip if date is not in current month (outside-month)
         - Set `this.selectedDate = date`
         - Import and use `dispatchCustomEvent` from `@lit-ui/core`:
           ```typescript
           dispatchCustomEvent(this, 'ui-date-select', {
             date: date,
             isoString: format(date, 'yyyy-MM-dd'),
           });
           ```
         - Import `format` from date-fns

    5. **Value sync:**
       - In `updated(changedProperties)`: if `changedProperties.has('value')` and `this.value` is truthy, parse with `parseISO(this.value)` and set `this.selectedDate`
       - Import `parseISO` from date-fns

    Build: `pnpm --filter @lit-ui/calendar build`
  </action>
  <verify>
    - `pnpm --filter @lit-ui/calendar build` succeeds
    - `grep "aria-current" packages/calendar/src/calendar.ts` confirms today indicator
    - `grep "aria-selected" packages/calendar/src/calendar.ts` confirms selected state
    - `grep "ui-date-select" packages/calendar/src/calendar.ts` confirms event emission
    - `grep "dispatchCustomEvent" packages/calendar/src/calendar.ts` confirms using core utility
  </verify>
  <done>Today's date has border indicator with aria-current="date", selected date is highlighted with aria-selected="true", clicking a date emits ui-date-select event with date object and ISO string</done>
</task>

</tasks>

<verification>
- Package builds without errors after changes
- Calendar grid has visual distinction for: today (border), selected (filled background), outside month (dimmed)
- ARIA attributes present: aria-current="date" on today, aria-selected on all date buttons
- ui-date-select event dispatched with { date, isoString } payload on click
</verification>

<success_criteria>
1. Today's date has visible border and aria-current="date"
2. Selected date has filled background and aria-selected="true"
3. Clicking a date dispatches ui-date-select CustomEvent
4. Value property syncs to selectedDate state
5. Outside-month dates are visually dimmed and don't trigger selection
</success_criteria>

<output>
After completion, create `.planning/phases/42-calendar-display-foundation/42-02-SUMMARY.md`
</output>
