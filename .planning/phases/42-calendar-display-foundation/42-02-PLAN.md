---
phase: 42-calendar-display-foundation
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - packages/calendar/src/calendar.ts
  - packages/calendar/src/styles.ts
autonomous: true

must_haves:
  truths:
    - "Today's date is visually distinct from other dates (bold font weight, border)"
    - "Selected date has distinct visual style (solid background fill)"
    - "Today indicator includes aria-current='date' for screen readers"
    - "Selected date includes aria-selected='true' for screen readers"
    - "Today and selected state can both apply to the same date cell"
  artifacts:
    - path: "packages/calendar/src/calendar.ts"
      provides: "Calendar with today/selected state styling"
      contains: "aria-current"
      contains: "aria-selected"
    - path: "packages/calendar/src/styles.ts"
      provides: "CSS custom properties for calendar theming"
      min_lines: 40
  key_links:
    - from: "packages/calendar/src/calendar.ts"
      to: "packages/calendar/src/styles.ts"
      via: "CSS custom properties"
      pattern: "--ui-calendar-"
    - from: "packages/calendar/src/calendar.ts"
      to: "ARIA attributes"
      via: "Conditional template rendering"
      pattern: "aria-current=\"date\""
    - from: "packages/calendar/src/styles.ts"
      to: "packages/core/src/styles/tailwind.css"
      via: "CSS variable inheritance"
      pattern: "var(--color-"
---

<objective>
Add today indicator and selected date styling to calendar cells. Users need visual and screen reader feedback to identify the current date and their selection.

Purpose: Visual states are core to calendar UX. Today and selected states must be distinct and accessible.

Output: Calendar cells with today indicator (bold + border) and selected state (filled background), with proper ARIA attributes.
</objective>

<execution_context>
@/Users/sn0w/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sn0w/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/42-calendar-display-foundation/42-RESEARCH.md
@/Users/sn0w/Documents/dev/lit-components/packages/core/src/tailwind-element.ts
@/Users/sn0w/Documents/dev/lit-components/packages/button/src/button.ts
</context>

<tasks>

<task type="auto">
  <name>Create calendar CSS custom properties for theming</name>
  <files>packages/calendar/src/styles.ts</files>
  <action>
    Create packages/calendar/src/styles.ts with CSS custom properties:

    Export a CSS string literal with calendar-specific CSS custom properties:

    ```css
    :root {
      /* Calendar spacing and sizing */
      --ui-calendar-gap: 0.25rem;
      --ui-calendar-cell-size: 2.5rem;
      --ui-calendar-cell-radius: 0.375rem;

      /* Today indicator styles */
      --ui-calendar-today-font-weight: 600;
      --ui-calendar-today-border: 2px solid var(--color-brand-500);

      /* Selected date styles */
      --ui-calendar-selected-bg: var(--color-brand-500);
      --ui-calendar-selected-text: oklch(0.98 0.01 250);

      /* Disabled state */
      --ui-calendar-disabled-opacity: 0.4;
    }
    ```

    This file will be imported into core's tailwind.css in a future task (when we add calendar to the main build).
    For now, create it as a standalone CSS string export.
  </action>
  <verify>grep "ui-calendar-" packages/calendar/src/styles.ts shows custom properties</verify>
  <done>styles.ts exports CSS custom properties for calendar theming</done>
</task>

<task type="auto">
  <name>Add today indicator to calendar cells</name>
  <files>packages/calendar/src/calendar.ts</files>
  <action>
    Update packages/calendar/src/calendar.ts to add today indicator:

    1. In renderDayCell(date: Date), check if date is today using isDateToday from date-utils
    2. Add aria-current="date" to today's cell (WCAG recommendation for current date)
    3. Add CSS class "today" to today's cell for styling
    4. In static styles, add [role="gridcell"].today { font-weight: var(--ui-calendar-today-font-weight); border: var(--ui-calendar-today-border); }

    Update renderDayCell signature:
    - Check: const isToday = isDateToday(date)
    - Return: html`<div role="gridcell" class="today" aria-current=${isToday ? 'date' : nothing}>${date.getDate()}</div>`

    Import nothing from Lit for aria-current - use conditional rendering with nothing from lit for falsy values.

    Follow CAL-02 requirement: Today indicator with aria-current="date".
  </action>
  <verify>grep "aria-current" packages/calendar/src/calendar.ts shows today indicator</verify>
  <done>Calendar cells show today indicator with bold font and border</done>
</task>

<task type="auto">
  <name>Add selected date state to calendar cells</name>
  <files>packages/calendar/src/calendar.ts</files>
  <action>
    Update packages/calendar/src/calendar.ts to add selected date state:

    1. Add @state() private selectedDate: string = '' (stores ISO date string)
    2. Initialize selectedDate from value property in connectedCallback (if value provided)
    3. In renderDayCell, check if date matches selectedDate using formatDate to compare
    4. Add aria-selected="true" to selected cell
    5. Add CSS class "selected" to selected cell
    6. In static styles, add [role="gridcell"].selected { background-color: var(--ui-calendar-selected-bg); color: var(--ui-calendar-selected-text); border-radius: var(--ui-calendar-cell-radius); }
    7. Add click handler to cells that updates selectedDate and emits ui-date-select event

    Click handler pattern:
    - private handleDateClick(date: Date) { this.selectedDate = formatDate(date); this.emitDateSelect(date); }
    - emitDateSelect(date: Date) { this.dispatchEvent(new CustomEvent('ui-date-select', { bubbles: true, composed: true, detail: { date: formatDate(date) } })); }

    Follow CAL-03 requirement: Selected date visually distinct from today.

    Important: Today and selected can coexist. Both classes should apply when date is both today AND selected.
  </action>
  <verify>grep "aria-selected" packages/calendar/src/calendar.ts shows selected state</verify>
  <done>Calendar cells show selected state with filled background and emit events</done>
</task>

</tasks>

<verification>
After completing all tasks, verify:

1. Today indicator: Current date has bold font and border
2. Selected state: Clicked date has filled background with contrasting text
3. ARIA attributes: aria-current="date" on today, aria-selected="true" on selected
4. CSS custom properties: styles.ts defined with --ui-calendar-* tokens
5. Event emission: Clicking cell emits ui-date-select event with ISO date string
6. Coexisting states: Today can also be selected (both styles apply)
7. SSR safety: No client-only API calls without isServer guard
</verification>

<success_criteria>
1. Today's date is visually highlighted (bold font + border)
2. Clicking a date selects it with filled background
3. Selected date emits ui-date-select event with ISO 8601 string
4. ARIA attributes present: aria-current on today, aria-selected on selected
5. Today and selected states can both apply to same cell
</success_criteria>

<output>
After completion, create `.planning/phases/42-calendar-display-foundation/42-02-SUMMARY.md`
</output>
