---
phase: 42-calendar-display-foundation
plan: 08
type: execute
wave: 3
depends_on: ["42-01", "42-02", "42-03", "42-04", "42-05", "42-06", "42-07"]
files_modified:
  - packages/calendar/src/calendar.ts
  - packages/calendar/tsconfig.json
  - packages/calendar/vite.config.ts
  - packages/core/src/styles/tailwind.css
  - apps/docs/src/routes/docs/(calendar).md
autonomous: true

must_haves:
  truths:
    - "Calendar respects dark mode via :host-context(.dark) selector"
    - "Component renders via SSR with Declarative Shadow DOM"
    - "CSS custom properties are defined in core tailwind.css"
    - "Component has TypeScript types and builds successfully"
    - "Component is registered in CLI registry and has docs page"
  artifacts:
    - path: "packages/calendar/src/calendar.ts"
      provides: "Calendar with dark mode and SSR support"
      contains: ":host-context(.dark)"
    - path: "packages/core/src/styles/tailwind.css"
      contains: "--ui-calendar-"
      provides: "Calendar CSS custom properties in global stylesheet"
    - path: "packages/calendar/tsconfig.json"
      provides: "TypeScript configuration"
    - path: "packages/calendar/vite.config.ts"
      provides: "Vite build configuration"
    - path: "apps/docs/src/routes/docs/(calendar).md"
      provides: "Calendar documentation page"
  key_links:
    - from: "packages/calendar/src/calendar.ts"
      to: "packages/core/src/styles/tailwind.css"
      via: "CSS custom properties inheritance"
      pattern: "var(--ui-calendar-"
    - from: "packages/core/src/styles/tailwind.css"
      to: "CSS @layer base"
      via: ":root rule with calendar tokens"
      pattern: "@layer base.*:root.*--ui-calendar-"
    - from: "packages/calendar/package.json"
      to: "CLI registry"
      via: "Component registration in cli/src/registry.ts"
      pattern: "calendar"
---

<objective>
Add dark mode support via :host-context(.dark), SSR compatibility with isServer guards, build configuration, and register component in CLI with documentation. Calendar must work in dark mode and render via SSR.

Purpose: Dark mode and SSR are project requirements. All components must respect theming and support server-side rendering.

Output: Calendar with dark mode styles, SSR-safe code, complete build config, CLI registration, and documentation.
</objective>

<execution_context>
@/Users/sn0w/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sn0w/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/42-calendar-display-foundation/42-RESEARCH.md
@/Users/sn0w/Documents/dev/lit-components/packages/core/src/tailwind-element.ts
@/Users/sn0w/Documents/dev/lit-components/packages/button/src/button.ts
</context>

<tasks>

<task type="auto">
  <name>Add dark mode styles to calendar component</name>
  <files>packages/calendar/src/calendar.ts</files>
  <action>
    Update packages/calendar/src/calendar.ts static styles to add dark mode support:

    Add :host-context(.dark) selectors for dark mode overrides:

    ```css
    /* Dark mode overrides */
    :host-context(.dark) [role="gridcell"].selected {
      background-color: var(--ui-calendar-selected-bg-dark);
      color: var(--ui-calendar-selected-text-dark);
    }

    :host-context(.dark) [role="gridcell"].today {
      border-color: var(--ui-calendar-today-border-dark);
    }

    :host-context(.dark) .calendar-header button {
      background: var(--ui-calendar-button-bg-dark);
      border-color: var(--ui-calendar-button-border-dark);
      color: var(--ui-calendar-button-text-dark);
    }

    :host-context(.dark) .calendar-header button:hover {
      background: var(--ui-calendar-button-hover-bg-dark);
    }
    ```

    Follow CAL-18 requirement: Component respects dark mode via :host-context(.dark).

    Note: The actual --ui-calendar-*-dark values should be defined in core's tailwind.css.
    This task adds the :host-context(.dark) selectors that consume those variables.
  </action>
  <verify>grep ":host-context(.dark)" packages/calendar/src/calendar.ts shows dark mode selectors</verify>
  <done>Calendar has dark mode styles via :host-context(.dark)</done>
</task>

<task type="auto">
  <name>Add calendar CSS custom properties to core tailwind.css</name>
  <files>packages/core/src/styles/tailwind.css</files>
  <action>
    Update packages/core/src/styles/tailwind.css to add calendar CSS custom properties:

    1. In the @layer base { :root { ... } } section, add calendar tokens:
       ```css
       @layer base {
         :root {
           /* ... existing tokens ... */

           /* Calendar tokens */
           --ui-calendar-gap: 0.25rem;
           --ui-calendar-cell-size: 2.5rem;
           --ui-calendar-cell-radius: 0.375rem;
           --ui-calendar-today-font-weight: 600;
           --ui-calendar-today-border: 2px solid var(--color-brand-500);
           --ui-calendar-selected-bg: var(--color-brand-500);
           --ui-calendar-selected-text: oklch(0.98 0.01 250);
           --ui-calendar-disabled-opacity: 0.4;

           /* Calendar button tokens */
           --ui-calendar-button-bg: var(--color-background);
           --ui-calendar-button-border: var(--color-border);
           --ui-calendar-button-text: var(--color-foreground);
           --ui-calendar-button-hover-bg: var(--color-muted);
         }
       }
       ```

    2. In the .dark { ... } section, add dark mode overrides:
       ```css
       .dark {
         /* ... existing dark tokens ... */

         /* Calendar dark mode */
         --ui-calendar-today-border-dark: 2px solid var(--color-brand-400);
         --ui-calendar-selected-bg-dark: var(--color-brand-400);
         --ui-calendar-selected-text-dark: oklch(0.2 0.01 250);
         --ui-calendar-button-bg-dark: var(--color-background-dark);
         --ui-calendar-button-border-dark: var(--color-border-dark);
         --ui-calendar-button-text-dark: var(--color-foreground-dark);
         --ui-calendar-button-hover-bg-dark: var(--color-muted-dark);
       }
       ```

    Follow the pattern from existing button tokens in tailwind.css.
  </action>
  <verify>grep "ui-calendar-" packages/core/src/styles/tailwind.css shows calendar tokens</verify>
  <done>Core tailwind.css has calendar CSS custom properties</done>
</task>

<task type="auto">
  <name>Create tsconfig.json and vite.config.ts for calendar package</name>
  <files>packages/calendar/tsconfig.json, packages/calendar/vite.config.ts</files>
  <action>
    Create build configuration files for calendar package:

    1. Create packages/calendar/tsconfig.json:
       - Copy from packages/button/tsconfig.json as template
       - Update references to point to calendar paths
       - Ensure extends: "@lit-ui/typescript-config/base.json"
       - Set compilerOptions.outDir to "./dist"
       - Set compilerOptions.rootDir to "./src"

    2. Create packages/calendar/vite.config.ts:
       - Copy from packages/button/vite.config.ts as template
       - Ensure plugins: [dts({ rollupTypes: true })]
       - Set build.lib.entry to "./src/index.ts"
       - Set build.lib.formats to ["es"]
       - Set build.lib.output to { entryFileNames: "[name].js" }

    Follow the exact pattern from button package configuration.
  </action>
  <verify>ls packages/calendar/tsconfig.json packages/calendar/vite.config.ts shows build config files exist</verify>
  <done>Calendar package has TypeScript and Vite build configuration</done>
</task>

<task type="auto">
  <name>Verify SSR compatibility and isServer guards</name>
  <files>packages/calendar/src/calendar.ts</files>
  <action>
    Review and verify packages/calendar/src/calendar.ts for SSR compatibility:

    1. Check all client-only code is guarded with !isServer:
       - Any DOM manipulation (attachInternals, addEventListener, etc.)
       - Any browser APIs (window, document, navigator)
       - Any initialization that requires DOM

    2. Ensure constructor has isServer guard:
       ```typescript
       constructor() {
         super();
         if (!isServer) {
           // Client-only initialization
         }
       }
       ```

    3. Ensure connectedCallback has isServer guard:
       ```typescript
       override connectedCallback(): void {
         super.connectedCallback();
         if (isServer) {
           return;
         }
         // Client-only code
       }
       ```

    4. Verify render() method has no side effects (pure rendering)
       - No DOM mutations outside Lit's controlled template
       - No event listeners attached in render()
       - All event handlers use @event decorator in template

    Follow CAL-19 requirement: Component renders via SSR with Declarative Shadow DOM.

    Note: If any isServer guards are missing, add them. The static styles with tailwindBaseStyles
    already handle SSR (inline styles during SSR, constructable sheets on client).
  </action>
  <verify>grep "isServer" packages/calendar/src/calendar.ts shows SSR guards in place</verify>
  <done>All client-only code guarded with isServer checks</done>
</task>

<task type="auto">
  <name>Build and test calendar package</name>
  <files>packages/calendar/</files>
  <action>
    Build the calendar package and verify it compiles:

    1. Run: pnpm install (to ensure date-fns dependency is installed)
    2. Run: pnpm --filter @lit-ui/calendar build
    3. Verify: dist/ directory is created with index.js, index.d.ts
    4. Verify: No TypeScript errors
    5. Verify: No build errors or warnings

    If build fails, fix errors before proceeding.

    Common issues to check:
    - Missing imports (add missing imports)
    - Type errors (fix type annotations)
    - CSS syntax errors (fix CSS strings)
    - Missing dependencies (add to package.json)
  </action>
  <verify>ls packages/calendar/dist/index.js packages/calendar/dist/index.d.ts shows build output</verify>
  <done>Calendar package builds successfully</done>
</task>

<task type="auto">
  <name>Register calendar in CLI and create documentation</name>
  <files>packages/cli/src/registry.ts, apps/docs/src/routes/docs/(calendar).md</files>
  <action>
    Register calendar component in CLI and create documentation:

    1. Update packages/cli/src/registry.ts:
       - Add calendar to COMPONENTS array
       - Follow pattern from button registration
       - Set files: ['calendar.ts']
       - Set templates for calendar.ts

    2. Create apps/docs/src/routes/docs/(calendar).md:
       - Copy from apps/docs/src/routes/docs/(button).md as template
       - Update title to "Calendar"
       - Update description to "Accessible calendar component with month grid, navigation, keyboard accessibility, and screen reader support"
       - Add calendar-specific props documentation (locale, value, minDate, maxDate, disabledDates, disableWeekends, multiple)
       - Add calendar-specific events documentation (ui-date-select, ui-month-change)
       - Add usage examples for different scenarios (basic, constrained, multi-select, localized)
       - Add accessibility notes (keyboard navigation, screen reader support)
       - Add internationalization notes (locale prop, first day of week)

    Follow the exact pattern from button documentation.
  </action>
  <verify>grep "calendar" packages/cli/src/registry.ts shows calendar registration</verify>
  <done>Calendar registered in CLI with documentation page</done>
</task>

</tasks>

<verification>
After completing all tasks, verify:

1. Dark mode: :host-context(.dark) selectors present for all colored elements
2. CSS properties: Calendar tokens defined in core tailwind.css
3. Dark mode override: .dark class has calendar token overrides
4. SSR guards: All client-only code guarded with !isServer
5. Build config: tsconfig.json and vite.config.ts present and valid
6. Build output: dist/index.js and dist/index.d.ts generated successfully
7. CLI registry: Calendar registered in packages/cli/src/registry.ts
8. Documentation: apps/docs/src/routes/docs/(calendar).md exists with usage examples
9. Test in browser: Component renders in light and dark modes
10. Test SSR: Component renders without errors during SSR (if SSR test environment available)
</verification>

<success_criteria>
1. Calendar respects dark mode via :host-context(.dark) selectors
2. Calendar renders via SSR with Declarative Shadow DOM
3. Package builds successfully with TypeScript
4. Component registered in CLI registry
5. Documentation page exists with usage examples
6. All 19 requirements (CAL-01 through CAL-19) are satisfied
</success_criteria>

<output>
After completion, create `.planning/phases/42-calendar-display-foundation/42-08-SUMMARY.md`
</output>
