---
phase: 42-calendar-display-foundation
plan: 06
type: execute
wave: 3
depends_on: ["42-02"]
files_modified:
  - packages/calendar/src/calendar.ts

autonomous: true

must_haves:
  truths:
    - "Dates before min-date are visually grayed and not selectable"
    - "Dates after max-date are visually grayed and not selectable"
    - "Specific disabled dates are visually grayed and not selectable"
    - "Disabled dates have human-readable reasons in aria-label"
  artifacts:
    - path: "packages/calendar/src/calendar.ts"
      provides: "Calendar with date constraint validation"
      contains: "DateConstraints"
  key_links:
    - from: "packages/calendar/src/calendar.ts"
      to: "date-fns"
      via: "isBefore/isAfter for constraint checking"
      pattern: "isBefore|isAfter"
---

<objective>
Add date constraints support including minimum date, maximum date, and specific disabled dates with proper visual states and accessible labels.

Purpose: Date pickers often need to restrict valid selections (e.g., no past dates for booking, no weekends for business). Disabled dates must be visually distinct and announce reasons to screen readers.
Output: Calendar that respects min-date, max-date, and disabled-dates constraints with ARIA-compliant disabled state.
</objective>

<execution_context>
@/Users/sn0w/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sn0w/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/42-calendar-display-foundation/42-RESEARCH.md
@.planning/phases/42-calendar-display-foundation/42-01-SUMMARY.md
@.planning/phases/42-calendar-display-foundation/42-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add date constraint properties and validation</name>
  <files>packages/calendar/src/calendar.ts</files>
  <action>
    Update `packages/calendar/src/calendar.ts`:

    1. **Interface definition:**
       - Define `interface DateConstraints { minDate: Date | null; maxDate: Date | null; disabledDates: Date[]; }` at the top of the file (or export it)

    2. **Properties (accept ISO strings from HTML attributes):**
       - `@property({ type: String, attribute: 'min-date' }) minDate = ''` — ISO string YYYY-MM-DD
       - `@property({ type: String, attribute: 'max-date' }) maxDate = ''` — ISO string YYYY-MM-DD
       - `@property({ type: Array, attribute: false }) disabledDates: string[] = []` — Array of ISO strings (set via JS, not HTML attribute)

    3. **Parsed constraint state (private):**
       - `private parsedConstraints: DateConstraints = { minDate: null, maxDate: null, disabledDates: [] }`
       - In `updated(changedProperties)`: if minDate, maxDate, or disabledDates changed, parse them:
         ```typescript
         if (changedProperties.has('minDate') || changedProperties.has('maxDate') || changedProperties.has('disabledDates')) {
           this.parsedConstraints = {
             minDate: this.minDate ? parseISO(this.minDate) : null,
             maxDate: this.maxDate ? parseISO(this.maxDate) : null,
             disabledDates: (this.disabledDates || []).map(d => parseISO(d)),
           };
         }
         ```

    4. **Constraint checking method:**
       - `private isDateDisabled(date: Date): { disabled: boolean; reason: string }`:
         - If `parsedConstraints.minDate && isBefore(date, parsedConstraints.minDate)` -> `{ disabled: true, reason: 'before minimum date' }`
         - If `parsedConstraints.maxDate && isAfter(date, parsedConstraints.maxDate)` -> `{ disabled: true, reason: 'after maximum date' }`
         - If `parsedConstraints.disabledDates.some(d => isSameDay(d, date))` -> `{ disabled: true, reason: 'unavailable' }`
         - Otherwise -> `{ disabled: false, reason: '' }`
       - Import `isBefore`, `isAfter` from date-fns

    5. **CSS additions:**
       - `.date-button:disabled, .date-button[aria-disabled="true"] { opacity: var(--ui-calendar-disabled-opacity, 0.5); cursor: not-allowed; pointer-events: none; }`

    6. **Template updates in render():**
       - For each date button, call `isDateDisabled(day)`:
         - If disabled: add `aria-disabled="true"`, update aria-label to include reason: `"${formatDateLabel(day, locale)}, ${reason}"`
         - Prevent click handler from firing for disabled dates
       - In `handleDateSelect()`: add early return if `isDateDisabled(date).disabled`

    7. **Keyboard navigation update:**
       - In keyboard handler, when navigating to a disabled date, skip over it to the next non-disabled date in the same direction. If all remaining dates in direction are disabled, stop at current position.

    Build: `pnpm --filter @lit-ui/calendar build`
  </action>
  <verify>
    - `pnpm --filter @lit-ui/calendar build` succeeds
    - `grep "min-date\|max-date" packages/calendar/src/calendar.ts` confirms attribute properties
    - `grep "isDateDisabled" packages/calendar/src/calendar.ts` confirms validation method
    - `grep "before minimum date\|after maximum date\|unavailable" packages/calendar/src/calendar.ts` confirms reason strings
    - `grep "aria-disabled" packages/calendar/src/calendar.ts` confirms disabled ARIA state
    - `grep "disabled-opacity" packages/calendar/src/calendar.ts` confirms CSS custom property usage
  </verify>
  <done>Calendar respects min-date, max-date, and disabled-dates constraints. Disabled dates are visually grayed with reduced opacity, not clickable, and have human-readable reasons in aria-label for screen readers.</done>
</task>

</tasks>

<verification>
- Package builds without errors
- min-date attribute prevents selection of earlier dates
- max-date attribute prevents selection of later dates
- disabledDates property (JS array) prevents selection of specific dates
- All disabled dates have aria-disabled="true"
- Disabled date aria-label includes reason ("before minimum date", "after maximum date", "unavailable")
- Keyboard navigation skips disabled dates
</verification>

<success_criteria>
1. Dates before min-date are visually disabled with aria-disabled="true"
2. Dates after max-date are visually disabled with aria-disabled="true"
3. Specific disabled dates are visually disabled with aria-disabled="true"
4. Each disabled date's aria-label includes human-readable reason
5. Click handler and keyboard selection ignore disabled dates
6. CSS custom property --ui-calendar-disabled-opacity controls opacity
</success_criteria>

<output>
After completion, create `.planning/phases/42-calendar-display-foundation/42-06-SUMMARY.md`
</output>
