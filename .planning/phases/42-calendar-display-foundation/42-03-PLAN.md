---
phase: 42-calendar-display-foundation
plan: 03
type: execute
wave: 2
depends_on: ["42-01"]
files_modified:
  - packages/calendar/src/calendar.ts
autonomous: true

must_haves:
  truths:
    - "User sees previous month and next month navigation buttons above calendar"
    - "Clicking previous/next buttons changes displayed month"
    - "User can select month from dropdown to jump to specific month"
    - "User can select year from dropdown to jump to specific year"
    - "Navigation emits ui-month-change event with year and month"
  artifacts:
    - path: "packages/calendar/src/calendar.ts"
      provides: "Month/year navigation controls"
      contains: "handlePreviousMonth"
      contains: "handleNextMonth"
      contains: "ui-month-change"
  key_links:
    - from: "packages/calendar/src/calendar.ts"
      to: "date-fns"
      via: "addMonths, subMonths functions"
      pattern: "addMonths|subMonths"
    - from: "packages/calendar/src/calendar.ts"
      to: "browser events"
      via: "CustomEvent emission"
      pattern: "ui-month-change"
---

<objective>
Add month navigation with previous/next buttons and month/year dropdown selectors. Users need to navigate between months and jump to specific dates.

Purpose: Navigation is essential for calendar functionality. Users must browse past and future months.

Output: Calendar header with prev/next buttons and month/year dropdowns that update the displayed month.
</objective>

<execution_context>
@/Users/sn0w/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sn0w/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/42-calendar-display-foundation/42-RESEARCH.md
@/Users/sn0w/Documents/dev/lit-components/packages/button/src/button.ts
</context>

<tasks>

<task type="auto">
  <name>Add previous/next month navigation buttons</name>
  <files>packages/calendar/src/calendar.ts</files>
  <action>
    Update packages/calendar/src/calendar.ts to add month navigation buttons:

    1. Import addMonths, subMonths from date-fns in date-utils.ts and re-export
    2. Add private methods:
       - handlePreviousMonth(): subtracts 1 month from currentMonth using subMonths
       - handleNextMonth(): adds 1 month to currentMonth using addMonths

    3. In render() method, add navigation header before the grid:
       ```html
       <div class="calendar-header">
         <button @click=${this.handlePreviousMonth} aria-label="Previous month">
           &lt;
         </button>
         <h2 id="calendar-heading" aria-live="polite">${this.getMonthYearLabel()}</h2>
         <button @click=${this.handleNextMonth} aria-label="Next month">
           &gt;
         </button>
       </div>
       ```

    4. Add header styles to static styles:
       - .calendar-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 0.5rem; }
       - .calendar-header button { padding: 0.25rem 0.5rem; border: 1px solid var(--color-border); background: var(--color-background); cursor: pointer; border-radius: 0.25rem; }
       - .calendar-header button:hover { background: var(--color-muted); }

    5. Add aria-live="polite" to heading for screen reader announcements (CAL-09)

    Follow CAL-04 requirement: Previous/next buttons with descriptive ARIA labels.
  </action>
  <verify>grep "handlePreviousMonth\|handleNextMonth" packages/calendar/src/calendar.ts shows navigation handlers</verify>
  <done>Previous/next buttons change displayed month</done>
</task>

<task type="auto">
  <name>Add month/year dropdown selectors</name>
  <files>packages/calendar/src/calendar.ts</files>
  <action>
    Update packages/calendar/src/calendar.ts to add month/year dropdowns:

    1. Create monthOptions array: ["January", "February", ..., "December"]
       - Use Intl.DateTimeFormat with locale to get localized month names
    2. Create yearOptions array: [currentYear - 10, ..., currentYear, ..., currentYear + 10]

    3. Add @state() properties for dropdown values:
       - @state() private selectedMonth: number = new Date().getMonth()
       - @state() private selectedYear: number = new Date().getFullYear()

    4. Update currentMonth when dropdowns change:
       - private handleMonthChange(event: Event) { const month = parseInt((event.target as HTMLSelectElement).value); this.selectedMonth = month; this.currentMonth = new Date(this.selectedYear, month, 1); this.emitMonthChange(); }
       - private handleYearChange(event: Event) { const year = parseInt((event.target as HTMLSelectElement).value); this.selectedYear = year; this.currentMonth = new Date(year, this.selectedMonth, 1); this.emitMonthChange(); }

    5. Replace heading with dropdown selector UI:
       ```html
       <select @change=${this.handleMonthChange} aria-label="Select month">
         ${monthOptions.map((name, index) => html`<option value=${index} ?selected=${this.selectedMonth === index}>${name}</option>`)}
       </select>
       <select @change=${this.handleYearChange} aria-label="Select year">
         ${yearOptions.map(year => html`<option value=${year} ?selected=${this.selectedYear === year}>${year}</option>`)}
       </select>
       ```

    6. Add dropdown styles: select { padding: 0.25rem 0.5rem; border: 1px solid var(--color-border); border-radius: 0.25rem; background: var(--color-background); }

    Follow CAL-05 and CAL-06 requirements: Month/year dropdowns for jumping to specific months.
  </action>
  <verify>grep "handleMonthChange\|handleYearChange" packages/calendar/src/calendar.ts shows dropdown handlers</verify>
  <done>Month/year dropdowns jump to selected month/year</done>
</task>

<task type="auto">
  <name>Add month change event emission</name>
  <files>packages/calendar/src/calendar.ts</files>
<action>
    Update packages/calendar/src/calendar.ts to emit ui-month-change event:

    1. Add private emitMonthChange() method:
       - private emitMonthChange() { this.dispatchEvent(new CustomEvent('ui-month-change', { bubbles: true, composed: true, detail: { year: this.currentMonth.getFullYear(), month: this.currentMonth.getMonth() } })); }

    2. Call emitMonthChange() after:
       - handlePreviousMonth() updates currentMonth
       - handleNextMonth() updates currentMonth
       - handleMonthChange() updates currentMonth
       - handleYearChange() updates currentMonth

    Event detail format:
    ```typescript
    {
      year: number,    // e.g., 2026
      month: number    // 0-11 (0 = January, 11 = December)
    }
    ```

    Follow project pattern for custom events (see button.ts click handlers).
  </action>
  <verify>grep "ui-month-change" packages/calendar/src/calendar.ts shows event emission</verify>
  <done>Month navigation emits ui-month-change event</done>
</task>

</tasks>

<verification>
After completing all tasks, verify:

1. Previous button: Navigates to previous month
2. Next button: Navigates to next month
3. Month dropdown: Jumps to selected month
4. Year dropdown: Jumps to selected year (range: currentYear Â± 10)
5. aria-live: Heading has aria-live="polite" for announcements
6. Event emission: Month changes emit ui-month-change event
7. ARIA labels: Buttons have descriptive aria-label attributes
8. SSR safety: No client-only API calls without isServer guard
</verification>

<success_criteria>
1. Previous/next buttons change displayed month
2. Month dropdown jumps to selected month
3. Year dropdown jumps to selected year
4. Month changes emit ui-month-change event with year and month
5. Screen readers announce month changes via aria-live region
</success_criteria>

<output>
After completion, create `.planning/phases/42-calendar-display-foundation/42-03-SUMMARY.md`
</output>
