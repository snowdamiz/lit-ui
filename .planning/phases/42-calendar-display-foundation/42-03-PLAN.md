---
phase: 42-calendar-display-foundation
plan: 03
type: execute
wave: 2
depends_on: ["42-01"]
files_modified:
  - packages/calendar/src/calendar.ts

autonomous: true

must_haves:
  truths:
    - "User can click previous/next buttons to navigate between months"
    - "User can select a specific month from a dropdown"
    - "User can select a specific year from a dropdown"
    - "Month change emits ui-month-change event with year and month"
  artifacts:
    - path: "packages/calendar/src/calendar.ts"
      provides: "Calendar with month navigation controls"
      contains: "ui-month-change"
  key_links:
    - from: "packages/calendar/src/calendar.ts"
      to: "consumer"
      via: "ui-month-change CustomEvent"
      pattern: "dispatchCustomEvent.*ui-month-change"
---

<objective>
Add month navigation controls including previous/next buttons and month/year dropdown selectors to the calendar component.

Purpose: Users need to navigate to different months and years to find their desired date. Previous/next buttons handle nearby months; dropdowns handle jumping to distant dates.
Output: Calendar header with prev/next arrows, month dropdown, year dropdown, and ui-month-change event emission.
</objective>

<execution_context>
@/Users/sn0w/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sn0w/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/42-calendar-display-foundation/42-RESEARCH.md
@.planning/phases/42-calendar-display-foundation/42-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add previous/next month navigation buttons</name>
  <files>packages/calendar/src/calendar.ts</files>
  <action>
    Update `packages/calendar/src/calendar.ts`:

    1. **Import additions:**
       - Import `addMonths`, `subMonths`, `getYear`, `getMonth` from date-fns (some may already be imported from Plan 01)

    2. **CSS additions:**
       - `.nav-button { display: flex; align-items: center; justify-content: center; width: 2rem; height: 2rem; border: none; background: none; cursor: pointer; border-radius: var(--ui-calendar-radius, 0.375rem); color: var(--ui-calendar-nav-color, currentColor); }`
       - `.nav-button:hover { background-color: var(--ui-calendar-hover-bg, #f3f4f6); }`
       - `.nav-button:focus-visible { outline: 2px solid var(--ui-calendar-focus-ring, var(--color-ring, #3b82f6)); outline-offset: 2px; }`
       - `.nav-button svg { width: 1rem; height: 1rem; }`

    3. **Navigation methods:**
       - `private navigatePrevMonth(): void` — Sets `this.currentMonth = subMonths(this.currentMonth, 1)`, then calls `this.emitMonthChange()`
       - `private navigateNextMonth(): void` — Sets `this.currentMonth = addMonths(this.currentMonth, 1)`, then calls `this.emitMonthChange()`
       - `private emitMonthChange(): void` — Dispatches:
         ```typescript
         dispatchCustomEvent(this, 'ui-month-change', {
           year: getYear(this.currentMonth),
           month: getMonth(this.currentMonth),
         });
         ```

    4. **Header template update:**
       - Replace the simple h2 header with navigation controls:
         ```html
         <div class="calendar-header">
           <button class="nav-button" @click="${this.navigatePrevMonth}"
                   aria-label="Previous month, ${getMonthYearLabel(subMonths(this.currentMonth, 1), this.effectiveLocale)}">
             <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M15 18l-6-6 6-6"/></svg>
           </button>
           <h2 id="month-heading">${getMonthYearLabel(this.currentMonth, this.effectiveLocale)}</h2>
           <button class="nav-button" @click="${this.navigateNextMonth}"
                   aria-label="Next month, ${getMonthYearLabel(addMonths(this.currentMonth, 1), this.effectiveLocale)}">
             <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 18l6-6-6-6"/></svg>
           </button>
         </div>
         ```
  </action>
  <verify>
    - `grep "navigatePrevMonth\|navigateNextMonth" packages/calendar/src/calendar.ts` shows both methods
    - `grep "ui-month-change" packages/calendar/src/calendar.ts` confirms event emission
    - `grep "aria-label.*Previous month\|aria-label.*Next month" packages/calendar/src/calendar.ts` confirms descriptive labels
  </verify>
  <done>Previous/next buttons navigate months and emit ui-month-change events with descriptive ARIA labels</done>
</task>

<task type="auto">
  <name>Task 2: Add month and year dropdown selectors</name>
  <files>packages/calendar/src/calendar.ts</files>
  <action>
    Update `packages/calendar/src/calendar.ts`:

    1. **State additions:**
       - `@state() private selectedMonth: number = getMonth(new Date())` — tracks dropdown month selection
       - `@state() private selectedYear: number = getYear(new Date())` — tracks dropdown year selection

    2. **Sync dropdown state with currentMonth:**
       - In `updated(changedProperties)`: if currentMonth changed, sync `selectedMonth = getMonth(this.currentMonth)` and `selectedYear = getYear(this.currentMonth)`

    3. **CSS additions:**
       - `.month-year-selectors { display: flex; align-items: center; gap: 0.25rem; }`
       - `.month-select, .year-select { padding: 0.25rem 0.5rem; border: 1px solid var(--ui-calendar-border, #e5e7eb); border-radius: var(--ui-calendar-radius, 0.375rem); background: var(--ui-calendar-bg, white); font-size: 0.875rem; cursor: pointer; color: inherit; }`
       - `.month-select:focus-visible, .year-select:focus-visible { outline: 2px solid var(--ui-calendar-focus-ring, var(--color-ring, #3b82f6)); outline-offset: 2px; }`

    4. **Dropdown handlers:**
       - `private handleMonthSelect(e: Event): void` — Gets value from (e.target as HTMLSelectElement).value, creates new Date with setMonth, updates currentMonth, calls emitMonthChange()
       - `private handleYearSelect(e: Event): void` — Gets value, creates new Date with setYear, updates currentMonth, calls emitMonthChange()

    5. **Header template update:**
       - Replace the h2 heading text with month/year dropdowns:
         ```html
         <div class="month-year-selectors">
           <select class="month-select" aria-label="Select month" @change="${this.handleMonthSelect}">
             ${getMonthNames(this.effectiveLocale).map((name, i) =>
               html`<option value="${i}" ?selected="${i === this.selectedMonth}">${name}</option>`
             )}
           </select>
           <select class="year-select" aria-label="Select year" @change="${this.handleYearSelect}">
             ${this.getYearRange().map(year =>
               html`<option value="${year}" ?selected="${year === this.selectedYear}">${year}</option>`
             )}
           </select>
         </div>
         ```
       - Keep the h2 with `id="month-heading"` but make it visually hidden (for aria-labelledby reference). OR change the h2 to render the dropdown selectors inline.
       - The month-heading ID is still needed for the grid's aria-labelledby, so keep an accessible heading that reflects the current month, either as visible text alongside dropdowns or as a visually-hidden element.

    6. **Year range helper:**
       - `private getYearRange(): number[]` — Returns array of years from (currentYear - 100) to (currentYear + 50) for broad date selection (CAL-06 requirement)

    Build: `pnpm --filter @lit-ui/calendar build`
  </action>
  <verify>
    - `pnpm --filter @lit-ui/calendar build` succeeds
    - `grep "month-select\|year-select" packages/calendar/src/calendar.ts` confirms dropdown elements
    - `grep "Select month\|Select year" packages/calendar/src/calendar.ts` confirms ARIA labels
    - `grep "handleMonthSelect\|handleYearSelect" packages/calendar/src/calendar.ts` confirms handlers
  </verify>
  <done>Month and year dropdowns allow jumping to specific months/years, state syncs with currentMonth, and emitMonthChange fires on change</done>
</task>

</tasks>

<verification>
- Package builds without errors
- Calendar header contains: prev button, month/year dropdowns, next button
- Navigation buttons have descriptive aria-label including target month name
- Month dropdown shows all 12 months in locale-aware names
- Year dropdown shows reasonable range for distant year selection (CAL-06)
- All navigation paths emit ui-month-change event
</verification>

<success_criteria>
1. Previous/next buttons navigate between months
2. Month dropdown shows localized month names and jumps to selected month
3. Year dropdown allows selection across 150-year range
4. All navigation emits ui-month-change event with {year, month}
5. Dropdown state stays in sync with currentMonth
</success_criteria>

<output>
After completion, create `.planning/phases/42-calendar-display-foundation/42-03-SUMMARY.md`
</output>
