---
phase: 68-package-cli-documentation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - packages/data-table/package.json
  - packages/data-table/src/index.ts
  - packages/data-table/src/data-table.ts
  - packages/data-table/src/jsx.d.ts
autonomous: true

must_haves:
  truths:
    - "@lit-ui/checkbox and @lit-ui/popover are declared as peerDependencies"
    - "Element registration uses collision detection pattern from index.ts, not component file"
    - "JSX declarations cover all 35+ @property attributes and all 13 custom events"
    - "HTMLElementTagNameMap declares lui-data-table in index.ts"
  artifacts:
    - path: "packages/data-table/package.json"
      provides: "Complete peerDependencies including checkbox and popover"
      contains: "@lit-ui/checkbox"
    - path: "packages/data-table/src/index.ts"
      provides: "Custom element registration with collision detection and HTMLElementTagNameMap"
      contains: "customElements.get"
    - path: "packages/data-table/src/jsx.d.ts"
      provides: "Complete JSX type declarations for React, Vue, Svelte with all attributes and events"
      min_lines: 100
    - path: "packages/data-table/src/data-table.ts"
      provides: "Component file without element registration (moved to index.ts)"
  key_links:
    - from: "packages/data-table/src/index.ts"
      to: "packages/data-table/src/data-table.ts"
      via: "import { DataTable } and customElements.define"
      pattern: "customElements\\.define\\('lui-data-table'"
---

<objective>
Finalize the @lit-ui/data-table npm package for distribution by fixing missing peer dependencies, updating element registration to match the v6.0 collision detection pattern, and completing JSX/TSX type declarations for all properties and events added in phases 62-67.

Purpose: Ensures consumers can `npm install @lit-ui/data-table` and get a correctly configured package with proper dependency declarations and full TypeScript/JSX support across React, Vue, and Svelte.
Output: Updated package.json, index.ts with registration, data-table.ts without registration, comprehensive jsx.d.ts
</objective>

<execution_context>
@/Users/sn0w/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sn0w/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@packages/data-table/package.json
@packages/data-table/src/index.ts
@packages/data-table/src/data-table.ts
@packages/data-table/src/jsx.d.ts
@packages/data-table/src/types.ts
@packages/accordion/src/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix package.json and update element registration</name>
  <files>
    packages/data-table/package.json
    packages/data-table/src/index.ts
    packages/data-table/src/data-table.ts
  </files>
  <action>
**1. Update packages/data-table/package.json:**

Add missing peer dependencies. The current peerDependencies has `lit` and `@lit-ui/core`. Add `@lit-ui/checkbox` and `@lit-ui/popover`:

```json
"peerDependencies": {
  "lit": "^3.0.0",
  "@lit-ui/core": "^1.0.0",
  "@lit-ui/checkbox": "^1.0.0",
  "@lit-ui/popover": "^1.0.0"
}
```

Also add them to devDependencies if not present (using workspace:*):
```json
"@lit-ui/checkbox": "workspace:*",
"@lit-ui/popover": "workspace:*"
```

**2. Remove element registration from data-table.ts:**

Remove the block at the bottom of data-table.ts (around lines 3507-3517):
```typescript
// Register custom element (client-side only)
if (!isServer) {
  customElements.define('lui-data-table', DataTable);
}

// Type declaration for HTMLElementTagNameMap
declare global {
  interface HTMLElementTagNameMap {
    'lui-data-table': DataTable;
  }
}
```

Remove it entirely -- registration moves to index.ts.

**3. Update index.ts with collision detection registration pattern:**

At the bottom of index.ts (after all exports), add the registration block matching the accordion/tabs pattern EXACTLY:

```typescript
// Safe custom element registration with collision detection
import { DataTable } from './data-table.js';

if (typeof customElements !== 'undefined') {
  if (!customElements.get('lui-data-table')) {
    customElements.define('lui-data-table', DataTable);
  } else if (!isServer && import.meta.env?.DEV) {
    console.warn(
      '[lui-data-table] Custom element already registered. ' +
        'This may indicate duplicate imports or version conflicts.'
    );
  }
}

// TypeScript global type registration
declare global {
  interface HTMLElementTagNameMap {
    'lui-data-table': DataTable;
  }
}
```

Note: `isServer` is already imported in index.ts from `@lit-ui/core`. The `import { DataTable }` at the bottom is separate from the export statement -- the export at the top uses `export { DataTable } from './data-table.js'` which is a re-export. The registration block needs its own import statement (just like accordion/index.ts does it).

Also ensure the `import { isServer } from 'lit'` is present at the top of index.ts (it currently re-exports isServer from @lit-ui/core, but the registration block needs the direct import from lit). Check if `isServer` is available. If not, add `import { isServer } from 'lit';` at the top.
  </action>
  <verify>
Run `cd /Users/sn0w/Documents/dev/lit-components && npx tsc --noEmit -p packages/data-table/tsconfig.json` to verify TypeScript compilation passes.

Verify package.json has 4 peerDependencies (lit, @lit-ui/core, @lit-ui/checkbox, @lit-ui/popover).

Verify data-table.ts no longer contains `customElements.define`.

Verify index.ts contains `customElements.get('lui-data-table')` collision detection pattern.
  </verify>
  <done>
Package.json declares all 4 peer dependencies. Element registration moved from data-table.ts to index.ts with collision detection pattern matching accordion/tabs. HTMLElementTagNameMap declared in index.ts.
  </done>
</task>

<task type="auto">
  <name>Task 2: Complete JSX/TSX type declarations</name>
  <files>packages/data-table/src/jsx.d.ts</files>
  <action>
Rewrite jsx.d.ts completely. The current file is a Phase 61 placeholder with ~10 attributes. The data-table now has 35+ @property declarations and 13 custom events.

**Step 1:** Read ALL @property decorators from data-table.ts to build the complete attribute list. Group by feature area.

**Step 2:** Write the new jsx.d.ts with this structure:

```typescript
/**
 * JSX type declarations for lui-data-table custom element.
 * Provides type support for React, Vue, and Svelte.
 */

import type { RowData, SortingState, ColumnFiltersState, PaginationState, RowSelectionState, ColumnSizingState, VisibilityState, ColumnOrderState, ExpandedState } from '@tanstack/lit-table';
import type { ColumnDef, LoadingState, EmptyStateType, RowAction, BulkAction, DataCallback, ServerExportParams, DetailContentRenderer, ColumnPreferencesChangeEvent } from './types.js';

interface LuiDataTableAttributes<TData extends RowData = RowData> {
  // Core
  columns?: ColumnDef<TData>[];
  data?: TData[];
  loading?: LoadingState;
  'aria-label'?: string;
  'max-height'?: string;
  'row-height'?: number;
  'skeleton-rows'?: number;
  'empty-state-type'?: EmptyStateType;
  'no-data-message'?: string;
  'no-matches-message'?: string;

  // Sorting
  sorting?: SortingState;
  'manual-sorting'?: boolean;

  // Selection
  'enable-selection'?: boolean;
  'row-selection'?: RowSelectionState;
  'row-id-key'?: string;
  'total-row-count'?: number;
  'preserve-selection-on-filter'?: boolean;

  // Filtering
  'column-filters'?: ColumnFiltersState;
  'global-filter'?: string;
  'manual-filtering'?: boolean;

  // Pagination
  pagination?: PaginationState;
  'manual-pagination'?: boolean;
  'page-count'?: number;

  // Column customization
  'enable-column-resizing'?: boolean;
  'column-sizing'?: ColumnSizingState;
  'column-resize-mode'?: 'onChange' | 'onEnd';
  'column-visibility'?: VisibilityState;
  'show-column-picker'?: boolean;
  'column-order'?: ColumnOrderState;
  'enable-column-reorder'?: boolean;
  'sticky-first-column'?: boolean;
  'persistence-key'?: string;

  // Editing
  'enable-row-editing'?: boolean;

  // Row actions
  rowActions?: RowAction<TData>[];
  'hover-reveal-actions'?: boolean;
  bulkActions?: BulkAction[];

  // Export
  onExport?: (params: ServerExportParams) => void | Promise<void>;

  // Expandable rows
  renderDetailContent?: DetailContentRenderer<TData>;
  expanded?: ExpandedState;
  'single-expand'?: boolean;

  // Async data
  dataCallback?: DataCallback<TData>;
  'debounce-delay'?: number;

  // Column preferences callback
  onColumnPreferencesChange?: (prefs: ColumnPreferencesChangeEvent) => void;
}

// Event types for type-safe event handling
interface LuiDataTableEvents {
  'ui-sort-change': CustomEvent;
  'ui-selection-change': CustomEvent;
  'ui-filter-change': CustomEvent;
  'ui-pagination-change': CustomEvent;
  'ui-column-visibility-change': CustomEvent;
  'ui-column-order-change': CustomEvent;
  'ui-column-preferences-change': CustomEvent;
  'ui-column-preferences-reset': CustomEvent;
  'ui-cell-edit': CustomEvent;
  'ui-row-edit': CustomEvent;
  'ui-row-action': CustomEvent;
  'ui-bulk-action': CustomEvent;
  'ui-expanded-change': CustomEvent;
}
```

**React JSX section:**
```typescript
declare global {
  namespace JSX {
    interface IntrinsicElements {
      'lui-data-table': React.DetailedHTMLProps<
        React.HTMLAttributes<HTMLElement> & LuiDataTableAttributes,
        HTMLElement
      >;
    }
  }
}
```

**Vue section:**
```typescript
declare module 'vue' {
  export interface GlobalComponents {
    'lui-data-table': import('vue').DefineComponent<LuiDataTableAttributes>;
  }
}
```

**Svelte section** with ALL 13 events:
```typescript
declare namespace svelteHTML {
  interface IntrinsicElements {
    'lui-data-table': LuiDataTableAttributes & {
      'on:ui-sort-change'?: (e: CustomEvent) => void;
      'on:ui-selection-change'?: (e: CustomEvent) => void;
      'on:ui-filter-change'?: (e: CustomEvent) => void;
      'on:ui-pagination-change'?: (e: CustomEvent) => void;
      'on:ui-column-visibility-change'?: (e: CustomEvent) => void;
      'on:ui-column-order-change'?: (e: CustomEvent) => void;
      'on:ui-column-preferences-change'?: (e: CustomEvent) => void;
      'on:ui-column-preferences-reset'?: (e: CustomEvent) => void;
      'on:ui-cell-edit'?: (e: CustomEvent) => void;
      'on:ui-row-edit'?: (e: CustomEvent) => void;
      'on:ui-row-action'?: (e: CustomEvent) => void;
      'on:ui-bulk-action'?: (e: CustomEvent) => void;
      'on:ui-expanded-change'?: (e: CustomEvent) => void;
    };
  }
}
```

End with `export {};`

**Important:** Cross-reference every @property in data-table.ts. The attribute name is from the `attribute:` option in the decorator. Properties with `attribute: false` (like `rowActions`, `bulkActions`, `dataCallback`, `onExport`, `renderDetailContent`, `onColumnPreferencesChange`, `pageSizeOptions`) should still be in the interface but they use the camelCase JavaScript property name since they can only be set via JS, not HTML attributes.
  </action>
  <verify>
Run `cd /Users/sn0w/Documents/dev/lit-components && npx tsc --noEmit -p packages/data-table/tsconfig.json` to verify no type errors.

Count the number of properties in LuiDataTableAttributes -- should be 35+ entries.

Count the Svelte events -- should be exactly 13 `on:ui-*` events.

Verify the file imports types from both `@tanstack/lit-table` and `./types.js`.
  </verify>
  <done>
jsx.d.ts contains comprehensive type declarations covering all 35+ properties and all 13 custom events for React, Vue, and Svelte integration. All property types match their @property decorator declarations in data-table.ts.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit -p packages/data-table/tsconfig.json` passes with zero errors
2. package.json peerDependencies includes lit, @lit-ui/core, @lit-ui/checkbox, @lit-ui/popover
3. data-table.ts contains NO `customElements.define` call
4. index.ts contains collision detection registration (`customElements.get`)
5. index.ts contains `HTMLElementTagNameMap` declaration
6. jsx.d.ts has 35+ attribute entries and 13 Svelte event handlers
7. `cd /Users/sn0w/Documents/dev/lit-components && pnpm build --filter @lit-ui/data-table` succeeds
</verification>

<success_criteria>
- Package is correctly configured with all peer dependencies declared
- Element registration follows the v6.0 collision detection pattern in index.ts
- JSX declarations are complete for all properties and events across React, Vue, Svelte
- TypeScript compilation and build both pass
</success_criteria>

<output>
After completion, create `.planning/phases/68-package-cli-documentation/68-01-SUMMARY.md`
</output>
