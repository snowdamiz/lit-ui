---
phase: 46-date-range-picker-core
plan: 05
type: execute
wave: 5
depends_on: ["46-04"]
files_modified:
  - packages/date-range-picker/src/date-range-picker.ts
  - packages/date-range-picker/src/index.ts
  - packages/date-range-picker/src/jsx.d.ts
autonomous: true

must_haves:
  truths:
    - "Component renders correctly in dark mode via :host-context(.dark)"
    - "Package exports are complete and all types are available"
    - "Custom element 'lui-date-range-picker' is registered via index.ts"
    - "JSX types work for React, Vue, and Svelte"
    - "Package builds without errors"
  artifacts:
    - path: "packages/date-range-picker/src/index.ts"
      provides: "Public exports, custom element registration, HTMLElementTagNameMap"
      contains: "customElements.define"
    - path: "packages/date-range-picker/src/jsx.d.ts"
      provides: "JSX type declarations for React, Vue, Svelte"
      contains: "IntrinsicElements"
    - path: "packages/date-range-picker/src/date-range-picker.ts"
      provides: "Dark mode styles via :host-context(.dark)"
      contains: ":host-context(.dark)"
  key_links:
    - from: "packages/date-range-picker/src/index.ts"
      to: "packages/date-range-picker/src/date-range-picker.ts"
      via: "export { DateRangePicker } and customElements.define"
      pattern: "customElements\\.define.*lui-date-range-picker"
---

<objective>
Add dark mode styles, finalize package exports with custom element registration, and create JSX type declarations for React/Vue/Svelte framework support.

Purpose: Dark mode, exports, and JSX types are required for the component to be production-ready and usable across frameworks.
Output: Complete package ready for consumption with dark mode, type safety, and framework JSX support.
</objective>

<execution_context>
@/Users/sn0w/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sn0w/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/46-date-range-picker-core/46-01-SUMMARY.md
@.planning/phases/46-date-range-picker-core/46-04-SUMMARY.md
@packages/date-picker/src/index.ts — Custom element registration pattern (collision detection, isServer guard)
@packages/date-picker/src/jsx.d.ts — JSX type declaration pattern (React, Vue, Svelte interfaces, attribute/property separation)
@packages/date-picker/src/date-picker.ts — Dark mode pattern (:host-context(.dark) selectors)
@packages/calendar/src/index.ts — HTMLElementTagNameMap registration pattern
</context>

<tasks>

<task type="auto">
  <name>Task 1: Dark mode styles</name>
  <files>packages/date-range-picker/src/date-range-picker.ts</files>
  <action>
    Add dark mode styles using `:host-context(.dark)` selectors, following the established project pattern from date-picker and calendar components.

    Add the following dark mode CSS to the static styles array:

    ```css
    :host-context(.dark) .input-container {
      background-color: var(--ui-range-bg, #1f2937);
      border-color: var(--ui-range-border, #374151);
      color: var(--ui-range-text, #f9fafb);
    }

    :host-context(.dark) input {
      color: var(--ui-range-text, #f9fafb);
    }

    :host-context(.dark) input::placeholder {
      color: var(--ui-range-placeholder, #6b7280);
    }

    :host-context(.dark) .popup {
      background-color: var(--ui-range-popup-bg, #1f2937);
      border-color: var(--ui-range-popup-border, #374151);
      box-shadow: 0 10px 15px -3px rgba(0,0,0,0.3);
    }

    :host-context(.dark) .range-heading {
      color: var(--ui-range-heading-color, #f9fafb);
    }

    :host-context(.dark) .nav-button {
      color: var(--ui-calendar-nav-color, #d1d5db);
    }

    :host-context(.dark) .nav-button:hover {
      background-color: var(--ui-calendar-hover-bg, #374151);
    }

    :host-context(.dark) .icon-button {
      color: var(--ui-range-icon-color, #9ca3af);
    }

    :host-context(.dark) .icon-button:hover {
      color: var(--ui-range-icon-hover, #d1d5db);
    }

    :host-context(.dark) .error-message {
      color: var(--ui-range-error-color, #f87171);
    }

    :host-context(.dark) .helper-text {
      color: var(--ui-range-helper-color, #9ca3af);
    }

    :host-context(.dark) .input-container[aria-invalid="true"] {
      border-color: var(--ui-range-error-border, #f87171);
    }

    :host-context(.dark) .popup-footer {
      border-color: var(--ui-range-popup-border, #374151);
      color: var(--ui-range-helper-color, #9ca3af);
    }

    :host-context(.dark) .clear-button {
      color: var(--ui-range-clear-color, #9ca3af);
    }

    :host-context(.dark) .clear-button:hover {
      background-color: var(--ui-range-clear-hover-bg, #374151);
      color: var(--ui-range-clear-hover-color, #d1d5db);
    }

    :host-context(.dark) label {
      color: var(--ui-range-label-color, #d1d5db);
    }
    ```

    All dark mode values use CSS custom properties with dark-appropriate fallbacks. The inline styles on renderDay elements already use CSS custom properties (--ui-range-selected-bg, --ui-range-highlight-bg, --ui-range-preview-bg) which will cascade through Shadow DOM regardless of light/dark mode.

    **NOTE:** The range highlight inline styles in renderRangeDay do NOT need dark-mode-specific changes because they use CSS custom properties that can be overridden at any level. Users set `--ui-range-selected-bg`, `--ui-range-highlight-bg`, etc. globally for their dark theme.
  </action>
  <verify>
    Grep for `:host-context(.dark)` in date-range-picker.ts — dark mode selectors exist.
    Grep for `--ui-range-` — CSS custom properties used for all colors.
    Run `cd packages/date-range-picker && pnpm build` — builds without errors.
  </verify>
  <done>Dark mode styles added for all UI elements (input, popup, buttons, error/helper text, labels) using :host-context(.dark) with CSS custom property fallbacks.</done>
</task>

<task type="auto">
  <name>Task 2: Package exports, custom element registration, and JSX types</name>
  <files>
    packages/date-range-picker/src/index.ts
    packages/date-range-picker/src/jsx.d.ts
  </files>
  <action>
    **Finalize index.ts** with complete exports and custom element registration. Follow the exact pattern from `@lit-ui/date-picker`:

    ```typescript
    // @lit-ui/date-range-picker - Accessible date range picker component with SSR support
    /// <reference path="./jsx.d.ts" />
    import { isServer } from 'lit';

    // Export component class
    export { DateRangePicker } from './date-range-picker.js';

    // Export range utilities
    export {
      isDateInRange,
      isDateInPreview,
      validateRangeDuration,
      formatISOInterval,
      normalizeRange,
    } from './range-utils.js';

    export type { RangeValidation } from './range-utils.js';

    // Re-export TailwindElement and isServer for convenience
    export { TailwindElement, isServer } from '@lit-ui/core';

    // Import calendar to ensure it's registered when date-range-picker is used
    import '@lit-ui/calendar';

    // Safe custom element registration with collision detection
    import { DateRangePicker } from './date-range-picker.js';

    if (typeof customElements !== 'undefined') {
      if (!customElements.get('lui-date-range-picker')) {
        customElements.define('lui-date-range-picker', DateRangePicker);
      } else if (!isServer && import.meta.env?.DEV) {
        console.warn(
          '[lui-date-range-picker] Custom element already registered. ' +
            'This may indicate duplicate imports or version conflicts.'
        );
      }
    }
    ```

    **IMPORTANT (Phase 44-05 decision):** Keep `HTMLElementTagNameMap` in `date-range-picker.ts` (not duplicated in index.ts) to avoid TypeScript duplicate identifier error. Add to date-range-picker.ts at the bottom:
    ```typescript
    declare global {
      interface HTMLElementTagNameMap {
        'lui-date-range-picker': DateRangePicker;
      }
    }
    ```

    **Create jsx.d.ts** following the exact pattern from date-picker's jsx.d.ts:

    ```typescript
    /**
     * JSX type declarations for lui-date-range-picker custom element.
     * Provides type support for React, Vue, and Svelte.
     */

    import type { DateRangePicker } from './date-range-picker.js';

    // Attributes for lui-date-range-picker (HTML attributes, reflected)
    interface LuiDateRangePickerAttributes {
      'start-date'?: string;
      'end-date'?: string;
      name?: string;
      locale?: string;
      placeholder?: string;
      'helper-text'?: string;
      'min-date'?: string;
      'max-date'?: string;
      'min-days'?: number;
      'max-days'?: number;
      label?: string;
      error?: string;
      required?: boolean;
      disabled?: boolean;
    }

    // Event handler types
    interface LuiDateRangePickerEvents {
      onChange?: (e: CustomEvent<{
        startDate: string | null;
        endDate: string | null;
        isoInterval: string;
      }>) => void;
    }

    // React JSX support
    declare global {
      namespace JSX {
        interface IntrinsicElements {
          'lui-date-range-picker': React.DetailedHTMLProps<
            React.HTMLAttributes<DateRangePicker> & LuiDateRangePickerAttributes & LuiDateRangePickerEvents,
            DateRangePicker
          >;
        }
      }
    }

    // Vue support
    declare module 'vue' {
      export interface GlobalComponents {
        'lui-date-range-picker': import('vue').DefineComponent<LuiDateRangePickerAttributes>;
      }
    }

    // Svelte support
    declare namespace svelteHTML {
      interface IntrinsicElements {
        'lui-date-range-picker': LuiDateRangePickerAttributes & {
          'on:change'?: (e: CustomEvent<{
            startDate: string | null;
            endDate: string | null;
            isoInterval: string;
          }>) => void;
        };
      }
    }

    export {};
    ```

    After writing both files, run `cd packages/date-range-picker && pnpm build` to verify everything builds.
  </action>
  <verify>
    Run `cd packages/date-range-picker && pnpm build` — builds without errors.
    Grep for `customElements.define.*lui-date-range-picker` in index.ts — registration exists.
    Grep for `HTMLElementTagNameMap` in date-range-picker.ts — type registration exists.
    Grep for `IntrinsicElements` in jsx.d.ts — JSX types exist.
    Run `ls packages/date-range-picker/dist/index.js` — dist exists.
    Run `ls packages/date-range-picker/dist/index.d.ts` — type declarations exist.
  </verify>
  <done>Package exports complete with custom element registration, HTMLElementTagNameMap, and JSX type declarations for React/Vue/Svelte. Package builds with both JS and type declaration outputs.</done>
</task>

</tasks>

<verification>
1. `cd packages/date-range-picker && pnpm build` — builds without errors
2. Dark mode renders all elements with appropriate dark colors
3. `lui-date-range-picker` custom element is registered via index.ts
4. HTMLElementTagNameMap includes `lui-date-range-picker`
5. JSX types cover all attributes and events for React, Vue, and Svelte
6. dist/ contains both .js and .d.ts files
</verification>

<success_criteria>
- Dark mode styles cover all component UI elements with :host-context(.dark)
- All CSS colors use --ui-range-* custom properties for themability
- Custom element registered with collision detection and DEV warning
- HTMLElementTagNameMap in date-range-picker.ts (not index.ts) per Phase 44-05 decision
- JSX types separate HTML attributes from JS-only properties
- Package builds clean with JS output and TypeScript declarations
</success_criteria>

<output>
After completion, create `.planning/phases/46-date-range-picker-core/46-05-SUMMARY.md`
</output>
