---
phase: 14-core-package
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - packages/core/src/tailwind-element.ts
  - packages/core/src/styles/tailwind.css
  - packages/core/src/styles/host-defaults.css
  - packages/core/src/styles/safelist.css
  - packages/core/src/index.ts
autonomous: true

must_haves:
  truths:
    - "TailwindElement renders with inline styles during SSR (isServer returns true)"
    - "TailwindElement uses shared constructable stylesheets on client (isServer returns false)"
    - "Multiple component instances share one stylesheet per type (memory optimization)"
  artifacts:
    - path: "packages/core/src/tailwind-element.ts"
      provides: "SSR-aware base class with dual-mode styling"
      min_lines: 80
    - path: "packages/core/src/styles/tailwind.css"
      provides: "Tailwind v4 config with design tokens"
      contains: "@import \"tailwindcss\""
    - path: "packages/core/src/styles/host-defaults.css"
      provides: "Shadow DOM @property workaround"
      contains: ":host"
  key_links:
    - from: "packages/core/src/tailwind-element.ts"
      to: "packages/core/src/styles/tailwind.css"
      via: "import with ?inline"
      pattern: "tailwind\\.css\\?inline"
    - from: "packages/core/src/index.ts"
      to: "packages/core/src/tailwind-element.ts"
      via: "export"
      pattern: "export.*TailwindElement"
---

<objective>
Create SSR-aware TailwindElement base class with dual-mode styling

Purpose: Enable @lit-ui/core to provide a base class that works during server-side rendering (using inline styles in Declarative Shadow DOM) and optimizes to shared constructable stylesheets after hydration.

Output: TailwindElement class, CSS files, and exports ready for consumer use
</objective>

<execution_context>
@/Users/sn0w/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sn0w/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/14-core-package/14-RESEARCH.md
@src.old/base/tailwind-element.ts
@src.old/styles/tailwind.css
@src.old/styles/host-defaults.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create SSR-Aware TailwindElement Base Class</name>
  <files>packages/core/src/tailwind-element.ts</files>
  <action>
Create the TailwindElement base class adapted from src.old/base/tailwind-element.ts with SSR awareness:

1. Import `isServer` from `lit` for server detection
2. Import CSS files with `?inline` suffix for build-time processing
3. Create shared stylesheet variables at module level, but guard initialization with `!isServer`
4. Implement static `styles` getter that:
   - Returns inline CSS via `css` tagged template during SSR (isServer === true)
   - Returns empty array on client (styles applied via adoptedStyleSheets)
5. In `connectedCallback`, guard `_adoptTailwindStyles()` with `if (isServer) return;`
6. Keep @property extraction logic but guard with `typeof document !== 'undefined'`
7. Add JSDoc documentation explaining SSR behavior

Key pattern from research:
```typescript
import { LitElement, css, isServer, type CSSResultGroup } from 'lit';

// Guard constructable stylesheet creation
let sharedTailwindSheet: CSSStyleSheet | null = null;
if (!isServer && typeof CSSStyleSheet !== 'undefined') {
  sharedTailwindSheet = new CSSStyleSheet();
  sharedTailwindSheet.replaceSync(tailwindStyles);
}

static get styles(): CSSResultGroup {
  if (isServer) {
    return css`${tailwindStyles}\n${hostDefaults}`;
  }
  return [];
}
```
  </action>
  <verify>Check file exists with `ls packages/core/src/tailwind-element.ts` and verify it imports `isServer` from lit</verify>
  <done>TailwindElement class exists with isServer guards for dual-mode styling</done>
</task>

<task type="auto">
  <name>Task 2: Copy and Adapt CSS Files</name>
  <files>
    packages/core/src/styles/tailwind.css
    packages/core/src/styles/host-defaults.css
    packages/core/src/styles/safelist.css
  </files>
  <action>
Copy CSS files from src.old/styles/ to packages/core/src/styles/:

1. Create packages/core/src/styles/ directory
2. Copy tailwind.css - this contains:
   - @import "tailwindcss"
   - @theme block with primitive and semantic tokens
   - :host-context(.dark) overrides
   - :root component custom properties
3. Copy host-defaults.css - Shadow DOM @property workaround with :host declarations
4. Copy safelist.css - Explicit utility classes for btn-class/dialog-class passthrough

Update tailwind.css @import path: change `@import "./safelist.css"` to remain valid in new location.

No content changes needed - the CSS is already correct, just needs to be in the new package structure.
  </action>
  <verify>Run `ls packages/core/src/styles/` and verify all three CSS files exist</verify>
  <done>CSS files exist in packages/core/src/styles/ with correct content</done>
</task>

<task type="auto">
  <name>Task 3: Update Index Exports</name>
  <files>packages/core/src/index.ts</files>
  <action>
Update packages/core/src/index.ts to export TailwindElement and re-export isServer:

```typescript
// @lit-ui/core - SSR-aware base class for Tailwind-styled web components

export { TailwindElement } from './tailwind-element.js';

// Re-export isServer for component authors to use directly
export { isServer } from 'lit';

export const VERSION = '0.0.1';
```

The isServer re-export allows component authors to import from a single package instead of also importing from lit.
  </action>
  <verify>Run `pnpm --filter @lit-ui/core build` and check dist/index.d.ts contains TailwindElement and isServer exports</verify>
  <done>index.ts exports TailwindElement, isServer, and VERSION</done>
</task>

</tasks>

<verification>
Run from repository root:
1. `pnpm --filter @lit-ui/core build` - Build should succeed
2. `ls packages/core/dist/` - Should contain index.js and index.d.ts
3. `grep -l "isServer" packages/core/dist/index.js` - Should find isServer usage
4. `grep -l "TailwindElement" packages/core/dist/index.d.ts` - Should find TailwindElement export
</verification>

<success_criteria>
1. Build completes without errors
2. TailwindElement is exported from @lit-ui/core
3. isServer is re-exported from @lit-ui/core
4. CSS files are properly imported in the build
</success_criteria>

<output>
After completion, create `.planning/phases/14-core-package/14-01-SUMMARY.md`
</output>
