---
phase: 14-core-package
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - packages/core/src/tokens/index.ts
  - packages/core/src/utils/events.ts
  - packages/core/src/utils/environment.ts
  - packages/core/src/index.ts
  - packages/core/package.json
autonomous: true

must_haves:
  truths:
    - "Consumer imports `import { tokens } from '@lit-ui/core/tokens'` successfully"
    - "dispatchCustomEvent helper dispatches events with composed: true for Shadow DOM"
    - "Tree shaking removes unused exports (sideEffects: false maintained)"
  artifacts:
    - path: "packages/core/src/tokens/index.ts"
      provides: "Design tokens as CSS custom property references"
      min_lines: 50
    - path: "packages/core/src/utils/events.ts"
      provides: "Type-safe custom event dispatch helper"
      exports: ["dispatchCustomEvent"]
    - path: "packages/core/package.json"
      provides: "Exports field with /tokens subpath"
      contains: "\"./tokens\""
  key_links:
    - from: "packages/core/package.json"
      to: "packages/core/dist/tokens/index.js"
      via: "exports field"
      pattern: "\\./tokens.*tokens/index"
---

<objective>
Create design tokens module and utility helpers for @lit-ui/core

Purpose: Provide programmatic access to design tokens via CSS custom properties and helper utilities (dispatchCustomEvent) that component authors need. Enable subpath imports via package.json exports.

Output: tokens/index.ts, utils/events.ts, updated package.json with proper exports
</objective>

<execution_context>
@/Users/sn0w/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sn0w/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/14-core-package/14-RESEARCH.md
@.planning/phases/14-core-package/14-CONTEXT.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Design Tokens Module</name>
  <files>packages/core/src/tokens/index.ts</files>
  <action>
Create packages/core/src/tokens/index.ts with design token references using --lui- namespace:

```typescript
/**
 * Design Tokens for @lit-ui/core
 *
 * These tokens reference CSS custom properties defined in tailwind.css.
 * Use these for programmatic access to design system values.
 *
 * @example
 * ```typescript
 * import { tokens } from '@lit-ui/core/tokens';
 *
 * // Use in styles
 * css`color: ${tokens.color.primary};`
 * ```
 */

export const tokens = {
  color: {
    // Semantic colors (respond to light/dark theme)
    primary: 'var(--color-primary)',
    primaryForeground: 'var(--color-primary-foreground)',
    secondary: 'var(--color-secondary)',
    secondaryForeground: 'var(--color-secondary-foreground)',
    destructive: 'var(--color-destructive)',
    destructiveForeground: 'var(--color-destructive-foreground)',
    muted: 'var(--color-muted)',
    mutedForeground: 'var(--color-muted-foreground)',
    accent: 'var(--color-accent)',
    accentForeground: 'var(--color-accent-foreground)',
    background: 'var(--color-background)',
    foreground: 'var(--color-foreground)',
    border: 'var(--color-border)',
    input: 'var(--color-input)',
    ring: 'var(--color-ring)',
    card: 'var(--color-card)',
    cardForeground: 'var(--color-card-foreground)',
  },
  spacing: {
    0: 'var(--spacing-0)',
    px: 'var(--spacing-px)',
    0.5: 'var(--spacing-0\\.5)',
    1: 'var(--spacing-1)',
    2: 'var(--spacing-2)',
    3: 'var(--spacing-3)',
    4: 'var(--spacing-4)',
    5: 'var(--spacing-5)',
    6: 'var(--spacing-6)',
    8: 'var(--spacing-8)',
    10: 'var(--spacing-10)',
    12: 'var(--spacing-12)',
    16: 'var(--spacing-16)',
    20: 'var(--spacing-20)',
    24: 'var(--spacing-24)',
  },
  radius: {
    none: 'var(--radius-none)',
    sm: 'var(--radius-sm)',
    md: 'var(--radius-md)',
    lg: 'var(--radius-lg)',
    xl: 'var(--radius-xl)',
    '2xl': 'var(--radius-2xl)',
    '3xl': 'var(--radius-3xl)',
    full: 'var(--radius-full)',
  },
  shadow: {
    xs: 'var(--shadow-xs)',
    sm: 'var(--shadow-sm)',
    md: 'var(--shadow-md)',
    lg: 'var(--shadow-lg)',
    xl: 'var(--shadow-xl)',
    '2xl': 'var(--shadow-2xl)',
  },
  fontFamily: {
    sans: 'var(--font-family-sans)',
    mono: 'var(--font-family-mono)',
  },
  zIndex: {
    0: 'var(--z-0)',
    10: 'var(--z-10)',
    20: 'var(--z-20)',
    30: 'var(--z-30)',
    40: 'var(--z-40)',
    50: 'var(--z-50)',
  },
} as const;

// Type helpers for token paths
export type ColorToken = keyof typeof tokens.color;
export type SpacingToken = keyof typeof tokens.spacing;
export type RadiusToken = keyof typeof tokens.radius;
export type ShadowToken = keyof typeof tokens.shadow;
```

Note: Use Tailwind's token names (--color-primary, --spacing-4) not a custom --lui- namespace, since the tokens are already defined in @theme and Tailwind makes them available automatically.
  </action>
  <verify>Run `ls packages/core/src/tokens/index.ts` and verify file exists</verify>
  <done>tokens/index.ts exists with color, spacing, radius, shadow, fontFamily, zIndex tokens</done>
</task>

<task type="auto">
  <name>Task 2: Create Utility Helpers</name>
  <files>
    packages/core/src/utils/events.ts
    packages/core/src/utils/environment.ts
    packages/core/src/utils/index.ts
  </files>
  <action>
Create utility modules in packages/core/src/utils/:

**events.ts** - Type-safe custom event dispatch:
```typescript
/**
 * Custom Event Utilities
 *
 * Helpers for dispatching typed custom events from Lit components.
 */

export interface CustomEventOptions {
  bubbles?: boolean;
  composed?: boolean;
  cancelable?: boolean;
}

const defaultOptions: CustomEventOptions = {
  bubbles: true,
  composed: true,  // Cross shadow DOM boundary
  cancelable: false,
};

/**
 * Dispatch a typed custom event from a component.
 *
 * @param element - The element dispatching the event
 * @param eventName - Event type name
 * @param detail - Event detail payload
 * @param options - Event options (defaults: bubbles: true, composed: true)
 * @returns Whether the event was cancelled
 *
 * @example
 * ```typescript
 * dispatchCustomEvent(this, 'ui-change', { value: 'new value' });
 * ```
 */
export function dispatchCustomEvent<T>(
  element: HTMLElement,
  eventName: string,
  detail?: T,
  options: CustomEventOptions = {}
): boolean {
  const event = new CustomEvent<T>(eventName, {
    detail,
    ...defaultOptions,
    ...options,
  });
  return element.dispatchEvent(event);
}
```

**environment.ts** - Environment detection utilities:
```typescript
/**
 * Environment Detection Utilities
 *
 * Re-exports and helpers for SSR-safe environment detection.
 */

// Re-export isServer from lit for convenience
export { isServer } from 'lit';

/**
 * Check if constructable stylesheets are supported.
 * Always false on server, feature-detected on client.
 */
export const hasConstructableStylesheets =
  typeof globalThis !== 'undefined' &&
  typeof globalThis.CSSStyleSheet?.prototype?.replaceSync === 'function';
```

**index.ts** - Barrel export:
```typescript
export * from './events.js';
export * from './environment.js';
```
  </action>
  <verify>Run `ls packages/core/src/utils/` and verify events.ts and environment.ts exist</verify>
  <done>Utils directory contains events.ts, environment.ts, and index.ts</done>
</task>

<task type="auto">
  <name>Task 3: Update Package Exports and Main Index</name>
  <files>
    packages/core/package.json
    packages/core/src/index.ts
    packages/core/vite.config.ts
  </files>
  <action>
Update package.json exports to include /tokens and /utils subpaths:

```json
{
  "name": "@lit-ui/core",
  "version": "0.0.1",
  "type": "module",
  "main": "dist/index.js",
  "module": "dist/index.js",
  "types": "dist/index.d.ts",
  "exports": {
    ".": {
      "types": "./dist/index.d.ts",
      "import": "./dist/index.js"
    },
    "./tokens": {
      "types": "./dist/tokens/index.d.ts",
      "import": "./dist/tokens/index.js"
    },
    "./utils": {
      "types": "./dist/utils/index.d.ts",
      "import": "./dist/utils/index.js"
    }
  },
  "files": ["dist"],
  "sideEffects": false,
  ...rest unchanged
}
```

Update vite.config.ts to build multiple entry points. The current `createLibraryConfig` from @lit-ui/vite-config only supports single entry, so use inline defineConfig for multi-entry:

```typescript
import { defineConfig } from 'vite';
import tailwindcss from '@tailwindcss/vite';
import dts from 'vite-plugin-dts';

export default defineConfig({
  plugins: [
    tailwindcss(),
    dts({
      entryRoot: 'src'
    })
  ],
  build: {
    lib: {
      entry: {
        index: 'src/index.ts',
        'tokens/index': 'src/tokens/index.ts',
        'utils/index': 'src/utils/index.ts'
      },
      formats: ['es']
    },
    rollupOptions: {
      external: ['lit', /^lit\//, /^@lit\//, /^@lit-ui\//],
      output: {
        preserveModules: false,
        entryFileNames: '[name].js'
      }
    }
  }
});
```

This inline config supports object-style entry points and produces separate output files for each entry.

Update src/index.ts to also export utils (but NOT tokens - those are a separate subpath):
```typescript
// @lit-ui/core - SSR-aware base class for Tailwind-styled web components

export { TailwindElement } from './tailwind-element.js';
export { isServer } from 'lit';
export { dispatchCustomEvent, hasConstructableStylesheets } from './utils/index.js';

export const VERSION = '0.0.1';
```
  </action>
  <verify>Run `pnpm --filter @lit-ui/core build && ls packages/core/dist/tokens/index.js packages/core/dist/utils/index.js` to verify both subpath outputs exist</verify>
  <done>Package exports /tokens and /utils subpaths, build produces all entry point outputs</done>
</task>

</tasks>

<verification>
Run from repository root:
1. `pnpm --filter @lit-ui/core build` - Build should succeed
2. `ls packages/core/dist/tokens/` - Should contain index.js and index.d.ts
3. `ls packages/core/dist/utils/` - Should contain index.js and index.d.ts
4. `grep "tokens" packages/core/package.json` - Should show ./tokens export
</verification>

<success_criteria>
1. Build completes without errors
2. tokens/index.js and utils/index.js are in dist/
3. Package.json exports field includes /tokens and /utils subpaths
4. Type definitions generated for all exports
</success_criteria>

<output>
After completion, create `.planning/phases/14-core-package/14-02-SUMMARY.md`
</output>
