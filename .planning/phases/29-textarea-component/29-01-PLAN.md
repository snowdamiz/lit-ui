---
phase: 29-textarea-component
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - packages/textarea/package.json
  - packages/textarea/tsconfig.json
  - packages/textarea/vite.config.ts
  - packages/textarea/src/vite-env.d.ts
  - packages/textarea/src/index.ts
  - packages/textarea/src/textarea.ts
  - packages/textarea/src/jsx.d.ts
autonomous: true

must_haves:
  truths:
    - "User can type multiple lines of text that wrap naturally"
    - "User can resize textarea vertically by default"
    - "Form submission includes textarea value in FormData"
    - "Empty required textarea prevents form submission with validation error"
    - "Invalid textarea shows error styling and message after blur"
  artifacts:
    - path: "packages/textarea/package.json"
      provides: "Package configuration with peer dependencies"
      contains: "@lit-ui/textarea"
    - path: "packages/textarea/src/textarea.ts"
      provides: "Textarea component implementation"
      min_lines: 200
      exports: ["Textarea", "TextareaSize", "TextareaResize"]
    - path: "packages/textarea/src/index.ts"
      provides: "Package entry point with registration"
      contains: "lui-textarea"
  key_links:
    - from: "packages/textarea/src/textarea.ts"
      to: "@lit-ui/core"
      via: "TailwindElement import"
      pattern: "import.*TailwindElement.*from.*@lit-ui/core"
    - from: "packages/textarea/src/textarea.ts"
      to: "ElementInternals"
      via: "form participation"
      pattern: "attachInternals|setFormValue|setValidity"
---

<objective>
Create the @lit-ui/textarea package with a fully functional multi-line text input component.

Purpose: Provide developers with a form-integrated textarea that matches Input component patterns for consistency.
Output: Working textarea package with form participation, validation, label/helper/error display, and resize control.
</objective>

<execution_context>
@/Users/sn0w/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sn0w/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/29-textarea-component/29-CONTEXT.md
@.planning/phases/29-textarea-component/29-RESEARCH.md
@packages/input/src/input.ts
@packages/input/package.json
@packages/input/src/index.ts
@packages/input/src/jsx.d.ts
@packages/core/src/tokens/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create textarea package infrastructure</name>
  <files>
    packages/textarea/package.json
    packages/textarea/tsconfig.json
    packages/textarea/vite.config.ts
    packages/textarea/src/vite-env.d.ts
  </files>
  <action>
Create the @lit-ui/textarea package directory and configuration files.

**package.json** - Copy from @lit-ui/input and update:
- name: "@lit-ui/textarea"
- description: "Accessible textarea component built with Lit and Tailwind CSS"
- repository.directory: "packages/textarea"
- Keep identical devDependencies and peerDependencies

**tsconfig.json** - Identical to input package:
- extends: "@lit-ui/typescript-config/library.json"
- outDir: "./dist", rootDir: "./src", baseUrl: "."

**vite.config.ts** - Identical to input package:
- Use createLibraryConfig from @lit-ui/vite-config/library
- entry: 'src/index.ts'

**src/vite-env.d.ts** - Standard Vite type reference:
- `/// <reference types="vite/client" />`
  </action>
  <verify>
```bash
ls packages/textarea/package.json packages/textarea/tsconfig.json packages/textarea/vite.config.ts packages/textarea/src/vite-env.d.ts
```
All four files exist.
  </verify>
  <done>Package infrastructure files exist with correct configuration.</done>
</task>

<task type="auto">
  <name>Task 2: Implement core textarea component</name>
  <files>packages/textarea/src/textarea.ts</files>
  <action>
Create the Textarea class extending TailwindElement with full form participation and validation.

**Types:**
```typescript
export type TextareaSize = 'sm' | 'md' | 'lg';
export type TextareaResize = 'none' | 'vertical' | 'horizontal' | 'both';
```

**Properties** (mirror Input component where applicable):
- `size: TextareaSize = 'md'` - Size variant
- `name: string = ''` - Form field name
- `value: string = ''` - Current value
- `placeholder: string = ''` - Placeholder text
- `label: string = ''` - Label text
- `helperText: string = ''` - Helper text (attribute: 'helper-text')
- `requiredIndicator: 'asterisk' | 'text' = 'asterisk'` - Required indicator style
- `rows: number = 3` - Initial height in rows
- `resize: TextareaResize = 'vertical'` - Resize behavior (default vertical per CONTEXT.md)
- `minlength?: number` - Minimum length validation
- `maxlength?: number` - Maximum length validation
- `required: boolean = false` - Required validation (reflect: true)
- `disabled: boolean = false` - Disabled state (reflect: true)
- `readonly: boolean = false` - Readonly state (reflect: true)

**State:**
- `touched: boolean = false` - Has blur occurred
- `showError: boolean = false` - Should show error state

**Form Association:**
- `static formAssociated = true`
- `internals: ElementInternals | null` - Guard with isServer
- `formResetCallback()` - Reset value, touched, showError, call setFormValue(''), setValidity({})
- `formDisabledCallback(disabled: boolean)` - Set disabled property

**Validation** (copy pattern from Input):
- `validate()` - Mirror textarea.validity to ElementInternals
- `handleBlur()` - Set touched=true, validate, set showError
- `handleInput(e)` - Update value, call setFormValue, re-validate if touched

**Styles** (use --ui-textarea-* tokens from Phase 26):
```css
:host { display: inline-block; }
:host([disabled]) { pointer-events: none; }

.textarea-wrapper {
  display: flex;
  flex-direction: column;
  gap: 0.25rem;
}

textarea {
  border-radius: var(--ui-textarea-radius);
  border-width: var(--ui-textarea-border-width);
  border-style: solid;
  border-color: var(--ui-textarea-border);
  background-color: var(--ui-textarea-bg);
  color: var(--ui-textarea-text);
  font-family: inherit;
  transition: border-color var(--ui-textarea-transition),
              box-shadow var(--ui-textarea-transition);
}

textarea::placeholder { color: var(--ui-textarea-placeholder); }
textarea:focus-visible {
  outline: none;
  border-color: var(--ui-textarea-border-focus);
}

/* Size variants - match Input sizing */
textarea.textarea-sm {
  padding: var(--ui-textarea-padding-y-sm) var(--ui-textarea-padding-x-sm);
  font-size: var(--ui-textarea-font-size-sm);
}
textarea.textarea-md {
  padding: var(--ui-textarea-padding-y-md) var(--ui-textarea-padding-x-md);
  font-size: var(--ui-textarea-font-size-md);
}
textarea.textarea-lg {
  padding: var(--ui-textarea-padding-y-lg) var(--ui-textarea-padding-x-lg);
  font-size: var(--ui-textarea-font-size-lg);
}

/* Error state */
textarea.textarea-error { border-color: var(--ui-textarea-border-error); }

/* Disabled state */
textarea:disabled {
  background-color: var(--ui-textarea-bg-disabled);
  color: var(--ui-textarea-text-disabled);
  border-color: var(--ui-textarea-border-disabled);
  cursor: not-allowed;
}

/* Readonly state */
textarea:read-only:not(:disabled) {
  background-color: var(--ui-textarea-bg-disabled);
  cursor: text;
}

/* Resize variants */
textarea.resize-none { resize: none; }
textarea.resize-vertical { resize: vertical; }
textarea.resize-horizontal { resize: horizontal; }
textarea.resize-both { resize: both; }

/* Label/helper/error - match Input exactly */
.textarea-label { font-weight: 500; color: var(--ui-textarea-text); }
.required-indicator { color: var(--ui-textarea-text-error); margin-left: 0.125rem; }
.helper-text { font-size: 0.875em; color: var(--color-muted-foreground); }
.error-text { font-size: 0.875em; color: var(--ui-textarea-text-error); }
```

**Render Template:**
```typescript
render() {
  return html`
    <div class="textarea-wrapper" part="wrapper">
      ${this.label ? html`
        <label for=${this.textareaId} part="label" class="textarea-label label-${this.size}">
          ${this.label}
          ${this.required ? html`<span class="required-indicator">${this.requiredIndicator === 'text' ? ' (required)' : '*'}</span>` : nothing}
        </label>
      ` : nothing}

      ${this.helperText ? html`
        <span id="${this.textareaId}-helper" part="helper" class="helper-text">${this.helperText}</span>
      ` : nothing}

      <textarea
        id=${this.textareaId}
        part="textarea"
        class=${this.getTextareaClasses()}
        name=${this.name}
        .value=${this.value}
        rows=${this.rows}
        placeholder=${this.placeholder || nothing}
        ?required=${this.required}
        ?disabled=${this.disabled}
        ?readonly=${this.readonly}
        minlength=${this.minlength ?? nothing}
        maxlength=${this.maxlength ?? nothing}
        aria-invalid=${this.showError ? 'true' : nothing}
        aria-describedby=${this.getAriaDescribedBy()}
        @input=${this.handleInput}
        @blur=${this.handleBlur}
      ></textarea>

      ${this.showError && this.errorMessage ? html`
        <span id="${this.textareaId}-error" part="error" class="error-text" role="alert">${this.errorMessage}</span>
      ` : nothing}
    </div>
  `;
}
```

Include JSDoc comments for the class and all public properties.
  </action>
  <verify>
```bash
grep -E "class Textarea|formAssociated|attachInternals|setFormValue|setValidity" packages/textarea/src/textarea.ts
```
Shows class definition, form association, and ElementInternals methods.
  </verify>
  <done>Textarea component implements form participation, validation, resize control, and visual states.</done>
</task>

<task type="auto">
  <name>Task 3: Create package entry point and JSX types</name>
  <files>
    packages/textarea/src/index.ts
    packages/textarea/src/jsx.d.ts
  </files>
  <action>
**src/index.ts** - Follow Input package pattern:
```typescript
// @lit-ui/textarea - Textarea component with SSR support
/// <reference path="./jsx.d.ts" />
import { isServer } from 'lit';

// Export component class and types
export { Textarea } from './textarea.js';
export type { TextareaSize, TextareaResize } from './textarea.js';

// Re-export TailwindElement and isServer for convenience
export { TailwindElement, isServer } from '@lit-ui/core';

// Safe custom element registration with collision detection
import { Textarea } from './textarea.js';

if (typeof customElements !== 'undefined') {
  if (!customElements.get('lui-textarea')) {
    customElements.define('lui-textarea', Textarea);
  } else if (!isServer && import.meta.env?.DEV) {
    console.warn(
      '[lui-textarea] Custom element already registered. ' +
        'This may indicate duplicate imports or version conflicts.'
    );
  }
}

// TypeScript global type registration
declare global {
  interface HTMLElementTagNameMap {
    'lui-textarea': Textarea;
  }
}
```

**src/jsx.d.ts** - JSX type declarations for React/Vue/Svelte:
```typescript
/**
 * JSX type declarations for lui-textarea custom element.
 * Provides type support for React, Vue, and Svelte.
 */

import type { Textarea, TextareaSize, TextareaResize } from './textarea.js';

// Common attributes for lui-textarea
interface LuiTextareaAttributes {
  size?: TextareaSize;
  resize?: TextareaResize;
  name?: string;
  value?: string;
  placeholder?: string;
  label?: string;
  'helper-text'?: string;
  'required-indicator'?: 'asterisk' | 'text';
  rows?: number;
  minlength?: number;
  maxlength?: number;
  required?: boolean;
  disabled?: boolean;
  readonly?: boolean;
}

// React JSX support
declare global {
  namespace JSX {
    interface IntrinsicElements {
      'lui-textarea': React.DetailedHTMLProps<
        React.TextareaHTMLAttributes<Textarea> & LuiTextareaAttributes,
        Textarea
      >;
    }
  }
}

// Vue support
declare module 'vue' {
  export interface GlobalComponents {
    'lui-textarea': import('vue').DefineComponent<LuiTextareaAttributes>;
  }
}

// Svelte support
declare namespace svelteHTML {
  interface IntrinsicElements {
    'lui-textarea': LuiTextareaAttributes & {
      oninput?: (e: InputEvent) => void;
      'on:input'?: (e: CustomEvent<InputEvent>) => void;
    };
  }
}

export {};
```
  </action>
  <verify>
```bash
grep -E "lui-textarea|Textarea|TextareaSize" packages/textarea/src/index.ts packages/textarea/src/jsx.d.ts
```
Shows registration, exports, and JSX type declarations.
  </verify>
  <done>Package entry point registers custom element and exports types; JSX declarations support React/Vue/Svelte.</done>
</task>

</tasks>

<verification>
After all tasks complete:

```bash
# Build the package
cd /Users/sn0w/Documents/dev/lit-components && pnpm install && pnpm --filter @lit-ui/textarea build

# Verify build output
ls packages/textarea/dist/index.js packages/textarea/dist/index.d.ts

# TypeScript compilation check
pnpm --filter @lit-ui/textarea exec tsc --noEmit
```

Build succeeds and produces dist/index.js and dist/index.d.ts.
</verification>

<success_criteria>
1. packages/textarea directory exists with package.json, tsconfig.json, vite.config.ts
2. packages/textarea/src/textarea.ts implements Textarea class with form association
3. pnpm --filter @lit-ui/textarea build succeeds without errors
4. dist/index.js and dist/index.d.ts are generated
5. Component registers as lui-textarea custom element
</success_criteria>

<output>
After completion, create `.planning/phases/29-textarea-component/29-01-SUMMARY.md`
</output>
