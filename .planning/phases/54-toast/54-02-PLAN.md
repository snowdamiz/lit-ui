---
phase: 54-toast
plan: 02
type: execute
wave: 2
depends_on: ["54-01"]
files_modified:
  - packages/cli/src/registry/registry.json
  - packages/cli/src/templates/index.ts
autonomous: true

must_haves:
  truths:
    - "Running npx lit-ui add toast in copy-source mode produces a working standalone toast component"
    - "Running npm install @lit-ui/toast in npm mode installs the package correctly"
    - "The full workspace builds successfully with the toast package integrated"
  artifacts:
    - path: "packages/cli/src/registry/registry.json"
      provides: "CLI registry entry for toast component"
      contains: "toast"
    - path: "packages/cli/src/templates/index.ts"
      provides: "Copy-source templates for toast component"
      contains: "TOAST_TEMPLATE"
  key_links:
    - from: "packages/cli/src/registry/registry.json"
      to: "packages/cli/src/templates/index.ts"
      via: "Registry files array maps to template keys in COMPONENT_TEMPLATES"
      pattern: "toast"
    - from: "packages/cli/src/templates/index.ts"
      to: "LitElement"
      via: "Copy-source templates use LitElement directly (no @lit-ui/core dependency)"
      pattern: "LitElement"
---

<objective>
Add CLI registry entry and copy-source templates for the toast component, enabling installation via both `npx lit-ui add toast` (copy-source) and `npm install @lit-ui/toast` (npm mode).

Purpose: Complete TOAST-20 by making the toast component available through the CLI distribution system, matching the established pattern from tooltip (52-02) and popover (53-02).

Output: Updated registry.json with toast entry and templates/index.ts with toast templates, verified by full workspace build.
</objective>

<execution_context>
@/Users/sn0w/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sn0w/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior plan summary -- toast component implementation details
@.planning/phases/54-toast/54-01-SUMMARY.md

# Reference -- tooltip and popover CLI integration (exact patterns to follow)
@.planning/phases/52-tooltip/52-02-SUMMARY.md
@.planning/phases/53-popover/53-02-SUMMARY.md

# Files to modify
@packages/cli/src/registry/registry.json
@packages/cli/src/templates/index.ts

# Source component files to template-ify
@packages/toast/src/types.ts
@packages/toast/src/icons.ts
@packages/toast/src/state.ts
@packages/toast/src/api.ts
@packages/toast/src/toast.ts
@packages/toast/src/toaster.ts
@packages/toast/src/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add CLI registry entry and copy-source templates for toast</name>
  <files>
    packages/cli/src/registry/registry.json
    packages/cli/src/templates/index.ts
  </files>
  <action>
    Follow the exact pattern established by tooltip (52-02) and popover (53-02):

    **1. Registry entry (registry.json):**
    Add a `toast` entry to the components object with:
    - `name`: "toast"
    - `description`: "Toast notification system with imperative API, queue management, and swipe-to-dismiss"
    - `dependencies`: `["lit"]` (toast has NO @floating-ui/dom dependency -- it does not use Floating UI positioning)
    - `peerDependencies`: `["lit"]`
    - `files`: `["types.ts", "icons.ts", "state.ts", "api.ts", "toast.ts", "toaster.ts"]` (6 files -- all source modules that form the toast system, excluding index.ts since copy-source mode registers differently)
    - `registryDependencies`: `[]` (toast is standalone, uses CSS custom properties for theming which are inherited from the page)

    **2. Copy-source templates (templates/index.ts):**

    Toast has 6 source files, so create 6 template constants. The key difference from tooltip/popover is that toast does NOT use Floating UI, so there is no shadowDomPlatform to inline.

    **TOAST_TYPES_TEMPLATE:** Direct copy of types.ts -- it has no imports to rewrite.

    **TOAST_ICONS_TEMPLATE:** Rewrite imports:
    - Replace `import { html, nothing } from 'lit'` (if importing from @lit-ui/core) with `import { html, nothing } from 'lit'` (likely already correct since icons just use lit directly)
    - Keep all SVG templates unchanged

    **TOAST_STATE_TEMPLATE:** Direct copy of state.ts -- it only imports from local types.ts. Adjust the import path to `./types.js` (relative import for copy-source mode).

    **TOAST_API_TEMPLATE:** Rewrite imports:
    - Replace `import { toastState } from './state.js'` -> keep as-is (relative import works in copy-source)
    - Replace any `@lit-ui/core` imports with direct `lit` imports
    - Keep the SSR guard and auto-create logic unchanged

    **TOAST_ELEMENT_TEMPLATE:** Rewrite imports:
    - Replace `import { TailwindElement, tailwindBaseStyles } from '@lit-ui/core'` with `import { LitElement, html, css, nothing } from 'lit'` and use LitElement directly
    - Replace `tailwindBaseStyles` with an empty array or inline base styles
    - Keep all behavioral logic (swipe, timers, accessibility) unchanged
    - Include `@customElement('lui-toast')` decorator

    **TOAST_TOASTER_TEMPLATE:** Rewrite imports:
    - Replace `import { TailwindElement, tailwindBaseStyles } from '@lit-ui/core'` with `import { LitElement, html, css } from 'lit'`
    - Replace `import { isServer } from '@lit-ui/core'` with `import { isServer } from 'lit'` (Lit exports isServer from 'lit' in v3.3+, or use `const isServer = typeof document === 'undefined'` as inline guard)
    - Replace `tailwindBaseStyles` with empty array
    - Keep state subscription, queue management, positioning, popover=manual, and animation logic unchanged
    - Include `@customElement('lui-toaster')` decorator

    Add all 6 templates to the `COMPONENT_TEMPLATES` map:
    - `"types.ts"` -> `TOAST_TYPES_TEMPLATE`
    - `"icons.ts"` -> `TOAST_ICONS_TEMPLATE`
    - `"state.ts"` -> `TOAST_STATE_TEMPLATE`
    - `"api.ts"` -> `TOAST_API_TEMPLATE`
    - `"toast.ts"` -> `TOAST_ELEMENT_TEMPLATE`
    - `"toaster.ts"` -> `TOAST_TOASTER_TEMPLATE`

    **Escaping rules (critical -- match existing template patterns):**
    - Backticks inside the template string: escape with `\``
    - Template literal interpolations `${...}`: escape as `\${...}`
    - Regular single/double quotes: no escaping needed
    - Look at how TOOLTIP_TEMPLATE and POPOVER_TEMPLATE handle escapes and match exactly

    **IMPORTANT:** Since toast templates share names with potential other components' files (types.ts, icons.ts etc.), prefix the COMPONENT_TEMPLATES keys with the component name from the registry entry's files array context. Check how existing templates handle file key uniqueness -- if the key is just the filename and the CLI resolves based on the registry component, then simple filenames are fine. Follow the existing pattern exactly.
  </action>
  <verify>
    Run `cd packages/cli && pnpm build` -- builds without errors.
    Grep registry.json for `"toast"` -- entry exists.
    Grep templates/index.ts for `TOAST_TYPES_TEMPLATE`, `TOAST_STATE_TEMPLATE`, `TOAST_API_TEMPLATE`, `TOAST_ELEMENT_TEMPLATE`, `TOAST_TOASTER_TEMPLATE` -- all templates exist.
    Grep COMPONENT_TEMPLATES for toast file keys -- all 6 mappings exist.
  </verify>
  <done>CLI registry has toast entry with correct dependencies, and all 6 copy-source templates are standalone components using LitElement directly with no @lit-ui/core dependency.</done>
</task>

<task type="auto">
  <name>Task 2: Verify full workspace build and integration</name>
  <files></files>
  <action>
    Run the full workspace build to verify the toast package integrates correctly:

    1. Run `pnpm build` from the workspace root
    2. Verify all packages build successfully (expect pre-existing docs app TS errors for date-picker/date-range-picker/time-picker module declarations -- these are known tech debt, not new issues)
    3. Verify `packages/toast/dist/index.js` exists and contains the toast system
    4. Verify `packages/cli/dist/` contains the updated registry and templates

    If build fails with new errors (not the pre-existing docs app ones), fix them before proceeding.
  </action>
  <verify>
    Run `pnpm build` from workspace root -- all packages build (except known docs app TS errors).
    Run `ls packages/toast/dist/index.js` -- toast dist exists.
    The workspace is in a clean, buildable state with toast fully integrated.
  </verify>
  <done>Full workspace builds successfully with @lit-ui/toast integrated. The component is available via both npm install and CLI copy-source modes. TOAST-20 complete.</done>
</task>

</tasks>

<verification>
1. `pnpm build` succeeds for all packages (except known docs app pre-existing errors)
2. `packages/toast/dist/index.js` and `dist/index.d.ts` exist
3. `packages/cli/src/registry/registry.json` contains toast entry
4. `packages/cli/src/templates/index.ts` contains all 6 toast templates
5. COMPONENT_TEMPLATES map has all toast file keys
</verification>

<success_criteria>
TOAST-20 is complete: The toast component ships as @lit-ui/toast with a CLI registry entry and copy-source templates. The full workspace builds successfully.
</success_criteria>

<output>
After completion, create `.planning/phases/54-toast/54-02-SUMMARY.md`
</output>
