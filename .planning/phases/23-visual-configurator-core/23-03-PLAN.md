---
phase: 23-visual-configurator-core
plan: 03
type: execute
wave: 3
depends_on: ["23-02"]
files_modified:
  - apps/docs/src/components/configurator/ThemePreview.tsx
  - apps/docs/src/components/configurator/ConfiguratorLayout.tsx
  - apps/docs/src/components/configurator/GetCommandModal.tsx
  - apps/docs/src/pages/configurator/ConfiguratorPage.tsx
  - apps/docs/src/App.tsx
  - apps/docs/src/nav.ts
autonomous: true

must_haves:
  truths:
    - "Live preview updates Button and Dialog as user changes colors"
    - "Preview shows correct colors for active mode (light or dark)"
    - "Sidebar contains all color pickers organized by section"
    - "Get Command button opens modal with npx command"
    - "Configurator page is accessible at /configurator route"
  artifacts:
    - path: "apps/docs/src/components/configurator/ThemePreview.tsx"
      provides: "Live component preview with CSS injection"
      min_lines: 50
    - path: "apps/docs/src/components/configurator/ConfiguratorLayout.tsx"
      provides: "Sidebar + preview layout"
      min_lines: 40
    - path: "apps/docs/src/components/configurator/GetCommandModal.tsx"
      provides: "CLI command modal with copy button"
      min_lines: 40
    - path: "apps/docs/src/pages/configurator/ConfiguratorPage.tsx"
      provides: "Main configurator page component"
      min_lines: 30
  key_links:
    - from: "apps/docs/src/components/configurator/ThemePreview.tsx"
      to: "apps/docs/src/contexts/ConfiguratorContext.tsx"
      via: "getGeneratedCSS for style injection"
      pattern: "getGeneratedCSS"
    - from: "apps/docs/src/components/configurator/GetCommandModal.tsx"
      to: "@lit-ui/cli/theme"
      via: "encodeThemeConfig for command generation"
      pattern: "encodeThemeConfig"
    - from: "apps/docs/src/App.tsx"
      to: "apps/docs/src/pages/configurator/ConfiguratorPage.tsx"
      via: "Route definition"
      pattern: 'path="configurator"'
---

<objective>
Build the preview area, page layout, command modal, and integrate the configurator into the docs site routing.

Purpose: Assemble all pieces into a working configurator page. The preview shows live Button and Dialog components updating in real-time. The layout arranges sidebar controls and preview area. The modal displays the CLI command for copying.

Output: Complete configurator page accessible at /configurator with live preview and command generation.
</objective>

<execution_context>
@/Users/sn0w/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sn0w/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/23-visual-configurator-core/23-CONTEXT.md
@.planning/phases/23-visual-configurator-core/23-RESEARCH.md
@.planning/phases/23-visual-configurator-core/23-01-SUMMARY.md
@.planning/phases/23-visual-configurator-core/23-02-SUMMARY.md
@apps/docs/src/App.tsx
@apps/docs/src/nav.ts
@apps/docs/src/contexts/ConfiguratorContext.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ThemePreview and GetCommandModal components</name>
  <files>
    apps/docs/src/components/configurator/ThemePreview.tsx
    apps/docs/src/components/configurator/GetCommandModal.tsx
  </files>
  <action>
**ThemePreview.tsx** - Live component preview with CSS injection:

1. Use useConfigurator to get:
   - `getGeneratedCSS()` for CSS content
   - `activeMode` for light/dark class

2. CSS injection strategy:
   - Use a `<style>` element with id for updating
   - Insert generated CSS into document head (not scoped container)
   - This allows CSS custom properties to cascade into Shadow DOM
   - Clean up style element on unmount

3. Implementation:
   ```typescript
   useEffect(() => {
     const styleId = 'configurator-preview-theme';
     let styleEl = document.getElementById(styleId) as HTMLStyleElement;

     if (!styleEl) {
       styleEl = document.createElement('style');
       styleEl.id = styleId;
       document.head.appendChild(styleEl);
     }

     styleEl.textContent = getGeneratedCSS();

     return () => {
       // Don't remove on every re-render, only on unmount
     };
   }, [getGeneratedCSS]);

   // Cleanup on unmount
   useEffect(() => {
     return () => {
       const styleEl = document.getElementById('configurator-preview-theme');
       if (styleEl) styleEl.remove();
     };
   }, []);
   ```

4. Preview content:
   - Wrapper div with `className={activeMode === 'dark' ? 'dark' : ''}`
   - Background uses theme background color via CSS custom property
   - Show variety of Button variants: primary, secondary, destructive, outline, ghost
   - Show Dialog trigger button + working dialog
   - Interactive: buttons are clickable, dialog opens/closes

5. Layout within preview:
   - Padding, centered content
   - Card-like container for component showcase
   - Section headers: "Buttons", "Dialog"
   - Responsive grid for button variants

**GetCommandModal.tsx** - CLI command modal:

1. Props:
   ```typescript
   interface GetCommandModalProps {
     open: boolean;
     onClose: () => void;
   }
   ```

2. Use useConfigurator to get `getThemeConfig()`

3. Import encodeThemeConfig from @lit-ui/cli/theme

4. Generate command:
   ```typescript
   const config = getThemeConfig();
   const encoded = encodeThemeConfig(config);
   const initCommand = `npx @lit-ui/cli init --theme=${encoded}`;
   const themeCommand = `npx @lit-ui/cli theme ${encoded}`;
   ```

5. Copy functionality:
   - State for copied feedback
   - navigator.clipboard.writeText
   - Show checkmark icon briefly after copy

6. Render using lui-dialog:
   - Title: "Get CLI Command"
   - Description: "Run this command to apply your theme"
   - Two command sections: one for new projects (init), one for existing (theme)
   - Code block with monospace font
   - Copy button for each command
   - Close button in footer
  </action>
  <verify>
    - Both files exist in apps/docs/src/components/configurator/
    - TypeScript compiles: `cd apps/docs && pnpm exec tsc --noEmit`
  </verify>
  <done>
    - ThemePreview injects CSS and shows Button/Dialog components
    - Components update live when theme changes
    - GetCommandModal displays encoded CLI commands with copy buttons
  </done>
</task>

<task type="auto">
  <name>Task 2: Create ConfiguratorLayout and ConfiguratorPage</name>
  <files>
    apps/docs/src/components/configurator/ConfiguratorLayout.tsx
    apps/docs/src/pages/configurator/ConfiguratorPage.tsx
  </files>
  <action>
**ConfiguratorLayout.tsx** - Sidebar + preview layout:

1. Props:
   ```typescript
   interface ConfiguratorLayoutProps {
     sidebar: React.ReactNode;
     preview: React.ReactNode;
     onGetCommand: () => void;
   }
   ```

2. Layout structure (Tailwind):
   - Fixed sidebar on left: w-80 or w-96
   - Flexible preview area on right: flex-1
   - Full viewport height: h-screen
   - Sidebar scrollable: overflow-y-auto
   - Preview scrollable: overflow-y-auto

3. Sidebar structure:
   - Header with title "Theme Configurator"
   - ModeToggle at top
   - Divider
   - Color sections (rendered via children prop)
   - Divider
   - RadiusSelector
   - Divider
   - "Get Command" button at bottom (sticky or in footer)

4. Responsive considerations:
   - On mobile (< md): Stack vertically or show sidebar as overlay
   - For MVP: Keep sidebar fixed, preview scrolls
   - Add overflow handling

5. Styling:
   - Sidebar: bg-white border-r border-gray-200
   - Preview: bg-gray-50 (neutral background)
   - Consistent padding: p-4 or p-6

**ConfiguratorPage.tsx** - Main page component:

1. Wrap everything in ConfiguratorProvider

2. Compose the page:
   ```typescript
   export function ConfiguratorPage() {
     const [commandModalOpen, setCommandModalOpen] = useState(false);

     return (
       <ConfiguratorProvider>
         <ConfiguratorLayout
           sidebar={<ConfiguratorSidebar />}
           preview={<ThemePreview />}
           onGetCommand={() => setCommandModalOpen(true)}
         />
         <GetCommandModal
           open={commandModalOpen}
           onClose={() => setCommandModalOpen(false)}
         />
       </ConfiguratorProvider>
     );
   }
   ```

3. Create ConfiguratorSidebar as internal component or inline:
   - ModeToggle
   - ColorSection title="Brand Colors":
     - ColorPickerGroup for primary
     - ColorPickerGroup for secondary
     - ColorPickerGroup for destructive
   - ColorSection title="Surface Colors":
     - ColorPickerGroup for background
     - ColorPickerGroup for foreground
   - ColorSection title="Utility Colors":
     - ColorPickerGroup for muted
   - TailwindSwatches with onSelect that updates currently focused/last color
   - RadiusSelector
  </action>
  <verify>
    - Both files exist
    - TypeScript compiles: `cd apps/docs && pnpm exec tsc --noEmit`
  </verify>
  <done>
    - ConfiguratorLayout provides sidebar + preview arrangement
    - ConfiguratorPage composes all components into working page
    - Color pickers are grouped by semantic role per CONTEXT.md
  </done>
</task>

<task type="auto">
  <name>Task 3: Add routing and navigation</name>
  <files>
    apps/docs/src/App.tsx
    apps/docs/src/nav.ts
  </files>
  <action>
**App.tsx** - Add route for configurator:

1. Import ConfiguratorPage:
   ```typescript
   import { ConfiguratorPage } from './pages/configurator/ConfiguratorPage'
   ```

2. Add route OUTSIDE DocsLayout (configurator has its own layout):
   ```typescript
   <Routes>
     {/* Configurator has its own layout, not nested in DocsLayout */}
     <Route path="configurator" element={<ConfiguratorPage />} />

     <Route element={<DocsLayout />}>
       {/* existing routes */}
     </Route>
   </Routes>
   ```

**nav.ts** - Add configurator to navigation (if applicable):

1. Check current nav structure
2. Add entry for Configurator if nav is used for header/sidebar links:
   ```typescript
   {
     title: 'Theme Configurator',
     href: '/configurator',
     // icon if nav uses icons
   }
   ```

3. Place in appropriate section (Tools, or as standalone item)
  </action>
  <verify>
    - App.tsx compiles without errors
    - Route exists for /configurator path
    - Navigation updated if applicable
  </verify>
  <done>
    - Configurator accessible at /configurator
    - Route renders ConfiguratorPage directly (not in DocsLayout)
    - Navigation includes link to configurator
  </done>
</task>

</tasks>

<verification>
1. All component files exist in configurator directories
2. TypeScript compiles: `cd apps/docs && pnpm exec tsc --noEmit`
3. Dev server starts: `cd apps/docs && pnpm dev`
4. Navigate to /configurator - page loads without errors
5. Color pickers render and respond to interaction
6. Preview shows Button and Dialog components
</verification>

<success_criteria>
- [ ] ThemePreview.tsx injects CSS and shows live components
- [ ] GetCommandModal.tsx displays CLI commands with copy
- [ ] ConfiguratorLayout.tsx arranges sidebar and preview
- [ ] ConfiguratorPage.tsx composes all pieces
- [ ] Route added to App.tsx for /configurator
- [ ] Dev server runs without errors
- [ ] Configurator page loads at /configurator
</success_criteria>

<output>
After completion, create `.planning/phases/23-visual-configurator-core/23-03-SUMMARY.md`
</output>
