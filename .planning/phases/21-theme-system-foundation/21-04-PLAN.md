---
phase: 21-theme-system-foundation
plan: 04
type: tdd
wave: 2
depends_on: ["21-01", "21-02"]
files_modified:
  - packages/cli/src/theme/css-generator.ts
  - packages/cli/tests/theme/css-generator.test.ts
autonomous: true

must_haves:
  truths:
    - "CSS generator produces valid :root block with --lui-* variables"
    - "CSS generator produces .dark block with inverted colors"
    - "CSS generator includes prefers-color-scheme media query"
    - "Generated CSS includes documentation comments"
    - "Border radius tokens are generated for sm/md/lg values"
  artifacts:
    - path: "packages/cli/src/theme/css-generator.ts"
      provides: "CSS generation from theme config"
      exports: ["generateThemeCSS"]
  key_links:
    - from: "packages/cli/src/theme/css-generator.ts"
      to: "packages/cli/src/theme/color-scale.ts"
      via: "imports color utilities"
      pattern: "import.*deriveDarkMode.*deriveForeground.*from.*color-scale"
    - from: "packages/cli/src/theme/css-generator.ts"
      to: "packages/cli/src/theme/schema.ts"
      via: "imports ThemeConfig type"
      pattern: "import.*ThemeConfig.*from.*schema"
---

<objective>
Implement CSS generation that transforms theme configurations into Tailwind v4-compatible CSS.

Purpose: This is the final output of the theming system - valid CSS that can be injected into user's tailwind.css file. The CSS must define --lui-* variables that cascade into Shadow DOM and work with both class-based and media query dark mode.

Output: CSS generator producing properly formatted CSS with :root, .dark, and @media blocks, plus documentation comments.
</objective>

<execution_context>
@/Users/sn0w/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sn0w/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/21-theme-system-foundation/21-CONTEXT.md
@.planning/phases/21-theme-system-foundation/21-RESEARCH.md
@.planning/phases/21-theme-system-foundation/21-01-SUMMARY.md
@.planning/phases/21-theme-system-foundation/21-02-SUMMARY.md
@packages/core/src/styles/tailwind.css
</context>

<feature>
  <name>CSS Theme Generator</name>
  <files>
    packages/cli/src/theme/css-generator.ts
    packages/cli/tests/theme/css-generator.test.ts
  </files>
  <behavior>
    generateThemeCSS(config: ThemeConfig) -> string:
    - Input: Valid ThemeConfig with 6 colors and radius
    - Output: Complete CSS string with:
      1. Header comment block with generation metadata
      2. :root block with light mode --lui-* variables
      3. .dark block with dark mode overrides
      4. @media (prefers-color-scheme: dark) block
      5. Border radius variables (--lui-radius-sm, --lui-radius-md, --lui-radius-lg)

    Variable naming (from CONTEXT.md):
    - --lui-primary, --lui-primary-foreground
    - --lui-secondary, --lui-secondary-foreground
    - --lui-destructive, --lui-destructive-foreground
    - --lui-background, --lui-foreground
    - --lui-muted, --lui-muted-foreground
    - --lui-radius-sm, --lui-radius-md, --lui-radius-lg

    Dark mode:
    - Use deriveDarkMode() for color inversion
    - Use deriveForeground() for contrast colors
    - .dark selector AND @media (prefers-color-scheme: dark) { :root:not(.light) }

    Radius values (from CONTEXT.md):
    - sm: { sm: 0.125rem, md: 0.25rem, lg: 0.375rem }
    - md: { sm: 0.125rem, md: 0.375rem, lg: 0.5rem }
    - lg: { sm: 0.25rem, md: 0.5rem, lg: 0.75rem }

    Comments:
    - Section headers for each token group
    - Brief explanation of each semantic color purpose
  </behavior>
  <implementation>
    1. Create packages/cli/src/theme/css-generator.ts with:
       - Import ThemeConfig from ./schema
       - Import deriveDarkMode, deriveForeground from ./color-scale
       - Define radius value mappings as constant
       - generateThemeCSS function:
         - Build header comment with timestamp
         - Build :root block with all light mode vars
         - Build .dark block with derived dark colors
         - Build @media block (same values as .dark, wrapped differently)
         - Use template literal for clean formatting
    2. Write tests:
       - Output contains :root block
       - Output contains .dark block
       - Output contains @media (prefers-color-scheme: dark)
       - All 6 color pairs present in :root
       - Radius variables present
       - Comment header present
       - Valid CSS (can parse without errors)
    3. Update theme/index.ts to export generateThemeCSS
  </implementation>
</feature>

<verification>
```bash
# Run tests
pnpm test --filter @lit-ui/cli

# Manual verification: generate CSS and check validity
# Could use css-tree or similar to parse, or just visual inspection
```
</verification>

<success_criteria>
- All CSS generator tests pass
- Generated CSS is syntactically valid
- All required selectors present (:root, .dark, @media)
- All --lui-* variables defined
- Documentation comments included
</success_criteria>

<output>
After completion, create `.planning/phases/21-theme-system-foundation/21-04-SUMMARY.md`
</output>
