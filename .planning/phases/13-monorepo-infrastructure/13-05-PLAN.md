---
phase: 13-monorepo-infrastructure
plan: 05
type: execute
wave: 3
depends_on: ["13-01", "13-02", "13-03", "13-04"]
files_modified:
  - pnpm-lock.yaml
  - tsconfig.json
  - src/ (renamed to src.old/)
autonomous: true

must_haves:
  truths:
    - "pnpm install at root succeeds and links all packages"
    - "pnpm --filter @lit-ui/core build succeeds"
    - "pnpm --filter @lit-ui/button build succeeds"
    - "pnpm changeset creates a changeset file"
  artifacts:
    - path: "pnpm-lock.yaml"
      provides: "Workspace lockfile"
      min_lines: 100
  key_links:
    - from: "pnpm install"
      to: "packages/*/node_modules"
      via: "workspace linking"
      pattern: "node_modules"
---

<objective>
Install dependencies, verify workspace commands work, and clean up migration artifacts.

Purpose: Confirm the monorepo infrastructure is fully functional - packages install, build, and changesets work. Clean up old files that are superseded by the new structure.

Output: Working pnpm workspace with verified build and changeset commands
</objective>

<execution_context>
@/Users/sn0w/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sn0w/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/13-monorepo-infrastructure/13-RESEARCH.md
@.planning/phases/13-monorepo-infrastructure/13-01-SUMMARY.md
@.planning/phases/13-monorepo-infrastructure/13-02-SUMMARY.md
@.planning/phases/13-monorepo-infrastructure/13-03-SUMMARY.md
@.planning/phases/13-monorepo-infrastructure/13-04-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install workspace dependencies</name>
  <files>pnpm-lock.yaml</files>
  <action>
Remove old npm artifacts and install via pnpm:

```bash
# Remove old npm lockfile and node_modules
rm -f package-lock.json
rm -rf node_modules

# Install all workspace dependencies
pnpm install
```

This creates pnpm-lock.yaml and links all workspace packages.

If pnpm is not installed, install it first:
```bash
npm install -g pnpm@10
```

Verify workspace packages are linked:
```bash
pnpm ls --depth 0
```
  </action>
  <verify>Run `pnpm ls -r --depth 0 | head -20` to list workspace packages</verify>
  <done>pnpm-lock.yaml exists and all packages are linked</done>
</task>

<task type="auto">
  <name>Task 2: Verify builds work</name>
  <files>(no files modified - verification only)</files>
  <action>
Run builds to verify the workspace is correctly configured:

```bash
# Build shared configs first (they have no build step, just verify they exist)
pnpm --filter @lit-ui/typescript-config exec ls

# Build core package
pnpm --filter @lit-ui/core build

# Build button package (depends on core)
pnpm --filter @lit-ui/button build

# Build dialog package (depends on core)
pnpm --filter @lit-ui/dialog build
```

Each build should succeed and create dist/ with index.js and index.d.ts.

Also verify apps can still run (optional, quick check):
```bash
# Check docs can start dev server (just check command exists, don't wait)
pnpm --filter lit-ui-docs exec ls src/
```
  </action>
  <verify>Run `ls packages/*/dist/index.js 2>/dev/null | wc -l` (should be 3)</verify>
  <done>All three packages build successfully with dist/index.js</done>
</task>

<task type="auto">
  <name>Task 3: Verify changesets and clean up</name>
  <files>src/ (renamed to src.old/), tsconfig.json, vite.config.ts</files>
  <action>
Verify changesets work:
```bash
# Create a test changeset (we'll delete it after)
echo "---
'@lit-ui/core': patch
---

Test changeset for verification" > .changeset/test-changeset.md

# Verify changeset status
pnpm changeset status

# Remove test changeset
rm .changeset/test-changeset.md
```

Clean up old root-level source files (per migration approach):
```bash
# Rename src/ to src.old/ for reference during Phase 14-15 migration
mv src src.old

# Update root tsconfig.json to be workspace-only (no compilation)
# It should just reference child configs or be minimal
```

Update root tsconfig.json to minimal workspace config:
```json
{
  "compilerOptions": {
    "target": "ES2022",
    "module": "ESNext",
    "moduleResolution": "bundler",
    "strict": true,
    "skipLibCheck": true
  },
  "include": [],
  "references": []
}
```

Root vite.config.ts can be kept for now (or removed) - it's not used by workspace builds.

Clean up dist/ at root level:
```bash
rm -rf dist
```
  </action>
  <verify>Run `ls src.old/ && ls src 2>/dev/null || echo "src renamed"`</verify>
  <done>Changesets verified, src/ renamed to src.old/, root cleaned up</done>
</task>

</tasks>

<verification>
Final verification of Phase 13 success criteria:

1. **pnpm install works:**
   ```bash
   pnpm install --frozen-lockfile
   ```

2. **Filter builds work:**
   ```bash
   pnpm --filter @lit-ui/core build
   pnpm --filter @lit-ui/button build
   pnpm --filter @lit-ui/dialog build
   ```

3. **Changeset version works:**
   ```bash
   pnpm changeset status
   ```

4. **TypeScript cross-workspace:**
   ```bash
   # Create a temporary type error and verify it's caught
   # (This is verified by the build succeeding - tsc runs as part of vite build)
   ```
</verification>

<success_criteria>
- pnpm install succeeds at root
- pnpm --filter @lit-ui/X build works for core, button, dialog
- pnpm changeset status runs without error
- Old src/ renamed to src.old/
- No dist/ or node_modules/ at root level
- pnpm-lock.yaml exists (not package-lock.json)
</success_criteria>

<output>
After completion, create `.planning/phases/13-monorepo-infrastructure/13-05-SUMMARY.md`
</output>
