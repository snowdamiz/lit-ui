---
phase: 13-monorepo-infrastructure
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - pnpm-workspace.yaml
  - package.json
  - .changeset/config.json
  - .npmrc
autonomous: true

must_haves:
  truths:
    - "pnpm install at root installs all workspace packages"
    - "pnpm changeset command is available"
    - "Workspace packages use lockstep versioning"
  artifacts:
    - path: "pnpm-workspace.yaml"
      provides: "Workspace package locations"
      contains: "packages:"
    - path: ".changeset/config.json"
      provides: "Changeset configuration with fixed mode"
      contains: "@lit-ui"
    - path: "package.json"
      provides: "Root package with workspace scripts"
      contains: "pnpm -r"
  key_links:
    - from: "pnpm-workspace.yaml"
      to: "packages/*"
      via: "workspace glob"
      pattern: "packages/\\*"
---

<objective>
Set up pnpm workspace foundation with changesets for version management.

Purpose: Enable monorepo package management with lockstep versioning so all @lit-ui packages share version numbers and can be developed/released together.

Output: Root configuration files that define the workspace structure and versioning strategy.
</objective>

<execution_context>
@/Users/sn0w/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sn0w/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/13-monorepo-infrastructure/13-RESEARCH.md
@package.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create pnpm workspace configuration</name>
  <files>pnpm-workspace.yaml, .npmrc</files>
  <action>
Create pnpm-workspace.yaml that defines package locations:
```yaml
packages:
  - 'packages/*'
  - 'apps/*'
```

Create .npmrc with strict peer dependency handling:
```
strict-peer-dependencies=false
auto-install-peers=true
```

This enables pnpm workspaces with packages/ for libraries and apps/ for docs/landing.
  </action>
  <verify>Files exist and are valid YAML/config format</verify>
  <done>pnpm-workspace.yaml defines packages/* and apps/* globs</done>
</task>

<task type="auto">
  <name>Task 2: Configure root package.json for workspace</name>
  <files>package.json</files>
  <action>
Transform root package.json into workspace root:

1. Change name to "lit-ui-monorepo"
2. Add "private": true (monorepo root is never published)
3. Remove "main", "module", "types", "exports", "files" (library exports move to packages)
4. Remove dependencies/devDependencies except:
   - Keep: typescript (workspace-wide type checking)
   - Add: @changesets/cli, @changesets/changelog-github
5. Update scripts:
```json
{
  "dev": "pnpm -r --parallel run dev",
  "build": "pnpm -r run build",
  "test": "pnpm -r run test",
  "lint": "pnpm -r run lint",
  "changeset": "changeset",
  "version": "changeset version",
  "ci:publish": "pnpm build && changeset publish --access public"
}
```
6. Add packageManager field: "pnpm@10.0.0"
7. Add engines: { "node": ">=20.0.0", "pnpm": ">=10.0.0" }

Keep description and license.
  </action>
  <verify>Run `cat package.json | head -30` and confirm structure</verify>
  <done>Root package.json is workspace-configured with scripts for dev, build, changeset</done>
</task>

<task type="auto">
  <name>Task 3: Initialize changesets with fixed mode</name>
  <files>.changeset/config.json, .changeset/README.md</files>
  <action>
Create .changeset directory and config.json:

```json
{
  "$schema": "https://unpkg.com/@changesets/config@3.1.1/schema.json",
  "changelog": "@changesets/changelog-github",
  "commit": false,
  "fixed": [["@lit-ui/core", "@lit-ui/button", "@lit-ui/dialog"]],
  "linked": [],
  "access": "public",
  "baseBranch": "main",
  "updateInternalDependencies": "patch",
  "ignore": ["@lit-ui/typescript-config", "@lit-ui/vite-config", "lit-ui-docs", "lit-ui-landing"]
}
```

Key settings:
- fixed: All @lit-ui packages share same version (lockstep)
- ignore: Internal config packages and apps don't get versions
- access: public for npm publishing

Create .changeset/README.md with brief usage instructions for contributors.
  </action>
  <verify>Run `ls -la .changeset/` to confirm directory and files exist</verify>
  <done>.changeset/config.json exists with fixed mode for @lit-ui packages</done>
</task>

</tasks>

<verification>
After all tasks complete:
1. Verify files exist: `ls pnpm-workspace.yaml .npmrc package.json .changeset/config.json`
2. Verify workspace.yaml content: `cat pnpm-workspace.yaml`
3. Verify package.json has workspace scripts: `grep -A1 '"scripts"' package.json`
4. Verify changeset config has fixed mode: `grep '"fixed"' .changeset/config.json`
</verification>

<success_criteria>
- pnpm-workspace.yaml exists with packages/* and apps/* globs
- Root package.json has private: true and workspace scripts
- .changeset/config.json has fixed mode for @lit-ui packages
- .npmrc enables auto-install-peers
</success_criteria>

<output>
After completion, create `.planning/phases/13-monorepo-infrastructure/13-01-SUMMARY.md`
</output>
