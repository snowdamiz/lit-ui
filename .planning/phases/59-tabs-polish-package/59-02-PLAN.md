---
phase: 59-tabs-polish-package
plan: 02
type: execute
wave: 2
depends_on: ["59-01"]
files_modified:
  - packages/tabs/src/tabs.ts
  - packages/core/src/styles/tailwind.css
autonomous: true

must_haves:
  truths:
    - "When tabs overflow the container, left/right scroll buttons appear"
    - "Scroll buttons allow horizontal scrolling of the tablist"
    - "Scroll buttons hide when all tabs are visible (no overflow)"
    - "Tabs render correctly via Declarative Shadow DOM on the server and hydrate on the client"
    - "@lit-ui/tabs package is publishable with correct exports, peer deps, and types"
  artifacts:
    - path: "packages/tabs/src/tabs.ts"
      provides: "Overflow scroll buttons with scroll detection"
      contains: "scroll-button"
    - path: "packages/core/src/styles/tailwind.css"
      provides: "Scroll button CSS custom property tokens"
      contains: "--ui-tabs-scroll-button"
  key_links:
    - from: "packages/tabs/src/tabs.ts scroll event"
      to: "packages/tabs/src/tabs.ts updateScrollButtons"
      via: "scroll event listener on tablist updates button visibility"
      pattern: "updateScrollButtons"
    - from: "packages/tabs/src/tabs.ts ResizeObserver"
      to: "packages/tabs/src/tabs.ts updateScrollButtons"
      via: "ResizeObserver also triggers scroll button check"
      pattern: "updateScrollButtons"
---

<objective>
Add overflow scroll navigation buttons to the tablist and verify SSR compatibility and package publishability.

Purpose: Overflow scroll buttons provide a usable way to navigate tabs when they exceed the container width (TABS-19). SSR verification ensures the component works with Declarative Shadow DOM (TABS-21). Package audit confirms @lit-ui/tabs is ready to publish (INTG-02).
Output: Updated tabs.ts with scroll buttons and detection logic, updated tailwind.css with scroll button tokens.
</objective>

<execution_context>
@/Users/sn0w/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sn0w/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@packages/tabs/src/tabs.ts
@packages/core/src/styles/tailwind.css
@.planning/phases/59-tabs-polish-package/59-RESEARCH.md
@.planning/phases/59-tabs-polish-package/59-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Overflow scroll with navigation buttons</name>
  <files>packages/tabs/src/tabs.ts, packages/core/src/styles/tailwind.css</files>
  <action>
In `packages/tabs/src/tabs.ts`:

1. Add two `@state()` properties (import `state` from `lit/decorators.js`):
   ```typescript
   @state()
   private _showScrollLeft = false;

   @state()
   private _showScrollRight = false;
   ```

2. Add `updateScrollButtons()` method with `isServer` guard:
   ```typescript
   private updateScrollButtons(): void {
     if (isServer) return;
     if (this.orientation === 'vertical') {
       this._showScrollLeft = false;
       this._showScrollRight = false;
       return;
     }
     const tablist = this.shadowRoot?.querySelector('.tablist') as HTMLElement | null;
     if (!tablist) return;

     this._showScrollLeft = tablist.scrollLeft > 1;
     this._showScrollRight =
       tablist.scrollLeft + tablist.clientWidth < tablist.scrollWidth - 1;
   }
   ```

3. Add `scrollTabs()` method:
   ```typescript
   private scrollTabs(direction: 'left' | 'right'): void {
     const tablist = this.shadowRoot?.querySelector('.tablist') as HTMLElement | null;
     if (!tablist) return;

     const scrollAmount = tablist.clientWidth * 0.75;
     tablist.scrollBy({
       left: direction === 'left' ? -scrollAmount : scrollAmount,
       behavior: 'smooth',
     });
   }
   ```

4. In the existing `firstUpdated()`, after the ResizeObserver setup for the indicator (added in 59-01), also call `this.updateComplete.then(() => this.updateScrollButtons())` for initial scroll button state.

5. In the existing ResizeObserver callback (from 59-01), also call `this.updateScrollButtons()` alongside `this.updateIndicator()`.

6. In `handleSlotChange()`, after the indicator update (from 59-01), also add scroll button update: `this.updateComplete.then(() => this.updateScrollButtons())`.

7. Update the render template to wrap the tablist in a `.tablist-wrapper` div and add scroll buttons. The structure becomes:
   ```html
   <div class="tablist-wrapper">
     ${this._showScrollLeft ? html`
       <button
         class="scroll-button scroll-left"
         aria-hidden="true"
         tabindex="-1"
         @click=${() => this.scrollTabs('left')}
       >
         <svg viewBox="0 0 16 16" fill="none" stroke="currentColor" aria-hidden="true" width="16" height="16">
           <path d="M10 4l-4 4 4 4" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
         </svg>
       </button>
     ` : nothing}

     <div
       class="tablist"
       role="tablist"
       aria-orientation="${this.orientation}"
       aria-label="${this.label || nothing}"
       @keydown=${this.handleKeyDown}
       @scroll=${this.updateScrollButtons}
     >
       ${this.panels.map(...)}
       <!-- indicator div from 59-01 -->
     </div>

     ${this._showScrollRight ? html`
       <button
         class="scroll-button scroll-right"
         aria-hidden="true"
         tabindex="-1"
         @click=${() => this.scrollTabs('right')}
       >
         <svg viewBox="0 0 16 16" fill="none" stroke="currentColor" aria-hidden="true" width="16" height="16">
           <path d="M6 4l4 4-4 4" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
         </svg>
       </button>
     ` : nothing}
   </div>
   ```

   IMPORTANT: The existing `.tablist` div retains its role="tablist" and all its existing attributes. Only the outer wrapper and scroll buttons are new. The panels-container and slot remain unchanged below the wrapper.

8. Add CSS for scroll buttons and wrapper to `static override styles`:
   ```css
   .tablist-wrapper {
     position: relative;
     display: flex;
     align-items: center;
   }

   .tablist {
     overflow-x: auto;
     scrollbar-width: none;
     -ms-overflow-style: none;
   }

   .tablist::-webkit-scrollbar {
     display: none;
   }

   .scroll-button {
     flex-shrink: 0;
     display: flex;
     align-items: center;
     justify-content: center;
     width: var(--ui-tabs-scroll-button-size, 2rem);
     height: var(--ui-tabs-scroll-button-size, 2rem);
     border: none;
     background: var(--ui-tabs-list-bg);
     color: var(--ui-tabs-tab-text);
     cursor: pointer;
     border-radius: var(--ui-tabs-tab-radius);
     transition: color var(--ui-tabs-transition), background var(--ui-tabs-transition);
   }

   .scroll-button:hover {
     color: var(--ui-tabs-tab-hover-text);
     background: var(--ui-tabs-tab-hover-bg);
   }

   :host([orientation="vertical"]) .tablist-wrapper {
     display: contents;
   }
   ```

   NOTE: Merge the new `.tablist` overflow rules into the existing `.tablist` CSS rule (don't create a duplicate). The existing `.tablist` rule already has `display: inline-flex`, `align-items`, `gap`, etc. Just add `overflow-x: auto; scrollbar-width: none; -ms-overflow-style: none;` and the `::-webkit-scrollbar` rule. Also change `display: inline-flex` to `display: flex` so the tablist fills the wrapper width (needed for overflow detection).

In `packages/core/src/styles/tailwind.css`:

9. Add scroll button token in the `:root` block after the indicator tokens:
   ```css
   --ui-tabs-scroll-button-size: 2rem;
   ```
  </action>
  <verify>
Run `cd /Users/sn0w/Documents/dev/lit-components && pnpm --filter @lit-ui/tabs build` and confirm zero build errors. Verify `tabs.ts` contains: `scroll-button` class, `scrollTabs` method, `updateScrollButtons` method, `_showScrollLeft`/`_showScrollRight` state properties, `@scroll` event on tablist, `tablist-wrapper` class. Verify tailwind.css contains `--ui-tabs-scroll-button-size`.
  </verify>
  <done>
Scroll navigation buttons appear when tabs overflow the container width. Buttons hide when all tabs fit. Scroll event listener and ResizeObserver keep button visibility in sync. Buttons have aria-hidden="true" and tabindex="-1" (not in tab order). Scrollbar is hidden. Only applies to horizontal orientation.
  </done>
</task>

<task type="auto">
  <name>Task 2: SSR compatibility verification and package publishability audit</name>
  <files>packages/tabs/src/tabs.ts, packages/tabs/src/tab-panel.ts</files>
  <action>
**SSR Compatibility Verification (TABS-21):**

1. Audit ALL browser APIs in tabs.ts and tab-panel.ts for isServer guards:
   - `getBoundingClientRect()` in `updateIndicator()` -- must be guarded (should already be via isServer check at top of method)
   - `ResizeObserver` creation in `firstUpdated()` -- must be inside `!isServer` block (should already be)
   - `this.shadowRoot?.querySelector()` calls -- safe in firstUpdated/updated (client-only lifecycle), but verify
   - `scrollLeft`, `scrollWidth`, `clientWidth` in `updateScrollButtons()` -- must be guarded (should already be via isServer check at top)
   - `scrollBy()` in `scrollTabs()` -- only called from click handler (client-only), safe
   - `requestAnimationFrame` in syncPanelStates lazy re-check -- wrap in `!isServer` guard if not already
   - `this.setAttribute('data-state', ...)` in tab-panel.ts `updated()` -- already has isServer guard

2. Verify that the indicator div, scroll buttons, and all structural elements are part of the shadow DOM template and will render correctly in Declarative Shadow DOM output. These are all in the `render()` method which runs on server -- confirm:
   - Indicator div renders (with opacity:0 since _indicatorReady is false on server)
   - Scroll buttons do NOT render on server (_showScrollLeft/_showScrollRight default to false), which is correct
   - The `nothing` sentinel correctly omits elements when conditions are false

3. Add isServer guard to `requestAnimationFrame` call in syncPanelStates if not already present:
   ```typescript
   if (activePanel?.lazy && !isServer) {
     requestAnimationFrame(() => { ... });
   }
   ```

**Package Publishability Audit (INTG-02):**

4. Verify `packages/tabs/package.json` has all required fields:
   - `name`: "@lit-ui/tabs"
   - `version`: "1.0.0"
   - `main`/`module`: "dist/index.js"
   - `types`: "dist/index.d.ts"
   - `exports`: correct with import and types
   - `files`: ["dist"]
   - `sideEffects`: true (custom element registration)
   - `peerDependencies`: lit ^3.0.0 and @lit-ui/core ^1.0.0
   - `type`: "module"

5. Verify `packages/tabs/src/index.ts` exports Tabs, TabPanel, and registers custom elements with collision detection.

6. Run `pnpm --filter @lit-ui/tabs build` and verify:
   - dist/index.js exists
   - dist/index.d.ts exists
   - No TypeScript or build errors

7. If any issues found, fix them. If all checks pass, the package is publish-ready.
  </action>
  <verify>
Run `cd /Users/sn0w/Documents/dev/lit-components && pnpm --filter @lit-ui/tabs build` and confirm zero errors. Run `ls packages/tabs/dist/index.js packages/tabs/dist/index.d.ts` to verify build output exists. Grep for `isServer` in tabs.ts to confirm all browser API calls are guarded. Verify package.json has correct fields.
  </verify>
  <done>
All browser APIs have isServer guards. Indicator renders in DSD output (opacity:0 on server, positioned on client). Scroll buttons correctly omitted in server render. requestAnimationFrame guarded. Package has correct exports, peer deps, types, and builds successfully. @lit-ui/tabs is publish-ready.
  </done>
</task>

</tasks>

<verification>
1. `pnpm --filter @lit-ui/tabs build` succeeds with zero errors
2. `dist/index.js` and `dist/index.d.ts` exist in packages/tabs/dist/
3. All browser APIs (getBoundingClientRect, ResizeObserver, scrollLeft, scrollBy, requestAnimationFrame) are protected by isServer guards
4. Scroll buttons render conditionally based on overflow state
5. Package.json has correct name, exports, types, peer deps, files, and sideEffects fields
6. Custom element registration in index.ts has collision detection
</verification>

<success_criteria>
- Scroll buttons appear only when tabs overflow horizontally
- Scroll buttons are not in tab order (aria-hidden, tabindex=-1)
- Scrollbar is hidden (CSS)
- All new code is SSR-safe (isServer guards on all browser APIs)
- Indicator and structure render in Declarative Shadow DOM
- @lit-ui/tabs builds successfully with types
- Package has correct peer deps (lit, @lit-ui/core)
</success_criteria>

<output>
After completion, create `.planning/phases/59-tabs-polish-package/59-02-SUMMARY.md`
</output>
