---
phase: 60-cli-and-documentation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - packages/cli/src/templates/accordion.ts
  - packages/cli/src/templates/accordion-item.ts
  - packages/cli/src/templates/tabs.ts
  - packages/cli/src/templates/tab-panel.ts
  - packages/cli/src/templates/index.ts
  - packages/cli/src/registry/registry.json
autonomous: true

must_haves:
  truths:
    - "Running `npx lit-ui add accordion` resolves accordion template with accordion-item dependency"
    - "Running `npx lit-ui add tabs` resolves tabs template with tab-panel dependency"
    - "CLI templates import from ../../lib/lit-ui/tailwind-element instead of @lit-ui/core"
    - "CLI templates include CSS variable fallback values for standalone usage"
    - "Both accordion and tabs elements self-register via customElements.define with collision guards"
  artifacts:
    - path: "packages/cli/src/templates/accordion.ts"
      provides: "Accordion container CLI template"
      contains: "ACCORDION_TEMPLATE"
    - path: "packages/cli/src/templates/accordion-item.ts"
      provides: "AccordionItem CLI template"
      contains: "ACCORDION_ITEM_TEMPLATE"
    - path: "packages/cli/src/templates/tabs.ts"
      provides: "Tabs container CLI template"
      contains: "TABS_TEMPLATE"
    - path: "packages/cli/src/templates/tab-panel.ts"
      provides: "TabPanel CLI template"
      contains: "TAB_PANEL_TEMPLATE"
    - path: "packages/cli/src/templates/index.ts"
      provides: "Template registry map entries"
      contains: "accordion/accordion-item"
    - path: "packages/cli/src/registry/registry.json"
      provides: "Registry entries for CLI add command"
      contains: "accordion"
  key_links:
    - from: "packages/cli/src/templates/index.ts"
      to: "COMPONENT_TEMPLATES map"
      via: "import and map entry"
      pattern: "'accordion/accordion-item': ACCORDION_ITEM_TEMPLATE"
    - from: "packages/cli/src/registry/registry.json"
      to: "packages/cli/src/templates/index.ts"
      via: "file path -> template key resolution in copy-component.ts"
      pattern: "components/accordion/accordion-item.ts"
---

<objective>
Create CLI copy-source templates and registry entries for accordion and tabs components.

Purpose: Enable developers to install accordion and tabs via `npx lit-ui add accordion` and `npx lit-ui add tabs` with standalone CSS variable fallbacks (INTG-03, INTG-04, INTG-05, INTG-06).

Output: 4 template files, updated templates/index.ts, updated registry.json
</objective>

<execution_context>
@/Users/sn0w/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sn0w/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/60-cli-and-documentation/60-RESEARCH.md

# Source components to transform into templates
@packages/accordion/src/accordion.ts
@packages/accordion/src/accordion-item.ts
@packages/accordion/src/index.ts
@packages/tabs/src/tabs.ts
@packages/tabs/src/tab-panel.ts
@packages/tabs/src/index.ts

# Existing template patterns to follow
@packages/cli/src/templates/checkbox.ts
@packages/cli/src/templates/checkbox-group.ts
@packages/cli/src/templates/index.ts
@packages/cli/src/registry/registry.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create accordion and accordion-item CLI templates</name>
  <files>
    packages/cli/src/templates/accordion.ts
    packages/cli/src/templates/accordion-item.ts
  </files>
  <action>
Create two template files following the checkbox/checkbox-group pattern exactly. Each file exports a single `const TEMPLATE = \`...\`` template string.

**For both templates, apply these transformations from the source files:**

1. **Import transformation:**
   - Replace `import { TailwindElement, tailwindBaseStyles } from '@lit-ui/core';` with `import { TailwindElement, tailwindBaseStyles } from '../../lib/lit-ui/tailwind-element';`
   - Replace `import { dispatchCustomEvent } from '@lit-ui/core';` with an inline function definition:
     ```typescript
     function dispatchCustomEvent(el: HTMLElement, name: string, detail?: unknown) {
       el.dispatchEvent(new CustomEvent(name, { detail, bubbles: true, composed: true }));
     }
     ```
   - Change `import type { AccordionItem } from './accordion-item.js';` to `import type { AccordionItem } from './accordion-item';` (no .js extension)

2. **CSS variable fallbacks (INTG-06):** Add literal fallback values to ALL `var()` calls in CSS. Use these exact fallback values from the core theme:
   - `--ui-accordion-border` -> `#e5e7eb`
   - `--ui-accordion-border-width` -> `1px`
   - `--ui-accordion-radius` -> `0.375rem`
   - `--ui-accordion-header-padding` -> `0.75rem 0` (source already has this inline)
   - `--ui-accordion-header-font-weight` -> `500` (source already has this inline)
   - `--ui-accordion-header-font-size` -> `inherit` (source already has this inline)
   - `--ui-accordion-header-text` -> `inherit` (source already has this inline)
   - `--ui-accordion-header-bg` -> `transparent` (source already has this inline)
   - `--ui-accordion-header-hover-bg` -> `transparent` (source already has this inline)
   - `--ui-accordion-panel-padding` -> `0 0 0.75rem 0` (source already has this inline)
   - `--ui-accordion-panel-text` -> `inherit` (source already has this inline)
   - `--ui-accordion-transition` -> `200ms` (source already has this inline)
   - `--ui-accordion-ring` -> `currentColor` (source already has this inline)

   Note: Many accordion CSS vars already have inline fallbacks in the source. Only the accordion.ts container uses `--ui-accordion-border`, `--ui-accordion-border-width`, and `--ui-accordion-radius` without fallbacks. Add fallbacks to those.

3. **Element registration:** At the bottom of each template file, add `customElements.define()` with collision guard and `HTMLElementTagNameMap` declaration (matching the checkbox template pattern):

   For accordion.ts:
   ```typescript
   if (typeof customElements !== 'undefined') {
     if (!customElements.get('lui-accordion')) {
       customElements.define('lui-accordion', Accordion);
     }
   }

   declare global {
     interface HTMLElementTagNameMap {
       'lui-accordion': Accordion;
     }
   }
   ```

   For accordion-item.ts:
   ```typescript
   if (typeof customElements !== 'undefined') {
     if (!customElements.get('lui-accordion-item')) {
       customElements.define('lui-accordion-item', AccordionItem);
     }
   }

   declare global {
     interface HTMLElementTagNameMap {
       'lui-accordion-item': AccordionItem;
     }
   }
   ```

4. **Template string escaping:** Wrap entire file content in backtick template string. Escape all inner backticks with `\`` and all `${...}` expressions with `\${...}`. Follow the exact escaping pattern from checkbox.ts.

5. **Export naming:**
   - accordion.ts: `export const ACCORDION_TEMPLATE = \`...\`;`
   - accordion-item.ts: `export const ACCORDION_ITEM_TEMPLATE = \`...\`;`

**Critical:** The accordion source checks `el.tagName === 'LUI-ACCORDION-ITEM'` so both elements MUST be registered with those exact tag names.
  </action>
  <verify>
Run `npx tsc --noEmit -p packages/cli/tsconfig.json` to verify templates compile. Grep for `@lit-ui/core` in the template files to confirm no package imports remain. Grep for `customElements.define` to confirm both templates self-register.
  </verify>
  <done>
accordion.ts and accordion-item.ts template files exist, export ACCORDION_TEMPLATE and ACCORDION_ITEM_TEMPLATE respectively, import from ../../lib/lit-ui/tailwind-element, inline dispatchCustomEvent, include CSS variable fallbacks, and self-register via customElements.define with collision guards.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create tabs and tab-panel CLI templates, update index.ts and registry.json</name>
  <files>
    packages/cli/src/templates/tabs.ts
    packages/cli/src/templates/tab-panel.ts
    packages/cli/src/templates/index.ts
    packages/cli/src/registry/registry.json
  </files>
  <action>
**Create tabs.ts and tab-panel.ts templates** following the same transformation rules as Task 1:

1. **Import transformation:**
   - Replace `@lit-ui/core` imports with `../../lib/lit-ui/tailwind-element` and inline `dispatchCustomEvent`
   - Keep `import { styleMap } from 'lit/directives/style-map.js';` — this is a Lit core import, NOT a @lit-ui import
   - Change `import type { TabPanel } from './tab-panel.js';` to `import type { TabPanel } from './tab-panel';`

2. **CSS variable fallbacks (INTG-06):** Add literal fallback values. Many tabs CSS vars do NOT have inline fallbacks in the source. Add these:
   - `--ui-tabs-border` -> `#e5e7eb`
   - `--ui-tabs-list-gap` -> `0.25rem`
   - `--ui-tabs-list-padding` -> `0.25rem`
   - `--ui-tabs-list-bg` -> `#f4f4f5`
   - `--ui-tabs-list-radius` -> `0.375rem`
   - `--ui-tabs-tab-bg` -> `transparent`
   - `--ui-tabs-tab-text` -> `#71717a`
   - `--ui-tabs-tab-font-size` -> `0.875rem`
   - `--ui-tabs-tab-font-weight` -> `500`
   - `--ui-tabs-tab-padding` -> `0.5rem 1rem`
   - `--ui-tabs-tab-radius` -> `0.25rem`
   - `--ui-tabs-tab-hover-text` -> `#18181b`
   - `--ui-tabs-tab-hover-bg` -> `transparent`
   - `--ui-tabs-tab-active-text` -> `#18181b`
   - `--ui-tabs-tab-active-bg` -> `#ffffff`
   - `--ui-tabs-tab-active-shadow` -> `0 1px 2px 0 rgb(0 0 0 / 0.05)`
   - `--ui-tabs-panel-padding` -> `1rem 0`
   - `--ui-tabs-panel-text` -> `inherit`
   - `--ui-tabs-ring` -> `currentColor`
   - `--ui-tabs-transition` -> `150ms`
   - `--ui-tabs-indicator-color` -> `#3b82f6` (the already-inline fallback chain can simplify to this)
   - `--ui-tabs-indicator-height` -> `2px` (already inline in source)
   - `--ui-tabs-indicator-radius` -> `9999px` (already inline in source)
   - `--ui-tabs-indicator-transition` -> `200ms` (already inline in source)
   - `--ui-tabs-scroll-button-size` -> `2rem` (already inline in source)

3. **Element registration at bottom of each template** (same pattern as accordion):
   - tabs.ts: register `lui-tabs` with `Tabs` class
   - tab-panel.ts: register `lui-tab-panel` with `TabPanel` class

4. **Template string escaping:** Same rules as Task 1.

5. **Export naming:**
   - tabs.ts: `export const TABS_TEMPLATE = \`...\`;`
   - tab-panel.ts: `export const TAB_PANEL_TEMPLATE = \`...\`;`

**Update templates/index.ts:**

Add export and import lines for all 4 new templates, then add entries to COMPONENT_TEMPLATES map:

```typescript
// Exports (add after toast exports):
export { ACCORDION_TEMPLATE } from './accordion.js';
export { ACCORDION_ITEM_TEMPLATE } from './accordion-item.js';
export { TABS_TEMPLATE } from './tabs.js';
export { TAB_PANEL_TEMPLATE } from './tab-panel.js';

// Imports (add after toast imports):
import { ACCORDION_TEMPLATE } from './accordion.js';
import { ACCORDION_ITEM_TEMPLATE } from './accordion-item.js';
import { TABS_TEMPLATE } from './tabs.js';
import { TAB_PANEL_TEMPLATE } from './tab-panel.js';

// COMPONENT_TEMPLATES entries (add after toast entries):
accordion: ACCORDION_TEMPLATE,
'accordion/accordion-item': ACCORDION_ITEM_TEMPLATE,
tabs: TABS_TEMPLATE,
'tabs/tab-panel': TAB_PANEL_TEMPLATE,
```

**Critical template key mapping:** The copy-component.ts resolution chain tries: fileStem -> componentName/fileStem -> componentName. For a file `components/accordion/accordion-item.ts`:
- fileStem = "accordion-item" (no match in map)
- componentName/fileStem = "accordion/accordion-item" (MATCH)

So the key `'accordion/accordion-item'` is correct. Same logic for `'tabs/tab-panel'`.

**Update registry.json:**

Add two entries to the "components" array (after the existing toast entry):

```json
{
  "name": "accordion",
  "description": "Accessible accordion with single/multi-expand, collapsible mode, and CSS Grid height animation",
  "files": [
    { "path": "components/accordion/accordion.ts", "type": "component" },
    { "path": "components/accordion/accordion-item.ts", "type": "component" }
  ],
  "dependencies": [],
  "registryDependencies": []
},
{
  "name": "tabs",
  "description": "Accessible tabs with animated indicator, keyboard navigation, overflow scroll, and lazy panels",
  "files": [
    { "path": "components/tabs/tabs.ts", "type": "component" },
    { "path": "components/tabs/tab-panel.ts", "type": "component" }
  ],
  "dependencies": [],
  "registryDependencies": []
}
```
  </action>
  <verify>
Run `npx tsc --noEmit -p packages/cli/tsconfig.json` to verify all templates and index compile. Verify registry.json is valid JSON with `node -e "JSON.parse(require('fs').readFileSync('packages/cli/src/registry/registry.json', 'utf8'))"`. Check that COMPONENT_TEMPLATES map has entries for `accordion`, `accordion/accordion-item`, `tabs`, `tabs/tab-panel`.

**INTG-06 explicit verification — grep tabs.ts for ALL 25 CSS variables to confirm fallbacks present:**
```bash
for var in \
  "--ui-tabs-border" "--ui-tabs-list-gap" "--ui-tabs-list-padding" "--ui-tabs-list-bg" \
  "--ui-tabs-list-radius" "--ui-tabs-tab-bg" "--ui-tabs-tab-text" "--ui-tabs-tab-font-size" \
  "--ui-tabs-tab-font-weight" "--ui-tabs-tab-padding" "--ui-tabs-tab-radius" \
  "--ui-tabs-tab-hover-text" "--ui-tabs-tab-hover-bg" "--ui-tabs-tab-active-text" \
  "--ui-tabs-tab-active-bg" "--ui-tabs-tab-active-shadow" "--ui-tabs-panel-padding" \
  "--ui-tabs-panel-text" "--ui-tabs-ring" "--ui-tabs-transition" \
  "--ui-tabs-indicator-color" "--ui-tabs-indicator-height" "--ui-tabs-indicator-radius" \
  "--ui-tabs-indicator-transition" "--ui-tabs-scroll-button-size"; do
  grep -q "$var" packages/cli/src/templates/tabs.ts || echo "MISSING: $var"
done
```
If any variable prints "MISSING", add the fallback. All 25 must be present with fallback values.
  </verify>
  <done>
tabs.ts and tab-panel.ts template files exist with correct transformations. templates/index.ts exports all 4 new templates and maps them in COMPONENT_TEMPLATES with correct namespaced keys. registry.json has accordion and tabs entries with correct file paths and no dependencies.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit -p packages/cli/tsconfig.json` passes
2. `node -e "JSON.parse(require('fs').readFileSync('packages/cli/src/registry/registry.json', 'utf8'))"` succeeds
3. Grep confirms no `@lit-ui/core` imports in any of the 4 new template files
4. Grep confirms all 4 template files contain `customElements.define`
5. Grep confirms `COMPONENT_TEMPLATES` has entries: `accordion`, `accordion/accordion-item`, `tabs`, `tabs/tab-panel`
6. Grep confirms CSS variable fallback values present (e.g., `--ui-accordion-border, #e5e7eb` in accordion template)
7. Run the INTG-06 verification loop from Task 2's verify section — all 25 tabs CSS variables must be present with fallbacks in tabs.ts (no "MISSING" output)
</verification>

<success_criteria>
- 4 new template files created in packages/cli/src/templates/
- templates/index.ts exports and maps all 4 templates with correct namespaced keys
- registry.json has accordion and tabs entries with 2 files each
- All templates: import from ../../lib/lit-ui/tailwind-element, inline dispatchCustomEvent, include CSS variable fallbacks, self-register via customElements.define
- TypeScript compilation passes
</success_criteria>

<output>
After completion, create `.planning/phases/60-cli-and-documentation/60-01-SUMMARY.md`
</output>
