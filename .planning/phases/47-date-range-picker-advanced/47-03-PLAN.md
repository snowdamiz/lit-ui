---
phase: 47-date-range-picker-advanced
plan: 03
type: execute
wave: 2
depends_on: ["47-01"]
files_modified:
  - packages/date-range-picker/src/date-range-picker.ts
autonomous: true

must_haves:
  truths:
    - "User sees preset sidebar with Last 7 Days, Last 30 Days, This Month buttons when presets enabled"
    - "User clicks a preset button and the range is immediately set"
    - "User sees 'X days selected' duration text in popup footer when range is complete"
    - "Duration display shows inclusive day count (Jan 1 to Jan 7 = 7 days)"
    - "Preset buttons disabled when resolved range falls outside min/max constraints"
    - "Presets property accepts boolean | DateRangePreset[] (true uses defaults)"
  artifacts:
    - path: "packages/date-range-picker/src/date-range-picker.ts"
      provides: "Preset sidebar, duration display, presets property"
      contains: "effectivePresets"
  key_links:
    - from: "date-range-picker.ts"
      to: "range-preset-types.ts"
      via: "Import DateRangePreset, DEFAULT_RANGE_PRESETS"
      pattern: "import.*from './range-preset-types"
    - from: "date-range-picker.ts"
      to: "range-utils.ts"
      via: "Import computeRangeDuration for footer display"
      pattern: "import.*computeRangeDuration.*from './range-utils"
    - from: "handlePresetSelect"
      to: "validateAndEmit"
      via: "Preset click sets dates then validates and emits change event"
      pattern: "this.validateAndEmit"
---

<objective>
Add preset sidebar buttons and range duration display to the date range picker popup.

Purpose: Preset buttons provide one-click common ranges (DRP-16, DRP-17) and duration display shows "X days selected" (DRP-19), both essential for analytics-style date pickers.
Output: Updated date-range-picker.ts with preset sidebar, duration text in footer, and presets property.
</objective>

<execution_context>
@/Users/sn0w/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sn0w/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@packages/date-range-picker/src/date-range-picker.ts
@packages/date-range-picker/src/range-utils.ts
@packages/date-range-picker/src/range-preset-types.ts
@packages/date-picker/src/date-picker.ts
@.planning/phases/47-date-range-picker-advanced/47-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add presets property and preset handling logic</name>
  <files>packages/date-range-picker/src/date-range-picker.ts</files>
  <action>
    Add the presets property and preset handling to DateRangePicker:

    1. Import DateRangePreset and DEFAULT_RANGE_PRESETS from './range-preset-types.js'
    2. Import computeRangeDuration from './range-utils.js' (add to existing import)
    3. Import format from 'date-fns' (for formatting resolved preset dates to ISO strings) — already imported from @lit-ui/calendar, check if format is re-exported; if not, import from date-fns directly
    4. Import { isBefore as isBeforeDate, isAfter as isAfterDate, parseISO as parseISODate } from 'date-fns' if not already available for disabled preset checks

    Add property:
    ```typescript
    @property({ attribute: false })
    presets: DateRangePreset[] | boolean = false;
    ```
    Note: attribute: false because the value is an array/boolean, not serializable as HTML attribute. Matches Phase 45-02 decision.

    Add computed getter:
    ```typescript
    private get effectivePresets(): DateRangePreset[] {
      if (this.presets === true) return DEFAULT_RANGE_PRESETS;
      if (Array.isArray(this.presets)) return this.presets;
      return [];
    }
    ```

    Add preset selection handler:
    ```typescript
    private handlePresetSelect(preset: DateRangePreset): void {
      const { start, end } = preset.resolve();
      const startISO = format(start, 'yyyy-MM-dd');
      const endISO = format(end, 'yyyy-MM-dd');
      this.startDate = startISO;
      this.endDate = endISO;
      this.rangeState = 'complete';
      this.validateAndEmit();
    }
    ```

    Add preset disabled check (disable if resolved range falls outside min/max):
    ```typescript
    private isPresetDisabled(preset: DateRangePreset): boolean {
      const { start, end } = preset.resolve();
      if (this.minDate) {
        const min = parseISO(this.minDate);
        if (isBefore(start, min)) return true;
      }
      if (this.maxDate) {
        const max = parseISO(this.maxDate);
        if (isAfter(end, max)) return true;
      }
      return false;
    }
    ```
    Use isBefore/isAfter from date-fns (already imported or add to imports).
  </action>
  <verify>cd packages/date-range-picker && npx tsc --noEmit</verify>
  <done>presets property, effectivePresets getter, handlePresetSelect, and isPresetDisabled methods exist</done>
</task>

<task type="auto">
  <name>Task 2: Add preset sidebar UI and duration display in popup</name>
  <files>packages/date-range-picker/src/date-range-picker.ts</files>
  <action>
    Update renderCalendarContent() and styles for preset sidebar and duration display.

    1. Add durationText getter:
    ```typescript
    get durationText(): string {
      if (this.rangeState !== 'complete' || !this.startDate || !this.endDate) return '';
      const days = computeRangeDuration(this.startDate, this.endDate);
      return `${days} day${days === 1 ? '' : 's'} selected`;
    }
    ```

    2. Update renderCalendarContent() to wrap calendars and presets in a popup-body flex container:
    ```
    <div class="range-header">...</div>
    <div class="popup-body">
      ${this.effectivePresets.length > 0
        ? html`
          <div class="preset-sidebar">
            ${this.effectivePresets.map(preset => html`
              <button
                type="button"
                class="preset-button"
                ?disabled="${this.isPresetDisabled(preset)}"
                @click="${() => this.handlePresetSelect(preset)}"
              >${preset.label}</button>
            `)}
          </div>
        ` : nothing}
      <div class="calendars-wrapper ${this.isDragging ? 'dragging' : ''}" @mouseleave="${this.clearHoverPreview}">
        ...existing calendars...
      </div>
    </div>
    <div class="popup-footer">
      <span class="footer-status">${this.durationText || this.selectionStatus}</span>
      ...existing clear button...
    </div>
    ```

    Note: The durationText takes priority over selectionStatus in the footer. When a range is complete, show "X days selected". Otherwise, show the selection status prompt.

    3. Add CSS styles for preset sidebar and popup-body:
    ```css
    .popup-body {
      display: flex;
    }

    .preset-sidebar {
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
      padding: 0.5rem;
      border-right: 1px solid var(--ui-date-picker-popup-border, #e5e7eb);
      min-width: 120px;
    }

    .preset-button {
      font-size: 0.75rem;
      padding: 0.375rem 0.75rem;
      border: none;
      border-radius: 0.25rem;
      background: transparent;
      color: var(--ui-date-picker-text, var(--ui-input-text, inherit));
      cursor: pointer;
      text-align: left;
      white-space: nowrap;
      transition: background-color 150ms;
    }

    .preset-button:hover:not(:disabled) {
      background-color: var(--color-muted, #f3f4f6);
    }

    .preset-button:focus-visible {
      outline: 2px solid var(--color-ring, #3b82f6);
      outline-offset: 1px;
    }

    .preset-button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    ```

    4. Add container query for narrow containers — stack presets above calendars:
    ```css
    @container (max-width: 599px) {
      .popup-body {
        flex-direction: column;
      }
      .preset-sidebar {
        flex-direction: row;
        flex-wrap: wrap;
        border-right: none;
        border-bottom: 1px solid var(--ui-date-picker-popup-border, #e5e7eb);
      }
    }
    ```
    Note: This container query rule needs to be integrated with the existing @container (max-width: 599px) block that already handles .calendars-wrapper stacking.
  </action>
  <verify>
    1. cd packages/date-range-picker && npx tsc --noEmit
    2. pnpm --filter @lit-ui/date-range-picker build
  </verify>
  <done>
    - Preset sidebar renders when presets property is set (boolean or array)
    - Preset buttons call handlePresetSelect on click, setting the range
    - Duration text shows "X days selected" in footer when range is complete
    - Preset sidebar layout is vertical (left of calendars), stacks horizontally on narrow containers
    - Disabled presets have 0.5 opacity and not-allowed cursor
  </done>
</task>

</tasks>

<verification>
1. `cd packages/date-range-picker && npx tsc --noEmit` — TypeScript compiles
2. `pnpm --filter @lit-ui/date-range-picker build` — builds successfully
3. `pnpm --filter @lit-ui/date-range-picker test` — existing tests still pass
4. Footer shows "X days selected" (inclusive count) when range is complete
5. Preset sidebar visible when presets=true or presets=[...] is set
</verification>

<success_criteria>
- presets property accepts boolean | DateRangePreset[]
- Preset sidebar renders with clickable buttons
- Clicking a preset sets the full range and dispatches change event
- Duration text shows inclusive day count in popup footer
- Container query stacks presets horizontally on narrow containers
- Disabled presets when range falls outside min/max constraints
</success_criteria>

<output>
After completion, create `.planning/phases/47-date-range-picker-advanced/47-03-SUMMARY.md`
</output>
