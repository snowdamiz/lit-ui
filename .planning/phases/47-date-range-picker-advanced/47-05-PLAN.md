---
phase: 47-date-range-picker-advanced
plan: 05
type: execute
wave: 4
depends_on: ["47-04"]
files_modified:
  - packages/date-range-picker/src/date-range-picker.ts
  - packages/date-range-picker/src/index.ts
  - packages/date-range-picker/src/jsx.d.ts
autonomous: true

must_haves:
  truths:
    - "All new UI elements (preset sidebar, comparison toggle, preset buttons) have dark mode styles"
    - "Comparison range highlight colors have dark mode overrides"
    - "New types and utilities are exported from package index"
    - "JSX types include comparison and presets attributes"
    - "Component renders via SSR without errors (no browser-only APIs called on server)"
  artifacts:
    - path: "packages/date-range-picker/src/date-range-picker.ts"
      provides: "Dark mode styles for all Phase 47 UI additions"
      contains: ":host-context(.dark) .preset-sidebar"
    - path: "packages/date-range-picker/src/index.ts"
      provides: "Updated exports for range-preset-types and computeRangeDuration"
      exports: ["DateRangePreset", "DEFAULT_RANGE_PRESETS", "computeRangeDuration"]
    - path: "packages/date-range-picker/src/jsx.d.ts"
      provides: "Updated JSX types with comparison and presets attributes"
      contains: "comparison"
  key_links:
    - from: "index.ts"
      to: "range-preset-types.ts"
      via: "Re-export types and defaults"
      pattern: "export.*from './range-preset-types"
    - from: "jsx.d.ts"
      to: "date-range-picker.ts"
      via: "JSX attributes match component properties"
      pattern: "compare-start-date|compare-end-date|comparison"
---

<objective>
Complete Phase 47 with dark mode styles for all new UI elements, updated exports, and JSX types.

Purpose: Ensure all new features (presets, drag, comparison) have dark mode support (DRP-21), SSR compatibility (DRP-22), and proper TypeScript declarations for framework consumers.
Output: Updated dark mode styles, exports, and JSX types. Phase 47 complete.
</objective>

<execution_context>
@/Users/sn0w/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sn0w/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@packages/date-range-picker/src/date-range-picker.ts
@packages/date-range-picker/src/index.ts
@packages/date-range-picker/src/jsx.d.ts
@.planning/phases/47-date-range-picker-advanced/47-04-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add dark mode styles for all new UI elements</name>
  <files>packages/date-range-picker/src/date-range-picker.ts</files>
  <action>
    Add :host-context(.dark) overrides for every new CSS class added in Plans 02-04. Follow the existing dark mode pattern in the component (there are ~20 existing dark mode rules to match).

    Add the following dark mode rules to the static styles:

    1. Preset sidebar:
    ```css
    :host-context(.dark) .preset-sidebar {
      border-right-color: var(--ui-date-picker-popup-border, #374151);
    }
    ```

    2. Preset buttons:
    ```css
    :host-context(.dark) .preset-button {
      color: var(--ui-date-picker-text, var(--ui-input-text, #f9fafb));
    }

    :host-context(.dark) .preset-button:hover:not(:disabled) {
      background-color: var(--color-muted, #1f2937);
    }
    ```

    3. Comparison toggle:
    ```css
    :host-context(.dark) .comparison-toggle {
      border-bottom-color: var(--ui-date-picker-popup-border, #374151);
    }

    :host-context(.dark) .toggle-button {
      border-color: var(--ui-date-picker-border, var(--ui-input-border, #4b5563));
      color: var(--ui-date-picker-text, var(--ui-input-text, #f9fafb));
    }

    :host-context(.dark) .toggle-button:hover {
      background-color: var(--color-muted, #1f2937);
    }
    ```

    4. Comparison range colors (dark mode overrides for inline styles via CSS custom properties):
    The comparison range inline styles use CSS custom properties that cascade through Shadow DOM. Override them in dark mode:
    ```css
    :host-context(.dark) {
      --ui-range-compare-highlight-bg: #78350f;
      --ui-range-compare-preview-bg: #451a03;
    }
    ```

    5. Container query dark mode for stacked preset sidebar:
    ```css
    @container (max-width: 599px) {
      :host-context(.dark) .preset-sidebar {
        border-bottom-color: var(--ui-date-picker-popup-border, #374151);
      }
    }
    ```
    Note: This may need to be structured as `:host-context(.dark) .preset-sidebar` inside the container query, or the container query inside :host-context. Check what works with the existing pattern. If container queries cannot nest inside :host-context, add a separate container query block for dark mode.

    6. SSR verification: Review all new code for browser-only API usage. The new features use:
    - Pointer events: Only fire on user interaction (no SSR issue)
    - renderRangeDay: Only called during client rendering (no SSR issue)
    - Preset resolve(): Only called on click (no SSR issue)
    - No new document.addEventListener or window usage
    Confirm no additional isServer guards are needed beyond what already exists.
  </action>
  <verify>
    1. cd packages/date-range-picker && npx tsc --noEmit
    2. pnpm --filter @lit-ui/date-range-picker build
  </verify>
  <done>
    - Every new CSS class has a corresponding :host-context(.dark) override
    - Comparison range highlight/preview colors have dark mode overrides via CSS custom properties
    - No browser-only APIs called during SSR
  </done>
</task>

<task type="auto">
  <name>Task 2: Update exports and JSX types</name>
  <files>packages/date-range-picker/src/index.ts, packages/date-range-picker/src/jsx.d.ts</files>
  <action>
    1. Update index.ts to export new types and utilities:
    ```typescript
    // Add to existing exports:
    export { DateRangePreset, DEFAULT_RANGE_PRESETS } from './range-preset-types.js';
    export type { DateRangePreset } from './range-preset-types.js';
    ```
    Note: Export the interface as type export and the constant as value export.
    Also add computeRangeDuration to the existing range-utils re-exports:
    ```typescript
    export {
      isDateInRange,
      isDateInPreview,
      validateRangeDuration,
      formatISOInterval,
      normalizeRange,
      computeRangeDuration,  // NEW
    } from './range-utils.js';
    ```

    2. Update jsx.d.ts to include new attributes:
    Add to LuiDateRangePickerAttributes:
    ```typescript
    comparison?: boolean;
    'compare-start-date'?: string;
    'compare-end-date'?: string;
    ```
    Note: presets is JS-only (attribute: false), so it does NOT go in the HTML attributes interface. It's a JS property set via dot syntax.

    Update LuiDateRangePickerEvents to include the extended event payload:
    ```typescript
    interface LuiDateRangePickerEvents {
      onChange?: (e: CustomEvent<{
        startDate: string;
        endDate: string;
        isoInterval: string;
        compareStartDate?: string;
        compareEndDate?: string;
        compareIsoInterval?: string;
      }>) => void;
    }
    ```

    Update Svelte event handler type similarly.
  </action>
  <verify>
    1. cd packages/date-range-picker && npx tsc --noEmit
    2. pnpm --filter @lit-ui/date-range-picker build
    3. pnpm --filter @lit-ui/date-range-picker test
  </verify>
  <done>
    - index.ts exports DateRangePreset, DEFAULT_RANGE_PRESETS, computeRangeDuration
    - jsx.d.ts includes comparison, compare-start-date, compare-end-date attributes
    - JSX event types include optional comparison fields
    - All builds and tests pass
  </done>
</task>

</tasks>

<verification>
1. `cd packages/date-range-picker && npx tsc --noEmit` — TypeScript compiles
2. `pnpm --filter @lit-ui/date-range-picker build` — builds successfully
3. `pnpm --filter @lit-ui/date-range-picker test` — all tests pass
4. Grep for `:host-context(.dark)` in date-range-picker.ts confirms dark mode coverage for new classes
5. index.ts exports DateRangePreset, DEFAULT_RANGE_PRESETS, computeRangeDuration
6. jsx.d.ts includes comparison attributes
</verification>

<success_criteria>
- All new UI elements have dark mode styles via :host-context(.dark)
- Comparison range colors have dark mode overrides
- New types and utilities exported from package index
- JSX types updated with comparison attributes and extended event payload
- SSR compatible (no browser-only API calls on server)
- All builds and tests pass
</success_criteria>

<output>
After completion, create `.planning/phases/47-date-range-picker-advanced/47-05-SUMMARY.md`
</output>
