---
phase: 47-date-range-picker-advanced
plan: 01
type: tdd
wave: 1
depends_on: []
files_modified:
  - packages/date-range-picker/src/range-preset-types.ts
  - packages/date-range-picker/src/range-utils.ts
  - packages/date-range-picker/src/range-utils.test.ts
autonomous: true

must_haves:
  truths:
    - "DateRangePreset interface exists with label and resolve() returning { start: Date, end: Date }"
    - "DEFAULT_RANGE_PRESETS contains Last 7 Days, Last 30 Days, This Month presets"
    - "computeRangeDuration returns inclusive day count (differenceInCalendarDays + 1)"
    - "computeRangeDuration returns 0 for missing dates"
  artifacts:
    - path: "packages/date-range-picker/src/range-preset-types.ts"
      provides: "DateRangePreset interface and DEFAULT_RANGE_PRESETS"
      exports: ["DateRangePreset", "DEFAULT_RANGE_PRESETS"]
    - path: "packages/date-range-picker/src/range-utils.ts"
      provides: "computeRangeDuration utility function"
      exports: ["computeRangeDuration"]
    - path: "packages/date-range-picker/src/range-utils.test.ts"
      provides: "Tests for computeRangeDuration"
      contains: "describe('computeRangeDuration'"
  key_links:
    - from: "range-preset-types.ts"
      to: "date-fns"
      via: "subDays, startOfDay, startOfMonth, endOfMonth imports"
      pattern: "import.*from 'date-fns'"
    - from: "range-utils.ts"
      to: "date-fns"
      via: "differenceInCalendarDays for duration computation"
      pattern: "differenceInCalendarDays"
---

<objective>
Create the DateRangePreset type system and computeRangeDuration utility using TDD.

Purpose: Establish the type foundation and pure utility functions needed by preset buttons and duration display. Following the TDD approach ensures correctness for inclusive day counting (Pitfall 5: off-by-one).
Output: range-preset-types.ts with interface + defaults, computeRangeDuration in range-utils.ts, tests passing.
</objective>

<execution_context>
@/Users/sn0w/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sn0w/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@packages/date-range-picker/src/range-utils.ts
@packages/date-range-picker/src/range-utils.test.ts
@packages/date-picker/src/preset-types.ts
</context>

<feature>
  <name>computeRangeDuration</name>
  <files>packages/date-range-picker/src/range-utils.ts, packages/date-range-picker/src/range-utils.test.ts</files>
  <behavior>
    computeRangeDuration(startISO, endISO) -> number (inclusive day count)
    Cases:
    - ('2026-01-10', '2026-01-10') -> 1 (single day)
    - ('2026-01-10', '2026-01-16') -> 7 (7 days inclusive)
    - ('2026-01-01', '2026-01-31') -> 31
    - ('', '2026-01-10') -> 0 (missing start)
    - ('2026-01-10', '') -> 0 (missing end)
    - ('', '') -> 0 (both missing)
  </behavior>
  <implementation>
    Use differenceInCalendarDays(end, start) + 1 for inclusive counting, matching the pattern already used in validateRangeDuration. Return 0 for missing inputs.
  </implementation>
</feature>

<tasks>

<task type="auto">
  <name>Task 1: Create DateRangePreset types and DEFAULT_RANGE_PRESETS</name>
  <files>packages/date-range-picker/src/range-preset-types.ts</files>
  <action>
    Create range-preset-types.ts following the exact pattern from packages/date-picker/src/preset-types.ts but adapted for ranges:

    1. Import subDays, startOfDay, startOfMonth, endOfMonth from 'date-fns'
    2. Define DateRangePreset interface:
       - label: string
       - resolve: () => { start: Date; end: Date }
    3. Define DEFAULT_RANGE_PRESETS array with three presets:
       - 'Last 7 Days': resolve returns { start: subDays(startOfDay(new Date()), 6), end: startOfDay(new Date()) }
       - 'Last 30 Days': resolve returns { start: subDays(startOfDay(new Date()), 29), end: startOfDay(new Date()) }
       - 'This Month': resolve returns { start: startOfMonth(new Date()), end: endOfMonth(new Date()) }
    4. Export both DateRangePreset and DEFAULT_RANGE_PRESETS

    Key: resolve() functions are called at click time (not import time) for SSR safety. This matches Phase 45-01 decision.
  </action>
  <verify>TypeScript compiles without errors: cd packages/date-range-picker && npx tsc --noEmit</verify>
  <done>range-preset-types.ts exists with DateRangePreset interface and 3 default presets exported</done>
</task>

<task type="auto">
  <name>Task 2: TDD computeRangeDuration utility</name>
  <files>packages/date-range-picker/src/range-utils.ts, packages/date-range-picker/src/range-utils.test.ts</files>
  <action>
    RED phase:
    1. Add a new describe('computeRangeDuration') block to range-utils.test.ts
    2. Import computeRangeDuration from './range-utils.js'
    3. Write tests for all cases:
       - Single day range ('2026-01-10', '2026-01-10') -> 1
       - 7-day range ('2026-01-10', '2026-01-16') -> 7
       - Full month ('2026-01-01', '2026-01-31') -> 31
       - Missing start ('', '2026-01-10') -> 0
       - Missing end ('2026-01-10', '') -> 0
       - Both missing ('', '') -> 0
    4. Run tests — they MUST fail (computeRangeDuration doesn't exist yet)
    5. Commit: test(47-01): add failing tests for computeRangeDuration

    GREEN phase:
    1. Add computeRangeDuration function to range-utils.ts:
       - Import differenceInCalendarDays, parseISO, startOfDay from 'date-fns' (already imported)
       - If !startISO or !endISO, return 0
       - Parse both dates, compute differenceInCalendarDays(end, start) + 1
       - Return the result
    2. Export computeRangeDuration from range-utils.ts
    3. Run tests — they MUST pass
    4. Commit: feat(47-01): implement computeRangeDuration utility

    Note: differenceInCalendarDays and parseISO are already imported in range-utils.ts. startOfDay is also already imported. Just add the function.
  </action>
  <verify>pnpm --filter @lit-ui/date-range-picker test (all existing + new tests pass)</verify>
  <done>computeRangeDuration is exported from range-utils.ts, all 6 new tests + existing tests pass</done>
</task>

</tasks>

<verification>
1. `pnpm --filter @lit-ui/date-range-picker test` — all tests pass (existing + new computeRangeDuration tests)
2. `cd packages/date-range-picker && npx tsc --noEmit` — TypeScript compiles without errors
3. range-preset-types.ts exports DateRangePreset interface and DEFAULT_RANGE_PRESETS array
4. range-utils.ts exports computeRangeDuration function
</verification>

<success_criteria>
- DateRangePreset interface with label:string and resolve:()=>{start:Date,end:Date}
- DEFAULT_RANGE_PRESETS has 3 entries: Last 7 Days, Last 30 Days, This Month
- computeRangeDuration returns inclusive day count (7 days = 7, not 6)
- computeRangeDuration returns 0 for empty inputs
- All tests pass
</success_criteria>

<output>
After completion, create `.planning/phases/47-date-range-picker-advanced/47-01-SUMMARY.md`
</output>
