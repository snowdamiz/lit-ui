---
phase: 66-cell-renderers-row-actions-bulk-actions
plan: 02
type: execute
wave: 2
depends_on: ["66-01"]
files_modified:
  - packages/data-table/src/data-table.ts
  - packages/data-table/src/index.ts
autonomous: true

must_haves:
  truths:
    - "DataTable has rowActions property accepting RowAction[] array"
    - "DataTable has hoverRevealActions boolean attribute for ACT-02"
    - "Row actions column renders inline buttons for 1-2 actions or kebab menu for 3+"
    - "Row actions column merges with row edit actions — shows kebab in view mode, save/cancel in edit mode"
    - "Clicking a row action dispatches ui-row-action event with actionId and row data"
    - "Hover-reveal hides actions until row hover or focus-within"
    - "Keyboard navigation column count includes row actions column"
    - "Cell renderers module and row actions are exported from index.ts"
  artifacts:
    - path: "packages/data-table/src/data-table.ts"
      provides: "Row actions integration — properties, rendering, events"
      contains: "rowActions"
    - path: "packages/data-table/src/index.ts"
      provides: "Exports for cell-renderers.ts and row-actions.ts"
      contains: "cell-renderers"
  key_links:
    - from: "packages/data-table/src/data-table.ts"
      to: "packages/data-table/src/row-actions.ts"
      via: "import renderRowActions, rowActionsStyles"
      pattern: "import.*renderRowActions.*row-actions"
    - from: "packages/data-table/src/data-table.ts"
      to: "packages/data-table/src/cell-renderers.ts"
      via: "import cellRendererStyles"
      pattern: "import.*cellRendererStyles.*cell-renderers"
    - from: "packages/data-table/src/data-table.ts"
      to: "ui-row-action event dispatch"
      via: "CustomEvent dispatch in handleRowAction"
      pattern: "ui-row-action"
---

<objective>
Integrate row actions and cell renderer styles into the DataTable component. This wires the standalone modules from Plan 01 into the data table rendering, event dispatching, and keyboard navigation.

Purpose: Fulfills CELL-01 through CELL-04 (cell renderers available), ACT-01 through ACT-04 (row actions working).

Output:
- DataTable component gains `rowActions` property, `hoverRevealActions` attribute, and `ui-row-action` event
- Actions column merges with existing row edit actions column (unified column)
- Cell renderer styles included in DataTable static styles
- All cell renderer and row action exports added to index.ts
</objective>

<execution_context>
@/Users/sn0w/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sn0w/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md

@packages/data-table/src/data-table.ts
@packages/data-table/src/inline-editing.ts
@packages/data-table/src/index.ts
@packages/data-table/src/types.ts

@.planning/phases/66-cell-renderers-row-actions-bulk-actions/66-01-SUMMARY.md
@.planning/phases/66-cell-renderers-row-actions-bulk-actions/66-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Integrate row actions into DataTable component</name>
  <files>
    packages/data-table/src/data-table.ts
  </files>
  <action>
Modify `data-table.ts` to add row actions support. This is the main integration task.

**1. Add imports:**
- Import `renderRowActions, rowActionsStyles` from `'./row-actions.js'`
- Import `cellRendererStyles` from `'./cell-renderers.js'`
- Import `type RowAction, type RowActionEvent` from `'./types.js'` (add to existing type import)

**2. Add properties** (in the inline editing state section or a new "Row actions" section after it):

```typescript
// ==========================================================================
// Row Actions (ACT-*)
// ==========================================================================

/**
 * Array of row actions to display in the actions column.
 * For 1-2 actions: renders inline icon buttons.
 * For 3+: renders kebab menu with dropdown.
 */
@property({ type: Array })
rowActions: RowAction<TData>[] = [];

/**
 * When true, row action buttons are hidden until row is hovered or focused.
 * Always visible on touch devices via @media (hover: none).
 * @default false
 */
@property({ type: Boolean, attribute: 'hover-reveal-actions', reflect: true })
hoverRevealActions = false;
```

**3. Add `hasActionsColumn` computed getter:**

The actions column should be unified — it shows:
- Row actions (kebab or inline buttons) when NOT editing
- Row edit save/cancel when the row IS in edit mode (if enableRowEditing is also true)
- Nothing if neither rowActions nor enableRowEditing is configured

```typescript
/**
 * Whether an actions column should be rendered.
 * True when rowActions are configured OR enableRowEditing is true.
 */
private get hasActionsColumn(): boolean {
  return this.rowActions.length > 0 || this.enableRowEditing;
}
```

**4. Modify `getGridTemplateColumns`:**

Replace the existing `rowEditSuffix` logic with the unified actions column:

```typescript
// Change:
const rowEditSuffix = this.enableRowEditing ? ' 72px' : '';
// To:
const actionsColumnSuffix = this.hasActionsColumn ? ' 72px' : '';
```

Then replace all uses of `rowEditSuffix` with `actionsColumnSuffix` in that method.

**5. Modify `renderAllRows`:**

Replace the existing `enableRowEditing` conditional block at the end of each row with unified actions column rendering:

```typescript
${this.hasActionsColumn ? html`
  <div class="data-table-cell row-actions-cell" role="gridcell">
    <div class="row-actions-content">
      ${isRowEditing
        ? renderRowEditActions(true, {
            onEdit: () => this.activateRowEdit(row),
            onSave: () => this.saveRowEdit(),
            onCancel: () => this.cancelRowEdit(),
          })
        : this.enableRowEditing && !this.rowActions.length
          ? renderRowEditActions(false, {
              onEdit: () => this.activateRowEdit(row),
              onSave: () => this.saveRowEdit(),
              onCancel: () => this.cancelRowEdit(),
            })
          : this.rowActions.length > 0
            ? renderRowActions(row, this.rowActions, (actionId, r) => this.handleRowAction(actionId, r))
            : nothing
      }
    </div>
  </div>
` : nothing}
```

Simplify the logic: if isRowEditing, always show edit actions. Otherwise, if rowActions exist show row actions. If only enableRowEditing (no rowActions), show pencil trigger. The key decision tree:
- `isRowEditing` → save/cancel buttons (via renderRowEditActions with isEditing=true)
- `!isRowEditing && rowActions.length > 0 && enableRowEditing` → show kebab/inline actions WITH edit action included (developer should include createEditAction in their rowActions if they want the pencil in the kebab; the row edit activation is triggered by the `edit` action ID)
- `!isRowEditing && rowActions.length > 0 && !enableRowEditing` → just show rowActions
- `!isRowEditing && rowActions.length === 0 && enableRowEditing` → pencil trigger (existing behavior)

**6. Apply same change in `renderVirtualizedBody`:**

The same actions column conditional from step 5 must be replicated in the virtualItems.map() section.

**7. Apply same change in `renderHeader`:**

Find where the header renders the empty cell for `enableRowEditing`. Change it to use `this.hasActionsColumn` instead:

```typescript
// Change:
${this.enableRowEditing ? html`<div class="..."></div>` : nothing}
// To:
${this.hasActionsColumn ? html`<div class="data-table-header-cell row-actions-header" role="columnheader" aria-label="Actions"></div>` : nothing}
```

**8. Add handleRowAction method:**

```typescript
/**
 * Handle row action click. Dispatches ui-row-action event.
 * Special handling: if actionId is 'edit' and enableRowEditing is true,
 * activates row edit mode instead of dispatching event.
 */
private handleRowAction(actionId: string, row: Row<TData>): void {
  // Special case: built-in edit action triggers row edit mode
  if (actionId === 'edit' && this.enableRowEditing) {
    this.activateRowEdit(row);
    return;
  }

  const event = new CustomEvent<RowActionEvent<TData>>('ui-row-action', {
    detail: {
      actionId,
      row: row.original,
      rowId: row.id,
    },
    bubbles: true,
    composed: true,
  });
  this.dispatchEvent(event);
}
```

**9. Update keyboard navigation bounds in `updated()`:**

In the `updated()` method, find the colCount calculation:

```typescript
// Change:
if (this.enableRowEditing) colCount += 1;
// To:
if (this.hasActionsColumn) colCount += 1;
```

Also add `changedProperties.has('rowActions')` to the condition that triggers bounds update.

**10. Update ARIA colCount in render():**

```typescript
// Change:
const colCount = effectiveColumns.length + (this.enableRowEditing ? 1 : 0);
// To:
const colCount = effectiveColumns.length + (this.hasActionsColumn ? 1 : 0);
```

**11. Add CSS styles:**

Add `cellRendererStyles` and `rowActionsStyles` to the `static override styles` array:

```typescript
static override styles = [
  ...tailwindBaseStyles,
  columnPickerStyles,
  inlineEditingStyles,
  cellRendererStyles,    // ADD
  rowActionsStyles,      // ADD
  css`...`
];
```
  </action>
  <verify>
Run `npx tsc --noEmit --project packages/data-table/tsconfig.json` — should compile with no errors.
Verify data-table.ts has `rowActions` property, `hoverRevealActions` attribute, `handleRowAction` method.
Verify `hasActionsColumn` getter unifies row edit and row actions column.
Verify `getGridTemplateColumns` uses `actionsColumnSuffix`.
Verify both `renderAllRows` and `renderVirtualizedBody` render the unified actions column.
  </verify>
  <done>
DataTable renders a unified actions column supporting both row actions and row edit actions. Row action clicks dispatch `ui-row-action` events with row data. Keyboard navigation accounts for the actions column. Hover-reveal CSS is active when `hover-reveal-actions` attribute is set.
  </done>
</task>

<task type="auto">
  <name>Task 2: Export cell renderers and row actions from index.ts</name>
  <files>
    packages/data-table/src/index.ts
  </files>
  <action>
Add exports for the new modules to `index.ts`:

```typescript
// Cell renderers (built-in + type)
export {
  type CellRenderer,
  textCellRenderer,
  numberCellRenderer,
  dateCellRenderer,
  booleanCellRenderer,
  badgeCellRenderer,
  progressCellRenderer,
  avatarCellRenderer,
  cellRendererStyles,
} from './cell-renderers.js';

// Row actions (rendering + pre-built factories)
export {
  renderRowActions,
  createViewAction,
  createEditAction,
  createDeleteAction,
  rowActionsStyles,
  kebabIcon,
} from './row-actions.js';
```

Place these after the existing inline editing exports.

Also ensure types.ts re-exports are picking up the new types. Since `index.ts` already has `export * from './types.js'`, the RowAction, BulkAction, RowActionEvent, and BulkActionEvent interfaces will be automatically exported. Verify this is the case.
  </action>
  <verify>
Run `npx tsc --noEmit --project packages/data-table/tsconfig.json` — should compile with no errors.
Check that `import { badgeCellRenderer, createViewAction, RowAction, BulkAction } from '@lit-ui/data-table'` would resolve correctly by inspecting the index.ts exports.
  </verify>
  <done>
All cell renderer factories, row action utilities, and new type interfaces are exported from the package entry point. Developers can import everything from `@lit-ui/data-table`.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit --project packages/data-table/tsconfig.json` passes
2. DataTable with `rowActions=[createViewAction(), createEditAction(), createDeleteAction()]` would render a kebab menu
3. DataTable with `rowActions=[createEditAction()]` renders an inline edit button
4. DataTable with `enableRowEditing` only (no rowActions) still shows pencil trigger (backward compatible)
5. DataTable with both `rowActions` and `enableRowEditing` shows row actions in view mode, save/cancel in edit mode
6. `ui-row-action` event fires with correct actionId and row data
7. `hover-reveal-actions` attribute toggles CSS hover-reveal behavior
8. Keyboard nav bounds include actions column when present
9. All new exports available from `@lit-ui/data-table` package entry
</verification>

<success_criteria>
Row actions render correctly in both virtualized and non-virtualized modes. The unified actions column handles all combinations of rowActions + enableRowEditing. Events dispatch with proper detail. Hover-reveal works via CSS with keyboard and touch fallbacks. All exports compile and resolve.
</success_criteria>

<output>
After completion, create `.planning/phases/66-cell-renderers-row-actions-bulk-actions/66-02-SUMMARY.md`
</output>
