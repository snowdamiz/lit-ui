---
phase: 66-cell-renderers-row-actions-bulk-actions
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - packages/data-table/src/types.ts
  - packages/data-table/src/cell-renderers.ts
  - packages/data-table/src/row-actions.ts
autonomous: true

must_haves:
  truths:
    - "RowAction, BulkAction, RowActionEvent, BulkActionEvent types are exported from types.ts"
    - "CellRenderer type alias is exported from cell-renderers.ts"
    - "Seven built-in cell renderer factories exist: text, number, date, boolean, badge, progress, avatar"
    - "Each built-in renderer returns a function compatible with TanStack CellContext"
    - "renderRowActions function renders inline buttons for 1-2 actions and kebab menu for 3+"
    - "Pre-built view, edit, delete action factories are exported"
    - "Row actions kebab menu uses lui-popover for dropdown"
  artifacts:
    - path: "packages/data-table/src/types.ts"
      provides: "RowAction, BulkAction, RowActionEvent, BulkActionEvent interfaces"
      contains: "interface RowAction"
    - path: "packages/data-table/src/cell-renderers.ts"
      provides: "Built-in cell renderer factory functions"
      exports: ["CellRenderer", "textCellRenderer", "numberCellRenderer", "dateCellRenderer", "booleanCellRenderer", "badgeCellRenderer", "progressCellRenderer", "avatarCellRenderer"]
    - path: "packages/data-table/src/row-actions.ts"
      provides: "Row actions rendering and pre-built action factories"
      exports: ["renderRowActions", "createViewAction", "createEditAction", "createDeleteAction", "rowActionsStyles", "kebabIcon"]
  key_links:
    - from: "packages/data-table/src/cell-renderers.ts"
      to: "@tanstack/lit-table"
      via: "CellContext type import"
      pattern: "import.*CellContext.*@tanstack/lit-table"
    - from: "packages/data-table/src/row-actions.ts"
      to: "packages/data-table/src/types.ts"
      via: "RowAction type import"
      pattern: "import.*RowAction.*types"
---

<objective>
Create the standalone modules for cell renderers, row action types, and row action rendering — all independent of the DataTable component itself.

Purpose: These modules provide the building blocks that Plans 02 and 03 will integrate into `lui-data-table`. By isolating type definitions and factory functions first, we keep the DataTable modification plans focused on integration only.

Output:
- `types.ts` extended with RowAction, BulkAction, RowActionEvent, BulkActionEvent interfaces
- `cell-renderers.ts` — 7 built-in cell renderer factory functions with CSS styles
- `row-actions.ts` — Row actions rendering (inline + kebab) with pre-built action factories and CSS styles
</objective>

<execution_context>
@/Users/sn0w/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sn0w/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@packages/data-table/src/types.ts
@packages/data-table/src/selection-column.ts
@packages/data-table/src/inline-editing.ts
@packages/data-table/src/index.ts

@.planning/phases/66-cell-renderers-row-actions-bulk-actions/66-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add action types to types.ts and create cell-renderers.ts</name>
  <files>
    packages/data-table/src/types.ts
    packages/data-table/src/cell-renderers.ts
  </files>
  <action>
**1a. Extend types.ts** — Add the following interfaces and types at the bottom of the file (after the existing RowEditEvent interface), in a new section with a clear section header comment:

```typescript
// =============================================================================
// Row Actions Types (ACT-*)
// =============================================================================

/** Configuration for a single row action */
export interface RowAction<TData extends RowData = RowData> {
  id: string;
  label: string;
  icon?: TemplateResult | string;
  variant?: 'default' | 'destructive';
  disabled?: boolean | ((row: TData) => boolean);
  hidden?: boolean | ((row: TData) => boolean);
}

/** Event detail for row action events (ACT-03) */
export interface RowActionEvent<TData extends RowData = RowData> {
  actionId: string;
  row: TData;
  rowId: string;
}

// =============================================================================
// Bulk Actions Types (BULK-*)
// =============================================================================

/** Configuration for a bulk action */
export interface BulkAction {
  id: string;
  label: string;
  icon?: TemplateResult | string;
  variant?: 'default' | 'destructive';
  requiresConfirmation?: boolean;
  confirmTitle?: string;
  confirmMessage?: string | ((count: number) => string);
  confirmLabel?: string;
}

/** Event detail for bulk action events (BULK-05) */
export interface BulkActionEvent<TData extends RowData = RowData> {
  actionId: string;
  selectedRows: TData[];
  rowSelection: RowSelectionState;
  selectedCount: number;
}
```

Add `import type { TemplateResult } from 'lit';` at the top of types.ts (it's not currently imported).

**1b. Create cell-renderers.ts** — New file with all 7 built-in cell renderer factories plus CSS styles. Follow the exact pattern from the research document:

- Import `html, css, nothing, type TemplateResult` from 'lit', `type CellContext, RowData` from '@tanstack/lit-table'
- Export a `CellRenderer<TData, TValue>` type alias: `(info: CellContext<TData, TValue>) => TemplateResult`
- Implement these factory functions (each returns a `CellRenderer`):
  1. `textCellRenderer()` — Wraps value in `<span class="cell-text">`, handles null as empty string
  2. `numberCellRenderer(options?)` — Uses `Intl.NumberFormat`, supports `locale`, `decimals`, `prefix`, `suffix`. Shows em-dash for null.
  3. `dateCellRenderer(options?)` — Uses `Intl.DateTimeFormat`, supports `locale`, `format` (DateTimeFormatOptions). Handles both Date and string inputs. Shows em-dash for null/invalid.
  4. `booleanCellRenderer(options?)` — Renders check SVG for true, X SVG for false. Supports `trueLabel` and `falseLabel` for `aria-label`.
  5. `badgeCellRenderer(options?)` — Renders `<span class="cell-badge cell-badge--{color}">`. Supports `colorMap` (Record<string, string>) and `defaultColor`.
  6. `progressCellRenderer(options?)` — Renders `<div class="cell-progress" role="progressbar">` with inner fill bar. Supports `max` (default 100), `showLabel`, `color`.
  7. `avatarCellRenderer(options?)` — Renders `<img>` when src exists, initials fallback from `nameKey` when not. Supports `size` (default 28).

- Export `cellRendererStyles` as a `css` tagged template with styles for all renderers:
  - `.cell-text`: `overflow: hidden; text-overflow: ellipsis; white-space: nowrap;`
  - `.cell-number`: `font-variant-numeric: tabular-nums; text-align: right;` (right-aligned)
  - `.cell-empty`: `color: var(--color-muted-foreground, #71717a);`
  - `.cell-date`: inherited text styles
  - `.cell-boolean`: `display: inline-flex; align-items: center;`
  - `.cell-boolean--true`: `color: var(--color-success, #22c55e);`
  - `.cell-boolean--false`: `color: var(--color-muted-foreground, #71717a);`
  - `.cell-badge`: `display: inline-flex; padding: 2px 8px; border-radius: 9999px; font-size: 12px; font-weight: 500; line-height: 1.5;`
  - `.cell-badge--default`: `background: var(--color-muted, #f4f4f5); color: var(--ui-data-table-text-color, #09090b);`
  - `.cell-badge--green`, `--blue`, `--red`, `--yellow`, `--purple`: appropriate background/color pairs using oklch or simple hex
  - `.cell-progress`: `width: 100%; height: 8px; background: var(--color-muted, #f4f4f5); border-radius: 4px; overflow: hidden; position: relative;`
  - `.cell-progress-bar`: `height: 100%; background: var(--color-primary, #3b82f6); border-radius: 4px; transition: width 0.3s ease;`
  - `.cell-progress-label`: `font-size: 12px; margin-left: 8px;`
  - `.cell-avatar`: `border-radius: 50%; object-fit: cover; vertical-align: middle;`
  - `.cell-avatar--initials`: `display: inline-flex; align-items: center; justify-content: center; background: var(--color-muted, #f4f4f5); color: var(--color-muted-foreground, #71717a); font-size: 11px; font-weight: 600;`
  - Dark mode overrides for badge variants
  </action>
  <verify>
Run `npx tsc --noEmit --project packages/data-table/tsconfig.json` — should compile with no errors.
Verify cell-renderers.ts exports 7 renderer functions + CellRenderer type + cellRendererStyles.
Verify types.ts exports RowAction, BulkAction, RowActionEvent, BulkActionEvent.
  </verify>
  <done>
types.ts contains RowAction, BulkAction, RowActionEvent, BulkActionEvent interfaces.
cell-renderers.ts contains 7 factory functions, CellRenderer type, and cellRendererStyles CSS.
All types compile without errors.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create row-actions.ts with rendering and pre-built actions</name>
  <files>
    packages/data-table/src/row-actions.ts
  </files>
  <action>
Create `row-actions.ts` following the pattern from `inline-editing.ts` (standalone render functions + CSS styles):

**Imports:** `html, css, nothing, type TemplateResult` from 'lit', `type RowData, Row` from '@tanstack/lit-table', `type RowAction` from './types.js'.

**kebabIcon:** Export an SVG constant — three vertical dots (circles at cy=3, cy=8, cy=13).

**renderRowActions function:**
```typescript
export function renderRowActions<TData extends RowData>(
  row: Row<TData>,
  actions: RowAction<TData>[],
  onAction: (actionId: string, row: Row<TData>) => void
): TemplateResult
```

Logic:
1. Filter out hidden actions (check `hidden` property — boolean or function).
2. If 0 visible actions, return empty `html\`\``.
3. If 1-2 visible actions, render inline buttons with icon + aria-label. Each button: `class="row-action-btn"`, destructive variant class, disabled state from action config, `@click` calls `e.stopPropagation()` then `onAction(action.id, row)`.
4. If 3+ visible actions, render a `<lui-popover placement="bottom-end">` with:
   - Trigger: button with kebab icon, `class="row-action-kebab"`, `aria-label="Row actions"`, `aria-haspopup="menu"`, `@click` stops propagation
   - Content: `<div role="menu" class="row-actions-menu">` containing `<button role="menuitem">` for each action. Each menuitem: `class="row-actions-menu-item"`, destructive class, disabled state, icon + label. On click: stopPropagation, call onAction, close popover by setting `open = false` on closest `lui-popover`.

**Pre-built action factories:**
- `createViewAction<TData>(options?)` — id: 'view', label: 'View', eye icon SVG
- `createEditAction<TData>(options?)` — id: 'edit', label: 'Edit', pencil icon SVG
- `createDeleteAction<TData>(options?)` — id: 'delete', label: 'Delete', variant: 'destructive', trash icon SVG

Use the SVG icons from the research document.

**rowActionsStyles:** Export a `css` tagged template with:
- `.row-action-btn`: Same dimensions/style as `.row-edit-trigger` from inline-editing.ts (28px square, transparent bg, muted foreground color, hover states)
- `.row-action-btn.destructive`: `color: var(--color-destructive, #ef4444);` with hover adjustment
- `.row-action-kebab`: Same 28px square button style, hover background
- `.row-actions-inline`: `display: flex; align-items: center; gap: 2px;`
- `.row-actions-menu`: `min-width: 160px; padding: 4px 0; background: var(--ui-data-table-row-bg, #ffffff); border-radius: 6px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);`
- `.row-actions-menu-item`: `display: flex; align-items: center; gap: 8px; width: 100%; padding: 8px 12px; border: none; background: none; cursor: pointer; font-size: 14px; color: var(--ui-data-table-text-color, #09090b);`
- `.row-actions-menu-item:hover`: subtle background highlight
- `.row-actions-menu-item.destructive`: red color
- `.row-actions-menu-item:disabled`: muted, no cursor
- `.menu-item-icon`: `display: inline-flex; width: 16px; height: 16px; flex-shrink: 0;`
- `.menu-item-label`: text style
- Hover-reveal CSS (applied via host attribute):
  ```css
  :host([hover-reveal-actions]) .row-actions-content {
    opacity: 0; visibility: hidden; transition: opacity 0.15s ease, visibility 0.15s ease;
  }
  :host([hover-reveal-actions]) .data-table-row:hover .row-actions-content,
  :host([hover-reveal-actions]) .data-table-row:focus-within .row-actions-content {
    opacity: 1; visibility: visible;
  }
  @media (hover: none) {
    :host([hover-reveal-actions]) .row-actions-content {
      opacity: 1; visibility: visible;
    }
  }
  ```
- Focus-visible outline matching existing pattern
- Dark mode overrides for menu background, item hover, destructive colors
  </action>
  <verify>
Run `npx tsc --noEmit --project packages/data-table/tsconfig.json` — should compile with no errors.
Verify row-actions.ts exports: renderRowActions, createViewAction, createEditAction, createDeleteAction, rowActionsStyles, kebabIcon.
  </verify>
  <done>
row-actions.ts contains renderRowActions function with inline/kebab branching, 3 pre-built action factories, hover-reveal CSS, kebab menu styles, dark mode support. Compiles without errors.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit --project packages/data-table/tsconfig.json` passes
2. types.ts has 4 new interfaces: RowAction, BulkAction, RowActionEvent, BulkActionEvent
3. cell-renderers.ts exports CellRenderer type + 7 factory functions + cellRendererStyles
4. row-actions.ts exports renderRowActions + 3 pre-built factories + rowActionsStyles + kebabIcon
5. No modifications to data-table.ts in this plan (integration is Plan 02/03)
</verification>

<success_criteria>
All three module files compile. Type exports are correct. Factory functions return appropriate TemplateResult values. CSS styles cover all renderer variants and row action states including dark mode. No circular dependencies introduced.
</success_criteria>

<output>
After completion, create `.planning/phases/66-cell-renderers-row-actions-bulk-actions/66-01-SUMMARY.md`
</output>
