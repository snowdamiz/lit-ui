---
phase: 096-cli-integration-documentation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - packages/charts/vite.config.ts
  - packages/charts/package.json
autonomous: true
requirements:
  - CLI-02

must_haves:
  truths:
    - "Developer can import '@lit-ui/charts/line-chart' without TypeScript 'Cannot find module' error"
    - "Developer's bundler tree-shakes unused chart modules when using subpath imports"
    - "All 8 subpath entries resolve to distinct dist/ output files"
  artifacts:
    - path: "packages/charts/vite.config.ts"
      provides: "Multi-entry Vite build producing one JS file per chart type"
      contains: "entry:.*index.*line-chart.*area-chart"
    - path: "packages/charts/package.json"
      provides: "Subpath exports map for all 8 chart types plus root"
      contains: "./line-chart"
  key_links:
    - from: "packages/charts/vite.config.ts"
      to: "packages/charts/dist/line-chart.js"
      via: "Vite multi-entry build"
      pattern: "entry.*Record|entry.*\\{.*index"
    - from: "packages/charts/package.json exports"
      to: "packages/charts/dist/*.js"
      via: "Node.js exports field resolution"
      pattern: "\\.\/line-chart.*import.*dist\/line-chart"
---

<objective>
Enable per-chart subpath imports from @lit-ui/charts by converting the build from single-entry to multi-entry and declaring all 8 subpath export conditions in package.json.

Purpose: CLI-02 requirement — developers need `import '@lit-ui/charts/line-chart'` to work for TypeScript resolution and to enable tree-shaking of unused charts.
Output: Updated vite.config.ts (bespoke multi-entry config), updated package.json (8 subpath export entries).
</objective>

<execution_context>
@/Users/sn0w/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sn0w/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

<interfaces>
<!-- Key contracts for this plan. Executor should use these directly. -->

From packages/charts/vite.config.ts (current — single-entry):
```typescript
import { createLibraryConfig } from '@lit-ui/vite-config/library';
export default createLibraryConfig({ entry: 'src/index.ts' });
```

From packages/vite-config/library.js (createLibraryConfig signature):
```javascript
export function createLibraryConfig(options = {}) {
  const entry = options.entry || 'src/index.ts';
  const entryRoot = options.entryRoot || 'src';
  return defineConfig({
    plugins: [tailwindcss(), dts({ rollupTypes: true, entryRoot })],
    build: {
      lib: { entry, formats: ['es'], fileName: 'index' },
      rollupOptions: { external: ['lit', /^lit\//, /^@lit\//, /^@lit-ui\//] }
    }
  });
}
```
NOTE: createLibraryConfig accepts entry as string only and hardcodes fileName:'index'.
For multi-entry, charts MUST use a bespoke defineConfig — NOT createLibraryConfig.

From packages/charts/src/ (per-chart entry files confirmed to exist):
- src/line/line-chart.ts
- src/area/area-chart.ts
- src/bar/bar-chart.ts
- src/pie/pie-chart.ts
- src/scatter/scatter-chart.ts
- src/heatmap/heatmap-chart.ts
- src/candlestick/candlestick-chart.ts
- src/treemap/treemap-chart.ts
- src/index.ts (root entry)

From packages/charts/package.json (current exports — only root):
```json
{
  "exports": {
    ".": {
      "import": "./dist/index.js",
      "types": "./dist/index.d.ts"
    }
  },
  "sideEffects": true
}
```
</interfaces>
</context>

<tasks>

<task type="auto">
  <name>Task 1: Replace vite.config.ts with bespoke multi-entry build</name>
  <files>packages/charts/vite.config.ts</files>
  <action>
Replace the current single-entry vite.config.ts with a bespoke multi-entry configuration. Do NOT use createLibraryConfig — it hardcodes fileName:'index' which breaks multi-entry builds. Write a direct defineConfig call.

The new config must:
1. Import defineConfig from 'vite', tailwindcss from '@tailwindcss/vite', dts from 'vite-plugin-dts'
2. Set build.lib.entry as an object with 9 keys (do NOT include fileName — Vite uses entry keys as output file names automatically):
   ```typescript
   entry: {
     'index': 'src/index.ts',
     'line-chart': 'src/line/line-chart.ts',
     'area-chart': 'src/area/area-chart.ts',
     'bar-chart': 'src/bar/bar-chart.ts',
     'pie-chart': 'src/pie/pie-chart.ts',
     'scatter-chart': 'src/scatter/scatter-chart.ts',
     'heatmap-chart': 'src/heatmap/heatmap-chart.ts',
     'candlestick-chart': 'src/candlestick/candlestick-chart.ts',
     'treemap-chart': 'src/treemap/treemap-chart.ts',
   }
   ```
3. Set formats: ['es']
4. Keep rollupOptions.external: ['lit', /^lit\//, /^@lit\//, /^@lit-ui\//]
5. Keep dts({ rollupTypes: true, entryRoot: 'src' }) — this generates one .d.ts per entry automatically
6. Keep tailwindcss() plugin

CRITICAL: Do NOT add fileName field at all — omitting it is what enables per-entry file naming.
CRITICAL: sideEffects:true stays in package.json (not vite config).
  </action>
  <verify>
    <automated>cd /Users/sn0w/Documents/dev/lit-components && pnpm --filter @lit-ui/charts build 2>&1 | tail -20</automated>
  </verify>
  <done>Build succeeds producing dist/index.js, dist/line-chart.js, dist/area-chart.js, dist/bar-chart.js, dist/pie-chart.js, dist/scatter-chart.js, dist/heatmap-chart.js, dist/candlestick-chart.js, dist/treemap-chart.js plus corresponding .d.ts files</done>
</task>

<task type="auto">
  <name>Task 2: Add 8 subpath export entries to package.json</name>
  <files>packages/charts/package.json</files>
  <action>
Update the exports field in packages/charts/package.json to add subpath entries for all 8 chart types. Keep the existing "." root entry unchanged. Keep sideEffects:true unchanged.

The exports field must become:
```json
"exports": {
  ".": {
    "import": "./dist/index.js",
    "types": "./dist/index.d.ts"
  },
  "./line-chart": {
    "import": "./dist/line-chart.js",
    "types": "./dist/line-chart.d.ts"
  },
  "./area-chart": {
    "import": "./dist/area-chart.js",
    "types": "./dist/area-chart.d.ts"
  },
  "./bar-chart": {
    "import": "./dist/bar-chart.js",
    "types": "./dist/bar-chart.d.ts"
  },
  "./pie-chart": {
    "import": "./dist/pie-chart.js",
    "types": "./dist/pie-chart.d.ts"
  },
  "./scatter-chart": {
    "import": "./dist/scatter-chart.js",
    "types": "./dist/scatter-chart.d.ts"
  },
  "./heatmap-chart": {
    "import": "./dist/heatmap-chart.js",
    "types": "./dist/heatmap-chart.d.ts"
  },
  "./candlestick-chart": {
    "import": "./dist/candlestick-chart.js",
    "types": "./dist/candlestick-chart.d.ts"
  },
  "./treemap-chart": {
    "import": "./dist/treemap-chart.js",
    "types": "./dist/treemap-chart.d.ts"
  }
}
```

After updating package.json, trigger a build to confirm dist files are generated at the declared paths:
Run: `pnpm --filter @lit-ui/charts build`
Then verify: `ls packages/charts/dist/*.js | grep -v chunk` should show 9 .js files (index + 8 charts).
  </action>
  <verify>
    <automated>ls /Users/sn0w/Documents/dev/lit-components/packages/charts/dist/ | grep -E "^(index|line-chart|area-chart|bar-chart|pie-chart|scatter-chart|heatmap-chart|candlestick-chart|treemap-chart)\.(js|d\.ts)$" | wc -l</automated>
  </verify>
  <done>18 files listed (9 .js + 9 .d.ts — one per entry key). TypeScript can resolve `@lit-ui/charts/line-chart` (confirmed by package.json exports map matching dist/ output).</done>
</task>

</tasks>

<verification>
Run `pnpm --filter @lit-ui/charts build` from the workspace root. Confirm:
1. Build exits with code 0
2. `ls packages/charts/dist/*.js` shows index.js plus all 8 chart-specific JS files
3. `ls packages/charts/dist/*.d.ts` shows index.d.ts plus all 8 chart-specific type files
4. No chunk files are the only output — the named entries produce named outputs
</verification>

<success_criteria>
- `packages/charts/dist/line-chart.js` exists after build
- `packages/charts/dist/treemap-chart.js` exists after build
- `packages/charts/package.json` has "./line-chart" through "./treemap-chart" in exports
- Build command exits 0 with no errors
</success_criteria>

<output>
After completion, create `.planning/phases/096-cli-integration-documentation/096-01-SUMMARY.md`
</output>
