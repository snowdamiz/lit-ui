---
phase: 49-time-picker-advanced
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - packages/time-picker/src/clock-face.ts
  - packages/time-picker/src/time-dropdown.ts
autonomous: true

must_haves:
  truths:
    - "Clock face minute mode snaps pointer selection to nearest step interval when step > 1"
    - "Clock face minute mode only renders labels at step interval positions (e.g., 0, 15, 30, 45 for step=15)"
    - "Dropdown options within business hours range show a green left border and tinted background"
    - "Clock face hours within business hours range show a subtle accent indicator"
  artifacts:
    - path: "packages/time-picker/src/clock-face.ts"
      provides: "Interval snapping in minute mode + business hours visual indicator on hour numbers"
      contains: "_snapToInterval"
    - path: "packages/time-picker/src/time-dropdown.ts"
      provides: "Business hours CSS class on qualifying time options"
      contains: "business-hour"
  key_links:
    - from: "packages/time-picker/src/clock-face.ts"
      to: "step property"
      via: "New @property step on ClockFace, used in _renderMinuteMode and _calculateValueFromPointer"
      pattern: "_snapToInterval"
    - from: "packages/time-picker/src/time-dropdown.ts"
      to: "businessHours property"
      via: "New @property businessHours, checked when rendering each option"
      pattern: "business-hour"
---

<objective>
Add time interval snapping to the clock face minute mode and business hours visual highlighting to both the clock face and dropdown components.

Purpose: Fulfills TP-16 (interval precision) and TP-17 (business hours highlighting) at the sub-component level. The parent TimePicker will pass these properties down in Plan 06.
Output: Updated clock-face.ts with step-aware minute rendering and snapping, updated time-dropdown.ts with business hours CSS class.
</objective>

<execution_context>
@/Users/sn0w/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sn0w/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/49-time-picker-advanced/49-RESEARCH.md
@packages/time-picker/src/clock-face.ts
@packages/time-picker/src/time-dropdown.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add step-aware minute rendering and interval snapping to ClockFace</name>
  <files>packages/time-picker/src/clock-face.ts</files>
  <action>
Add a `step` property to ClockFace (default 1, type Number). This controls minute mode behavior:

1. Add `@property({ type: Number }) step = 1;`

2. Add a `businessHours` property: `@property({ attribute: false }) businessHours: { start: number; end: number } | false = false;`

3. Add a private `_snapToInterval(minute: number): number` method:
   - If `this.step <= 1`, return minute unchanged.
   - Otherwise, return `Math.round(minute / this.step) * this.step % 60`.

4. In `_calculateValueFromPointer`, for minute mode, apply snapping:
   - After calculating the raw minute value, pass it through `_snapToInterval()` before returning.

5. In `_renderMinuteMode()`, make it step-aware:
   - When `this.step > 1`, render only labels at step interval positions (e.g., for step=15: 0, 15, 30, 45). Use a for-loop `for (let i = 0; i < 60; i += this.step)` and render each as a major label (same style as existing i%5===0 labels).
   - When `this.step <= 1`, keep the existing rendering (60 positions with ticks/labels).

6. Add business hours indicator to hour mode rendering (`_renderHour12` and `_renderHour24`):
   - Check if `this.businessHours` is set.
   - For each hour number, if it falls within [businessHours.start, businessHours.end), render a subtle arc segment or a small green dot indicator near the number. Simplest approach: render a small circle (r=3) positioned just outside the number, filled with `var(--ui-time-picker-business-hour-accent, #22c55e)`.
   - In `_renderHour12`: check if the 24-hour equivalent falls in range. For AM hours 1-11 and PM hours mapped via to24Hour.
   - In `_renderHour24`: check directly if `num >= businessHours.start && num < businessHours.end`.

7. Add CSS for business hour indicator:
   ```css
   .business-indicator {
     fill: var(--ui-time-picker-business-hour-accent, #22c55e);
   }
   :host-context(.dark) .business-indicator {
     fill: var(--ui-time-picker-business-hour-accent, #4ade80);
   }
   ```
  </action>
  <verify>
Build the time-picker package: `cd packages/time-picker && npx tsc --noEmit`. No type errors.
Verify clock-face.ts has `step` property, `_snapToInterval` method, and step-aware `_renderMinuteMode`.
  </verify>
  <done>ClockFace respects step property for minute mode (renders only step-interval labels, snaps pointer to nearest interval) and shows business hours indicator on qualifying hours.</done>
</task>

<task type="auto">
  <name>Task 2: Add business hours highlighting to TimeDropdown</name>
  <files>packages/time-picker/src/time-dropdown.ts</files>
  <action>
1. Add a `businessHours` property to TimeDropdown:
   `@property({ attribute: false }) businessHours: { start: number; end: number } | false = false;`

2. In the render method, for each time option, check if it falls within business hours:
   ```typescript
   const isBusinessHour = this.businessHours &&
     opt.value.hour >= this.businessHours.start &&
     opt.value.hour < this.businessHours.end;
   ```
   Add the CSS class `business-hour` to the option div when `isBusinessHour` is true.

3. Add CSS styles for `.business-hour`:
   ```css
   .time-option.business-hour {
     border-left: 3px solid var(--ui-time-picker-business-hour-accent, #22c55e);
     background: var(--ui-time-picker-business-hour-bg, #f0fdf4);
   }
   .time-option.business-hour:hover {
     background: var(--ui-time-picker-business-hour-bg-hover, #dcfce7);
   }
   .time-option.business-hour.selected {
     background: var(--ui-time-picker-business-hour-bg, #f0fdf4);
     border-left-color: var(--ui-time-picker-business-hour-accent, #22c55e);
   }
   ```

4. Add dark mode styles:
   ```css
   :host-context(.dark) .time-option.business-hour {
     border-left-color: var(--ui-time-picker-business-hour-accent, #4ade80);
     background: var(--ui-time-picker-business-hour-bg, #052e16);
   }
   :host-context(.dark) .time-option.business-hour:hover {
     background: var(--ui-time-picker-business-hour-bg-hover, #064e3b);
   }
   ```
  </action>
  <verify>
Build: `cd packages/time-picker && npx tsc --noEmit`. No type errors.
Verify time-dropdown.ts has `businessHours` property and `.business-hour` CSS class applied conditionally.
  </verify>
  <done>TimeDropdown renders business hours options with a green left border and tinted background, with dark mode support.</done>
</task>

</tasks>

<verification>
1. `cd packages/time-picker && npx tsc --noEmit` passes with no errors
2. `grep -n '_snapToInterval\|businessHours\|business-hour\|step' packages/time-picker/src/clock-face.ts` shows all additions
3. `grep -n 'businessHours\|business-hour' packages/time-picker/src/time-dropdown.ts` shows business hours support
</verification>

<success_criteria>
- ClockFace accepts `step` property and snaps minute selections to nearest step interval
- ClockFace minute mode renders labels only at step positions when step > 1
- ClockFace and TimeDropdown accept `businessHours` property
- TimeDropdown renders qualifying options with `business-hour` CSS class (green border + tinted bg)
- Both components compile without TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/49-time-picker-advanced/49-01-SUMMARY.md`
</output>
