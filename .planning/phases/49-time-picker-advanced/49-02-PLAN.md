---
phase: 49-time-picker-advanced
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - packages/time-picker/src/timezone-display.ts
autonomous: true

must_haves:
  truths:
    - "Timezone display component renders local time and one or more additional timezones"
    - "Each timezone shows formatted time with abbreviation (e.g., '2:30 PM EST | 11:30 AM PST')"
    - "Timezone names use Intl.DateTimeFormat with IANA identifiers (not hardcoded offsets)"
    - "Component updates display when time value changes"
  artifacts:
    - path: "packages/time-picker/src/timezone-display.ts"
      provides: "Multi-timezone display internal component"
      contains: "TimezoneDisplay"
  key_links:
    - from: "packages/time-picker/src/timezone-display.ts"
      to: "Intl.DateTimeFormat"
      via: "formatToParts with timeZone option"
      pattern: "Intl.DateTimeFormat"
---

<objective>
Create an internal timezone display component that shows the selected time converted to multiple timezones.

Purpose: Fulfills TP-19 (multi-timezone display). The component is composed by the parent TimePicker (wired in Plan 06).
Output: New timezone-display.ts internal component.
</objective>

<execution_context>
@/Users/sn0w/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sn0w/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/49-time-picker-advanced/49-RESEARCH.md
@packages/time-picker/src/time-utils.ts
@packages/time-picker/src/time-picker.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create TimezoneDisplay internal component</name>
  <files>packages/time-picker/src/timezone-display.ts</files>
  <action>
Create a new internal component `lui-timezone-display` that renders time in multiple timezones. Follow the same patterns as other internal components (TimeInput, ClockFace, TimeDropdown).

1. Import from Lit and @lit-ui/core (TailwindElement, tailwindBaseStyles).
   Import `TimeValue` from `./time-utils.js`.

2. Define the `TimezoneDisplay` class extending `TailwindElement`:

   **Properties:**
   - `@property({ attribute: false }) value: TimeValue | null = null;` -- current time value
   - `@property() locale: string = 'en-US';` -- BCP 47 locale
   - `@property({ type: Boolean }) hour12: boolean = false;` -- 12/24h format
   - `@property() primaryTimezone: string = '';` -- primary IANA timezone (empty = local)
   - `@property({ attribute: false }) additionalTimezones: string[] = [];` -- additional IANA timezone IDs

   **Private method `formatTimeInTimezone(time: TimeValue, timezone: string): { time: string; tzName: string }`:**
   - Create a Date object: `new Date(2000, 0, 1, time.hour, time.minute, time.second)`
   - Use `Intl.DateTimeFormat` with `{ hour: 'numeric', minute: '2-digit', hour12: this.hour12, timeZone: timezone }` to format time.
   - Use `Intl.DateTimeFormat` with `{ timeZoneName: 'short', hour: 'numeric', timeZone: timezone }` and `formatToParts()` to extract timezone abbreviation.
   - Return `{ time: formattedTime, tzName: abbreviation }`.
   - Wrap in try/catch, return `{ time: '?', tzName: timezone }` on error (invalid IANA ID).

   **Private method `get timezoneEntries(): Array<{ time: string; tzName: string }>`:**
   - If no value, return empty array.
   - Build array: first entry is primaryTimezone (or local if empty).
   - Then each entry from `additionalTimezones`.
   - For local timezone (empty string), pass `Intl.DateTimeFormat().resolvedOptions().timeZone`.

   **Render method:**
   - If no value or no timezones to display, render `nothing`.
   - Render entries separated by ` | ` (pipe with spaces):
   ```html
   <div class="timezone-display" role="status" aria-label="Time in multiple timezones">
     ${entries.map((entry, i) => html`
       ${i > 0 ? html`<span class="tz-separator" aria-hidden="true">|</span>` : ''}
       <span class="tz-entry">
         <span class="tz-time">${entry.time}</span>
         <span class="tz-name">${entry.tzName}</span>
       </span>
     `)}
   </div>
   ```

   **Styles (CSS):**
   ```css
   :host { display: block; }

   .timezone-display {
     display: flex;
     align-items: center;
     gap: 0.5rem;
     font-size: 0.75rem;
     color: var(--ui-time-picker-timezone-text, var(--ui-input-placeholder, #6b7280));
     padding: 0.25rem 0;
   }

   .tz-separator {
     color: var(--ui-time-picker-timezone-separator, #d1d5db);
   }

   .tz-entry {
     display: inline-flex;
     align-items: baseline;
     gap: 0.25rem;
   }

   .tz-time {
     font-variant-numeric: tabular-nums;
   }

   .tz-name {
     font-size: 0.625rem;
     text-transform: uppercase;
     opacity: 0.8;
   }

   :host-context(.dark) .timezone-display {
     color: var(--ui-time-picker-timezone-text, #9ca3af);
   }

   :host-context(.dark) .tz-separator {
     color: var(--ui-time-picker-timezone-separator, #4b5563);
   }
   ```

3. Safe custom element registration at bottom of file (same pattern):
   ```typescript
   if (typeof customElements !== 'undefined') {
     if (!customElements.get('lui-timezone-display')) {
       customElements.define('lui-timezone-display', TimezoneDisplay);
     }
   }
   ```

**Key decisions:**
- Use `Intl.DateTimeFormat` exclusively for timezone conversion (never hardcoded offsets).
- Primary timezone defaults to browser local when empty string.
- `role="status"` for screen reader updates when time changes.
  </action>
  <verify>
Build: `cd packages/time-picker && npx tsc --noEmit`. No type errors.
Verify file exists and exports TimezoneDisplay class.
  </verify>
  <done>TimezoneDisplay component renders formatted time in multiple IANA timezones with abbreviations, separated by pipe characters, with dark mode support.</done>
</task>

</tasks>

<verification>
1. `cd packages/time-picker && npx tsc --noEmit` passes
2. `grep -n 'Intl.DateTimeFormat\|formatToParts\|timeZone' packages/time-picker/src/timezone-display.ts` shows Intl API usage
3. `grep -n 'additionalTimezones\|primaryTimezone' packages/time-picker/src/timezone-display.ts` shows timezone properties
</verification>

<success_criteria>
- TimezoneDisplay component compiles without errors
- Uses Intl.DateTimeFormat with IANA timezone identifiers (never fixed offsets)
- Renders "time abbrev | time abbrev" format for multiple timezones
- Has dark mode styles via :host-context(.dark)
- Follows internal component registration pattern
</success_criteria>

<output>
After completion, create `.planning/phases/49-time-picker-advanced/49-02-SUMMARY.md`
</output>
