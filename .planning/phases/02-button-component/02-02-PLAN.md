---
phase: 02-button-component
plan: 02
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - src/components/button/button.ts
autonomous: true

must_haves:
  truths:
    - "Button inside a form submits the form when clicked with type=submit"
    - "Button responds to Enter/Space keyboard activation"
    - "Button shows visible focus ring when focused via keyboard"
    - "Disabled/loading button remains in tab order but prevents action"
  artifacts:
    - path: "src/components/button/button.ts"
      provides: "Form-associated button with ElementInternals"
      contains: "static formAssociated = true"
  key_links:
    - from: "src/components/button/button.ts"
      to: "ElementInternals API"
      via: "attachInternals()"
      pattern: "this\\.internals = this\\.attachInternals"
    - from: "handleClick"
      to: "form.requestSubmit"
      via: "form submission"
      pattern: "this\\.internals\\.form\\?.requestSubmit"
---

<objective>
Add form participation via ElementInternals and keyboard accessibility to the button component.

Purpose: Enable the button to work inside HTML forms (submit/reset) and ensure full keyboard accessibility
Output: Button that can submit forms, responds to Enter/Space, and maintains proper focus handling
</objective>

<execution_context>
@/Users/sn0w/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sn0w/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-button-component/02-RESEARCH.md
@src/components/button/button.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add form participation with ElementInternals</name>
  <files>src/components/button/button.ts</files>
  <action>
Modify the button component to add form participation:

1. Add static property for form association:
   ```typescript
   static formAssociated = true;
   ```

2. Add private internals property and initialize in constructor:
   ```typescript
   private internals: ElementInternals;

   constructor() {
     super();
     this.internals = this.attachInternals();
   }
   ```

3. Add `type` property:
   ```typescript
   @property({ type: String }) type: 'button' | 'submit' | 'reset' = 'button';
   ```

4. Add click handler that performs form actions:
   ```typescript
   private handleClick(e: Event) {
     if (this.disabled) {
       e.preventDefault();
       e.stopPropagation();
       return;
     }

     if (this.type === 'submit' && this.internals.form) {
       this.internals.form.requestSubmit();
     } else if (this.type === 'reset' && this.internals.form) {
       this.internals.form.reset();
     }
   }
   ```

5. Wire up the click handler to the inner button:
   ```typescript
   @click=${this.handleClick}
   ```

6. Set inner button type to "button" (not submit) to prevent double submission:
   The inner `<button>` should always have `type="button"` since we handle submission manually via ElementInternals.

Note: Keyboard handling (Enter/Space) comes FREE from using native `<button>` element - do NOT add manual keydown handlers (per RESEARCH.md anti-patterns).
  </action>
  <verify>Run `npm run build` - should compile without errors</verify>
  <done>Button has formAssociated=true, internals attached, and handleClick performs form actions</done>
</task>

<task type="auto">
  <name>Task 2: Verify focus and disabled accessibility</name>
  <files>src/components/button/button.ts</files>
  <action>
Ensure accessibility attributes are properly set:

1. Confirm aria-disabled is set on the inner button when disabled:
   ```typescript
   ?aria-disabled=${this.disabled}
   ```

2. Confirm the focus ring CSS from Plan 01 is in place (button:focus-visible with inset box-shadow)

3. Add :host styles for proper display and disabled state:
   ```css
   :host {
     display: inline-block;
   }
   :host([disabled]) {
     pointer-events: none;
   }
   ```

4. Ensure the disabled prop reflects as an attribute for :host([disabled]) to work:
   ```typescript
   @property({ type: Boolean, reflect: true }) disabled = false;
   ```

Note: Do NOT use HTML `disabled` attribute on the inner button - use `aria-disabled` only so screen readers can still tab to and announce the button (per RESEARCH.md pitfall #1).
  </action>
  <verify>
Run `npm run build` - should compile without errors.
Check that button.ts has aria-disabled binding and reflect:true on disabled prop.
  </verify>
  <done>Button uses aria-disabled (not HTML disabled), disabled reflects as attribute, :host styles applied</done>
</task>

</tasks>

<verification>
1. `npm run build` completes without errors
2. Button has `static formAssociated = true`
3. Button attaches internals in constructor
4. handleClick calls requestSubmit() for type="submit"
5. aria-disabled is bound (not HTML disabled)
6. disabled property has reflect: true
7. :host styles set display: inline-block
</verification>

<success_criteria>
- Button with type="submit" inside a form can trigger form submission
- Button with type="reset" inside a form can reset the form
- Keyboard activation works via native button (no manual handlers)
- Focus ring is visible on keyboard focus
- Disabled button is aria-disabled but NOT HTML disabled (remains in tab order)
- disabled attribute reflects to host element
</success_criteria>

<output>
After completion, create `.planning/phases/02-button-component/02-02-SUMMARY.md`
</output>
