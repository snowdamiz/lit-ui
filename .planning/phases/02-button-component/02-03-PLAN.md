---
phase: 02-button-component
plan: 03
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - src/components/button/button.ts
autonomous: true

must_haves:
  truths:
    - "Button in loading state shows pulsing dots spinner"
    - "Button maintains fixed width when transitioning to loading state"
    - "Loading button announces state via aria-busy and aria-label"
    - "Icons can be placed in leading (icon-start) and trailing (icon-end) slots"
  artifacts:
    - path: "src/components/button/button.ts"
      provides: "Loading state with spinner, icon slots"
      contains: "slot name=\"icon-start\""
  key_links:
    - from: "loading property"
      to: "spinner render"
      via: "conditional template"
      pattern: "this\\.loading.*renderSpinner"
    - from: "icon slots"
      to: "button render"
      via: "named slots"
      pattern: "slot name=\"icon-(start|end)\""
---

<objective>
Add loading state with pulsing dots spinner and icon slots to the button component.

Purpose: Enable async action feedback with accessible loading indicator, plus icon composition via slots
Output: Button with loading property showing spinner, and icon-start/icon-end slots for icon placement
</objective>

<execution_context>
@/Users/sn0w/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sn0w/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-button-component/02-CONTEXT.md
@.planning/phases/02-button-component/02-RESEARCH.md
@src/components/button/button.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add loading state with pulsing dots spinner</name>
  <files>src/components/button/button.ts</files>
  <action>
Add loading state functionality:

1. Add loading property:
   ```typescript
   @property({ type: Boolean, reflect: true }) loading = false;
   ```

2. Create spinner render method with THREE pulsing dots:
   ```typescript
   private renderSpinner() {
     return html`<span class="spinner" aria-hidden="true"><span></span></span>`;
   }
   ```
   Note: The spinner element needs inner span for the middle dot (pseudo-elements for first/third).

3. Add spinner CSS to static styles (pulsing dots animation per CONTEXT.md):
   ```css
   .spinner {
     display: inline-flex;
     align-items: center;
     gap: 0.2em;
   }

   .spinner::before,
   .spinner::after,
   .spinner > span {
     content: '';
     width: 0.4em;
     height: 0.4em;
     border-radius: 50%;
     background: currentColor;
     animation: pulse 1.2s ease-in-out infinite;
   }

   .spinner::before { animation-delay: 0s; }
   .spinner > span { animation-delay: 0.2s; }
   .spinner::after { animation-delay: 0.4s; }

   @keyframes pulse {
     0%, 80%, 100% {
       opacity: 0.3;
       transform: scale(0.7);
     }
     40% {
       opacity: 1;
       transform: scale(1);
     }
   }
   ```

4. Update render() to show spinner when loading (replaces text, not alongside per CONTEXT.md):
   ```typescript
   ${this.loading
     ? this.renderSpinner()
     : html`<slot></slot>`
   }
   ```

5. Add accessibility attributes for loading state:
   ```typescript
   ?aria-busy=${this.loading}
   aria-label=${this.loading ? 'Loading' : nothing}
   ```
   Import `nothing` from 'lit'.

6. Prevent layout shift: Add min-width style tracking to maintain button width.
   Use a CSS approach: the button should have `min-width: fit-content` and use a technique to preserve width.

   Alternative simpler approach: Set the spinner container to have same base dimensions as typical button text.
   The spinner dots at 0.4em scale with font-size, so they'll fit naturally in the button's line-height.

7. Update handleClick to guard against loading state (in addition to disabled):
   ```typescript
   if (this.disabled || this.loading) {
     e.preventDefault();
     e.stopPropagation();
     return;
   }
   ```

8. Ensure loading button has aria-disabled (prevents action, stays in tab order):
   ```typescript
   ?aria-disabled=${this.disabled || this.loading}
   ```
  </action>
  <verify>Run `npm run build` - should compile without errors</verify>
  <done>Loading property exists, spinner renders with pulsing dots animation, aria-busy and aria-label set</done>
</task>

<task type="auto">
  <name>Task 2: Add icon slots</name>
  <files>src/components/button/button.ts</files>
  <action>
Add named slots for icons:

1. Update render() to include icon slots:
   ```typescript
   render() {
     return html`
       <button
         class=${this.getButtonClasses()}
         ?aria-disabled=${this.disabled || this.loading}
         ?aria-busy=${this.loading}
         aria-label=${this.loading ? 'Loading' : nothing}
         @click=${this.handleClick}
         type="button"
       >
         <slot name="icon-start"></slot>
         ${this.loading
           ? this.renderSpinner()
           : html`<slot></slot>`
         }
         <slot name="icon-end"></slot>
       </button>
     `;
   }
   ```

2. Add gap to button classes for icon spacing:
   Size-specific gaps:
   - sm: gap-1.5
   - md: gap-2
   - lg: gap-2.5

3. Add CSS for icon sizing that scales with button size:
   ```css
   ::slotted([slot="icon-start"]),
   ::slotted([slot="icon-end"]) {
     width: 1em;
     height: 1em;
     flex-shrink: 0;
   }
   ```
   Using 1em means icons scale with the button's font-size automatically.

4. Ensure icons use currentColor by default (set via CSS custom property or inherit):
   Icons slotted in will naturally inherit color from the button's text color.
  </action>
  <verify>Run `npm run build` - should compile without errors</verify>
  <done>icon-start and icon-end slots exist in render template, gap sizing applied per size, ::slotted styles for icons</done>
</task>

</tasks>

<verification>
1. `npm run build` completes without errors
2. Button has loading property with reflect: true
3. Spinner uses three pulsing dots (::before, span, ::after)
4. Loading button has aria-busy="true" and aria-label="Loading"
5. handleClick guards against both disabled and loading
6. icon-start and icon-end slots present in template
7. Gap classes vary by size (gap-1.5, gap-2, gap-2.5)
8. ::slotted styles set icon dimensions to 1em
</verification>

<success_criteria>
- loading=true shows three pulsing dots animation (spinner replaces text)
- Loading button has aria-busy="true" and aria-label="Loading"
- Loading button is aria-disabled and click is prevented
- Spinner animation is smooth (pulse keyframes)
- icon-start slot accepts icons before button text
- icon-end slot accepts icons after button text
- Icons scale with button size (1em width/height)
- Proper gap between icon and text based on size variant
</success_criteria>

<output>
After completion, create `.planning/phases/02-button-component/02-03-SUMMARY.md`
</output>
