---
phase: 28-input-differentiators
plan: 02
type: execute
wave: 2
depends_on: ["28-01"]
files_modified:
  - packages/input/src/input.ts
  - packages/input/src/jsx.d.ts
autonomous: true

must_haves:
  truths:
    - "User can toggle password visibility with eye icon button"
    - "Password toggle announces state to screen readers"
    - "Clear button appears when input has value"
    - "Focus returns to input after clearing"
    - "Clear button works on any input type with clearable attribute"
  artifacts:
    - path: "packages/input/src/input.ts"
      provides: "Password toggle with SVG icons"
      contains: "passwordVisible"
    - path: "packages/input/src/input.ts"
      provides: "Clear button with clearable prop"
      contains: "clearable"
    - path: "packages/input/src/jsx.d.ts"
      provides: "JSX types for clearable prop"
      contains: "clearable"
  key_links:
    - from: "password toggle button"
      to: "input type attribute"
      via: "passwordVisible state"
      pattern: "type=.*password.*text"
    - from: "clear button click"
      to: "input focus"
      via: "handleClear method"
      pattern: "this\\.inputEl\\?\\.focus"
---

<objective>
Add password visibility toggle and clearable input features to the Input component.

Purpose: Enhance UX with common input affordances - password toggle helps users verify their input, clear button provides quick way to empty the field.

Output: Input component with working password toggle (for type="password") and clear button (for any type when clearable=true).
</objective>

<execution_context>
@/Users/sn0w/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sn0w/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/28-input-differentiators/28-CONTEXT.md
@.planning/phases/28-input-differentiators/28-RESEARCH.md
@.planning/phases/28-input-differentiators/28-01-SUMMARY.md
@packages/input/src/input.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add password visibility toggle with accessibility</name>
  <files>packages/input/src/input.ts</files>
  <action>
Implement password toggle button with inline SVG icons and proper accessibility:

1. Add `@state() private passwordVisible = false;` property

2. Import `svg` from 'lit' alongside existing imports

3. Define SVG icon templates as private class properties (use Feather-style paths from RESEARCH.md):
   - `eyeIcon` - eye open (password hidden, click to show)
   - `eyeOffIcon` - eye with line through (password visible, click to hide)

4. Add `togglePasswordVisibility()` method:
   ```typescript
   private togglePasswordVisibility(): void {
     this.passwordVisible = !this.passwordVisible;
   }
   ```

5. Add `renderPasswordToggle()` method returning button with:
   - `type="button"` (prevent form submit)
   - `class="password-toggle"`
   - `aria-pressed=${this.passwordVisible}`
   - `aria-controls=${this.inputId}`
   - Click handler calling togglePasswordVisibility
   - SVG icon (eyeOffIcon when visible, eyeIcon when hidden)
   - Visually hidden text label

6. Add `renderLiveRegion()` method for screen reader announcements:
   ```html
   <span class="visually-hidden" role="status" aria-live="polite">
     ${this.passwordVisible ? 'Password shown' : 'Password hidden'}
   </span>
   ```

7. Modify input type binding: `type=${this.type === 'password' && this.passwordVisible ? 'text' : this.type}`

8. Conditionally render toggle in container: `${this.type === 'password' ? this.renderPasswordToggle() : nothing}`

9. Add CSS for toggle button (after suffix slot, before error):
   - `.password-toggle` - flex, align-items center, transparent bg, no border, cursor pointer
   - `.password-toggle:hover` - muted background
   - `.password-toggle:focus-visible` - ring outline
   - `.toggle-icon` - size 1.25em
   - `.visually-hidden` - sr-only positioning

10. Add form reset handler to reset passwordVisible to false
  </action>
  <verify>
Run `pnpm build` - build succeeds.
Test in browser:
1. Create `<lui-input type="password">` - eye icon appears
2. Click toggle - password becomes visible, icon changes to eye-off
3. Click again - password hidden, icon back to eye
4. Verify screen reader announces "Password shown" / "Password hidden"
5. Verify toggle is keyboard accessible (Tab to it, Enter/Space to activate)
  </verify>
  <done>Password toggle works with proper accessibility (aria-pressed, aria-live announcements).</done>
</task>

<task type="auto">
  <name>Task 2: Add clearable attribute and clear button</name>
  <files>packages/input/src/input.ts, packages/input/src/jsx.d.ts</files>
  <action>
Implement clear button that appears when input has value:

1. Add `@property({ type: Boolean }) clearable = false;` property

2. Define X-circle SVG icon as private class property (from RESEARCH.md)

3. Add `handleClear()` method:
   ```typescript
   private handleClear(): void {
     this.value = '';
     this.updateFormValue();
     this.inputEl?.focus();

     // Re-validate if already touched
     if (this.touched) {
       const isValid = this.validate();
       this.showError = !isValid;
     }
   }
   ```

4. Add `renderClearButton()` method returning button with:
   - `type="button"` (prevent form submit)
   - `class="clear-button"`
   - `aria-label="Clear input"`
   - Click handler calling handleClear
   - X-circle SVG icon

5. Conditionally render in container (after password toggle, before suffix):
   ```typescript
   ${this.clearable && this.value ? this.renderClearButton() : nothing}
   ```

6. Add CSS for clear button:
   - `.clear-button` - same styling as password-toggle
   - `.clear-icon` - size 1.25em

7. Update JSX types in jsx.d.ts:
   - Add `clearable?: boolean;` to LuiInputProps interface
  </action>
  <verify>
Run `pnpm build` - build succeeds.
Test in browser:
1. Create `<lui-input clearable>` - no clear button when empty
2. Type text - clear button (X) appears
3. Click clear button - input empties, focus stays in input
4. Verify clear works with type="email", type="search", etc.
5. Test with required + clearable: clear, blur - shows validation error
  </verify>
  <done>Clear button appears when clearable input has value, clears and returns focus on click.</done>
</task>

</tasks>

<verification>
After all tasks complete:

1. Build check: `pnpm build` passes
2. Type check: No TypeScript errors
3. Password toggle: Works on type="password" only, accessible
4. Clear button: Works on any type when clearable=true, shows only when value exists
5. Combined test: Password input with clearable - both toggle and clear work together
</verification>

<success_criteria>
1. User clicks eye icon on password input - password text becomes visible
2. Screen reader user hears "Password shown" announcement on toggle
3. User types in clearable input - clear button (X) appears
4. User clicks clear button - input empties, focus remains in input
5. Developer can use `<lui-input type="password" clearable>` - both features work
6. Password toggle only appears on type="password", clear button only on clearable inputs
</success_criteria>

<output>
After completion, create `.planning/phases/28-input-differentiators/28-02-SUMMARY.md`
</output>
