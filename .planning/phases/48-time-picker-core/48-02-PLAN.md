---
phase: 48-time-picker-core
plan: 02
type: execute
wave: 2
depends_on: ["48-01"]
files_modified:
  - packages/time-picker/src/time-input.ts
autonomous: true

must_haves:
  truths:
    - "User can adjust hours with ArrowUp/ArrowDown keys in spinbutton"
    - "User can adjust minutes with ArrowUp/ArrowDown keys in spinbutton"
    - "Hour spinbutton respects 1-12 or 0-23 range based on format mode"
    - "Minute spinbutton wraps 0-59 on increment/decrement"
    - "User can type multi-digit numbers with type-ahead buffer (750ms timeout)"
    - "AM/PM toggle button switches period and updates aria-label"
    - "Switching between 12/24-hour format preserves the actual time value"
  artifacts:
    - path: "packages/time-picker/src/time-input.ts"
      provides: "LuiTimeInput component with hour/minute spinbuttons and AM/PM toggle"
      exports: ["TimeInput"]
      min_lines: 200
  key_links:
    - from: "packages/time-picker/src/time-input.ts"
      to: "packages/time-picker/src/time-utils.ts"
      via: "imports TimeValue, to12Hour, to24Hour, clampHour, clampMinute"
      pattern: "import.*time-utils"
---

<objective>
Build the time input component with hour/minute spinbuttons, AM/PM toggle, and 12/24-hour format switching.

Purpose: This is the primary interaction surface where users type or arrow-key through time values. The spinbutton pattern provides accessible numeric input following WAI-ARIA APG.
Output: `lui-time-input` internal component ready for composition in the main time-picker.
</objective>

<execution_context>
@/Users/sn0w/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sn0w/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@.planning/phases/48-time-picker-core/48-RESEARCH.md
@.planning/phases/48-time-picker-core/48-01-SUMMARY.md
@packages/time-picker/src/time-utils.ts
@packages/input/src/input.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Hour and minute spinbutton inputs</name>
  <files>packages/time-picker/src/time-input.ts</files>
  <action>
Create `TimeInput` component extending TailwindElement with these properties:

**Properties:**
- `value: TimeValue | null = null` — current time value (attribute: false, since it's an object)
- `hour12: boolean = false` — whether to display in 12-hour format
- `disabled: boolean = false` — disabled state
- `readonly: boolean = false` — readonly state

**Internal state (@state):**
- `focusedField: 'hour' | 'minute' | 'period' = 'hour'`
- `typeAheadBuffer: string = ''`
- `typeAheadTimer: number | undefined`

**Render structure:**
```
<div class="time-input-wrapper">
  <div role="spinbutton" class="hour-input" aria-label="Hour" ...>HH</div>
  <span class="separator">:</span>
  <div role="spinbutton" class="minute-input" aria-label="Minute" ...>MM</div>
  {if hour12:}
  <button class="period-toggle" aria-label="AM/PM toggle: ${period}">AM/PM</button>
</div>
```

**Each spinbutton must have:**
- `role="spinbutton"`
- `tabindex="0"`
- `aria-valuenow` — current numeric value
- `aria-valuemin` — 0 (24h) or 1 (12h) for hours; 0 for minutes
- `aria-valuemax` — 23 (24h) or 12 (12h) for hours; 59 for minutes
- `aria-valuetext` — formatted display text (e.g., "2 PM" for hour in 12h mode, "30" for minutes)

**Keyboard handling per WAI-ARIA Spinbutton Pattern:**
- ArrowUp: Increment value by 1 (hours wrap 23->0 or 12->1; minutes wrap 59->0)
- ArrowDown: Decrement value by 1 (hours wrap 0->23 or 1->12; minutes wrap 0->59)
- Home: Set to minimum value (0 or 1 for hours, 0 for minutes)
- End: Set to maximum value (23 or 12 for hours, 59 for minutes)
- PageUp: Jump +6 hours or +10 minutes
- PageDown: Jump -6 hours or -10 minutes
- Digit keys (0-9): Type-ahead buffer — accumulate digits for ~750ms, then parse as number and clamp to valid range. E.g., pressing "1" then "4" within 750ms = hour 14 (or clamped if in 12h mode).
- Tab: Move to next field (hour -> minute -> period toggle)

**Type-ahead buffer implementation:**
- On digit keypress: append to `typeAheadBuffer`, clear existing timer, set new 750ms timer
- On timer expiry: parse buffer as int, clamp to valid range using `clampHour`/`clampMinute`, apply value, clear buffer
- On non-digit key: immediately apply buffered value if any, clear buffer

**AM/PM toggle button:**
- Only rendered when `hour12` is true
- Displays current period ('AM' or 'PM')
- Click or Space/Enter toggles between AM and PM
- Toggling AM/PM updates the internal 24-hour value via `to24Hour`
- `aria-label="AM/PM toggle: currently ${period}"`

**Dispatching changes:**
- After any value change, dispatch `ui-time-input-change` CustomEvent with `detail: { value: TimeValue }`
- Use `dispatchCustomEvent` from @lit-ui/core if available, otherwise `this.dispatchEvent(new CustomEvent(...))`

**Styling with CSS custom properties:**
- `.time-input-wrapper`: flex row, gap-1, items-center
- Each spinbutton: `min-w-[2.5rem]`, text-center, padding, rounded border
- Focus ring on active spinbutton: `ring-2 ring-blue-500` or via `--ui-time-picker-focus-ring`
- Separator: text-gray-400
- Period toggle: ml-1, px-2, py-1, rounded, border, hover state
- Use `var(--ui-time-picker-*, var(--ui-input-*, fallback))` pattern for all colors/borders
  </action>
  <verify>
Run `npx tsc --noEmit -p packages/time-picker/tsconfig.json` — no type errors. Visually inspect the rendered output by checking the render() method includes both spinbuttons with correct ARIA attributes.
  </verify>
  <done>TimeInput component renders hour/minute spinbuttons with full keyboard navigation (arrows, Home/End, PageUp/Down, type-ahead), AM/PM toggle when hour12=true, and dispatches ui-time-input-change events on value changes.</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit -p packages/time-picker/tsconfig.json` — no type errors
2. TimeInput class exported from time-input.ts
3. Spinbutton role attributes present (role, aria-valuenow, aria-valuemin, aria-valuemax, aria-valuetext)
4. Keyboard handler covers ArrowUp, ArrowDown, Home, End, PageUp, PageDown, digit type-ahead
5. AM/PM toggle only renders when hour12=true
</verification>

<success_criteria>
- Hour spinbutton accepts 0-23 (24h) or 1-12 (12h) with wrapping on increment/decrement
- Minute spinbutton accepts 0-59 with wrapping
- Type-ahead buffer allows typing "14" to set hour 14
- AM/PM toggle preserves actual time when switching period
- All ARIA attributes correct per WAI-ARIA Spinbutton Pattern
- CSS custom properties follow --ui-time-picker-* naming convention
</success_criteria>

<output>
After completion, create `.planning/phases/48-time-picker-core/48-02-SUMMARY.md`
</output>
