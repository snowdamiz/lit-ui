---
phase: 48-time-picker-core
plan: 03
type: execute
wave: 2
depends_on: ["48-01"]
files_modified:
  - packages/time-picker/src/clock-face.ts
autonomous: true

must_haves:
  truths:
    - "User sees a circular clock face with 12 hour markers in 12-hour mode"
    - "User sees inner/outer ring (1-12 outer, 13-23+0 inner) in 24-hour mode"
    - "User sees 60 minute indicators when in minute selection mode"
    - "User can click or drag on clock face to select hour or minute"
    - "Selected value shows a clock hand line from center to selected position"
    - "Clock face selection emits ui-clock-select event with selected value"
  artifacts:
    - path: "packages/time-picker/src/clock-face.ts"
      provides: "ClockFace SVG component with hour/minute selection"
      exports: ["ClockFace"]
      min_lines: 200
  key_links:
    - from: "packages/time-picker/src/clock-face.ts"
      to: "packages/time-picker/src/time-utils.ts"
      via: "imports TimeValue for value representation"
      pattern: "import.*time-utils"
---

<objective>
Build the SVG clock face interface for visual time selection with hour marks, minute indicators, and pointer event interaction.

Purpose: The clock face provides an intuitive visual interface for time selection, complementing the spinbutton inputs. It follows the Material Design inner/outer ring pattern for 24-hour mode.
Output: `ClockFace` internal component ready for composition in the main time-picker popup.
</objective>

<execution_context>
@/Users/sn0w/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sn0w/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@.planning/phases/48-time-picker-core/48-RESEARCH.md
@.planning/phases/48-time-picker-core/48-01-SUMMARY.md
@packages/time-picker/src/time-utils.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Clock face SVG rendering with hour/minute markers</name>
  <files>packages/time-picker/src/clock-face.ts</files>
  <action>
Create `ClockFace` component extending TailwindElement with these properties:

**Properties:**
- `mode: 'hour' | 'minute' = 'hour'` — which ring to display
- `hour: number = 0` — currently selected hour (0-23)
- `minute: number = 0` — currently selected minute (0-59)
- `hour12: boolean = false` — 12 or 24 hour display
- `disabled: boolean = false`

**SVG Layout (viewBox="0 0 240 240"):**
- Center point: (120, 120)
- Outer radius: 100px (for hour numbers 1-12, or minute markers)
- Inner radius: 65px (for 24-hour numbers 13-23 + 0)
- Clock circle: stroke circle at outer radius
- Center dot: small filled circle at (120, 120), r=3

**Hour mode rendering:**
- **12-hour mode:** 12 text labels (1-12) positioned on outer ring at 30-degree intervals
  - Position formula: x = 120 + radius * cos((i * 30 - 90) * PI / 180), same for y with sin
  - 12 is at top (angle -90 degrees = position 0)
- **24-hour mode:** Inner/outer ring pattern (Material Design)
  - Outer ring: numbers 1-12 at radius 85px
  - Inner ring: numbers 13-23 and 0 at radius 55px (smaller font size)
  - 0 is at the "12 o'clock" position on the inner ring
- Each number: `<text>` element, text-anchor="middle", dominant-baseline="central"
- Selected number: highlighted with filled circle behind it (r=16), different text color

**Minute mode rendering:**
- 60 tick marks around outer ring (every 6 degrees)
- Major labels every 5 minutes: 00, 05, 10, 15, 20, 25, 30, 35, 40, 45, 50, 55
- Minor ticks: small circles (r=1) for non-labeled minutes
- Selected minute: highlighted circle behind label, same as hour selection

**Clock hand:**
- `<line>` from center (120, 120) to the selected value's position
- `<circle>` at the selected position (r=16 for highlighted marker, r=3 for hand endpoint if between markers)
- Use CSS transition on hand position for smooth movement between selections

**Styling:**
- Clock circle: `stroke: var(--ui-time-picker-clock-border, #e5e7eb)`, `fill: var(--ui-time-picker-clock-bg, #f9fafb)`
- Number text: `fill: var(--ui-time-picker-clock-text, #374151)`, font-size 14px (outer), 12px (inner ring)
- Selected marker circle: `fill: var(--ui-time-picker-primary, var(--ui-primary, #3b82f6))`
- Selected text: `fill: white`
- Clock hand line: `stroke: var(--ui-time-picker-primary, var(--ui-primary, #3b82f6))`, stroke-width 2
- Center dot: `fill: var(--ui-time-picker-primary, var(--ui-primary, #3b82f6))`
  </action>
  <verify>Run `npx tsc --noEmit -p packages/time-picker/tsconfig.json` — no type errors.</verify>
  <done>Clock face SVG renders correctly with hour markers (12h and 24h inner/outer ring) and minute indicators with visual selection state.</done>
</task>

<task type="auto">
  <name>Task 2: Pointer events interaction for clock face selection</name>
  <files>packages/time-picker/src/clock-face.ts</files>
  <action>
Add pointer event handling to ClockFace for click and drag selection:

**Pointer event handling (unified touch/mouse via Pointer Events API):**
- `@pointerdown` on SVG: Start tracking, set `pointerCapture`, calculate initial value
- `@pointermove` on SVG: If tracking, calculate value from pointer position, update preview
- `@pointerup` on SVG: End tracking, confirm selection, release capture

**Value calculation from pointer position:**
```
1. Get SVG bounding rect
2. Calculate pointer position relative to center:
   dx = pointerX - centerX
   dy = pointerY - centerY
3. Calculate angle: atan2(dy, dx) + 90 degrees (rotate so 12 o'clock = 0)
4. Normalize to 0-360 range
5. For hours: divide by 30 to get 1-12 position
   - For 24h mode: calculate distance from center to determine inner vs outer ring
   - Distance < 75px → inner ring (13-23, 0)
   - Distance >= 75px → outer ring (1-12)
6. For minutes: divide by 6 to get 0-59 position, round to nearest integer
```

**Inner/outer ring detection for 24-hour mode:**
- Calculate distance from center: `Math.sqrt(dx*dx + dy*dy)`
- Scale by SVG viewBox ratio (getBoundingClientRect vs 240)
- threshold at ~70% of outer radius → inner ring = hours 0, 13-23

**Event dispatching:**
- On selection (pointerup or click): dispatch `ui-clock-select` CustomEvent with `detail: { value: number, mode: 'hour' | 'minute' }`
- The parent component will handle transitioning from hour to minute mode after hour selection

**Accessibility:**
- `role="group"` on the SVG with `aria-label="Clock face for ${mode} selection"`
- The clock face is a supplementary visual — primary input is the spinbuttons. Clock face itself does not need keyboard navigation (spinbuttons handle that).
- `aria-hidden="true"` is NOT set since it provides click interaction

**Prevent text selection during drag:**
- Call `e.preventDefault()` on pointerdown
- Use `touch-action: none` CSS on the SVG element
  </action>
  <verify>Run `npx tsc --noEmit -p packages/time-picker/tsconfig.json` — no type errors. Verify pointerdown/pointermove/pointerup handlers exist in the component.</verify>
  <done>Clock face responds to click and drag with correct value calculation including inner/outer ring detection for 24-hour mode. Events dispatched on selection.</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit -p packages/time-picker/tsconfig.json` — no type errors
2. ClockFace class exported from clock-face.ts
3. SVG rendering includes hour markers (12h and 24h modes) and minute indicators
4. Pointer event handlers calculate correct values from position
5. Inner/outer ring detection works for 24-hour mode
6. ui-clock-select event dispatched with value and mode
</verification>

<success_criteria>
- Clock face renders 12 hours (12h mode) or inner/outer ring (24h mode)
- Minute mode shows 60 positions with major labels every 5 minutes
- Click/drag on clock face calculates correct value from position
- Selected value shows highlighted marker and clock hand
- CSS custom properties for all visual elements (--ui-time-picker-clock-*)
</success_criteria>

<output>
After completion, create `.planning/phases/48-time-picker-core/48-03-SUMMARY.md`
</output>
