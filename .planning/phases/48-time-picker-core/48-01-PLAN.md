---
phase: 48-time-picker-core
plan: 01
type: tdd
wave: 1
depends_on: []
files_modified:
  - packages/time-picker/package.json
  - packages/time-picker/tsconfig.json
  - packages/time-picker/vite.config.ts
  - packages/time-picker/src/vite-env.d.ts
  - packages/time-picker/src/time-utils.ts
  - packages/time-picker/src/time-utils.test.ts
  - packages/time-picker/src/time-presets.ts
autonomous: true

must_haves:
  truths:
    - "parseTimeISO correctly parses HH:mm and HH:mm:ss strings into TimeValue objects"
    - "timeToISO converts TimeValue to zero-padded HH:mm:ss string"
    - "to12Hour and to24Hour correctly handle all boundary cases (0, 12, 13, 23)"
    - "isEndTimeAfterStart validates end > start with allow-overnight flag"
    - "Time presets resolve to expected TimeValue objects at call time"
  artifacts:
    - path: "packages/time-picker/package.json"
      provides: "Package configuration with peer dependencies"
      contains: "@lit-ui/time-picker"
    - path: "packages/time-picker/src/time-utils.ts"
      provides: "TimeValue interface and all time utility functions"
      exports: ["TimeValue", "parseTimeISO", "timeToISO", "to12Hour", "to24Hour", "isEndTimeAfterStart", "getDefaultHourCycle", "formatTimeForDisplay", "clampHour", "clampMinute"]
    - path: "packages/time-picker/src/time-presets.ts"
      provides: "TimePreset interface and default presets"
      exports: ["TimePreset", "DEFAULT_TIME_PRESETS", "resolveNow"]
  key_links:
    - from: "packages/time-picker/src/time-utils.ts"
      to: "TimeValue interface"
      via: "All utility functions operate on TimeValue"
      pattern: "TimeValue"
---

<objective>
Set up the @lit-ui/time-picker package and implement time utility functions with TDD.

Purpose: Establish the package foundation and core time manipulation logic that all subsequent plans depend on. TDD ensures correctness of 12/24-hour conversion boundary cases and ISO 8601 parsing.
Output: Working package with tested time-utils.ts and time-presets.ts.
</objective>

<execution_context>
@/Users/sn0w/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sn0w/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/48-time-picker-core/48-RESEARCH.md

Reference existing package patterns:
@packages/date-picker/package.json
@packages/date-picker/tsconfig.json
@packages/date-picker/vite.config.ts
@packages/date-picker/src/preset-types.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Scaffold @lit-ui/time-picker package</name>
  <files>
    packages/time-picker/package.json
    packages/time-picker/tsconfig.json
    packages/time-picker/vite.config.ts
    packages/time-picker/src/vite-env.d.ts
  </files>
  <action>
Create the time-picker package following the exact same structure as @lit-ui/date-picker:

1. **package.json** — name: "@lit-ui/time-picker", same structure as date-picker's package.json. Peer dependencies: @lit-ui/core ^1.0.0, date-fns ^4.0.0, lit ^3.0.0. Dependencies: @floating-ui/dom ^1.7.4. Dev dependencies: same as date-picker (workspace refs for @lit-ui/core, @lit-ui/typescript-config, @lit-ui/vite-config, plus @tailwindcss/vite, date-fns, lit, tailwindcss, typescript, vite, vite-plugin-dts, vitest). Description: "Accessible time picker component built with Lit, Tailwind CSS, and date-fns". Keywords: lit, web-components, ui, tailwind, ssr, time-picker, date-fns. Scripts: dev and build same as date-picker. Note: NO peer dependency on @lit-ui/calendar (time picker doesn't use calendar).

2. **tsconfig.json** — Extends @lit-ui/typescript-config/library.json, outDir ./dist, rootDir ./src, include [src].

3. **vite.config.ts** — `import { createLibraryConfig } from '@lit-ui/vite-config/library'; export default createLibraryConfig({ entry: 'src/index.ts' });`

4. **src/vite-env.d.ts** — `/// <reference types="vite/client" />`

5. Run `pnpm install` from repo root to link the new workspace package.
  </action>
  <verify>
Run `ls packages/time-picker/src/vite-env.d.ts` to confirm file exists. Run `pnpm install` from repo root succeeds without errors.
  </verify>
  <done>Package directory exists with correct package.json, tsconfig.json, vite.config.ts, and pnpm workspace resolution works.</done>
</task>

<task type="auto">
  <name>Task 2: TDD time-utils — TimeValue interface and utility functions</name>
  <files>
    packages/time-picker/src/time-utils.ts
    packages/time-picker/src/time-utils.test.ts
  </files>
  <action>
**RED phase — Write failing tests first** in time-utils.test.ts covering:

1. **parseTimeISO:**
   - `parseTimeISO('14:30:00')` -> `{ hour: 14, minute: 30, second: 0 }`
   - `parseTimeISO('09:05')` -> `{ hour: 9, minute: 5, second: 0 }` (no seconds = default 0)
   - `parseTimeISO('0:00:00')` -> `{ hour: 0, minute: 0, second: 0 }` (midnight)
   - `parseTimeISO('23:59:59')` -> `{ hour: 23, minute: 59, second: 59 }` (max)
   - `parseTimeISO('24:00:00')` -> `null` (out of range)
   - `parseTimeISO('12:60:00')` -> `null` (invalid minutes)
   - `parseTimeISO('invalid')` -> `null`
   - `parseTimeISO('')` -> `null`

2. **timeToISO:**
   - `timeToISO({ hour: 14, minute: 30, second: 0 })` -> `'14:30:00'`
   - `timeToISO({ hour: 0, minute: 0, second: 0 })` -> `'00:00:00'`
   - `timeToISO({ hour: 9, minute: 5, second: 7 })` -> `'09:05:07'`

3. **to12Hour (all boundary cases):**
   - `to12Hour(0)` -> `{ hour: 12, period: 'AM' }` (midnight)
   - `to12Hour(1)` -> `{ hour: 1, period: 'AM' }`
   - `to12Hour(11)` -> `{ hour: 11, period: 'AM' }`
   - `to12Hour(12)` -> `{ hour: 12, period: 'PM' }` (noon)
   - `to12Hour(13)` -> `{ hour: 1, period: 'PM' }`
   - `to12Hour(23)` -> `{ hour: 11, period: 'PM' }`

4. **to24Hour (all boundary cases):**
   - `to24Hour(12, 'AM')` -> `0` (midnight)
   - `to24Hour(1, 'AM')` -> `1`
   - `to24Hour(12, 'PM')` -> `12` (noon)
   - `to24Hour(1, 'PM')` -> `13`
   - `to24Hour(11, 'PM')` -> `23`

5. **isEndTimeAfterStart:**
   - `isEndTimeAfterStart('09:00:00', '17:00:00')` -> `true`
   - `isEndTimeAfterStart('17:00:00', '09:00:00')` -> `false`
   - `isEndTimeAfterStart('09:00:00', '09:00:00')` -> `false` (equal = not after)
   - `isEndTimeAfterStart('23:00:00', '01:00:00', true)` -> `true` (overnight allowed)
   - `isEndTimeAfterStart('', '09:00:00')` -> `true` (empty = skip validation)

6. **clampHour/clampMinute:**
   - `clampHour(-1, false)` -> `0`, `clampHour(24, false)` -> `23` (24h mode)
   - `clampHour(0, true)` -> `1`, `clampHour(13, true)` -> `12` (12h mode)
   - `clampMinute(-1)` -> `0`, `clampMinute(60)` -> `59`

7. **getDefaultHourCycle:**
   - `getDefaultHourCycle('en-US')` -> `'h12'`
   - `getDefaultHourCycle('de-DE')` -> `'h23'`

8. **formatTimeForDisplay:**
   - `formatTimeForDisplay({ hour: 14, minute: 30, second: 0 }, 'en-US', true)` contains `'2:30'` and `'PM'`
   - `formatTimeForDisplay({ hour: 14, minute: 30, second: 0 }, 'en-US', false)` contains `'14:30'`

Run tests — they MUST fail (no implementation yet).

**GREEN phase — Implement time-utils.ts** with:

```typescript
export interface TimeValue {
  hour: number;   // 0-23 (always 24-hour internally)
  minute: number; // 0-59
  second: number; // 0-59 (default 0)
}
```

Implement all functions from the research document: `parseTimeISO`, `timeToISO`, `to12Hour`, `to24Hour`, `isEndTimeAfterStart`, `clampHour`, `clampMinute`, `getDefaultHourCycle`, `formatTimeForDisplay`.

Key implementation details:
- `parseTimeISO`: Use regex `/^(\d{1,2}):(\d{2})(?::(\d{2}))?$/`, validate ranges 0-23/0-59/0-59
- `to12Hour`: Handle 0->12AM, 12->12PM explicitly per research Pitfall 1
- `isEndTimeAfterStart`: Convert to total minutes for comparison, respect allowOvernight flag
- `getDefaultHourCycle`: Use `Intl.DateTimeFormat(locale, {hour:'numeric'}).resolvedOptions().hourCycle`
- `formatTimeForDisplay`: Create a Date object, set hours/minutes, use `Intl.DateTimeFormat` with `hour:'numeric', minute:'2-digit', hour12`

Run tests — they MUST all pass.
  </action>
  <verify>Run `cd packages/time-picker && npx vitest run src/time-utils.test.ts` — all tests pass.</verify>
  <done>TimeValue interface exported. All utility functions implemented with passing tests covering boundary cases.</done>
</task>

<task type="auto">
  <name>Task 3: Time preset types and defaults</name>
  <files>packages/time-picker/src/time-presets.ts</files>
  <action>
Create time-presets.ts following the exact same pattern as packages/date-picker/src/preset-types.ts:

```typescript
export interface TimePreset {
  /** Display label for the preset button */
  label: string;
  /** Function that returns the resolved TimeValue when called */
  resolve: () => TimeValue;
}
```

Import TimeValue from './time-utils.js'.

Define `DEFAULT_TIME_PRESETS: TimePreset[]` with:
- Morning: `{ hour: 9, minute: 0, second: 0 }`
- Afternoon: `{ hour: 14, minute: 0, second: 0 }`
- Evening: `{ hour: 18, minute: 0, second: 0 }`

Resolver functions called at click time (not import time) for SSR safety — exactly like date-picker preset pattern.

Define `resolveNow(): TimeValue` function that returns current time from `new Date()`.
  </action>
  <verify>Run `npx tsc --noEmit -p packages/time-picker/tsconfig.json` — no type errors.</verify>
  <done>TimePreset interface, DEFAULT_TIME_PRESETS array, and resolveNow function exported.</done>
</task>

</tasks>

<verification>
1. `ls packages/time-picker/src/time-utils.ts packages/time-picker/src/time-presets.ts` — both exist
2. `cd packages/time-picker && npx vitest run` — all tests pass
3. `npx tsc --noEmit -p packages/time-picker/tsconfig.json` — no type errors
</verification>

<success_criteria>
- Package scaffolded with correct dependencies matching date-picker pattern
- TimeValue interface and all utility functions implemented with passing TDD tests
- 12/24-hour conversion boundary cases verified (0, 12, 13, 23)
- TimePreset type and defaults follow date-picker preset pattern
- pnpm workspace resolution works
</success_criteria>

<output>
After completion, create `.planning/phases/48-time-picker-core/48-01-SUMMARY.md`
</output>
