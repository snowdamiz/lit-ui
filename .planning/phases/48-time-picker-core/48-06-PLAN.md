---
phase: 48-time-picker-core
plan: 06
type: execute
wave: 4
depends_on: ["48-05"]
files_modified:
  - packages/time-picker/src/time-picker.ts
  - packages/time-picker/src/time-input.ts
  - packages/time-picker/src/clock-face.ts
  - packages/time-picker/src/time-dropdown.ts
  - packages/time-picker/src/index.ts
  - packages/time-picker/src/jsx.d.ts
autonomous: true

must_haves:
  truths:
    - "All time picker components render correctly in dark mode via :host-context(.dark)"
    - "import '@lit-ui/time-picker' registers lui-time-picker custom element"
    - "TimePicker, TimeValue, TimePreset types available as named exports"
    - "JSX types allow using <lui-time-picker> in React/Vue/Svelte with type checking"
    - "Package builds without errors via vite build"
  artifacts:
    - path: "packages/time-picker/src/index.ts"
      provides: "Package exports and custom element registration"
      exports: ["TimePicker", "TimeValue", "TimePreset", "DEFAULT_TIME_PRESETS", "resolveNow", "parseTimeISO", "timeToISO", "formatTimeForDisplay"]
    - path: "packages/time-picker/src/jsx.d.ts"
      provides: "JSX type declarations for React and framework integration"
      contains: "LuiTimePickerAttributes"
  key_links:
    - from: "packages/time-picker/src/index.ts"
      to: "packages/time-picker/src/time-picker.ts"
      via: "customElements.define('lui-time-picker', TimePicker)"
      pattern: "customElements.define"
    - from: "packages/time-picker/src/time-picker.ts"
      to: "HTMLElementTagNameMap"
      via: "declare global interface HTMLElementTagNameMap"
      pattern: "HTMLElementTagNameMap"
---

<objective>
Add dark mode support, package exports, custom element registration, and JSX type declarations for the time picker.

Purpose: Finalize the time picker package for consumption — dark mode for visual polish, exports for API surface, JSX types for framework integration.
Output: Complete, buildable @lit-ui/time-picker package ready for use.
</objective>

<execution_context>
@/Users/sn0w/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sn0w/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@.planning/phases/48-time-picker-core/48-RESEARCH.md
@.planning/phases/48-time-picker-core/48-05-SUMMARY.md
@packages/date-picker/src/index.ts
@packages/date-picker/src/jsx.d.ts
@packages/date-range-picker/src/jsx.d.ts
@packages/time-picker/src/time-picker.ts
@packages/time-picker/src/time-input.ts
@packages/time-picker/src/clock-face.ts
@packages/time-picker/src/time-dropdown.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Dark mode styles for all time picker components</name>
  <files>
    packages/time-picker/src/time-picker.ts
    packages/time-picker/src/time-input.ts
    packages/time-picker/src/clock-face.ts
    packages/time-picker/src/time-dropdown.ts
  </files>
  <action>
Add `:host-context(.dark)` CSS rules to each component's styles, following the established project pattern (Phase 42-08, 47-05 decisions):

**time-picker.ts dark mode:**
- Input display: dark bg (`var(--ui-time-picker-bg, #111827)`), dark border (`var(--ui-time-picker-border, #374151)`), light text
- Popup: dark bg, dark border, shadow adjusted for dark backgrounds
- Label: light text color
- Clear button / toggle button: light icon color, dark hover bg
- Error message: red-400 (lighter for dark backgrounds)
- Preset buttons: dark bg, light text, dark hover bg, dark border

**time-input.ts dark mode:**
- Spinbutton fields: dark bg, light text, dark border
- Focus ring: blue-400 (slightly lighter for dark)
- Separator: gray-500
- AM/PM toggle: dark bg, light text, dark border

**clock-face.ts dark mode:**
- Clock circle: dark fill (`#1f2937`), dark stroke (`#374151`)
- Number text: light color (`#d1d5db`)
- Selected marker: primary color (unchanged, works on both)
- Clock hand: primary color (unchanged)
- Center dot: primary color

**time-dropdown.ts dark mode:**
- Option text: light color
- Option hover bg: `#374151`
- Selected option bg: dark blue tint, lighter text
- Scrollbar: dark track and thumb
- Border: dark border

Use the pattern:
```css
:host-context(.dark) .class-name {
  property: var(--ui-time-picker-dark-variant, dark-fallback);
}
```

Ensure all CSS custom properties have fallback chain: `--ui-time-picker-* -> --ui-input-* -> hardcoded fallback`.
  </action>
  <verify>Run `npx tsc --noEmit -p packages/time-picker/tsconfig.json` — no type errors. Grep for `:host-context(.dark)` in all four component files to confirm dark mode rules exist.</verify>
  <done>All four time picker component files have :host-context(.dark) CSS rules with appropriate dark colors for backgrounds, borders, text, and interactive states.</done>
</task>

<task type="auto">
  <name>Task 2: Package exports, custom element registration, and JSX types</name>
  <files>
    packages/time-picker/src/index.ts
    packages/time-picker/src/jsx.d.ts
    packages/time-picker/src/time-picker.ts
  </files>
  <action>
**1. index.ts** — Follow the exact pattern from packages/date-picker/src/index.ts:

```typescript
// @lit-ui/time-picker - Accessible time picker component with SSR support
/// <reference path="./jsx.d.ts" />
import { isServer } from 'lit';

// Export component class
export { TimePicker } from './time-picker.js';

// Export utility functions for consumer reuse
export {
  parseTimeISO,
  timeToISO,
  formatTimeForDisplay,
  getDefaultHourCycle,
  to12Hour,
  to24Hour,
  isEndTimeAfterStart,
} from './time-utils.js';
export type { TimeValue } from './time-utils.js';

// Export preset types and defaults
export type { TimePreset } from './time-presets.js';
export { DEFAULT_TIME_PRESETS, resolveNow } from './time-presets.js';

// Re-export TailwindElement and isServer for convenience
export { TailwindElement, isServer } from '@lit-ui/core';

// Safe custom element registration with collision detection
import { TimePicker } from './time-picker.js';

if (typeof customElements !== 'undefined') {
  if (!customElements.get('lui-time-picker')) {
    customElements.define('lui-time-picker', TimePicker);
  } else if (!isServer && import.meta.env?.DEV) {
    console.warn(
      '[lui-time-picker] Custom element already registered. ' +
        'This may indicate duplicate imports or version conflicts.'
    );
  }
}
```

Note: Internal components (TimeInput, ClockFace, TimeDropdown) are NOT exported — they are implementation details registered internally by the main component.

Register internal custom elements inside their respective component files (or in time-picker.ts):
- `lui-time-input` -> TimeInput
- `lui-clock-face` -> ClockFace
- `lui-time-dropdown` -> TimeDropdown

Each with the same safe registration pattern (check customElements.get first).

**2. HTMLElementTagNameMap** — Add to time-picker.ts (NOT index.ts, per Phase 44-05 decision):

```typescript
declare global {
  interface HTMLElementTagNameMap {
    'lui-time-picker': TimePicker;
  }
}
```

**3. jsx.d.ts** — Follow the pattern from packages/date-range-picker/src/jsx.d.ts, separating attributes and events:

```typescript
import type { TimePicker } from './time-picker.js';

// Separate JS-only props (presets) from HTML attributes
interface LuiTimePickerAttributes {
  value?: string;
  name?: string;
  label?: string;
  placeholder?: string;
  required?: boolean;
  disabled?: boolean;
  readonly?: boolean;
  hour12?: boolean;
  locale?: string;
  step?: number;
  'min-time'?: string;
  'max-time'?: string;
  'allow-overnight'?: boolean;
  'show-timezone'?: boolean;
  timezone?: string;
  'interface-mode'?: 'clock' | 'dropdown' | 'both';
  class?: string;
  id?: string;
  slot?: string;
  style?: string | Record<string, string>;
}

interface LuiTimePickerEvents {
  onchange?: (event: CustomEvent<{ value: string }>) => void;
  'on:change'?: (event: CustomEvent<{ value: string }>) => void;
}

type LuiTimePickerProps = LuiTimePickerAttributes & LuiTimePickerEvents;

// React JSX
declare namespace JSX {
  interface IntrinsicElements {
    'lui-time-picker': LuiTimePickerProps;
  }
}

// Preact JSX
declare module 'preact' {
  namespace JSX {
    interface IntrinsicElements {
      'lui-time-picker': LuiTimePickerProps;
    }
  }
}

// Svelte — uses HTMLElementTagNameMap automatically
// Vue — uses HTMLElementTagNameMap via defineCustomElement
```

**Note:** `presets` property is excluded from JSX attributes (attribute: false, JS-only) per Phase 47-05 pattern.

**4. Build verification:**
- Run `cd packages/time-picker && pnpm build` to verify the package builds
- Check that dist/ contains index.js and index.d.ts
  </action>
  <verify>
1. Run `cd packages/time-picker && pnpm build` — builds without errors
2. Run `ls packages/time-picker/dist/index.js packages/time-picker/dist/index.d.ts` — both exist
3. Run `npx tsc --noEmit -p packages/time-picker/tsconfig.json` — no type errors
  </verify>
  <done>Package exports all public API (TimePicker, TimeValue, TimePreset, utility functions), custom element registered as lui-time-picker, JSX types enable framework type checking, package builds successfully.</done>
</task>

</tasks>

<verification>
1. `cd packages/time-picker && pnpm build` — builds without errors
2. `ls packages/time-picker/dist/` — contains index.js and index.d.ts
3. Grep for `:host-context(.dark)` in all component files — dark mode rules present
4. Grep for `customElements.define` in index.ts — lui-time-picker registered
5. `packages/time-picker/src/jsx.d.ts` exists with LuiTimePickerAttributes interface
6. HTMLElementTagNameMap declaration in time-picker.ts
</verification>

<success_criteria>
- All components render correctly in dark mode with :host-context(.dark) selectors
- Package exports: TimePicker class, TimeValue/TimePreset types, utility functions, resolveNow
- Custom element registration: lui-time-picker (public), lui-time-input/lui-clock-face/lui-time-dropdown (internal)
- JSX types: React, Preact intrinsic elements with attribute types
- HTMLElementTagNameMap: lui-time-picker mapped to TimePicker class
- Package builds successfully with vite
- presets property excluded from JSX attributes (attribute: false)
</success_criteria>

<output>
After completion, create `.planning/phases/48-time-picker-core/48-06-SUMMARY.md`
</output>
