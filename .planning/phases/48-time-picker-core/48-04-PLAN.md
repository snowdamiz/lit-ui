---
phase: 48-time-picker-core
plan: 04
type: execute
wave: 2
depends_on: ["48-01"]
files_modified:
  - packages/time-picker/src/time-dropdown.ts
autonomous: true

must_haves:
  truths:
    - "User sees a scrollable list of time options at configurable step intervals"
    - "User can click a time option to select it"
    - "User can navigate dropdown with ArrowUp/ArrowDown keys"
    - "Selected time option is visually highlighted and has aria-selected=true"
    - "Dropdown generates correct options based on step (default 30-min = 48 options)"
  artifacts:
    - path: "packages/time-picker/src/time-dropdown.ts"
      provides: "TimeDropdown listbox component for desktop time selection"
      exports: ["TimeDropdown"]
      min_lines: 100
  key_links:
    - from: "packages/time-picker/src/time-dropdown.ts"
      to: "packages/time-picker/src/time-utils.ts"
      via: "imports TimeValue, timeToISO, formatTimeForDisplay"
      pattern: "import.*time-utils"
---

<objective>
Build the dropdown time selection interface as a desktop alternative to the clock face.

Purpose: The dropdown provides a familiar listbox pattern for quick time selection at fixed intervals (e.g., every 30 minutes), commonly preferred on desktop for its simplicity.
Output: `TimeDropdown` internal component ready for composition in the main time-picker popup.
</objective>

<execution_context>
@/Users/sn0w/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sn0w/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@.planning/phases/48-time-picker-core/48-RESEARCH.md
@.planning/phases/48-time-picker-core/48-01-SUMMARY.md
@packages/time-picker/src/time-utils.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Time option generation and dropdown rendering</name>
  <files>packages/time-picker/src/time-dropdown.ts</files>
  <action>
Create `TimeDropdown` component extending TailwindElement with these properties:

**Properties:**
- `value: TimeValue | null = null` — currently selected time (attribute: false)
- `step: number = 30` — interval in minutes between options (min 1, max 60)
- `hour12: boolean = false` — display format
- `locale: string = 'en-US'` — locale for formatting
- `disabled: boolean = false`
- `minTime: string = ''` — minimum selectable time as HH:mm (for filtering options)
- `maxTime: string = ''` — maximum selectable time as HH:mm

**Internal state:**
- `highlightedIndex: number = -1` — keyboard navigation position
- `options: Array<{ value: TimeValue, display: string, iso: string }>` — computed option list

**Option generation (`generateTimeOptions`):**
- Start at 00:00, increment by `step` minutes until 23:59
- For each slot: create TimeValue, format display text using `formatTimeForDisplay`, generate ISO string via `timeToISO`
- Filter out options before minTime or after maxTime if specified
- For step=30: generates 48 options (00:00, 00:30, 01:00, ..., 23:30)
- For step=15: generates 96 options
- For step=60: generates 24 options
- Recompute when `step`, `minTime`, `maxTime`, `hour12`, or `locale` change (use `willUpdate`)

**Render structure:**
```html
<div class="time-dropdown-wrapper" role="listbox" aria-label="Select time">
  ${options.map((opt, i) => html`
    <div
      role="option"
      class="time-option ${isSelected ? 'selected' : ''} ${isHighlighted ? 'highlighted' : ''}"
      aria-selected=${isSelected ? 'true' : 'false'}
      @click=${() => selectOption(opt)}
      @pointerenter=${() => highlightedIndex = i}
    >${opt.display}</div>
  `)}
</div>
```

- Selected option: compare `opt.value.hour === value?.hour && opt.value.minute === value?.minute`
- Auto-scroll selected option into view on first render (`firstUpdated`) and when value changes

**Keyboard navigation:**
- ArrowDown: Move highlight down, wrap to top
- ArrowUp: Move highlight up, wrap to bottom
- Enter/Space: Select highlighted option
- Home: Jump to first option
- End: Jump to last option
- Type-ahead: Match by display text (first letter matching)

**Event dispatching:**
- On option selection: dispatch `ui-time-dropdown-select` CustomEvent with `detail: { value: TimeValue }`

**Styling:**
- Wrapper: `max-h-[240px]` (shows ~8 options), overflow-y auto, border, rounded
- Each option: `px-3 py-2`, cursor-pointer, hover bg
- Selected option: `bg-blue-50 text-blue-700 font-medium` (or via --ui-time-picker-selected-bg, --ui-time-picker-selected-text)
- Highlighted option: `bg-gray-100` (keyboard focus indicator)
- Scrollbar: thin styled via CSS
- Use `var(--ui-time-picker-*, var(--ui-input-*, fallback))` pattern
  </action>
  <verify>Run `npx tsc --noEmit -p packages/time-picker/tsconfig.json` — no type errors. Verify option generation produces correct count for step=30 (48 options) and step=15 (96 options).</verify>
  <done>TimeDropdown renders scrollable listbox of time options at configurable intervals with keyboard navigation, selection highlighting, and auto-scroll to selected item.</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit -p packages/time-picker/tsconfig.json` — no type errors
2. TimeDropdown class exported from time-dropdown.ts
3. Option generation produces 48 options for step=30
4. role="listbox" and role="option" with aria-selected present
5. Keyboard navigation (ArrowUp/Down, Enter, Home/End) implemented
6. ui-time-dropdown-select event dispatched on selection
</verification>

<success_criteria>
- Dropdown generates correct number of options based on step interval
- Options display locale-aware formatted time via Intl.DateTimeFormat
- Selected option visually distinguished and has aria-selected="true"
- Keyboard navigation with ArrowUp/Down, Enter, Home/End works correctly
- Auto-scrolls to selected option on open
- CSS custom properties for theming
</success_criteria>

<output>
After completion, create `.planning/phases/48-time-picker-core/48-04-SUMMARY.md`
</output>
