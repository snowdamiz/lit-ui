---
phase: 25-docs-site-dark-mode
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/docs/src/contexts/ThemeContext.tsx
  - apps/docs/index.html
  - apps/docs/src/index.css
  - apps/docs/src/main.tsx
autonomous: true

must_haves:
  truths:
    - "Theme state is globally accessible via React context"
    - "Theme persists in localStorage across sessions"
    - "No flash of wrong theme on page load"
    - "Tailwind dark: variant works with class-based dark mode"
  artifacts:
    - path: "apps/docs/src/contexts/ThemeContext.tsx"
      provides: "ThemeProvider and useTheme hook"
      exports: ["ThemeProvider", "useTheme"]
    - path: "apps/docs/index.html"
      provides: "FOUC prevention script"
      contains: "localStorage.getItem('theme')"
    - path: "apps/docs/src/index.css"
      provides: "Dark mode CSS custom variant and variables"
      contains: "@custom-variant dark"
  key_links:
    - from: "apps/docs/src/main.tsx"
      to: "ThemeProvider"
      via: "context wrapper"
      pattern: "ThemeProvider"
    - from: "apps/docs/index.html"
      to: "localStorage"
      via: "inline script"
      pattern: "classList.add.*dark"
---

<objective>
Create the foundational theme infrastructure for dark mode support.

Purpose: Enable global theme state management with localStorage persistence and prevent flash of wrong theme on page load.
Output: ThemeContext, FOUC prevention script, Tailwind CSS v4 dark mode configuration.
</objective>

<execution_context>
@/Users/sn0w/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sn0w/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/25-docs-site-dark-mode/25-RESEARCH.md
@.planning/phases/25-docs-site-dark-mode/25-CONTEXT.md
@apps/docs/src/contexts/ConfiguratorContext.tsx
@apps/docs/src/main.tsx
@apps/docs/src/index.css
@apps/docs/index.html
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ThemeContext with localStorage persistence</name>
  <files>apps/docs/src/contexts/ThemeContext.tsx</files>
  <action>
Create a new ThemeContext following the pattern established by ConfiguratorContext.

The context should:
1. Export `ThemeProvider` component and `useTheme` hook
2. Manage theme state as `'light' | 'dark'`
3. Initialize state by reading the current dark class on document.documentElement (set by FOUC script)
4. Provide `theme` value and `setTheme` function
5. When `setTheme` is called:
   - Update React state
   - Save to localStorage with key 'theme'
   - Toggle 'dark' class on document.documentElement
6. Wrap localStorage calls in try-catch for private browsing compatibility

Follow the exact pattern from RESEARCH.md:
```typescript
interface ThemeContextValue {
  theme: 'light' | 'dark';
  setTheme: (theme: 'light' | 'dark') => void;
}
```

Do NOT add system preference detection here - that's handled by the FOUC script.
  </action>
  <verify>File exists with correct exports, no TypeScript errors</verify>
  <done>ThemeContext exports ThemeProvider and useTheme, manages theme state with localStorage sync</done>
</task>

<task type="auto">
  <name>Task 2: Add FOUC prevention script to index.html</name>
  <files>apps/docs/index.html</files>
  <action>
Add an inline blocking script in the `<head>` section BEFORE the closing `</head>` tag.

The script should:
1. Run immediately (IIFE pattern)
2. Try to read 'theme' from localStorage
3. If theme is 'dark' OR (no saved theme AND system prefers dark mode), add 'dark' class to html element
4. Wrap in try-catch for localStorage errors
5. Default to light mode for first-time visitors with no system preference (per CONTEXT.md)

Use this exact pattern from RESEARCH.md:
```html
<script>
  (function() {
    try {
      var theme = localStorage.getItem('theme');
      if (theme === 'dark' || (!theme && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
        document.documentElement.classList.add('dark');
      }
    } catch (e) {}
  })();
</script>
```

Place this script AFTER the Google Fonts link but BEFORE the closing `</head>` tag.
  </action>
  <verify>View page source shows script in head, dark class applied based on preference</verify>
  <done>FOUC prevention script sets dark class before React hydration</done>
</task>

<task type="auto">
  <name>Task 3: Configure Tailwind CSS v4 dark mode and add dark CSS variables</name>
  <files>apps/docs/src/index.css</files>
  <action>
Modify index.css to enable class-based dark mode and add dark mode color variables.

1. Add the custom variant AFTER the @import "tailwindcss" line:
```css
@custom-variant dark (&:where(.dark, .dark *));
```

2. Add a `.dark` selector block AFTER the `@theme` block with dark mode semantic colors.
Use shadcn-inspired neutral dark palette (per CONTEXT.md):
```css
.dark {
  --color-background: oklch(0.10 0 0);
  --color-foreground: oklch(0.95 0 0);
  --color-muted-foreground: oklch(0.65 0 0);
  --color-border: oklch(0.25 0 0);
  --color-card: oklch(0.12 0 0);
}
```

3. Update utility classes that need dark variants:
- `.grid-pattern` - adjust grid line color for dark mode
- `.hero-gradient` - adjust gradient for dark mode
- `.bottom-fade` - adjust fade to dark background
- `.focus-ring` - adjust focus ring for dark mode
- `::selection` - adjust selection colors for dark mode

Use the `dark:` prefix in Tailwind classes OR add `.dark` selector overrides in CSS.
For the utility classes that are defined in CSS, add `.dark` overrides.
  </action>
  <verify>Build succeeds, dark mode variables cascade when .dark class present on html</verify>
  <done>Tailwind dark: variant works, dark mode CSS variables defined, utility classes have dark variants</done>
</task>

</tasks>

<verification>
1. Run `cd apps/docs && npm run build` - should succeed
2. Run `cd apps/docs && npm run dev` and manually test:
   - Add `class="dark"` to html element in DevTools
   - Verify CSS variables change (check computed styles on body)
   - Remove class, verify variables revert
3. Check that ThemeContext has no TypeScript errors
</verification>

<success_criteria>
- ThemeContext.tsx exists with ThemeProvider and useTheme exports
- index.html has inline FOUC prevention script in head
- index.css has @custom-variant dark and .dark variable overrides
- Build passes with no errors
- Dark mode variables apply when .dark class is on html element
</success_criteria>

<output>
After completion, create `.planning/phases/25-docs-site-dark-mode/25-01-SUMMARY.md`
</output>
