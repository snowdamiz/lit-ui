---
phase: 61-core-table-shell-virtualization
plan: 02
type: execute
wave: 2
depends_on: ["61-01"]
files_modified:
  - packages/data-table/src/data-table.ts
  - packages/data-table/src/index.ts
autonomous: true

must_haves:
  truths:
    - "User sees table with columns and rows rendered from column definitions and data array"
    - "User sees header row with column names"
    - "Table uses div-based layout with role=grid ARIA structure"
  artifacts:
    - path: "packages/data-table/src/data-table.ts"
      provides: "Main DataTable component with TableController"
      min_lines: 150
      exports: ["DataTable"]
    - path: "packages/data-table/src/index.ts"
      provides: "Updated exports including DataTable"
      exports: ["DataTable", "ColumnDef"]
  key_links:
    - from: "packages/data-table/src/data-table.ts"
      to: "@tanstack/lit-table"
      via: "TableController import"
      pattern: "TableController"
    - from: "packages/data-table/src/data-table.ts"
      to: "packages/data-table/src/types.ts"
      via: "ColumnDef import"
      pattern: "import.*ColumnDef.*from.*types"
---

<objective>
Implement the core DataTable component with TanStack Table integration for basic rendering.

Purpose: Create the foundational lui-data-table custom element that renders columns and rows using TanStack Table's TableController. This establishes the core rendering pipeline before adding virtualization.

Output:
- Working lui-data-table component that renders data
- Basic CSS Grid layout for table structure
- Proper ARIA grid structure (role="grid", role="row", role="gridcell")
</objective>

<execution_context>
@/Users/sn0w/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sn0w/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/61-core-table-shell-virtualization/61-RESEARCH.md
@.planning/phases/61-core-table-shell-virtualization/61-01-SUMMARY.md
@packages/tabs/src/tabs.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create DataTable component with TableController</name>
  <files>
    packages/data-table/src/data-table.ts
  </files>
  <action>
Create the main DataTable component following patterns from research and existing components:

```typescript
/**
 * lui-data-table - A high-performance data table with virtual scrolling
 *
 * Features (Phase 61):
 * - Renders columns and rows from column definitions
 * - TanStack Table for headless state management
 * - Div-based layout with ARIA grid pattern
 * - CSS Grid for column sizing
 * - SSR compatible via isServer guards
 *
 * @example
 * ```html
 * <lui-data-table
 *   .columns=${columns}
 *   .data=${data}
 * ></lui-data-table>
 * ```
 */

import { html, css, isServer, type PropertyValues } from 'lit';
import { property, state } from 'lit/decorators.js';
import { TailwindElement, tailwindBaseStyles } from '@lit-ui/core';
import {
  TableController,
  getCoreRowModel,
  flexRender,
  type RowData,
} from '@tanstack/lit-table';
import type { ColumnDef, LoadingState, EmptyStateType } from './types.js';
```

Key implementation points:

1. **Properties**:
   - `columns: ColumnDef<TData>[]` - Column definitions array
   - `data: TData[]` - Row data array
   - `loading: LoadingState` - 'idle' | 'loading' | 'updating'
   - `rowHeight: number` - Fixed row height for virtualization (default 48)
   - `ariaLabel: string` - Accessible label for the grid

2. **TableController setup**:
   - Initialize TableController in constructor
   - Call `this.tableController.table({...})` in render
   - Pass columns, data, getCoreRowModel()

3. **Render structure** (div-based, NOT native table):
   ```html
   <div class="data-table-container">
     <div class="data-table-header" role="rowgroup">
       <div class="data-table-row header-row" role="row">
         ${headerCells}
       </div>
     </div>
     <div class="data-table-body" role="rowgroup">
       ${rows}
     </div>
   </div>
   ```

4. **ARIA attributes**:
   - Container: `role="grid"`, `aria-rowcount`, `aria-colcount`, `aria-label`
   - Header: `role="columnheader"`, `aria-colindex`
   - Cells: `role="gridcell"`, `aria-colindex`
   - Rows: `role="row"`, `aria-rowindex`

5. **CSS Grid layout**:
   - Use CSS Grid with `grid-template-columns` for column widths
   - Default column widths from column definitions or equal distribution

6. **flexRender usage**:
   - Use TanStack's flexRender for header and cell rendering
   - Handles both string and function renderers

Do NOT implement:
- Virtualization (Plan 03)
- Loading/empty states (Plan 04)
- Keyboard navigation (Plan 05)

Keep this plan focused on basic rendering only.
  </action>
  <verify>
    pnpm --filter @lit-ui/data-table build succeeds
    No TypeScript errors in data-table.ts
  </verify>
  <done>
    DataTable component renders columns and rows
    ARIA grid structure in place (role="grid", role="row", role="gridcell")
  </done>
</task>

<task type="auto">
  <name>Task 2: Add CSS styles and update exports</name>
  <files>
    packages/data-table/src/data-table.ts
    packages/data-table/src/index.ts
  </files>
  <action>
Add CSS styles to DataTable and update package exports:

1. **CSS styles in data-table.ts** (add to static styles):

```css
:host {
  display: block;
  --ui-data-table-header-bg: var(--color-muted, #f4f4f5);
  --ui-data-table-row-bg: var(--color-background, #ffffff);
  --ui-data-table-row-hover-bg: var(--color-muted, #f4f4f5);
  --ui-data-table-border-color: var(--color-border, #e4e4e7);
  --ui-data-table-text-color: var(--color-foreground, #09090b);
  --ui-data-table-header-text: var(--color-muted-foreground, #71717a);
  --ui-data-table-row-height: 48px;
  --ui-data-table-header-height: 48px;
  --ui-data-table-cell-padding: 0.75rem 1rem;
  --ui-data-table-font-size: 0.875rem;
  --ui-data-table-header-font-weight: 500;
}

:host-context(.dark) {
  --ui-data-table-header-bg: #27272a;
  --ui-data-table-row-bg: #09090b;
  --ui-data-table-row-hover-bg: #27272a;
  --ui-data-table-border-color: #3f3f46;
  --ui-data-table-text-color: #fafafa;
  --ui-data-table-header-text: #a1a1aa;
}

.data-table-container {
  width: 100%;
  border: 1px solid var(--ui-data-table-border-color);
  border-radius: var(--ui-radius, 0.5rem);
  overflow: hidden;
}

.data-table-header {
  position: sticky;
  top: 0;
  z-index: 10;
  background: var(--ui-data-table-header-bg);
  border-bottom: 1px solid var(--ui-data-table-border-color);
}

.data-table-row {
  display: grid;
  min-height: var(--ui-data-table-row-height);
  align-items: center;
}

.data-table-row:not(.header-row) {
  background: var(--ui-data-table-row-bg);
  border-bottom: 1px solid var(--ui-data-table-border-color);
}

.data-table-row:not(.header-row):last-child {
  border-bottom: none;
}

.data-table-row:not(.header-row):hover {
  background: var(--ui-data-table-row-hover-bg);
}

.data-table-cell {
  padding: var(--ui-data-table-cell-padding);
  font-size: var(--ui-data-table-font-size);
  color: var(--ui-data-table-text-color);
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.data-table-header-cell {
  padding: var(--ui-data-table-cell-padding);
  font-size: var(--ui-data-table-font-size);
  font-weight: var(--ui-data-table-header-font-weight);
  color: var(--ui-data-table-header-text);
  text-align: left;
}
```

2. **Update index.ts**:
```typescript
export * from './types.js';
export { DataTable } from './data-table.js';
```

3. **Register custom element** at end of data-table.ts:
```typescript
if (!isServer) {
  customElements.define('lui-data-table', DataTable);
}

declare global {
  interface HTMLElementTagNameMap {
    'lui-data-table': DataTable;
  }
}
```
  </action>
  <verify>
    pnpm --filter @lit-ui/data-table build succeeds
    Check dist/index.js exports DataTable
  </verify>
  <done>
    Component has CSS styling for table layout
    DataTable exported from package index
    Custom element registered as lui-data-table
  </done>
</task>

</tasks>

<verification>
1. `pnpm --filter @lit-ui/data-table build` succeeds without errors
2. TypeScript compiles without errors
3. `dist/data-table.js` contains the DataTable class
4. CSS custom properties defined for theming
5. ARIA roles present in render output
</verification>

<success_criteria>
- DataTable component renders column headers from column definitions
- DataTable component renders rows from data array
- ARIA grid structure: role="grid" container with role="row" and role="gridcell"
- CSS Grid layout with configurable column widths
- Dark mode support via :host-context(.dark)
- Build succeeds, TypeScript clean
</success_criteria>

<output>
After completion, create `.planning/phases/61-core-table-shell-virtualization/61-02-SUMMARY.md`
</output>
