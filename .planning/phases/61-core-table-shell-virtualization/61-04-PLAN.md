---
phase: 61-core-table-shell-virtualization
plan: 04
type: execute
wave: 3
depends_on: ["61-02"]
files_modified:
  - packages/data-table/src/data-table.ts
autonomous: true

must_haves:
  truths:
    - "User sees skeleton loaders during initial data fetch"
    - "User sees loading overlay during data updates (sort, filter)"
    - "User sees 'No data' message when data array is empty"
    - "User sees 'No matches' message when filters return zero results"
  artifacts:
    - path: "packages/data-table/src/data-table.ts"
      provides: "Loading and empty state rendering"
      contains: "skeleton"
  key_links:
    - from: "packages/data-table/src/data-table.ts"
      to: "loading property"
      via: "conditional rendering"
      pattern: "this.loading.*skeleton|loading.*overlay"
---

<objective>
Add loading states and empty states to DataTable component.

Purpose: Provide clear visual feedback during data loading (skeleton loaders for initial load, overlay for updates) and when no data is available (distinguishing between empty dataset and no filter matches).

Output:
- Skeleton loader rows during initial loading
- Semi-transparent overlay during updates
- Empty state with icon and message for no data
- Empty state with different message for no filter matches
</objective>

<execution_context>
@/Users/sn0w/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sn0w/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/61-core-table-shell-virtualization/61-RESEARCH.md
@.planning/phases/61-core-table-shell-virtualization/61-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add skeleton loading state</name>
  <files>
    packages/data-table/src/data-table.ts
  </files>
  <action>
Implement skeleton loading state for initial data fetch:

1. **Add loading-related properties**:
```typescript
/**
 * Loading state of the table.
 * - 'idle': No loading in progress
 * - 'loading': Initial data fetch (shows skeleton)
 * - 'updating': Data update in progress (shows overlay)
 * @default 'idle'
 */
@property({ type: String })
loading: LoadingState = 'idle';

/**
 * Number of skeleton rows to show during initial loading.
 * @default 5
 */
@property({ type: Number })
skeletonRows = 5;
```

2. **Create skeleton row renderer**:
```typescript
private renderSkeletonRows(): TemplateResult {
  const gridTemplateColumns = this.columns
    .map(() => '1fr')
    .join(' ');

  return html`
    <div
      class="data-table-body skeleton-container"
      role="rowgroup"
      aria-busy="true"
      aria-label="Loading data"
    >
      ${Array.from({ length: this.skeletonRows }).map((_, rowIndex) => html`
        <div
          class="data-table-row skeleton-row"
          role="row"
          aria-rowindex="${rowIndex + 2}"
          style="--grid-template-columns: ${gridTemplateColumns};"
        >
          ${this.columns.map((_, colIndex) => html`
            <div
              class="data-table-cell skeleton-cell"
              role="gridcell"
              aria-colindex="${colIndex + 1}"
            >
              <div class="skeleton-pulse"></div>
            </div>
          `)}
        </div>
      `)}
    </div>
  `;
}
```

3. **Add skeleton CSS styles**:
```css
.skeleton-cell {
  padding: var(--ui-data-table-cell-padding);
}

.skeleton-pulse {
  height: 1em;
  background: linear-gradient(
    90deg,
    var(--ui-data-table-skeleton-base, #e4e4e7) 25%,
    var(--ui-data-table-skeleton-highlight, #f4f4f5) 50%,
    var(--ui-data-table-skeleton-base, #e4e4e7) 75%
  );
  background-size: 200% 100%;
  animation: skeleton-pulse 1.5s ease-in-out infinite;
  border-radius: 4px;
}

:host-context(.dark) .skeleton-pulse {
  --ui-data-table-skeleton-base: #3f3f46;
  --ui-data-table-skeleton-highlight: #52525b;
}

@keyframes skeleton-pulse {
  0% { background-position: 200% 0; }
  100% { background-position: -200% 0; }
}

@media (prefers-reduced-motion: reduce) {
  .skeleton-pulse {
    animation: none;
    background: var(--ui-data-table-skeleton-base, #e4e4e7);
  }
}
```

4. **Update render method to show skeleton**:
```typescript
private renderBody(table: Table<TData>): TemplateResult {
  // Show skeleton during initial loading
  if (this.loading === 'loading') {
    return this.renderSkeletonRows();
  }

  // ... rest of body rendering
}
```
  </action>
  <verify>
    pnpm --filter @lit-ui/data-table build succeeds
    Skeleton animation CSS is present
    renderSkeletonRows method exists
  </verify>
  <done>
    Skeleton loader renders during loading='loading' state
    Animation respects prefers-reduced-motion
    Dark mode skeleton colors defined
  </done>
</task>

<task type="auto">
  <name>Task 2: Add updating overlay and empty states</name>
  <files>
    packages/data-table/src/data-table.ts
  </files>
  <action>
Implement updating overlay and empty states:

1. **Add empty state properties**:
```typescript
/**
 * Type of empty state to show when data is empty.
 * - 'no-data': Default empty state (no data available)
 * - 'no-matches': Filter resulted in no matches
 * @default 'no-data'
 */
@property({ type: String })
emptyStateType: EmptyStateType = 'no-data';

/**
 * Custom message for no-data empty state.
 * @default 'No data available'
 */
@property({ type: String })
noDataMessage = 'No data available';

/**
 * Custom message for no-matches empty state.
 * @default 'No results match your filters'
 */
@property({ type: String })
noMatchesMessage = 'No results match your filters';
```

2. **Create empty state renderer**:
```typescript
private renderEmptyState(): TemplateResult {
  const isNoMatches = this.emptyStateType === 'no-matches';
  const message = isNoMatches ? this.noMatchesMessage : this.noDataMessage;
  const description = isNoMatches
    ? 'Try adjusting your search or filter criteria'
    : 'Data will appear here once available';

  return html`
    <div
      class="data-table-body empty-state-container"
      role="rowgroup"
    >
      <div
        class="empty-state"
        role="row"
        aria-rowindex="2"
      >
        <div
          role="gridcell"
          aria-colspan="${this.columns.length}"
          class="empty-state-cell"
        >
          <div class="empty-state-icon">
            ${isNoMatches ? this.renderSearchIcon() : this.renderEmptyIcon()}
          </div>
          <p class="empty-state-message">${message}</p>
          <p class="empty-state-description">${description}</p>
        </div>
      </div>
    </div>
  `;
}

private renderEmptyIcon(): TemplateResult {
  return html`
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" width="48" height="48">
      <rect x="3" y="3" width="18" height="18" rx="2" stroke-width="2"/>
      <line x1="9" y1="9" x2="15" y2="15" stroke-width="2"/>
      <line x1="15" y1="9" x2="9" y2="15" stroke-width="2"/>
    </svg>
  `;
}

private renderSearchIcon(): TemplateResult {
  return html`
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" width="48" height="48">
      <circle cx="11" cy="11" r="8" stroke-width="2"/>
      <path d="M21 21l-4.35-4.35" stroke-width="2"/>
    </svg>
  `;
}
```

3. **Create updating overlay renderer**:
```typescript
private renderUpdatingOverlay(): TemplateResult {
  if (this.loading !== 'updating') {
    return html``;
  }

  return html`
    <div class="updating-overlay" aria-hidden="true">
      <div class="updating-spinner"></div>
    </div>
  `;
}
```

4. **Add CSS for empty state and overlay**:
```css
/* Empty State */
.empty-state-container {
  display: flex;
  align-items: center;
  justify-content: center;
  min-height: 200px;
}

.empty-state-cell {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 2rem;
  text-align: center;
}

.empty-state-icon {
  color: var(--ui-data-table-header-text);
  margin-bottom: 1rem;
  opacity: 0.5;
}

.empty-state-message {
  font-size: 1rem;
  font-weight: 500;
  color: var(--ui-data-table-text-color);
  margin: 0 0 0.5rem 0;
}

.empty-state-description {
  font-size: 0.875rem;
  color: var(--ui-data-table-header-text);
  margin: 0;
}

/* Updating Overlay */
.data-table-container {
  position: relative;
}

.updating-overlay {
  position: absolute;
  inset: 0;
  background: var(--ui-data-table-overlay-bg, rgba(255, 255, 255, 0.7));
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 20;
}

:host-context(.dark) .updating-overlay {
  --ui-data-table-overlay-bg: rgba(9, 9, 11, 0.7);
}

.updating-spinner {
  width: 24px;
  height: 24px;
  border: 2px solid var(--ui-data-table-border-color);
  border-top-color: var(--color-primary, #3b82f6);
  border-radius: 50%;
  animation: spin 0.8s linear infinite;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

@media (prefers-reduced-motion: reduce) {
  .updating-spinner {
    animation: none;
    border-top-color: var(--ui-data-table-border-color);
    opacity: 0.5;
  }
}
```

5. **Update render method to show states**:
```typescript
private renderBody(table: Table<TData>): TemplateResult {
  // Show skeleton during initial loading
  if (this.loading === 'loading') {
    return this.renderSkeletonRows();
  }

  // Show empty state when no data
  if (this.data.length === 0) {
    return this.renderEmptyState();
  }

  // Render actual data (with updating overlay if applicable)
  return html`
    ${this.renderVirtualRows(table)}
    ${this.renderUpdatingOverlay()}
  `;
}
```
  </action>
  <verify>
    pnpm --filter @lit-ui/data-table build succeeds
    Empty state renders when data.length === 0
    Updating overlay shows during loading='updating'
  </verify>
  <done>
    Empty state shows 'No data' message when data is empty
    Empty state shows 'No matches' message when emptyStateType='no-matches'
    Updating overlay appears during loading='updating' state
    All states respect dark mode and reduced motion
  </done>
</task>

</tasks>

<verification>
1. `pnpm --filter @lit-ui/data-table build` succeeds
2. TypeScript compiles without errors
3. Skeleton rows render during loading='loading'
4. Empty state renders with correct message based on emptyStateType
5. Updating overlay renders during loading='updating'
6. Dark mode styles applied correctly
7. Reduced motion respected for animations
</verification>

<success_criteria>
- CORE-03: Loading state shows skeleton loaders during initial data fetch
- CORE-04: Loading overlay appears during data updates
- CORE-05: Empty state displays "no data" message when data array is empty
- CORE-06: Empty state displays "no matches" message when filters return zero results
</success_criteria>

<output>
After completion, create `.planning/phases/61-core-table-shell-virtualization/61-04-SUMMARY.md`
</output>
