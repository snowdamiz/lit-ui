---
phase: 17-framework-integration
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - examples/node/package.json
  - examples/node/tsconfig.json
  - examples/node/src/server.ts
  - examples/node/src/client.ts
  - examples/node/README.md
autonomous: true

must_haves:
  truths:
    - "Developer runs `pnpm dev` and server starts on port 3000"
    - "Browser loads http://localhost:3000 and sees SSR'd Button and Dialog"
    - "Button click handler fires after hydration"
    - "Dialog opens and closes after hydration"
  artifacts:
    - path: "examples/node/package.json"
      provides: "Express example project configuration"
      contains: "express"
    - path: "examples/node/src/server.ts"
      provides: "Express server with SSR route"
      contains: "renderToString"
    - path: "examples/node/src/client.ts"
      provides: "Client hydration entry point"
      contains: "@lit-ui/ssr/hydration"
    - path: "examples/node/README.md"
      provides: "Quick start and explanation"
      contains: "hydration"
  key_links:
    - from: "examples/node/src/server.ts"
      to: "@lit-ui/ssr"
      via: "renderToString import"
      pattern: "import.*renderToString.*@lit-ui/ssr"
    - from: "examples/node/src/client.ts"
      to: "@lit-ui/ssr/hydration"
      via: "first import"
      pattern: "import.*@lit-ui/ssr/hydration"
---

<objective>
Create a generic Node.js/Express SSR example demonstrating @lit-ui components.

Purpose: Show developers how to SSR Lit components in any Node.js environment without framework-specific magic. This serves as the reference implementation for custom SSR setups.

Output: Working Express server that SSR's Button and Dialog components with proper client hydration.
</objective>

<execution_context>
@/Users/sn0w/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sn0w/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/17-framework-integration/17-CONTEXT.md
@.planning/phases/17-framework-integration/17-RESEARCH.md
@.planning/phases/16-ssr-package/16-01-SUMMARY.md
@.planning/phases/16-ssr-package/16-02-SUMMARY.md
@packages/ssr/src/index.ts
@packages/ssr/src/hydration.ts
@pnpm-workspace.yaml
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Express project structure</name>
  <files>
    examples/node/package.json
    examples/node/tsconfig.json
  </files>
  <action>
    Create examples/node directory with:

    1. package.json:
       - name: "@lit-ui/example-node" (private: true)
       - type: module
       - scripts: dev (tsx watch src/server.ts), build (vite build for client), start (node dist/server.js)
       - dependencies: express ^5.2.0
       - devDependencies: tsx, vite, typescript ^5.9
       - Link to workspace packages: @lit-ui/ssr, @lit-ui/button, @lit-ui/dialog, @lit-ui/core all as "workspace:*"

    2. tsconfig.json:
       - extends @lit-ui/typescript-config/library.json
       - compilerOptions: outDir dist, rootDir src
       - include: ["src/**/*"]

    Note: Do NOT add examples/* to pnpm-workspace.yaml per CONTEXT.md decision (examples are standalone, not runnable from root).
  </action>
  <verify>
    Files exist at examples/node/package.json and examples/node/tsconfig.json.
    package.json contains "express" dependency and workspace:* links.
  </verify>
  <done>Express project structure created with correct dependencies</done>
</task>

<task type="auto">
  <name>Task 2: Create SSR server and client entry</name>
  <files>
    examples/node/src/server.ts
    examples/node/src/client.ts
  </files>
  <action>
    1. Create src/server.ts:
       - Import express from 'express'
       - Import { renderToString, html } from '@lit-ui/ssr'
       - Import '@lit-ui/button' (registers lui-button)
       - Import '@lit-ui/dialog' (registers lui-dialog)
       - Create Express app
       - Serve static files from 'public' directory
       - GET '/' route that:
         - Renders Button (variant="primary") and Dialog with slots
         - Includes one CSS custom property override (e.g., --ui-button-radius)
         - Sends complete HTML document with:
           - DOCTYPE
           - script type="module" src="/client.js" in head
           - SSR'd content in body
       - Listen on port 3000
       - Add helpful inline comments explaining hydration flow

    2. Create src/client.ts:
       - FIRST line: import '@lit-ui/ssr/hydration' (CRITICAL: must be first)
       - Then: import '@lit-ui/button'
       - Then: import '@lit-ui/dialog'
       - Add click handler to button (document.querySelector, addEventListener)
       - Add open/close for dialog demonstration
       - Add console.log confirming hydration complete
       - Add clear comment explaining why import order matters
  </action>
  <verify>
    server.ts contains renderToString and html imports from @lit-ui/ssr.
    client.ts first non-comment line is import '@lit-ui/ssr/hydration'.
    Both files have component imports.
  </verify>
  <done>Server renders components, client hydrates them with working interactivity</done>
</task>

<task type="auto">
  <name>Task 3: Create README and verify example runs</name>
  <files>
    examples/node/README.md
  </files>
  <action>
    1. Create README.md with:
       - Title: Node.js/Express SSR Example
       - Quick Start: cd examples/node, pnpm install, pnpm dev
       - What This Shows: SSR with @lit-ui/ssr, proper hydration order
       - Key Files: server.ts (SSR), client.ts (hydration)
       - Important: Hydration Import Order section explaining WHY @lit-ui/ssr/hydration must be first
       - Link to main lit-ui docs for deep dive
       - NO generic "How SSR Works" section (per CONTEXT.md)

    2. Verify the example:
       - cd examples/node && pnpm install
       - Build client bundle: pnpm build (creates public/client.js)
       - Start server: pnpm dev
       - Curl localhost:3000 and verify HTML contains:
         - <template shadowrootmode="open"> (Declarative Shadow DOM)
         - lui-button and lui-dialog tags
  </action>
  <verify>
    README.md exists with Quick Start section.
    pnpm install succeeds in examples/node directory.
    Curl localhost:3000 returns HTML with Declarative Shadow DOM templates.
  </verify>
  <done>Node.js example documented and verified working</done>
</task>

</tasks>

<verification>
- [ ] examples/node directory created with package.json, tsconfig.json
- [ ] Server imports renderToString from @lit-ui/ssr
- [ ] Server registers components before rendering
- [ ] Client imports @lit-ui/ssr/hydration FIRST
- [ ] README explains hydration import order requirement
- [ ] pnpm install succeeds in examples/node
- [ ] Server starts and returns SSR'd HTML with DSD templates
</verification>

<success_criteria>
1. Developer can cd examples/node && pnpm install && pnpm dev
2. Browser shows Button and Dialog components
3. Components are interactive after hydration (button clicks work, dialog opens/closes)
4. HTML response contains Declarative Shadow DOM templates
</success_criteria>

<output>
After completion, create `.planning/phases/17-framework-integration/17-01-SUMMARY.md`
</output>
