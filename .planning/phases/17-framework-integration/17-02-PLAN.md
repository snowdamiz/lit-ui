---
phase: 17-framework-integration
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - examples/nextjs/package.json
  - examples/nextjs/tsconfig.json
  - examples/nextjs/next.config.mjs
  - examples/nextjs/app/layout.tsx
  - examples/nextjs/app/page.tsx
  - examples/nextjs/app/components/LitDemo.tsx
  - examples/nextjs/README.md
autonomous: true

must_haves:
  truths:
    - "Developer runs `pnpm dev` and Next.js dev server starts"
    - "Browser loads http://localhost:3000 and sees SSR'd Button and Dialog"
    - "Button click handler fires after hydration"
    - "Dialog opens and closes after hydration"
    - "No hydration mismatch errors in console"
  artifacts:
    - path: "examples/nextjs/next.config.mjs"
      provides: "Next.js config with withLitSSR plugin"
      contains: "withLitSSR"
    - path: "examples/nextjs/app/components/LitDemo.tsx"
      provides: "Client component wrapper for Lit components"
      contains: "use client"
    - path: "examples/nextjs/README.md"
      provides: "Quick start and explanation"
      contains: "use client"
  key_links:
    - from: "examples/nextjs/next.config.mjs"
      to: "@lit-labs/nextjs"
      via: "withLitSSR import"
      pattern: "import.*withLitSSR.*@lit-labs/nextjs"
    - from: "examples/nextjs/app/components/LitDemo.tsx"
      to: "@lit-ui/ssr/hydration"
      via: "first import after 'use client'"
      pattern: "import.*@lit-ui/ssr/hydration"
---

<objective>
Create a Next.js App Router SSR example demonstrating @lit-ui components.

Purpose: Show developers how to SSR Lit components in Next.js 15+ with proper 'use client' boundaries. This is the pattern for React-based SSR with Lit.

Output: Working Next.js app that SSR's Button and Dialog components with proper client hydration and no RSC conflicts.
</objective>

<execution_context>
@/Users/sn0w/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sn0w/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/17-framework-integration/17-CONTEXT.md
@.planning/phases/17-framework-integration/17-RESEARCH.md
@.planning/phases/16-ssr-package/16-02-SUMMARY.md
@packages/ssr/src/hydration.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Next.js project with Lit SSR config</name>
  <files>
    examples/nextjs/package.json
    examples/nextjs/tsconfig.json
    examples/nextjs/next.config.mjs
  </files>
  <action>
    Create examples/nextjs directory with minimal Next.js setup:

    1. package.json:
       - name: "@lit-ui/example-nextjs" (private: true)
       - type: module
       - scripts: dev, build, start (standard Next.js scripts)
       - dependencies: next ^15.0.0, react ^19.0.0, react-dom ^19.0.0, @lit-labs/nextjs latest
       - devDependencies: typescript ^5.9, @types/react, @types/node
       - Link to workspace packages: @lit-ui/ssr, @lit-ui/button, @lit-ui/dialog, @lit-ui/core all as "workspace:*"

    2. tsconfig.json:
       - Standard Next.js tsconfig with App Router settings
       - compilerOptions: target ES2022, lib DOM/ESNext, module ESNext, jsx preserve
       - Include app directory

    3. next.config.mjs:
       - Import withLitSSR from '@lit-labs/nextjs'
       - Basic nextConfig with reactStrictMode: true
       - Export wrapped config: withLitSSR()(nextConfig)
       - Add comment explaining what withLitSSR does (DSD polyfill, module transform)
  </action>
  <verify>
    Files exist at examples/nextjs/package.json, tsconfig.json, next.config.mjs.
    next.config.mjs imports and uses withLitSSR.
  </verify>
  <done>Next.js project configured with Lit SSR plugin</done>
</task>

<task type="auto">
  <name>Task 2: Create App Router pages with Lit components</name>
  <files>
    examples/nextjs/app/layout.tsx
    examples/nextjs/app/page.tsx
    examples/nextjs/app/components/LitDemo.tsx
  </files>
  <action>
    1. Create app/layout.tsx:
       - Standard RootLayout with html/body
       - Metadata: title "Lit UI Next.js Example"
       - Simple styling (can use inline styles or minimal CSS)

    2. Create app/page.tsx:
       - Server Component (no 'use client')
       - Import LitDemo from './components/LitDemo'
       - Render heading and LitDemo component
       - Add explanation text about what the page demonstrates

    3. Create app/components/LitDemo.tsx:
       - FIRST line: 'use client' directive (CRITICAL for Lit in Next.js)
       - SECOND import: '@lit-ui/ssr/hydration' (CRITICAL: must be before components)
       - Then: import '@lit-ui/button'
       - Then: import '@lit-ui/dialog'
       - Create functional component that renders:
         - lui-button with variant="primary" and onClick handler (useState for count)
         - lui-dialog with title slot and content
         - Button to open dialog (useState for dialog open state)
       - Include one CSS custom property override to show theming works
       - Add comments explaining:
         - Why 'use client' is required (RSC can't serialize DSD templates)
         - Why hydration import must be first
  </action>
  <verify>
    LitDemo.tsx starts with 'use client' directive.
    LitDemo.tsx imports @lit-ui/ssr/hydration before component imports.
    page.tsx is a Server Component (no 'use client').
  </verify>
  <done>App Router pages created with proper client boundary pattern</done>
</task>

<task type="auto">
  <name>Task 3: Create README and verify example runs</name>
  <files>
    examples/nextjs/README.md
  </files>
  <action>
    1. Create README.md with:
       - Title: Next.js App Router SSR Example
       - Quick Start: cd examples/nextjs, pnpm install, pnpm dev
       - What This Shows: Lit SSR in Next.js with 'use client' boundary
       - Key Files: next.config.mjs (plugin), LitDemo.tsx (client wrapper)
       - Important: 'use client' Boundary section explaining:
         - Why Lit components need client boundary
         - RSC payload serialization breaks DSD templates
         - All Lit usage must be in client components
       - Important: Hydration Import Order section
       - Link to main lit-ui docs for deep dive

    2. Verify the example:
       - cd examples/nextjs && pnpm install
       - pnpm dev (start Next.js dev server)
       - Open browser, check for:
         - No console errors about hydration mismatch
         - Button and Dialog render correctly
         - Interactivity works after hydration
  </action>
  <verify>
    README.md exists with Quick Start and 'use client' explanation.
    pnpm install succeeds in examples/nextjs directory.
    pnpm dev starts without errors.
  </verify>
  <done>Next.js example documented and verified working</done>
</task>

</tasks>

<verification>
- [ ] examples/nextjs directory created with all config files
- [ ] next.config.mjs uses withLitSSR wrapper
- [ ] LitDemo.tsx has 'use client' as first line
- [ ] LitDemo.tsx imports @lit-ui/ssr/hydration before components
- [ ] page.tsx is Server Component that imports client component
- [ ] README explains 'use client' requirement and import order
- [ ] pnpm install and pnpm dev succeed
- [ ] No hydration mismatch errors in browser console
</verification>

<success_criteria>
1. Developer can cd examples/nextjs && pnpm install && pnpm dev
2. Browser shows Button and Dialog components without hydration errors
3. Components are interactive after hydration
4. Pattern demonstrates proper 'use client' boundary for Lit in React SSR
</success_criteria>

<output>
After completion, create `.planning/phases/17-framework-integration/17-02-SUMMARY.md`
</output>
