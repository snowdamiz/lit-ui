---
phase: 64-column-customization
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - packages/data-table/src/data-table.ts
  - packages/data-table/src/types.ts
autonomous: true

must_haves:
  truths:
    - "User can drag column divider to resize column width"
    - "User double-clicks divider to auto-fit column to content"
    - "User cannot shrink column below 50px minimum"
  artifacts:
    - path: "packages/data-table/src/data-table.ts"
      provides: "Resize handles in header cells with TanStack sizing integration"
      contains: "getResizeHandler"
    - path: "packages/data-table/src/types.ts"
      provides: "ColumnSizingState re-export"
      contains: "ColumnSizingState"
  key_links:
    - from: "data-table.ts renderHeaderCell"
      to: "header.getResizeHandler()"
      via: "mousedown/touchstart event binding"
      pattern: "getResizeHandler"
    - from: "data-table.ts columnSizing state"
      to: "TanStack table options"
      via: "onColumnSizingChange callback"
      pattern: "onColumnSizingChange"
---

<objective>
Implement column resizing with drag handles and double-click auto-fit.

Purpose: Users need to customize column widths to fit their data and workflow. Resize handles provide intuitive drag-to-resize, while double-click auto-fit quickly sizes columns to content.

Output: lui-data-table with working column resize functionality via TanStack Table's sizing APIs.
</objective>

<execution_context>
@/Users/sn0w/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sn0w/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/64-column-customization/64-RESEARCH.md
@packages/data-table/src/data-table.ts
@packages/data-table/src/types.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add TanStack column sizing state and options</name>
  <files>packages/data-table/src/data-table.ts, packages/data-table/src/types.ts</files>
  <action>
1. In types.ts:
   - Re-export ColumnSizingState from @tanstack/lit-table (already importing, just need export)
   - Add ColumnSizingInfoState type if not present

2. In data-table.ts:
   - Add @property columnSizing: ColumnSizingState = {} for externally-controlled sizing
   - Add @state _columnSizingInfo for internal resize tracking (transient state)
   - Add @property enableColumnResizing = true (boolean to enable/disable feature)
   - Add @property columnResizeMode: 'onChange' | 'onEnd' = 'onChange' for resize preview vs final

3. Update tableController.table() options in render():
   - Add enableColumnResizing: this.enableColumnResizing
   - Add columnResizeMode: this.columnResizeMode
   - Add columnResizeDirection: 'ltr'
   - Add state: { columnSizing: this.columnSizing, columnSizingInfo: this._columnSizingInfo }
   - Add onColumnSizingChange callback that updates this.columnSizing
   - Add onColumnSizingInfoChange callback that updates this._columnSizingInfo

4. Update getGridTemplateColumns() to use TanStack column.getSize():
   - Replace current logic with: columns.map(col => `${col.getSize()}px`).join(' ')
   - Handle minSize constraint in column definitions (minSize defaults to 50 per COL-03)

NOTE: Use columnResizeMode: 'onChange' for real-time preview during drag. The 'onEnd' mode is better for performance with very large tables but provides no visual feedback during drag.
  </action>
  <verify>
TypeScript compiles without errors:
```bash
cd packages/data-table && pnpm build
```
  </verify>
  <done>
- columnSizing property accepts external sizing state
- TanStack table options include all sizing configuration
- getGridTemplateColumns uses column.getSize() for widths
  </done>
</task>

<task type="auto">
  <name>Task 2: Render resize handles in header cells</name>
  <files>packages/data-table/src/data-table.ts</files>
  <action>
1. Create private renderResizeHandle(header: Header<TData, unknown>) method:
   - Return html`` if !header.column.getCanResize()
   - Get isResizing = header.column.getIsResizing()
   - Get handler = header.getResizeHandler() (returns mouse/touch event handler)
   - Return resize handle div with:
     - class="column-resize-handle ${isResizing ? 'is-resizing' : ''}"
     - @mousedown=${handler}
     - @touchstart=${handler}
     - @dblclick=${(e) => { e.stopPropagation(); this.autoFitColumn(header.column); }}
     - role="separator"
     - aria-orientation="vertical"
     - aria-label="Resize ${header.column.columnDef.header} column"
     - tabindex="0"
     - @keydown for arrow key resize (left -10px, right +10px with min/max constraints)

2. Update renderHeaderCell() to include resize handle:
   - Add position: relative to header cell (needed for absolute handle positioning)
   - Call this.renderResizeHandle(header) after filter indicator

3. Add CSS for resize handle:
   ```css
   .data-table-header-cell {
     position: relative; /* For resize handle positioning */
   }

   .column-resize-handle {
     position: absolute;
     right: 0;
     top: 0;
     height: 100%;
     width: 4px;
     cursor: col-resize;
     user-select: none;
     touch-action: none;
     background: transparent;
     z-index: 1;
   }

   .column-resize-handle:hover,
   .column-resize-handle.is-resizing {
     background: var(--color-primary, #3b82f6);
   }

   .column-resize-handle:focus-visible {
     outline: 2px solid var(--color-primary, #3b82f6);
     outline-offset: -2px;
   }

   /* Prevent text selection during resize */
   :host([data-resizing]) {
     user-select: none;
     cursor: col-resize;
   }
   ```

4. Add data-resizing attribute to host during resize:
   - In onColumnSizingInfoChange callback, toggle this.dataset.resizing based on isResizingColumn

NOTE: The header cell already uses display: flex. The resize handle needs position: absolute to stay at the right edge. Stop event propagation on dblclick to prevent sort toggle.
  </action>
  <verify>
Build succeeds and dev server shows resize handles:
```bash
cd packages/data-table && pnpm build
cd apps/docs && pnpm dev
# Visit data table demo page, hover between column headers to see resize cursor
```
  </verify>
  <done>
- Resize handles appear between column headers
- Handles highlight on hover and during drag
- Keyboard arrow keys adjust width by 10px
- Double-click triggers auto-fit (placeholder for Task 3)
  </done>
</task>

<task type="auto">
  <name>Task 3: Implement auto-fit column width on double-click</name>
  <files>packages/data-table/src/data-table.ts</files>
  <action>
1. Create private autoFitColumn(column: Column<TData, unknown>) method:
   - Query all visible cells for this column: querySelectorAll(`[data-column-id="${column.id}"]`)
   - Also query header cell: querySelector(`.data-table-header-cell[data-column-id="${column.id}"]`)
   - Initialize maxWidth = 0
   - Measure header content:
     - Get header content element's scrollWidth + padding (32px for cell padding)
     - maxWidth = Math.max(maxWidth, headerWidth)
   - Measure each visible body cell:
     - maxWidth = Math.max(maxWidth, cell.scrollWidth + 32)
   - Apply min/max constraints:
     - const minSize = column.columnDef.minSize ?? 50
     - const maxSize = column.columnDef.maxSize ?? 500
     - const fitWidth = Math.max(minSize, Math.min(maxSize, maxWidth))
   - Update sizing state:
     - this.columnSizing = { ...this.columnSizing, [column.id]: fitWidth }

2. Add data-column-id attribute to header cells and body cells:
   - In renderHeaderCell(): data-column-id="${header.column.id}"
   - In renderCell(): data-column-id="${cell.column.id}"

3. Document limitation in code comment:
   - Auto-fit only measures visible (virtualized) rows
   - For large datasets, width may not fit all data perfectly
   - Manual resize is available for fine-tuning

NOTE: With virtualization, we can only measure visible rows. This is an inherent limitation documented in research. The auto-fit provides "best effort" sizing based on visible content.
  </action>
  <verify>
Manual testing:
1. Scroll to see various rows
2. Double-click column divider
3. Column should resize to fit visible content (or min/max bounds)

```bash
cd packages/data-table && pnpm build
```
  </verify>
  <done>
- Double-click on resize handle auto-fits column to content
- Auto-fit respects minSize (50px default) and maxSize constraints
- Column ID attributes added for DOM measurement
  </done>
</task>

</tasks>

<verification>
After all tasks complete:
1. Build succeeds: `cd packages/data-table && pnpm build`
2. Type check passes: `pnpm typecheck`
3. Resize handles visible between column headers when enableColumnResizing=true
4. Dragging resize handle changes column width in real-time
5. Double-click auto-fits to visible content width
6. Columns cannot be resized below 50px (COL-03)
7. Keyboard navigation (arrow keys) adjusts width by 10px increments
</verification>

<success_criteria>
- COL-01: Column widths are resizable via drag handles between headers
- COL-02: Double-click column divider auto-fits column to content width
- COL-03: Minimum column width prevents columns from becoming too narrow (50px)
- TypeScript compiles without errors
- No regressions in existing sorting/selection/filtering functionality
</success_criteria>

<output>
After completion, create `.planning/phases/64-column-customization/64-01-SUMMARY.md`
</output>
