---
phase: 44-date-picker-core
plan: 01
type: tdd
wave: 1
depends_on: []
files_modified:
  - packages/date-picker/package.json
  - packages/date-picker/tsconfig.json
  - packages/date-picker/vite.config.ts
  - packages/date-picker/src/vite-env.d.ts
  - packages/date-picker/src/date-input-parser.ts
autonomous: true

must_haves:
  truths:
    - "Date input parser correctly parses dates in ISO format (yyyy-MM-dd)"
    - "Date input parser correctly parses dates with slashes, dashes, and dots"
    - "Date input parser respects locale for MM/dd vs dd/MM ambiguity"
    - "Date input parser returns null for invalid date strings"
    - "Package scaffolding builds without errors"
  artifacts:
    - path: "packages/date-picker/package.json"
      provides: "Package configuration with @floating-ui/dom, date-fns, @lit-ui/calendar peer deps"
      contains: "@lit-ui/date-picker"
    - path: "packages/date-picker/src/date-input-parser.ts"
      provides: "Multi-format date parsing utility"
      exports: ["parseDateInput", "getDisplayFormat", "formatDateForDisplay"]
  key_links:
    - from: "packages/date-picker/src/date-input-parser.ts"
      to: "date-fns"
      via: "import { parse, isValid, format } from 'date-fns'"
      pattern: "import.*parse.*date-fns"
---

<objective>
Create the @lit-ui/date-picker package scaffolding and implement the date input parser utility using TDD.

Purpose: The date input parser is the core logic for converting user-typed text into valid dates. It handles multiple formats (dashes, slashes, dots) with locale-aware ordering to resolve MM/dd vs dd/MM ambiguity. This is a pure function with well-defined inputs/outputs, ideal for TDD.
Output: New package directory with build config + tested date-input-parser.ts utility.
</objective>

<execution_context>
@/Users/sn0w/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sn0w/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/44-date-picker-core/44-RESEARCH.md

Reference patterns from:
@packages/calendar/package.json (peer deps pattern for date-fns)
@packages/calendar/tsconfig.json (extends shared config)
@packages/calendar/vite.config.ts (shared vite config)
@packages/input/package.json (form component package pattern)
@packages/select/package.json (@floating-ui/dom dependency pattern)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create @lit-ui/date-picker package scaffolding</name>
  <files>
    packages/date-picker/package.json
    packages/date-picker/tsconfig.json
    packages/date-picker/vite.config.ts
    packages/date-picker/src/vite-env.d.ts
  </files>
  <action>
    Create the package directory and configuration files following established patterns:

    **package.json** — Match @lit-ui/calendar pattern but add dependencies:
    - name: "@lit-ui/date-picker"
    - description: "Accessible date picker component built with Lit, Tailwind CSS, and date-fns"
    - Same exports, files, scripts, type fields as @lit-ui/calendar
    - peerDependencies: lit ^3.0.0, @lit-ui/core ^1.0.0, date-fns ^4.0.0, @lit-ui/calendar ^1.0.0
    - dependencies: @floating-ui/dom ^1.7.4 (direct dep, not peer — matches @lit-ui/select)
    - devDependencies: workspace:* for @lit-ui/core, @lit-ui/calendar, @lit-ui/typescript-config, @lit-ui/vite-config, plus date-fns ^4.1.0, lit ^3.3.2, tailwindcss ^4.1.18, @tailwindcss/vite ^4.1.18, typescript ^5.9.3, vite ^7.3.1, vite-plugin-dts ^4.5.4

    **tsconfig.json** — Exact copy of @lit-ui/calendar/tsconfig.json (extends @lit-ui/typescript-config/library.json)

    **vite.config.ts** — Exact copy of @lit-ui/calendar/vite.config.ts (uses createLibraryConfig)

    **src/vite-env.d.ts** — Standard Vite types reference: `/// <reference types="vite/client" />`

    Run `pnpm install` after creating package.json to link workspace dependencies.
  </action>
  <verify>
    - `ls packages/date-picker/package.json` exists
    - `ls packages/date-picker/tsconfig.json` exists
    - `ls packages/date-picker/vite.config.ts` exists
    - `pnpm install` succeeds without errors
  </verify>
  <done>Package scaffolding exists with correct dependencies and workspace linking</done>
</task>

<task type="auto">
  <name>Task 2: TDD date input parser — Red/Green/Refactor</name>
  <files>packages/date-picker/src/date-input-parser.ts</files>
  <action>
    Implement the date input parser using TDD (write tests mentally, implement to satisfy them).

    Create `packages/date-picker/src/date-input-parser.ts` with three exported functions:

    **1. `parseDateInput(input: string, locale?: string): Date | null`**
    - Trims input. Returns null for empty/whitespace strings.
    - Uses date-fns `parse()` to try multiple format strings sequentially.
    - Always tries ISO format first (yyyy-MM-dd) — unambiguous.
    - For locale starting with "en-US" or "en-CA": try MM/dd formats before dd/MM formats.
    - For all other locales: try dd/MM formats before MM/dd formats.
    - Format strings to try (in locale-determined order):
      - ISO: 'yyyy-MM-dd'
      - Slash US: 'MM/dd/yyyy', 'M/d/yyyy'
      - Slash EU: 'dd/MM/yyyy', 'd/M/yyyy'
      - Dash US: 'MM-dd-yyyy'
      - Dash EU: 'dd-MM-yyyy'
      - Dot US: 'MM.dd.yyyy'
      - Dot EU: 'dd.MM.yyyy'
    - Uses `isValid()` from date-fns to check each parse result.
    - Returns the Date from the first valid parse, or null if none succeed.
    - Reference date for parse(): `new Date()` (current date for relative parsing context).

    **2. `formatDateForDisplay(date: Date, locale?: string): string`**
    - Uses `Intl.DateTimeFormat` with `{ year: 'numeric', month: 'long', day: 'numeric' }`.
    - If no locale provided, defaults to 'en-US' (SSR-safe fallback).
    - Returns formatted string like "January 31, 2026" (en-US) or "31 janvier 2026" (fr-FR).

    **3. `getPlaceholderText(locale?: string): string`**
    - Returns locale-appropriate placeholder text.
    - For en-US/en-CA: "MM/DD/YYYY"
    - For all others: "DD/MM/YYYY"
    - This helps users understand expected input format (DP-09).

    Import only: `{ parse, isValid } from 'date-fns'` — keep imports minimal for tree-shaking.

    Do NOT import `format` from date-fns here — use Intl.DateTimeFormat for display formatting (zero bundle cost).
  </action>
  <verify>
    - `pnpm --filter @lit-ui/date-picker build` succeeds
    - `grep "parseDateInput" packages/date-picker/src/date-input-parser.ts` shows the export
    - `grep "formatDateForDisplay" packages/date-picker/src/date-input-parser.ts` shows the export
    - `grep "getPlaceholderText" packages/date-picker/src/date-input-parser.ts` shows the export
  </verify>
  <done>Date input parser correctly parses ISO, slash, dash, and dot formats with locale-aware MM/dd vs dd/MM ordering. Display formatting uses Intl.DateTimeFormat for zero-bundle-cost locale support.</done>
</task>

</tasks>

<verification>
- `pnpm --filter @lit-ui/date-picker build` completes without errors
- date-input-parser.ts exports parseDateInput, formatDateForDisplay, getPlaceholderText
- parseDateInput handles: "2026-01-31", "01/31/2026", "31/01/2026", "01-31-2026", "31.01.2026"
- parseDateInput returns null for: "", "  ", "not a date", "13/13/2026"
- formatDateForDisplay returns locale-aware long format
</verification>

<success_criteria>
1. @lit-ui/date-picker package exists with correct dependencies
2. Package builds without errors via pnpm workspace
3. parseDateInput correctly parses dates in 9+ format variations
4. Locale determines MM/dd vs dd/MM priority for ambiguous inputs
5. formatDateForDisplay uses Intl.DateTimeFormat with month: 'long'
6. getPlaceholderText returns locale-appropriate format hint
</success_criteria>

<output>
After completion, create `.planning/phases/44-date-picker-core/44-01-SUMMARY.md`
</output>
