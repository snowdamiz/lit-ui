---
phase: 24-presets-and-enhanced-features
plan: 03
type: execute
wave: 3
depends_on: ["24-01", "24-02"]
files_modified:
  - apps/docs/src/pages/configurator/ConfiguratorPage.tsx
  - apps/docs/src/components/configurator/ConfiguratorLayout.tsx
autonomous: false

must_haves:
  truths:
    - "User can apply preset with one click and see it reflected in preview"
    - "User can generate shareable theme URL that restores configuration when loaded"
    - "Shade scale auto-calculates and displays for primary color"
    - "All Phase 24 features are accessible from the configurator UI"
  artifacts:
    - path: "apps/docs/src/pages/configurator/ConfiguratorPage.tsx"
      provides: "URL sync and integrated sidebar components"
      contains: "useSearchParams"
    - path: "apps/docs/src/components/configurator/ConfiguratorLayout.tsx"
      provides: "Layout with ShareButton in header"
      contains: "ShareButton"
  key_links:
    - from: "ConfiguratorPage.tsx"
      to: "useSearchParams"
      via: "react-router import"
      pattern: "import.*useSearchParams.*react-router"
    - from: "ConfiguratorPage.tsx"
      to: "loadThemeConfig"
      via: "URL decode on mount"
      pattern: "decodeThemeConfig.*loadThemeConfig"
    - from: "ConfiguratorPage.tsx"
      to: "PresetSelector"
      via: "component render in sidebar"
      pattern: "<PresetSelector"
    - from: "ConfiguratorLayout.tsx"
      to: "ShareButton"
      via: "component render in header"
      pattern: "<ShareButton"
---

<objective>
Integrate all Phase 24 components into the configurator: add PresetSelector and ShadeScaleDisplay to sidebar, add ShareButton to header, and implement URL sync for shareable links.

Purpose: This plan wires everything together so users get the complete preset + sharing + shade scale experience.

Output: Updated ConfiguratorPage with URL sync, PresetSelector, ShadeScaleDisplay; Updated ConfiguratorLayout with ShareButton
</objective>

<execution_context>
@/Users/sn0w/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sn0w/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/24-presets-and-enhanced-features/24-RESEARCH.md
@.planning/phases/24-presets-and-enhanced-features/24-01-SUMMARY.md
@.planning/phases/24-presets-and-enhanced-features/24-02-SUMMARY.md

# Files to modify
@apps/docs/src/pages/configurator/ConfiguratorPage.tsx
@apps/docs/src/components/configurator/ConfiguratorLayout.tsx

# New components to integrate
@apps/docs/src/components/configurator/PresetSelector.tsx
@apps/docs/src/components/configurator/ShareButton.tsx
@apps/docs/src/components/configurator/ShadeScaleDisplay.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add URL sync to ConfiguratorPage</name>
  <files>apps/docs/src/pages/configurator/ConfiguratorPage.tsx</files>
  <action>
Add URL synchronization to ConfiguratorPage that:
1. Loads theme from URL on mount (if ?theme= param exists)
2. Does NOT auto-update URL on changes (only via explicit Share button)

Modifications to ConfiguratorPage.tsx:

1. Add imports at top:
```typescript
import { useEffect, useRef } from "react";
import { useSearchParams } from "react-router";
import { decodeThemeConfig } from "@lit-ui/cli/theme";
```

2. Add PresetSelector and ShadeScaleDisplay imports:
```typescript
import { PresetSelector } from "../../components/configurator/PresetSelector";
import { ShadeScaleDisplay } from "../../components/configurator/ShadeScaleDisplay";
```

3. Create a new component inside the file that handles URL loading. Add before ConfiguratorSidebar:
```typescript
/**
 * URLLoader - Loads theme from URL on mount
 * Must be inside ConfiguratorProvider to access context
 */
function URLLoader() {
  const [searchParams] = useSearchParams();
  const { loadThemeConfig } = useConfigurator();
  const initialLoadDone = useRef(false);

  useEffect(() => {
    if (initialLoadDone.current) return;
    initialLoadDone.current = true;

    const encoded = searchParams.get("theme");
    if (encoded) {
      try {
        const config = decodeThemeConfig(encoded);
        loadThemeConfig(config);
      } catch (e) {
        console.warn("Invalid theme in URL, using defaults:", e);
        // Keep defaults - don't break the page
      }
    }
  }, [searchParams, loadThemeConfig]);

  return null; // This component only handles side effects
}
```

4. Update ConfiguratorSidebar to include PresetSelector and ShadeScaleDisplay:
Add PresetSelector after ModeToggle, add ShadeScaleDisplay after Brand Colors section.

In the return statement of ConfiguratorSidebar, update to:
```typescript
return (
  <div className="space-y-6">
    {/* Mode Toggle */}
    <ModeToggle />

    <div className="h-px bg-gray-200 dark:bg-gray-700" />

    {/* Preset Themes */}
    <PresetSelector />

    <div className="h-px bg-gray-200 dark:bg-gray-700" />

    {/* Brand Colors Section */}
    <ColorSection title="Brand Colors">
      <div onClick={() => setLastColorKey("primary")}>
        <ColorPickerGroup colorKey="primary" label="Primary" />
      </div>
      {/* Primary shade scale */}
      <ShadeScaleDisplay baseColor={lightColors.primary} label="Primary Shades" />
      <div onClick={() => setLastColorKey("secondary")}>
        <ColorPickerGroup colorKey="secondary" label="Secondary" />
      </div>
      <div onClick={() => setLastColorKey("destructive")}>
        <ColorPickerGroup colorKey="destructive" label="Destructive" />
      </div>
    </ColorSection>

    {/* Surface Colors Section */}
    <ColorSection title="Surface Colors">
      <div onClick={() => setLastColorKey("background")}>
        <ColorPickerGroup colorKey="background" label="Background" />
      </div>
      <div onClick={() => setLastColorKey("foreground")}>
        <ColorPickerGroup colorKey="foreground" label="Foreground" />
      </div>
    </ColorSection>

    {/* Utility Colors Section */}
    <ColorSection title="Utility Colors">
      <div onClick={() => setLastColorKey("muted")}>
        <ColorPickerGroup colorKey="muted" label="Muted" />
      </div>
    </ColorSection>

    <div className="h-px bg-gray-200 dark:bg-gray-700" />

    {/* Tailwind Swatches */}
    <TailwindSwatches onSelect={handleSwatchSelect} />

    <div className="h-px bg-gray-200 dark:bg-gray-700" />

    {/* Radius Selector */}
    <RadiusSelector />
  </div>
);
```

5. Update ConfiguratorSidebar to get lightColors from context:
Add `lightColors` to the destructured values from useConfigurator():
```typescript
const {
  activeMode,
  lightColors,
  setLightColor,
  setDarkColor,
} = useConfigurator();
```

6. Update ConfiguratorPageContent to include URLLoader:
```typescript
function ConfiguratorPageContent() {
  const [commandModalOpen, setCommandModalOpen] = useState(false);

  return (
    <>
      <URLLoader />
      <ConfiguratorLayout
        sidebar={<ConfiguratorSidebar />}
        preview={<ThemePreview />}
        onGetCommand={() => setCommandModalOpen(true)}
      />
      <GetCommandModal
        open={commandModalOpen}
        onClose={() => setCommandModalOpen(false)}
      />
    </>
  );
}
```

Key behaviors:
- URL loading happens once on mount via useRef guard
- Invalid URL themes are caught and logged, defaults used
- PresetSelector appears below ModeToggle
- ShadeScaleDisplay shows primary color's 50-950 scale
- No automatic URL updates (that would spam history)
  </action>
  <verify>
```bash
cd apps/docs && npx tsc --noEmit
grep -q "useSearchParams" apps/docs/src/pages/configurator/ConfiguratorPage.tsx
grep -q "PresetSelector" apps/docs/src/pages/configurator/ConfiguratorPage.tsx
grep -q "ShadeScaleDisplay" apps/docs/src/pages/configurator/ConfiguratorPage.tsx
```
  </verify>
  <done>ConfiguratorPage loads theme from URL on mount, includes PresetSelector and ShadeScaleDisplay in sidebar</done>
</task>

<task type="auto">
  <name>Task 2: Add ShareButton to ConfiguratorLayout header</name>
  <files>apps/docs/src/components/configurator/ConfiguratorLayout.tsx</files>
  <action>
Update ConfiguratorLayout to include ShareButton in the header area next to the "Get Command" button.

1. Add import at top:
```typescript
import { ShareButton } from "./ShareButton";
```

2. Find the header area where "Get Command" button is rendered and add ShareButton next to it.

Look for the button that calls onGetCommand - add ShareButton before it:
```typescript
<div className="flex items-center gap-2">
  <ShareButton />
  <button
    onClick={onGetCommand}
    // ... existing button props
  >
    Get Command
  </button>
</div>
```

The exact location depends on the current layout structure. The ShareButton should appear in the header/toolbar area, visually grouped with the "Get Command" button.

If the current layout doesn't have a header toolbar, add one:
```typescript
{/* Header toolbar */}
<div className="flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700">
  <h1 className="text-lg font-semibold text-gray-900 dark:text-gray-100">
    Theme Configurator
  </h1>
  <div className="flex items-center gap-2">
    <ShareButton />
    <button
      onClick={onGetCommand}
      className="flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg text-sm font-medium hover:bg-blue-700 transition-colors"
    >
      Get Command
    </button>
  </div>
</div>
```
  </action>
  <verify>
```bash
cd apps/docs && npx tsc --noEmit
grep -q "ShareButton" apps/docs/src/components/configurator/ConfiguratorLayout.tsx
```
  </verify>
  <done>ConfiguratorLayout includes ShareButton in header next to Get Command button</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete Phase 24 integration:
- PresetSelector in sidebar for one-click preset application
- ShadeScaleDisplay showing primary color's 50-950 scale
- ShareButton in header for copying shareable URL
- URL sync that loads theme from ?theme= parameter on page load
  </what-built>
  <how-to-verify>
1. Start dev server: `cd apps/docs && npm run dev`
2. Navigate to http://localhost:5173/configurator

**Test Presets (CONFIG-07, CONFIG-08):**
3. Find "Presets" section in sidebar below Mode Toggle
4. Click "Ocean" preset - colors should change to blue theme
5. Click "Forest" preset - colors should change to green theme
6. Click "Sunset" preset - colors should change to warm orange
7. Click "Default" preset - colors should return to gray

**Test Shade Scale (CONFIG-12):**
8. Look below Primary color picker for "Primary Shades" display
9. Should show 11 color swatches (50 to 950) derived from primary
10. Change primary color - shade scale should update

**Test Share URL (CONFIG-10):**
11. Click "Share URL" button in header
12. Button should show "Copied!" feedback
13. Paste URL - should include ?theme=<encoded string>
14. Open the pasted URL in new tab - theme should be restored

**Test Get Command (CONFIG-09 - already working):**
15. Click "Get Command" button
16. Modal should show npx commands with encoded theme

**Overall:**
- No console errors
- All buttons responsive
- Dark mode toggle still works
- Preview updates when presets applied
  </how-to-verify>
  <resume-signal>Type "approved" if all features work, or describe any issues found</resume-signal>
</task>

</tasks>

<verification>
Phase 24 is complete when:

1. Presets available (default, ocean, forest, sunset) - CONFIG-07
2. User can apply preset with one click - CONFIG-08
3. CLI command generation works (already done) - CONFIG-09
4. Shareable URL works (copy + load) - CONFIG-10
5. Shade scale displays for primary color - CONFIG-12
</verification>

<success_criteria>
- PresetSelector displays 4 themes, clicking applies them
- ShareButton copies URL with encoded theme, shows feedback
- ShadeScaleDisplay shows 11 shades derived from primary
- URL with ?theme= param loads correctly on page visit
- No TypeScript errors, no console errors
- Visual verification passes
</success_criteria>

<output>
After completion, create `.planning/phases/24-presets-and-enhanced-features/24-03-SUMMARY.md`
</output>
