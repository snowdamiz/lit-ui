---
phase: 19-publishing
plan: 04
type: execute
wave: 3
depends_on: ["19-03"]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "npm organization 'lit-ui' exists and user is owner"
    - "NPM_TOKEN secret added to GitHub repository"
    - "First publish succeeds to npm registry"
  artifacts: []
  key_links:
    - from: "GitHub Actions"
      to: "npm registry"
      via: "NPM_TOKEN secret"
      pattern: "secrets.NPM_TOKEN"

user_setup:
  - service: npm
    why: "Publishing @lit-ui scoped packages requires organization ownership"
    env_vars:
      - name: NPM_TOKEN
        source: "npmjs.com -> Profile -> Access Tokens -> Generate New Token (Automation)"
    dashboard_config:
      - task: "Create 'lit-ui' organization"
        location: "npmjs.com -> Add Organization -> Name: lit-ui"
  - service: github
    why: "CI workflow needs npm token for publishing"
    dashboard_config:
      - task: "Add NPM_TOKEN secret"
        location: "GitHub repo -> Settings -> Secrets and variables -> Actions -> New repository secret"
---

<objective>
Configure npm organization and GitHub secrets for automated publishing.

Purpose: The @lit-ui scope requires an npm organization. GitHub Actions needs NPM_TOKEN to publish.
Output: Infrastructure ready for first publish.
</objective>

<execution_context>
@/Users/sn0w/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sn0w/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/19-publishing/19-CONTEXT.md
@.planning/phases/19-publishing/19-RESEARCH.md
</context>

<tasks>

<task type="checkpoint:human-action" gate="blocking">
  <action>Create npm organization and access token</action>
  <instructions>
## Step 1: Create npm Organization

1. Go to [npmjs.com](https://www.npmjs.com)
2. Log in to your npm account
3. Click your profile picture -> "Add Organization"
4. Organization name: `lit-ui`
5. Choose "Unlimited public packages" (free tier)
6. Click "Create"

**Why:** Scoped packages like `@lit-ui/core` require a matching organization or username. Since the scope is `@lit-ui`, an organization named `lit-ui` must exist.

## Step 2: Generate Automation Token

1. Go to [npmjs.com](https://www.npmjs.com)
2. Click your profile picture -> "Access Tokens"
3. Click "Generate New Token"
4. Select "Automation" (for CI/CD, no 2FA prompts)
5. Name it: `github-actions-lit-ui`
6. Click "Generate Token"
7. **Copy the token immediately** (it won't be shown again)

## Step 3: Add Token to GitHub

1. Go to your GitHub repository
2. Click "Settings" -> "Secrets and variables" -> "Actions"
3. Click "New repository secret"
4. Name: `NPM_TOKEN`
5. Value: Paste the npm token from Step 2
6. Click "Add secret"
  </instructions>
  <resume-signal>Type "configured" when npm org exists and NPM_TOKEN is added to GitHub, or describe any issues</resume-signal>
</task>

<task type="auto">
  <name>Task 2: Test publish with changeset (dry run simulation)</name>
  <files>No files modified - verification only</files>
  <action>
After user confirms setup, verify the publish infrastructure:

1. Create a test changeset to simulate versioning:
```bash
# Check current changeset status
pnpm changeset status
```

2. Verify packages are recognized:
```bash
# List all workspace packages that would be published
pnpm -r exec -- node -e "const p=require('./package.json'); if(!p.private) console.log(p.name + '@' + p.version)"
```

3. Check npm pack output (what would be published):
```bash
for pkg in core button dialog ssr; do
  echo "=== @lit-ui/$pkg ==="
  cd packages/$pkg && npm pack --dry-run 2>&1 | tail -10 && cd ../..
done

echo "=== lit-ui CLI ==="
cd packages/cli && npm pack --dry-run 2>&1 | tail -10 && cd ../..
```

Note: Actual publishing happens when:
1. User creates a changeset (`pnpm changeset`)
2. User commits and pushes to main
3. GitHub Actions creates a "Version Packages" PR
4. User merges the PR
5. GitHub Actions publishes to npm

This plan only sets up the infrastructure. First real publish is user-driven.
  </action>
  <verify>
```bash
pnpm changeset status
pnpm -r exec -- node -e "const p=require('./package.json'); if(!p.private) console.log(p.name)"
```
Should list all 5 publishable packages.
  </verify>
  <done>npm org exists, NPM_TOKEN configured, packages ready for first changeset</done>
</task>

</tasks>

<verification>
1. npm organization `lit-ui` exists
2. NPM_TOKEN secret exists in GitHub repository
3. All 5 packages show in changeset status
4. npm pack --dry-run succeeds for all packages
</verification>

<success_criteria>
- User confirms npm organization created
- User confirms NPM_TOKEN added to GitHub
- `pnpm changeset status` shows all packages
- Infrastructure ready for first publish
</success_criteria>

<output>
After completion, create `.planning/phases/19-publishing/19-04-SUMMARY.md`

## Next Steps After This Phase

To publish the first version:

1. Create a changeset:
   ```bash
   pnpm changeset
   ```
   Select all packages, choose "patch", describe changes

2. Commit and push:
   ```bash
   git add .
   git commit -m "chore: add changeset for initial release"
   git push
   ```

3. GitHub Actions will create a "Version Packages" PR

4. Review and merge the PR

5. GitHub Actions will publish to npm and create GitHub Releases
</output>
