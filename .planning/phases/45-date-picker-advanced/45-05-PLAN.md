---
phase: 45-date-picker-advanced
plan: 05
type: execute
wave: 4
depends_on: ["45-02", "45-03", "45-04"]
files_modified:
  - packages/date-picker/src/date-picker.ts
  - packages/date-picker/src/index.ts
  - packages/date-picker/src/jsx.d.ts
autonomous: true

must_haves:
  truths:
    - "Preset buttons and inline mode have proper dark mode styles via :host-context(.dark)"
    - "Inline mode renders correctly during SSR (no Floating UI or document listeners)"
    - "Natural language parser, preset types, and all new exports are available from package index"
    - "JSX types include inline, presets, and format attributes for React/Vue/Svelte"
    - "Component renders via SSR with Declarative Shadow DOM"
  artifacts:
    - path: "packages/date-picker/src/date-picker.ts"
      provides: "Complete dark mode styles for preset buttons and inline mode"
      contains: ":host-context(.dark) .preset-button"
    - path: "packages/date-picker/src/index.ts"
      provides: "Updated exports including new types and utilities"
      contains: "parseNaturalLanguage"
    - path: "packages/date-picker/src/jsx.d.ts"
      provides: "Updated JSX types with new attributes"
      contains: "inline"
  key_links:
    - from: "packages/date-picker/src/index.ts"
      to: "packages/date-picker/src/natural-language.ts"
      via: "re-export parseNaturalLanguage"
      pattern: "export.*natural-language"
    - from: "packages/date-picker/src/index.ts"
      to: "packages/date-picker/src/preset-types.ts"
      via: "re-export DatePreset, DEFAULT_PRESETS"
      pattern: "export.*preset-types"
---

<objective>
Complete dark mode support for all new Phase 45 UI elements (preset buttons, inline mode), ensure SSR compatibility, update package exports with new utilities and types, and update JSX type declarations for framework consumers.

Purpose: Satisfies DP-26 (dark mode via :host-context(.dark)), DP-27 (SSR with Declarative Shadow DOM), and ensures all Phase 45 features are properly exported and typed.
Output: Updated date-picker.ts with dark mode styles, index.ts with new exports, jsx.d.ts with new attributes.
</objective>

<execution_context>
@/Users/sn0w/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sn0w/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@.planning/phases/45-date-picker-advanced/45-02-SUMMARY.md
@.planning/phases/45-date-picker-advanced/45-03-SUMMARY.md
@.planning/phases/45-date-picker-advanced/45-04-SUMMARY.md
@packages/date-picker/src/date-picker.ts
@packages/date-picker/src/index.ts
@packages/date-picker/src/jsx.d.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add dark mode styles for preset buttons and inline mode</name>
  <files>packages/date-picker/src/date-picker.ts</files>
  <action>
    Add the following dark mode CSS rules to the static styles section, alongside the existing `:host-context(.dark)` rules:

    ```css
    /* Dark mode: Preset buttons */
    :host-context(.dark) .preset-buttons {
      border-bottom-color: var(--ui-date-picker-popup-border, #374151);
    }

    :host-context(.dark) .preset-button {
      border-color: var(--ui-date-picker-preset-border, #4b5563);
      background: var(--ui-date-picker-preset-bg, #1f2937);
      color: var(--ui-date-picker-preset-text, #f9fafb);
    }

    :host-context(.dark) .preset-button:hover:not(:disabled) {
      background: var(--ui-date-picker-preset-bg-hover, #374151);
      border-color: var(--ui-date-picker-preset-border-hover, #6b7280);
    }

    /* Dark mode: Inline mode */
    :host-context(.dark) .inline-wrapper {
      color: var(--ui-date-picker-text, #f9fafb);
    }
    ```

    Also verify the SSR guards are correct:
    - `connectedCallback` should guard both document listener AND inline check: `if (!isServer && !this.inline)`
    - `disconnectedCallback` same guard
    - `openPopup` has `if (isServer) return;` already in positionPopup
    - Inline mode `renderInlineCalendar()` has no Floating UI calls — SSR-safe by design
    - Natural language resolvers are functions, not evaluated at import time — SSR-safe

    If any SSR guard is missing, add it. The existing `isServer` guard in the constructor for `attachInternals()` should remain unchanged.
  </action>
  <verify>
    `npx tsc --noEmit` in packages/date-picker — no TypeScript errors.
  </verify>
  <done>
    - Preset buttons have dark mode styles matching existing component dark theme
    - Inline mode inherits dark mode text color
    - SSR guards verified for all new code paths
  </done>
</task>

<task type="auto">
  <name>Task 2: Update package exports and JSX types</name>
  <files>
    packages/date-picker/src/index.ts
    packages/date-picker/src/jsx.d.ts
  </files>
  <action>
    1. **Update `index.ts`** to export new utilities:
       Add these exports after the existing export block:
       ```typescript
       // Export natural language parser for consumer reuse
       export { parseNaturalLanguage } from './natural-language.js';

       // Export preset types for custom preset configuration
       export type { DatePreset } from './preset-types.js';
       export { DEFAULT_PRESETS } from './preset-types.js';
       ```

    2. **Update `jsx.d.ts`** to include new attributes:
       Add to `LuiDatePickerAttributes`:
       ```typescript
       inline?: boolean;
       ```

       Add to `LuiDatePickerEvents` (no new events needed — change event is unchanged).

       Create a new interface for JS-only properties that can be set via JSX:
       ```typescript
       // JS-only properties (set via property binding, not attributes)
       interface LuiDatePickerProperties {
         presets?: import('./preset-types.js').DatePreset[] | boolean;
         format?: Intl.DateTimeFormatOptions | null;
       }
       ```

       Update the React JSX IntrinsicElements to include both:
       ```typescript
       'lui-date-picker': React.DetailedHTMLProps<
         React.HTMLAttributes<DatePicker> & LuiDatePickerAttributes & LuiDatePickerProperties & LuiDatePickerEvents,
         DatePicker
       >;
       ```

       Update the Vue GlobalComponents to include new attributes.

       Update the Svelte IntrinsicElements to include new attributes:
       ```typescript
       'lui-date-picker': LuiDatePickerAttributes & LuiDatePickerProperties & {
         'on:change'?: (e: CustomEvent<{ date: Date | null; isoString: string }>) => void;
       };
       ```

    3. **Ensure the inline mode calendar also has show-constraint-tooltips:**
       In `renderInlineCalendar()` (added by Plan 03), verify the `<lui-calendar>` element includes:
       `?show-constraint-tooltips=${!!(this.minDate || this.maxDate)}`
       If missing (Plan 03 may have added a TODO), add it now.
  </action>
  <verify>
    ```bash
    cd packages/date-picker && npx tsc --noEmit
    ```
    - TypeScript compiles without errors
    - All exports resolve correctly
  </verify>
  <done>
    - parseNaturalLanguage, DatePreset, DEFAULT_PRESETS exported from package
    - JSX types include inline, presets, and format attributes
    - React, Vue, and Svelte type declarations updated
    - Inline mode calendar has constraint tooltips wired
  </done>
</task>

</tasks>

<verification>
```bash
cd packages/date-picker && npx tsc --noEmit && npx vitest run --reporter=verbose
```
- TypeScript compiles without errors
- All tests pass
- New exports are available from the package
</verification>

<success_criteria>
- `import { parseNaturalLanguage, DEFAULT_PRESETS } from '@lit-ui/date-picker'` works
- `import type { DatePreset } from '@lit-ui/date-picker'` works
- Dark mode renders correctly for preset buttons and inline mode
- SSR renders without errors (no document/window references in server path)
- JSX types allow `<lui-date-picker inline presets={true} format={{ year: 'numeric', month: 'short', day: 'numeric' }} />`
</success_criteria>

<output>
After completion, create `.planning/phases/45-date-picker-advanced/45-05-SUMMARY.md`
</output>
