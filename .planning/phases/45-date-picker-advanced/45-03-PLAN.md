---
phase: 45-date-picker-advanced
plan: 03
type: execute
wave: 3
depends_on: ["45-02"]
files_modified:
  - packages/date-picker/src/date-picker.ts
autonomous: true

must_haves:
  truths:
    - "User can set inline attribute to render always-visible calendar without popup"
    - "Inline mode skips input field, popup, Floating UI, click-outside, and focus trap"
    - "Inline mode still shows label, presets, error messages, and helper text"
    - "Date selection in inline mode dispatches change event same as popup mode"
    - "Inline mode works with form integration (ElementInternals value submission)"
  artifacts:
    - path: "packages/date-picker/src/date-picker.ts"
      provides: "DatePicker with inline mode rendering"
      contains: "renderInlineCalendar"
  key_links:
    - from: "packages/date-picker/src/date-picker.ts render()"
      to: "renderInlineCalendar()"
      via: "conditional branch on this.inline at top of render()"
      pattern: "this\\.inline"
---

<objective>
Add inline mode to the date picker that renders an always-visible calendar without the popup/input wrapper. When `inline` is true, the component skips the input field, popup positioning, click-outside detection, and focus trap — rendering just the label, optional presets, and calendar directly.

Purpose: Satisfies DP-23 (inline mode displays always-visible calendar without popup).
Output: Updated date-picker.ts with inline property and renderInlineCalendar method.
</objective>

<execution_context>
@/Users/sn0w/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sn0w/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@.planning/phases/45-date-picker-advanced/45-02-SUMMARY.md
@packages/date-picker/src/date-picker.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add inline property and conditional rendering</name>
  <files>packages/date-picker/src/date-picker.ts</files>
  <action>
    1. **Add `inline` property** (reflected boolean):
       ```typescript
       @property({ type: Boolean, reflect: true })
       inline = false;
       ```
       Place it in the Properties section alongside other reflected attributes.

    2. **Guard event listener attachment** in `connectedCallback`:
       Change `if (!isServer)` to `if (!isServer && !this.inline)` for the document click listener.
       Same guard in `disconnectedCallback`.

    3. **Add `renderInlineCalendar()` private method:**
       ```typescript
       private renderInlineCalendar() {
         return html`
           <div class="date-picker-wrapper inline-wrapper">
             ${this.label
               ? html`
                   <label class="date-picker-label">
                     ${this.label}
                     ${this.required
                       ? html`<span class="required-indicator">*</span>`
                       : nothing}
                   </label>
                 `
               : nothing}

             ${this.renderPresets()}

             <lui-calendar
               .value=${this.value}
               .locale=${this.effectiveLocale}
               min-date=${this.minDate || nothing}
               max-date=${this.maxDate || nothing}
               @change=${this.handleCalendarSelect}
             ></lui-calendar>

             ${this.helperText && !this.hasError
               ? html`<span class="helper-text">${this.helperText}</span>`
               : nothing}

             ${this.hasError && this.errorMessage
               ? html`<span class="error-text" role="alert">${this.errorMessage}</span>`
               : nothing}
           </div>
         `;
       }
       ```

    4. **Update `render()` method** to branch on inline mode:
       At the very start of render(), before the existing return, add:
       ```typescript
       if (this.inline) {
         return this.renderInlineCalendar();
       }
       ```

    5. **Override `handleCalendarSelect` behavior for inline mode:**
       In `handleCalendarSelect`, only call `this.closePopup()` if `!this.inline` — inline mode has no popup to close.
       Change:
       ```typescript
       // Close popup (restores focus to input)
       this.closePopup();
       ```
       To:
       ```typescript
       // Close popup (restores focus to input) — skip in inline mode
       if (!this.inline) {
         this.closePopup();
       }
       ```

    6. **Skip `openPopup`/`togglePopup` in inline mode:**
       Add early return in `openPopup()`: `if (this.inline) return;`
       Add early return in `togglePopup()`: `if (this.inline) return;`

    7. **Add inline-specific CSS:**
       ```css
       .inline-wrapper {
         display: inline-flex;
         flex-direction: column;
         gap: 0.25rem;
       }

       .inline-wrapper .preset-buttons {
         border-bottom: none;
         padding: 0 0 0.25rem 0;
       }

       :host([inline]) {
         width: auto;
       }
       ```

    8. **Hidden form input for inline mode:**
       Since inline mode has no visible text input, form submission still works via ElementInternals (already set up in constructor). No hidden input needed — ElementInternals handles form value without a visible input. However, ensure `validate()` still works by checking if `this.inputEl` might be null in inline mode:
       - In `validate()`, the `this.inputEl` is passed as anchor to `setValidity`. In inline mode, inputEl won't exist. Change the anchor parameter: use `this.inputEl ?? undefined` (undefined is valid — it just means no anchor element).
       - Same for handleInputBlur's setValidity calls — but handleInputBlur won't be called in inline mode since there's no input.
  </action>
  <verify>
    `npx tsc --noEmit` in packages/date-picker — no TypeScript errors.
    `cd packages/date-picker && npx vitest run` — all tests pass.
  </verify>
  <done>
    - `<lui-date-picker inline>` renders calendar directly without input/popup
    - Inline mode shows label, presets (if configured), and calendar
    - Date selection in inline mode dispatches change event
    - No document click listeners attached in inline mode
    - Form integration works via ElementInternals
    - No regressions in popup mode
  </done>
</task>

</tasks>

<verification>
```bash
cd packages/date-picker && npx tsc --noEmit && npx vitest run --reporter=verbose
```
- TypeScript compiles without errors
- All tests pass
- Inline mode renders calendar without popup wrapper
</verification>

<success_criteria>
- `<lui-date-picker inline label="Pick a date"></lui-date-picker>` renders always-visible calendar
- No popup, input field, or calendar icon button in inline mode
- Clicking a date dispatches change event with date and isoString
- Inline mode works with presets (`.presets=${true}`)
- No memory leaks (no document listeners in inline mode)
- Form submission still sends ISO value
</success_criteria>

<output>
After completion, create `.planning/phases/45-date-picker-advanced/45-03-SUMMARY.md`
</output>
