---
phase: 45-date-picker-advanced
plan: 02
type: execute
wave: 2
depends_on: ["45-01"]
files_modified:
  - packages/date-picker/src/preset-types.ts
  - packages/date-picker/src/date-picker.ts
  - packages/date-picker/src/date-input-parser.ts
autonomous: true

must_haves:
  truths:
    - "User can click Today, Tomorrow, Next Week preset buttons to select dates"
    - "Preset buttons appear above the calendar in the popup"
    - "Presets respect min/max constraints — disabled when resolved date is out of range"
    - "User can pass custom preset array via .presets property"
    - "User can customize date display format via .format property with Intl.DateTimeFormat options"
    - "Custom format only affects display — input parsing still accepts any parseable format"
  artifacts:
    - path: "packages/date-picker/src/preset-types.ts"
      provides: "DatePreset interface and DEFAULT_PRESETS array"
      exports: ["DatePreset", "DEFAULT_PRESETS"]
    - path: "packages/date-picker/src/date-picker.ts"
      provides: "Updated component with presets and format properties"
      contains: "presets"
    - path: "packages/date-picker/src/date-input-parser.ts"
      provides: "Updated formatDateForDisplay with optional options parameter"
      contains: "options?: Intl.DateTimeFormatOptions"
  key_links:
    - from: "packages/date-picker/src/date-picker.ts"
      to: "packages/date-picker/src/preset-types.ts"
      via: "import DatePreset, DEFAULT_PRESETS"
      pattern: "import.*preset-types"
    - from: "packages/date-picker/src/date-picker.ts"
      to: "packages/date-picker/src/date-input-parser.ts"
      via: "formatDateForDisplay called with format options"
      pattern: "formatDateForDisplay.*format"
---

<objective>
Add preset buttons and custom format property to the date picker. Presets provide one-click date selection for common dates (Today, Tomorrow, Next Week). The format property accepts Intl.DateTimeFormatOptions to customize how selected dates are displayed in the input.

Purpose: Satisfies DP-21 (quick preset buttons), DP-22 (Today, Tomorrow, Next Week presets), and DP-24 (custom format prop with Intl.DateTimeFormat options).
Output: preset-types.ts with types and defaults, updated date-picker.ts with new properties and preset rendering, updated formatDateForDisplay with options parameter.
</objective>

<execution_context>
@/Users/sn0w/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sn0w/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@.planning/phases/45-date-picker-advanced/45-RESEARCH.md
@.planning/phases/45-date-picker-advanced/45-01-SUMMARY.md
@packages/date-picker/src/date-picker.ts
@packages/date-picker/src/date-input-parser.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create preset types and update formatDateForDisplay</name>
  <files>
    packages/date-picker/src/preset-types.ts
    packages/date-picker/src/date-input-parser.ts
  </files>
  <action>
    1. Create `preset-types.ts` with:
       - `DatePreset` interface: `{ label: string; resolve: () => Date }`
       - `DEFAULT_PRESETS` array with three entries:
         - `{ label: 'Today', resolve: () => startOfDay(new Date()) }`
         - `{ label: 'Tomorrow', resolve: () => addDays(startOfDay(new Date()), 1) }`
         - `{ label: 'Next Week', resolve: () => startOfWeek(addWeeks(new Date(), 1), { weekStartsOn: 1 }) }`
       - Import `addDays`, `addWeeks`, `startOfWeek`, `startOfDay` from `date-fns`

    2. Update `formatDateForDisplay` in `date-input-parser.ts`:
       - Add optional third parameter: `options?: Intl.DateTimeFormatOptions`
       - Use `options ?? { year: 'numeric', month: 'long', day: 'numeric' }` as the effective options
       - This is backward compatible — existing callers without the parameter get the same behavior
  </action>
  <verify>
    `npx tsc --noEmit` in packages/date-picker — no TypeScript errors.
    Existing tests still pass: `cd packages/date-picker && npx vitest run`
  </verify>
  <done>
    - DatePreset interface and DEFAULT_PRESETS exported from preset-types.ts
    - formatDateForDisplay accepts optional Intl.DateTimeFormatOptions third parameter
    - No regressions in existing tests
  </done>
</task>

<task type="auto">
  <name>Task 2: Add presets and format properties to DatePicker component</name>
  <files>packages/date-picker/src/date-picker.ts</files>
  <action>
    Add two new properties to the DatePicker class:

    1. **`presets` property** (JS-only, not reflected as attribute):
       ```typescript
       @property({ attribute: false })
       presets: DatePreset[] | boolean = false;
       ```
       - When `true`, use DEFAULT_PRESETS
       - When `DatePreset[]`, use that array
       - When `false` (default), show no presets

    2. **`format` property** (JS-only, not reflected):
       ```typescript
       @property({ attribute: false })
       format: Intl.DateTimeFormatOptions | null = null;
       ```

    3. **Computed getter for effective presets:**
       ```typescript
       private get effectivePresets(): DatePreset[] {
         if (this.presets === true) return DEFAULT_PRESETS;
         if (Array.isArray(this.presets)) return this.presets;
         return [];
       }
       ```

    4. **Update `updated()` lifecycle** to pass format options to `formatDateForDisplay`:
       - Change `formatDateForDisplay(date, this.effectiveLocale)` to `formatDateForDisplay(date, this.effectiveLocale, this.format ?? undefined)`
       - Apply this change in both the `updated()` method and the `handleCalendarSelect()` method and the `handleInputBlur()` method

    5. **Add `renderPresets()` private method:**
       - Returns `nothing` if `effectivePresets` is empty
       - Renders a horizontal row of buttons above the calendar:
         ```html
         <div class="preset-buttons">
           ${this.effectivePresets.map(preset => {
             const resolved = preset.resolve();
             const isDisabledPreset = this.isPresetDisabled(resolved);
             return html`
               <button
                 type="button"
                 class="preset-button ${isDisabledPreset ? 'preset-disabled' : ''}"
                 ?disabled=${isDisabledPreset}
                 @click=${() => this.handlePresetSelect(preset)}
               >${preset.label}</button>
             `;
           })}
         </div>
         ```

    6. **Add `isPresetDisabled(date: Date)` private method:**
       - Check if date is before minDate or after maxDate (same logic as constraint validation)
       - Return true if out of range, false otherwise

    7. **Add `handlePresetSelect(preset: DatePreset)` private method:**
       - Resolve the preset: `const date = preset.resolve();`
       - Set `this.value = format(date, 'yyyy-MM-dd');`
       - Set `this.displayValue = formatDateForDisplay(date, this.effectiveLocale, this.format ?? undefined);`
       - Clear `this.internalError`
       - Call `this.updateFormValue()` and `this.validate()`
       - Close popup via `this.closePopup()`
       - Dispatch change event with date and isoString

    8. **Update popup render** to include presets above the calendar:
       In the `render()` method, inside the popup div (before `<lui-calendar>`), add:
       `${this.renderPresets()}`

    9. **Add CSS for preset buttons** in the static styles:
       ```css
       .preset-buttons {
         display: flex;
         gap: 0.25rem;
         padding: 0.5rem;
         border-bottom: 1px solid var(--ui-date-picker-popup-border, #e5e7eb);
       }

       .preset-button {
         flex: 1;
         padding: 0.375rem 0.5rem;
         font-size: 0.75rem;
         border: 1px solid var(--ui-date-picker-preset-border, #d1d5db);
         border-radius: 0.25rem;
         background: var(--ui-date-picker-preset-bg, #f9fafb);
         color: var(--ui-date-picker-preset-text, inherit);
         cursor: pointer;
         transition: background-color 150ms, border-color 150ms;
         white-space: nowrap;
       }

       .preset-button:hover:not(:disabled) {
         background: var(--ui-date-picker-preset-bg-hover, #e5e7eb);
         border-color: var(--ui-date-picker-preset-border-hover, #9ca3af);
       }

       .preset-button:focus-visible {
         outline: 2px solid var(--color-ring, #3b82f6);
         outline-offset: 1px;
       }

       .preset-button:disabled {
         opacity: 0.5;
         cursor: not-allowed;
       }
       ```

    Import `DatePreset` and `DEFAULT_PRESETS` from `./preset-types.js` at the top of the file.
    Import `format` from `date-fns` is already present.
  </action>
  <verify>
    `npx tsc --noEmit` in packages/date-picker — no TypeScript errors.
    `cd packages/date-picker && npx vitest run` — all tests pass.
  </verify>
  <done>
    - `presets` property accepts boolean or DatePreset[] and renders preset buttons above calendar in popup
    - `format` property accepts Intl.DateTimeFormatOptions and customizes display formatting
    - Preset buttons are disabled when their resolved date falls outside min/max range
    - Clicking a preset selects the date, closes popup, and dispatches change event
    - No regressions in existing functionality
  </done>
</task>

</tasks>

<verification>
```bash
cd packages/date-picker && npx tsc --noEmit && npx vitest run --reporter=verbose
```
- TypeScript compiles without errors
- All existing and new tests pass
- Preset buttons render in the popup when presets property is truthy
- Custom format option changes the display format in the input
</verification>

<success_criteria>
- DatePicker with `.presets=${true}` shows Today, Tomorrow, Next Week buttons above calendar
- Clicking a preset button selects the date and closes the popup
- DatePicker with `.format=${{ year: 'numeric', month: 'short', day: 'numeric' }}` displays dates like "Jan 31, 2026"
- Presets are disabled when their resolved date falls outside min/max constraints
- No regressions in date input parsing or form integration
</success_criteria>

<output>
After completion, create `.planning/phases/45-date-picker-advanced/45-02-SUMMARY.md`
</output>
