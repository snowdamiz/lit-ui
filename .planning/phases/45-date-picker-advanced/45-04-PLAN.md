---
phase: 45-date-picker-advanced
plan: 04
type: execute
wave: 1
depends_on: []
files_modified:
  - packages/calendar/src/calendar.ts
autonomous: true

must_haves:
  truths:
    - "User sees tooltip on hover over disabled dates explaining the constraint reason"
    - "Tooltip shows 'Before minimum date', 'After maximum date', or 'Unavailable' as appropriate"
    - "Tooltip appears above the date cell and disappears on mouse leave"
    - "Tooltip does NOT appear on enabled dates"
    - "show-constraint-tooltips property controls tooltip visibility (opt-in)"
  artifacts:
    - path: "packages/calendar/src/calendar.ts"
      provides: "Calendar with constraint tooltip rendering on disabled dates"
      contains: "show-constraint-tooltips"
  key_links:
    - from: "packages/calendar/src/calendar.ts renderDayCell()"
      to: "data-tooltip attribute on disabled date buttons"
      via: "conditional data-tooltip when constraint.disabled && showConstraintTooltips"
      pattern: "data-tooltip"
---

<objective>
Add tooltip support to the calendar component for disabled dates. When the `show-constraint-tooltips` property is true, hovering over a disabled date shows a tooltip explaining why it's disabled (e.g., "Before minimum date", "After maximum date", "Unavailable"). Uses CSS `::after` pseudo-elements with `data-tooltip` attribute — NOT the HTML `title` attribute (which has a known Firefox bug in Shadow DOM).

Purpose: Satisfies DP-25 (min/max dates show tooltip with constraint reason).
Output: Updated calendar.ts with show-constraint-tooltips property and CSS tooltip rendering.
</objective>

<execution_context>
@/Users/sn0w/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sn0w/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@.planning/phases/45-date-picker-advanced/45-RESEARCH.md
@packages/calendar/src/calendar.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add show-constraint-tooltips property and data-tooltip rendering</name>
  <files>packages/calendar/src/calendar.ts</files>
  <action>
    1. **Add `show-constraint-tooltips` property** (reflected boolean):
       ```typescript
       @property({ type: Boolean, attribute: 'show-constraint-tooltips' })
       showConstraintTooltips = false;
       ```
       Place in the Properties section alongside other public properties.

    2. **Capitalize constraint reasons** in `isDateDisabled`:
       Change the reason strings from lowercase to title case for user-facing tooltip display:
       - `'before minimum date'` -> `'Before minimum date'`
       - `'after maximum date'` -> `'After maximum date'`
       - `'unavailable'` -> `'Unavailable'`
       Note: The lowercase versions are currently used in aria-label. After capitalization, they'll read better as both tooltip text and aria-label text.

    3. **Update `renderDayCell` method** to add `data-tooltip` attribute on disabled date buttons:
       In the default rendering path (non-renderDay), when `constraint.disabled` is true AND `this.showConstraintTooltips` is true, add `data-tooltip="${constraint.reason}"` to the button element.

       For the standard button rendering (line ~1436), change:
       ```html
       <button
         class="date-button ${outsideMonth ? 'outside-month' : ''} ${todayFlag ? 'today' : ''}"
       ```
       To:
       ```html
       <button
         class="date-button ${outsideMonth ? 'outside-month' : ''} ${todayFlag ? 'today' : ''}"
         data-tooltip="${this.showConstraintTooltips && constraint.disabled && constraint.reason ? constraint.reason : nothing}"
       ```

       For the renderDay wrapper (line ~1421), add the same data-tooltip to the `.date-button-wrapper` div.

    4. **Add tooltip CSS** in the static styles section:
       ```css
       /* Constraint tooltip for disabled dates */
       .date-button[data-tooltip],
       .date-button-wrapper[data-tooltip] {
         position: relative;
       }

       .date-button[data-tooltip]:hover::after,
       .date-button-wrapper[data-tooltip]:hover::after {
         content: attr(data-tooltip);
         position: absolute;
         bottom: calc(100% + 4px);
         left: 50%;
         transform: translateX(-50%);
         padding: 0.25rem 0.5rem;
         background: var(--ui-calendar-tooltip-bg, #1f2937);
         color: var(--ui-calendar-tooltip-text, #ffffff);
         font-size: 0.6875rem;
         line-height: 1.25;
         border-radius: 0.25rem;
         white-space: nowrap;
         z-index: 10;
         pointer-events: none;
       }

       /* Dark mode tooltip */
       :host-context(.dark) .date-button[data-tooltip]:hover::after,
       :host-context(.dark) .date-button-wrapper[data-tooltip]:hover::after {
         background: var(--ui-calendar-tooltip-bg, #e5e7eb);
         color: var(--ui-calendar-tooltip-text, #111827);
       }
       ```

       Note: The `.date-button` already has `position: relative` or needs it added if not present. Check the existing styles — the date buttons in the calendar use CSS Grid cells which are already relatively positioned. If not, add `position: relative` to `.date-button`.
  </action>
  <verify>
    `cd packages/calendar && npx tsc --noEmit` — no TypeScript errors.
    `cd packages/calendar && npx vitest run` — all tests pass (if calendar has tests).
    Visually: tooltip appears on hover over disabled dates when `show-constraint-tooltips` is set.
  </verify>
  <done>
    - `show-constraint-tooltips` property added to Calendar component
    - Hovering over disabled dates shows tooltip with constraint reason
    - Tooltip uses CSS ::after pseudo-element (not title attribute)
    - Tooltip has dark mode support
    - No tooltip on enabled dates
    - No regressions in calendar rendering or keyboard navigation
  </done>
</task>

<task type="auto">
  <name>Task 2: Wire tooltip property from date-picker to calendar</name>
  <files>packages/date-picker/src/date-picker.ts</files>
  <action>
    In the date-picker's popup render (the `<lui-calendar>` element inside the popup div), add the `show-constraint-tooltips` attribute:

    Change (in the popup section of render()):
    ```html
    <lui-calendar
      .value=${this.value}
      .locale=${this.effectiveLocale}
      min-date=${this.minDate || nothing}
      max-date=${this.maxDate || nothing}
      @change=${this.handleCalendarSelect}
    ></lui-calendar>
    ```
    To:
    ```html
    <lui-calendar
      .value=${this.value}
      .locale=${this.effectiveLocale}
      min-date=${this.minDate || nothing}
      max-date=${this.maxDate || nothing}
      ?show-constraint-tooltips=${!!(this.minDate || this.maxDate)}
      @change=${this.handleCalendarSelect}
    ></lui-calendar>
    ```

    This auto-enables tooltips whenever min/max constraints are set on the date picker. No extra property needed on the date picker — it's inferred.

    Also apply the same to the `renderInlineCalendar()` method's `<lui-calendar>` element (from Plan 03). If Plan 03 hasn't run yet (this plan is Wave 1, Plan 03 is Wave 3), note this as a TODO comment:
    ```typescript
    // TODO: Plan 03 (inline mode) will add renderInlineCalendar() — add show-constraint-tooltips there too
    ```

    **Note**: This task modifies date-picker.ts which is also modified by Plans 02 and 03. Since this plan is Wave 1 and those are Wave 2-3, there's no conflict. However, only modify the popup calendar element in render() — do not touch other parts of date-picker.ts.
  </action>
  <verify>
    `cd packages/date-picker && npx tsc --noEmit` — no TypeScript errors.
  </verify>
  <done>
    - Date picker automatically enables constraint tooltips on its calendar when min/max dates are set
    - Tooltip behavior is transparent to the date picker consumer
  </done>
</task>

</tasks>

<verification>
```bash
cd packages/calendar && npx tsc --noEmit
cd packages/date-picker && npx tsc --noEmit
```
- TypeScript compiles without errors in both packages
- Calendar shows tooltips on disabled dates when show-constraint-tooltips is set
</verification>

<success_criteria>
- `<lui-calendar show-constraint-tooltips min-date="2026-01-15"></lui-calendar>` shows "Before minimum date" tooltip on dates before Jan 15
- `<lui-date-picker min-date="2026-01-15"></lui-date-picker>` popup calendar shows tooltips automatically
- Tooltips appear on hover, positioned above the date cell
- Dark mode inverts tooltip colors
- No tooltip on enabled, selectable dates
</success_criteria>

<output>
After completion, create `.planning/phases/45-date-picker-advanced/45-04-SUMMARY.md`
</output>
