---
phase: 03-dialog-component
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/dialog/dialog.ts
  - src/index.ts
autonomous: true

must_haves:
  truths:
    - "Dialog opens when open property is set to true"
    - "Dialog closes when open property is set to false"
    - "Focus is trapped within dialog while open (Tab cycles within)"
    - "Pressing Escape closes the dialog"
    - "Dialog has aria-labelledby pointing to title element"
    - "Dialog has aria-describedby pointing to content element"
  artifacts:
    - path: "src/components/dialog/dialog.ts"
      provides: "Dialog component using native <dialog> with showModal()"
      min_lines: 80
    - path: "src/index.ts"
      provides: "Dialog export"
      contains: "export { Dialog }"
  key_links:
    - from: "src/components/dialog/dialog.ts"
      to: "native <dialog>"
      via: "showModal() and close() methods"
      pattern: "showModal\\(\\)|dialogEl\\.close\\(\\)"
    - from: "src/components/dialog/dialog.ts"
      to: "TailwindElement"
      via: "extends"
      pattern: "extends TailwindElement"
---

<objective>
Create the core dialog component wrapping native `<dialog>` element with showModal() for automatic focus trapping, Escape key handling, and ARIA modal semantics.

Purpose: Establishes the foundation for an accessible modal dialog that leverages browser-native features for focus management and keyboard interaction.

Output: A `ui-dialog` component with open property, show()/close() methods, and proper ARIA attributes.
</objective>

<execution_context>
@/Users/sn0w/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sn0w/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-dialog-component/03-RESEARCH.md
@.planning/phases/03-dialog-component/03-CONTEXT.md
@src/base/tailwind-element.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create dialog component with native dialog element</name>
  <files>src/components/dialog/dialog.ts</files>
  <action>
Create `src/components/dialog/dialog.ts` with the following:

1. **Component structure:**
   - Extend TailwindElement
   - Custom element name: `ui-dialog`
   - Import decorators: `customElement`, `property`, `query`

2. **Properties:**
   - `open: boolean` (reflect: true) - Controls dialog visibility
   - `size: 'sm' | 'md' | 'lg'` - Dialog width (default: 'md')
   - `dismissible: boolean` (default: true) - Whether Escape/backdrop can close

3. **Query:**
   - `@query('dialog') private dialogEl!: HTMLDialogElement`

4. **Core methods:**
   - `show()` - Sets `this.open = true`
   - `close()` - Will be expanded in Plan 02

5. **Lifecycle:**
   - `updated(changedProperties)` - When `open` changes:
     - If `open && !dialogEl.open`: call `dialogEl.showModal()`
     - If `!open && dialogEl.open`: call `dialogEl.close()`

6. **Event handlers:**
   - `handleCancel(e: Event)` - Listens to native `cancel` event (Escape key)
     - If not dismissible: `e.preventDefault()` and return
     - Otherwise: set `this.open = false`

7. **Render structure:**
```html
<dialog @cancel=${handleCancel} aria-labelledby="dialog-title" aria-describedby="dialog-description">
  <div class="dialog-content" @click=${stopPropagation}>
    <header id="dialog-title">
      <slot name="title"></slot>
    </header>
    <div id="dialog-description">
      <slot></slot>
    </div>
    <footer>
      <slot name="footer"></slot>
    </footer>
  </div>
</dialog>
```

8. **Size classes:**
   Use Record pattern like Button:
   ```typescript
   const sizeClasses: Record<DialogSize, string> = {
     sm: 'max-w-sm',
     md: 'max-w-md',
     lg: 'max-w-lg'
   };
   ```

9. **Base styles:**
   ```css
   :host { display: contents; }
   dialog { border: none; padding: 0; }
   .dialog-content { /* Tailwind classes for padding, bg, rounded */ }
   ```

Reference RESEARCH.md Pattern 1 and Pattern 2 for implementation details.
  </action>
  <verify>
File exists at `src/components/dialog/dialog.ts` with:
- Class `Dialog` extending TailwindElement
- `@customElement('ui-dialog')` decorator
- `open` property with reflect: true
- `@query('dialog')` for dialogEl reference
- `updated()` calling showModal()/close()
- `handleCancel()` with dismissible check
- Three named slots: title, default, footer
  </verify>
  <done>
Dialog component file created with native dialog wrapping, open/close via property, showModal() focus trapping, and cancel event handling for Escape key.
  </done>
</task>

<task type="auto">
  <name>Task 2: Export Dialog from library entry point</name>
  <files>src/index.ts</files>
  <action>
Add Dialog export to `src/index.ts`:

1. Import Dialog component:
   ```typescript
   import { Dialog } from './components/dialog/dialog.js';
   ```

2. Add to exports:
   ```typescript
   export { Dialog } from './components/dialog/dialog.js';
   ```

3. If type exports exist, also export DialogSize:
   ```typescript
   export type { DialogSize } from './components/dialog/dialog.js';
   ```

Follow the existing pattern used for Button export.
  </action>
  <verify>
Run `npm run build` - should complete without errors.
Check `dist/index.d.ts` includes Dialog export.
  </verify>
  <done>
Dialog component exported from library. Build produces ES module and type declarations.
  </done>
</task>

</tasks>

<verification>
1. `npm run build` completes without errors
2. `dist/index.js` contains Dialog class
3. `dist/index.d.ts` exports Dialog type
4. Dialog component uses native `<dialog>` element
5. showModal() is called when open becomes true
</verification>

<success_criteria>
- Dialog component exists at `src/components/dialog/dialog.ts`
- Component extends TailwindElement and uses native `<dialog>`
- `open` property controls visibility via showModal()/close()
- Escape key triggers cancel event which closes dialog (when dismissible)
- Named slots for title, default content, and footer exist
- Dialog exported from `src/index.ts`
- Build succeeds with type declarations
</success_criteria>

<output>
After completion, create `.planning/phases/03-dialog-component/03-01-SUMMARY.md`
</output>
