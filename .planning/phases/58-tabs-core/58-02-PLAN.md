---
phase: 58-tabs-core
plan: 02
type: execute
wave: 2
depends_on: ["58-01"]
files_modified:
  - packages/tabs/src/tabs.ts
  - packages/tabs/src/tab-panel.ts
  - packages/core/src/styles/tailwind.css
autonomous: true

must_haves:
  truths:
    - "In automatic mode, arrow keys immediately activate the focused tab"
    - "In manual mode, arrow keys move focus only; Enter/Space activates"
    - "Left/Right arrows navigate horizontal tabs; Up/Down arrows navigate vertical tabs"
    - "Arrow key navigation wraps from last to first and vice versa"
    - "Home/End keys jump to first/last non-disabled tab"
    - "Disabled tabs are skipped during keyboard navigation"
    - "Tab key from tablist moves focus to active panel content"
    - "Screen reader identifies tablist, tab, and tabpanel roles with aria-selected and aria-orientation"
    - "Tabs render with --ui-tabs-* CSS custom properties and respond to dark mode"
  artifacts:
    - path: "packages/tabs/src/tabs.ts"
      provides: "Full keyboard navigation, activation modes, orientation, ARIA, disabled handling"
      contains: "handleKeyDown"
    - path: "packages/tabs/src/tab-panel.ts"
      provides: "tabindex=0 on active panel for Tab key focus"
      contains: "tabindex"
    - path: "packages/core/src/styles/tailwind.css"
      provides: "CSS custom properties for tabs theming in :root and .dark blocks"
      contains: "--ui-tabs-"
  key_links:
    - from: "packages/tabs/src/tabs.ts handleKeyDown"
      to: "packages/tabs/src/tabs.ts activateTab/focusTabButton"
      via: "keyboard event -> state change -> focus management"
      pattern: "handleKeyDown.*activateTab|focusTab"
    - from: "packages/core/src/styles/tailwind.css"
      to: "packages/tabs/src/tabs.ts"
      via: "CSS custom properties consumed in component styles"
      pattern: "--ui-tabs-"
---

<objective>
Add keyboard navigation, dual activation modes (automatic/manual), horizontal/vertical orientation, full ARIA attributes, disabled tab handling, and CSS custom property theming with dark mode to the tabs component created in Plan 01.

Purpose: Complete the Phase 58 success criteria — users can navigate tabs with keyboard, screen readers announce correct roles/states, and tabs are visually themed with project-consistent tokens.
Output: Fully accessible, keyboard-navigable, themed tabs component.
</objective>

<execution_context>
@/Users/sn0w/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sn0w/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/58-tabs-core/58-RESEARCH.md
@.planning/phases/58-tabs-core/58-01-SUMMARY.md

# Pattern references:
@packages/accordion/src/accordion.ts (keyboard nav pattern: handleKeyDown, updateRovingTabindex)
@packages/accordion/src/accordion-item.ts (disabled pattern, data-state)
@packages/radio/src/radio-group.ts (roving tabindex, arrow key wrapping)
@packages/core/src/styles/tailwind.css (CSS custom property token format - :root block and .dark block)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Keyboard navigation, activation modes, orientation, ARIA, and disabled tabs</name>
  <files>
    packages/tabs/src/tabs.ts
    packages/tabs/src/tab-panel.ts
  </files>
  <action>
    Update tabs.ts and tab-panel.ts to add full keyboard navigation and accessibility.

    **tabs.ts — Keyboard navigation (`handleKeyDown` method)**:

    Add a `@keydown` handler on the tablist div (NOT the wrapper). Implementation:

    1. **Orientation-aware arrow keys**:
       - `forwardKey`: `'ArrowRight'` for horizontal, `'ArrowDown'` for vertical
       - `backwardKey`: `'ArrowLeft'` for horizontal, `'ArrowUp'` for vertical
       - Only respond to orientation-matching arrow keys, Home, End, and (in manual mode) Enter/Space
       - Call `e.preventDefault()` for handled keys

    2. **Navigation logic** (reuse accordion pattern):
       - Build `enabledPanels` array: `this.panels.filter(p => !p.disabled)`
       - Find current focused index via `enabledPanels.findIndex(p => p.value === this._focusedValue)` where `_focusedValue` is a new private field tracking which tab has focus (distinct from `value` which tracks the ACTIVE tab — these differ in manual mode)
       - Forward arrow: `nextIndex = (currentIndex + 1) % enabledPanels.length` (wrapping)
       - Backward arrow: `nextIndex = (currentIndex - 1 + enabledPanels.length) % enabledPanels.length` (wrapping)
       - Home: `nextIndex = 0`
       - End: `nextIndex = enabledPanels.length - 1`

    3. **Activation mode branching**:
       - **Automatic** (default): Arrow keys move focus AND activate tab. After computing nextIndex:
         - Set `this.value = enabledPanels[nextIndex].value`
         - Call `syncPanelStates()`
         - Dispatch `ui-change` event
         - Update `_focusedValue` and focus the tab button
       - **Manual**: Arrow keys only move focus. After computing nextIndex:
         - Update `_focusedValue` and roving tabindex
         - Focus the tab button (do NOT change `this.value`)
         - Enter/Space: activate the currently focused tab (`_focusedValue`):
           - Set `this.value = this._focusedValue`
           - Call `syncPanelStates()`
           - Dispatch `ui-change` event

    4. **Focus management** — `focusTabButton(panelValue: string)`:
       - Query shadowRoot for button with matching ID: `this.shadowRoot?.querySelector(\`#${this.tabsId}-tab-${panelValue}\`)`
       - Call `.focus()` on it

    5. **Roving tabindex** — `updateRovingTabindex()`:
       - In automatic mode, the active tab (`this.value`) has tabindex=0, all others -1
       - In manual mode, the focused tab (`this._focusedValue`) has tabindex=0, all others -1
       - This is handled in render() via a `getTabIndex(panel)` method that returns `'0'` or `'-1'`
       - When `_focusedValue` is unset (initial state), default to `this.value`

    6. **`_focusedValue` initialization**: In `handleSlotChange` and when `value` changes (in automatic mode), sync `_focusedValue = this.value`

    7. **Disabled tab handling**:
       - Container-level `disabled` property disables all tabs (already from Plan 01)
       - Individual panel `disabled` property: tab button gets `aria-disabled="true"`, cursor:not-allowed, opacity, and is SKIPPED in keyboard navigation (the `enabledPanels` filter handles this)
       - Clicking a disabled tab is a no-op (already from Plan 01)

    **tabs.ts — ARIA enhancements**:
    - tablist div: `role="tablist"`, `aria-orientation="${this.orientation}"`, `aria-label="${this.label || nothing}"`
    - Tab buttons: `role="tab"`, `aria-selected`, `aria-controls`, `aria-disabled` (already from Plan 01 render)
    - Panel ARIA: In `syncPanelStates()`, also set on each panel host element:
      - `panel.setAttribute('role', 'tabpanel')` (move from tab-panel.ts connectedCallback to container for consistency)
      - `panel.id = \`${this.tabsId}-panel-${panel.value}\``
      - `panel.setAttribute('aria-labelledby', \`${this.tabsId}-tab-${panel.value}\`)`
      - Active panel: `panel.setAttribute('tabindex', '0')` (so Tab from tablist reaches panel)
      - Inactive panel: `panel.removeAttribute('tabindex')`

    **tab-panel.ts updates**:
    - Remove the `role="tabpanel"` setting from connectedCallback if it was added in Plan 01 (container now handles all ARIA on host)
    - The active panel should be focusable via tabindex (container sets this)
    - Add `data-state` attribute: in `updated()`, when `active` changes, set `this.setAttribute('data-state', this.active ? 'active' : 'inactive')` with `isServer` guard (matches accordion-item pattern)

    **Updated render() in tabs.ts** — The tablist div should include `@keydown=${this.handleKeyDown}`:
    ```
    <div
      role="tablist"
      aria-orientation="${this.orientation}"
      aria-label="${this.label || nothing}"
      class="tablist"
      @keydown=${this.handleKeyDown}
    >
    ```

    After changes, run `cd packages/tabs && pnpm build` to verify compilation.
  </action>
  <verify>
    - `cd packages/tabs && pnpm build` succeeds
    - `grep "handleKeyDown" packages/tabs/src/tabs.ts` returns match
    - `grep "activationMode" packages/tabs/src/tabs.ts` returns match
    - `grep "ArrowRight\|ArrowLeft\|ArrowUp\|ArrowDown" packages/tabs/src/tabs.ts` returns matches
    - `grep "Home\|End" packages/tabs/src/tabs.ts` returns match
    - `grep "Enter\|' '" packages/tabs/src/tabs.ts` returns match (Space key)
    - `grep "aria-orientation" packages/tabs/src/tabs.ts` returns match
    - `grep "data-state" packages/tabs/src/tab-panel.ts` returns match
    - `grep "tabindex" packages/tabs/src/tabs.ts` returns matches (roving tabindex)
  </verify>
  <done>
    Keyboard navigation works with wrapping, Home/End. Automatic mode activates on arrow. Manual mode moves focus only, Enter/Space activates. Horizontal uses Left/Right, vertical uses Up/Down. Disabled tabs skipped. ARIA roles and states correct. Active panel receives tabindex="0" for Tab key focus. data-state attribute reflects active/inactive.
  </done>
</task>

<task type="auto">
  <name>Task 2: CSS custom properties and dark mode theming</name>
  <files>
    packages/tabs/src/tabs.ts
    packages/core/src/styles/tailwind.css
  </files>
  <action>
    Add CSS custom property tokens for tabs theming and update component styles to consume them.

    **packages/core/src/styles/tailwind.css** — Add tabs tokens in TWO places:

    1. **:root block** — Insert BEFORE the closing `}` of the `:root` block (after the Accordion Component section, before the `/* GLOBAL UTILITIES */` comment). Use the exact same section format as accordion:

    ```css
    /* -------------------------------------------------------------------------
     * Tabs Component
     * ------------------------------------------------------------------------- */

    /* Layout */
    --ui-tabs-border: var(--color-border, var(--ui-color-border));

    /* Tab list */
    --ui-tabs-list-bg: var(--color-muted, var(--ui-color-muted));
    --ui-tabs-list-padding: 0.25rem;
    --ui-tabs-list-radius: 0.375rem;
    --ui-tabs-list-gap: 0.25rem;

    /* Tab button */
    --ui-tabs-tab-padding: 0.5rem 1rem;
    --ui-tabs-tab-radius: 0.25rem;
    --ui-tabs-tab-font-size: 0.875rem;
    --ui-tabs-tab-font-weight: 500;
    --ui-tabs-tab-text: var(--color-muted-foreground, var(--ui-color-muted-foreground));
    --ui-tabs-tab-bg: transparent;
    --ui-tabs-tab-hover-text: var(--color-foreground, var(--ui-color-foreground));
    --ui-tabs-tab-hover-bg: transparent;

    /* Active tab */
    --ui-tabs-tab-active-text: var(--color-foreground, var(--ui-color-foreground));
    --ui-tabs-tab-active-bg: var(--color-background, white);
    --ui-tabs-tab-active-shadow: 0 1px 2px 0 rgb(0 0 0 / 0.05);

    /* Panel */
    --ui-tabs-panel-padding: 1rem 0;
    --ui-tabs-panel-text: var(--color-foreground, var(--ui-color-foreground));

    /* Focus */
    --ui-tabs-ring: var(--color-ring, var(--ui-color-ring));

    /* Transition */
    --ui-tabs-transition: 150ms;
    ```

    2. **.dark block** — Insert after the `/* Accordion dark mode */` section, before the closing `}`:

    ```css
    /* Tabs dark mode */
    --ui-tabs-list-bg: var(--color-gray-800);
    --ui-tabs-tab-text: var(--color-gray-400);
    --ui-tabs-tab-hover-text: var(--color-gray-50);
    --ui-tabs-tab-active-text: var(--color-gray-50);
    --ui-tabs-tab-active-bg: var(--color-gray-900);
    --ui-tabs-panel-text: var(--color-gray-50);
    ```

    **packages/tabs/src/tabs.ts** — Replace minimal structural styles with full themed styles consuming the CSS custom properties:

    ```css
    :host {
      display: block;
    }

    :host([disabled]) {
      opacity: 0.5;
      pointer-events: none;
    }

    .tablist {
      display: inline-flex;
      align-items: center;
      gap: var(--ui-tabs-list-gap);
      padding: var(--ui-tabs-list-padding);
      background: var(--ui-tabs-list-bg);
      border-radius: var(--ui-tabs-list-radius);
    }

    :host([orientation="vertical"]) .tablist {
      flex-direction: column;
      align-items: stretch;
    }

    :host([orientation="vertical"]) .tabs-wrapper {
      display: flex;
      gap: 1rem;
    }

    .tab-button {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      white-space: nowrap;
      border: none;
      background: var(--ui-tabs-tab-bg);
      color: var(--ui-tabs-tab-text);
      font-family: inherit;
      font-size: var(--ui-tabs-tab-font-size);
      font-weight: var(--ui-tabs-tab-font-weight);
      padding: var(--ui-tabs-tab-padding);
      border-radius: var(--ui-tabs-tab-radius);
      cursor: pointer;
      transition: color var(--ui-tabs-transition), background var(--ui-tabs-transition), box-shadow var(--ui-tabs-transition);
    }

    .tab-button:hover:not([aria-disabled="true"]) {
      color: var(--ui-tabs-tab-hover-text);
      background: var(--ui-tabs-tab-hover-bg);
    }

    .tab-button.tab-active {
      color: var(--ui-tabs-tab-active-text);
      background: var(--ui-tabs-tab-active-bg);
      box-shadow: var(--ui-tabs-tab-active-shadow);
    }

    .tab-button[aria-disabled="true"] {
      cursor: not-allowed;
      opacity: 0.5;
    }

    .tab-button:focus-visible {
      outline: none;
      box-shadow: 0 0 0 2px var(--ui-tabs-ring);
    }

    .tab-button.tab-active:focus-visible {
      box-shadow: var(--ui-tabs-tab-active-shadow), 0 0 0 2px var(--ui-tabs-ring);
    }

    .panels-container {
      padding: var(--ui-tabs-panel-padding);
      color: var(--ui-tabs-panel-text);
    }

    @media (prefers-reduced-motion: reduce) {
      .tab-button {
        transition-duration: 0ms;
      }
    }
    ```

    Also add `reflect: true` to the `orientation` property so the `:host([orientation="vertical"])` CSS selector works.

    After changes, run `cd packages/tabs && pnpm build` to verify compilation.
  </action>
  <verify>
    - `cd packages/tabs && pnpm build` succeeds
    - `grep "\-\-ui-tabs-" packages/core/src/styles/tailwind.css | wc -l` returns at least 15 (tokens in :root + .dark)
    - `grep "\-\-ui-tabs-" packages/tabs/src/tabs.ts | wc -l` returns at least 10 (styles consuming tokens)
    - `grep "orientation.*vertical" packages/tabs/src/tabs.ts` returns match (vertical layout)
    - `grep "prefers-reduced-motion" packages/tabs/src/tabs.ts` returns match
    - `grep "Tabs dark mode" packages/core/src/styles/tailwind.css` returns match
  </verify>
  <done>
    Tabs consume --ui-tabs-* CSS custom properties for all visual styling. Dark mode overrides exist in .dark block. Vertical orientation renders as flex column with side-by-side layout. Reduced motion respected. Active tab has distinct visual treatment (background, shadow, text color). Disabled tabs show reduced opacity with not-allowed cursor.
  </done>
</task>

</tasks>

<verification>
1. Build succeeds: `cd packages/tabs && pnpm build`
2. Keyboard navigation: handleKeyDown processes ArrowLeft/Right (horizontal), ArrowUp/Down (vertical), Home, End
3. Activation modes: automatic activates on arrow, manual activates on Enter/Space
4. Wrapping: last->first and first->last navigation works
5. Disabled tabs: skipped in keyboard nav, shown with reduced opacity
6. ARIA: tablist, tab, tabpanel roles; aria-selected, aria-controls, aria-labelledby, aria-orientation
7. Panel focusability: active panel has tabindex="0"
8. CSS tokens: --ui-tabs-* defined in :root, dark overrides in .dark
9. Vertical orientation: flex-direction column, Up/Down arrow keys
10. data-state on panels: "active"/"inactive"
</verification>

<success_criteria>
- Arrow keys navigate between tabs with wrapping; Home/End jump to first/last
- Automatic mode: arrow keys activate tab immediately
- Manual mode: arrow keys move focus, Enter/Space activates
- Horizontal tabs use Left/Right; vertical tabs use Up/Down
- Disabled tabs are visually muted and skipped in keyboard navigation
- ARIA roles and states are correctly set on tablist, tabs, and panels
- Active panel receives tabindex="0" for keyboard access
- All visual properties use --ui-tabs-* CSS custom properties
- Dark mode has distinct overrides
- Package builds without errors
</success_criteria>

<output>
After completion, create `.planning/phases/58-tabs-core/58-02-SUMMARY.md`
</output>
