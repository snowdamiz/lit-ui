---
/**
 * Astro SSR Example with Lit Components
 *
 * This page demonstrates how to use @lit-ui components in Astro with
 * server-side rendering and client-side hydration.
 *
 * For self-registering custom elements (@lit-ui components):
 * - Import components in frontmatter for SSR registration
 * - Use custom element tags directly in HTML
 * - Import in script tag for client-side hydration
 *
 * The components are server-rendered with Declarative Shadow DOM,
 * then hydrated on the client when the script loads.
 */
import Layout from '../layouts/Layout.astro';

// Import component modules to register custom elements for SSR
import '@lit-ui/button';
import '@lit-ui/dialog';
---

<Layout title="Astro + Lit SSR Example">
  <h1>Astro SSR with Lit Components</h1>

  <section>
    <h2>Button Component</h2>
    <p>Click the button to see hydration working:</p>

    <!--
      The lui-button is server-rendered with Declarative Shadow DOM.
      After hydration via the script tag below, click handlers work.
    -->
    <lui-button variant="primary" id="demo-button">
      Click Me
    </lui-button>

    <p id="button-status" style="margin-top: 1rem; color: #666;">
      Button not clicked yet
    </p>
  </section>

  <section>
    <h2>Dialog Component</h2>
    <p>Open the dialog to see SSR + hydration in action:</p>

    <lui-button variant="secondary" id="open-dialog">
      Open Dialog
    </lui-button>

    <!--
      The dialog is SSR'd with its content. After hydration,
      showModal() and close() work as expected.
    -->
    <lui-dialog id="demo-dialog">
      <span slot="header">Hello from SSR</span>
      <p>This dialog was server-rendered and hydrated on the client.</p>
      <p>The content was visible in the initial HTML response.</p>
      <div slot="footer">
        <lui-button variant="secondary" id="close-dialog">Close</lui-button>
      </div>
    </lui-dialog>
  </section>

  <section>
    <h2>Theming Example</h2>
    <p>CSS custom properties work with SSR:</p>

    <!--
      Override a CSS custom property to demonstrate theming.
      The style is included in SSR output.
    -->
    <lui-button variant="primary" style="--ui-button-radius: 999px;">
      Rounded Button
    </lui-button>
  </section>
</Layout>

<!--
  Client-side script for hydration and interactivity.

  CRITICAL: @lit-ui/ssr/hydration MUST be the FIRST import.
  This patches LitElement before any component classes load,
  enabling proper hydration of server-rendered Declarative Shadow DOM.

  Unlike Next.js/Node.js where hydration import goes in a single entry file,
  Astro's script tags are bundled per-page, so the hydration import goes here.
-->
<script>
  // FIRST: Import hydration support (patches LitElement)
  import '@lit-ui/ssr/hydration';

  // THEN: Import component modules for client-side hydration
  import '@lit-ui/button';
  import '@lit-ui/dialog';

  // Button click handler
  const button = document.getElementById('demo-button');
  const status = document.getElementById('button-status');
  let clickCount = 0;

  button?.addEventListener('click', () => {
    clickCount++;
    if (status) {
      status.textContent = `Button clicked ${clickCount} time${clickCount === 1 ? '' : 's'}`;
      status.style.color = '#2563eb';
    }
  });

  // Dialog open/close handlers
  const openButton = document.getElementById('open-dialog');
  const closeButton = document.getElementById('close-dialog');
  const dialog = document.getElementById('demo-dialog') as HTMLDialogElement | null;

  openButton?.addEventListener('click', () => {
    dialog?.showModal?.();
  });

  closeButton?.addEventListener('click', () => {
    dialog?.close?.();
  });
</script>
